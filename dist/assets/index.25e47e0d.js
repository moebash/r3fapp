(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function a2(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Je={exports:{}},wt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var CC=Symbol.for("react.element"),UV=Symbol.for("react.portal"),DV=Symbol.for("react.fragment"),PV=Symbol.for("react.strict_mode"),QV=Symbol.for("react.profiler"),OV=Symbol.for("react.provider"),jV=Symbol.for("react.context"),qV=Symbol.for("react.forward_ref"),$V=Symbol.for("react.suspense"),e1=Symbol.for("react.memo"),t1=Symbol.for("react.lazy"),Ry=Symbol.iterator;function n1(i){return i===null||typeof i!="object"?null:(i=Ry&&i[Ry]||i["@@iterator"],typeof i=="function"?i:null)}var l2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I2=Object.assign,c2={};function ql(i,e,t){this.props=i,this.context=e,this.refs=c2,this.updater=t||l2}ql.prototype.isReactComponent={};ql.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};ql.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function C2(){}C2.prototype=ql.prototype;function w0(i,e,t){this.props=i,this.context=e,this.refs=c2,this.updater=t||l2}var W0=w0.prototype=new C2;W0.constructor=w0;I2(W0,ql.prototype);W0.isPureReactComponent=!0;var Vy=Array.isArray,u2=Object.prototype.hasOwnProperty,S0={current:null},d2={key:!0,ref:!0,__self:!0,__source:!0};function A2(i,e,t){var n,s={},o=null,r=null;if(e!=null)for(n in e.ref!==void 0&&(r=e.ref),e.key!==void 0&&(o=""+e.key),e)u2.call(e,n)&&!d2.hasOwnProperty(n)&&(s[n]=e[n]);var g=arguments.length-2;if(g===1)s.children=t;else if(1<g){for(var a=Array(g),l=0;l<g;l++)a[l]=arguments[l+2];s.children=a}if(i&&i.defaultProps)for(n in g=i.defaultProps,g)s[n]===void 0&&(s[n]=g[n]);return{$$typeof:CC,type:i,key:o,ref:r,props:s,_owner:S0.current}}function i1(i,e){return{$$typeof:CC,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function R0(i){return typeof i=="object"&&i!==null&&i.$$typeof===CC}function s1(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var xy=/\/+/g;function up(i,e){return typeof i=="object"&&i!==null&&i.key!=null?s1(""+i.key):e.toString(36)}function Hd(i,e,t,n,s){var o=typeof i;(o==="undefined"||o==="boolean")&&(i=null);var r=!1;if(i===null)r=!0;else switch(o){case"string":case"number":r=!0;break;case"object":switch(i.$$typeof){case CC:case UV:r=!0}}if(r)return r=i,s=s(r),i=n===""?"."+up(r,0):n,Vy(s)?(t="",i!=null&&(t=i.replace(xy,"$&/")+"/"),Hd(s,e,t,"",function(l){return l})):s!=null&&(R0(s)&&(s=i1(s,t+(!s.key||r&&r.key===s.key?"":(""+s.key).replace(xy,"$&/")+"/")+i)),e.push(s)),1;if(r=0,n=n===""?".":n+":",Vy(i))for(var g=0;g<i.length;g++){o=i[g];var a=n+up(o,g);r+=Hd(o,e,t,a,s)}else if(a=n1(i),typeof a=="function")for(i=a.call(i),g=0;!(o=i.next()).done;)o=o.value,a=n+up(o,g++),r+=Hd(o,e,t,a,s);else if(o==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return r}function fu(i,e,t){if(i==null)return i;var n=[],s=0;return Hd(i,n,"","",function(o){return e.call(t,o,s++)}),n}function o1(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var xi={current:null},Fd={transition:null},r1={ReactCurrentDispatcher:xi,ReactCurrentBatchConfig:Fd,ReactCurrentOwner:S0};wt.Children={map:fu,forEach:function(i,e,t){fu(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return fu(i,function(){e++}),e},toArray:function(i){return fu(i,function(e){return e})||[]},only:function(i){if(!R0(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};wt.Component=ql;wt.Fragment=DV;wt.Profiler=QV;wt.PureComponent=w0;wt.StrictMode=PV;wt.Suspense=$V;wt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=r1;wt.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=I2({},i.props),s=i.key,o=i.ref,r=i._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,r=S0.current),e.key!==void 0&&(s=""+e.key),i.type&&i.type.defaultProps)var g=i.type.defaultProps;for(a in e)u2.call(e,a)&&!d2.hasOwnProperty(a)&&(n[a]=e[a]===void 0&&g!==void 0?g[a]:e[a])}var a=arguments.length-2;if(a===1)n.children=t;else if(1<a){g=Array(a);for(var l=0;l<a;l++)g[l]=arguments[l+2];n.children=g}return{$$typeof:CC,type:i.type,key:s,ref:o,props:n,_owner:r}};wt.createContext=function(i){return i={$$typeof:jV,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:OV,_context:i},i.Consumer=i};wt.createElement=A2;wt.createFactory=function(i){var e=A2.bind(null,i);return e.type=i,e};wt.createRef=function(){return{current:null}};wt.forwardRef=function(i){return{$$typeof:qV,render:i}};wt.isValidElement=R0;wt.lazy=function(i){return{$$typeof:t1,_payload:{_status:-1,_result:i},_init:o1}};wt.memo=function(i,e){return{$$typeof:e1,type:i,compare:e===void 0?null:e}};wt.startTransition=function(i){var e=Fd.transition;Fd.transition={};try{i()}finally{Fd.transition=e}};wt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};wt.useCallback=function(i,e){return xi.current.useCallback(i,e)};wt.useContext=function(i){return xi.current.useContext(i)};wt.useDebugValue=function(){};wt.useDeferredValue=function(i){return xi.current.useDeferredValue(i)};wt.useEffect=function(i,e){return xi.current.useEffect(i,e)};wt.useId=function(){return xi.current.useId()};wt.useImperativeHandle=function(i,e,t){return xi.current.useImperativeHandle(i,e,t)};wt.useInsertionEffect=function(i,e){return xi.current.useInsertionEffect(i,e)};wt.useLayoutEffect=function(i,e){return xi.current.useLayoutEffect(i,e)};wt.useMemo=function(i,e){return xi.current.useMemo(i,e)};wt.useReducer=function(i,e,t){return xi.current.useReducer(i,e,t)};wt.useRef=function(i){return xi.current.useRef(i)};wt.useState=function(i){return xi.current.useState(i)};wt.useSyncExternalStore=function(i,e,t){return xi.current.useSyncExternalStore(i,e,t)};wt.useTransition=function(){return xi.current.useTransition()};wt.version="18.2.0";(function(i){i.exports=wt})(Je);var h2={exports:{}},ss={},p2={exports:{}},m2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(k,F){var z=k.length;k.push(F);e:for(;0<z;){var X=z-1>>>1,T=k[X];if(0<s(T,F))k[X]=F,k[z]=T,z=X;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var F=k[0],z=k.pop();if(z!==F){k[0]=z;e:for(var X=0,T=k.length,Q=T>>>1;X<Q;){var ee=2*(X+1)-1,oe=k[ee],j=ee+1,ge=k[j];if(0>s(oe,z))j<T&&0>s(ge,oe)?(k[X]=ge,k[j]=z,X=j):(k[X]=oe,k[ee]=z,X=ee);else if(j<T&&0>s(ge,z))k[X]=ge,k[j]=z,X=j;else break e}}return F}function s(k,F){var z=k.sortIndex-F.sortIndex;return z!==0?z:k.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var r=Date,g=r.now();i.unstable_now=function(){return r.now()-g}}var a=[],l=[],I=1,C=null,u=3,A=!1,h=!1,m=!1,b=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(k){for(var F=t(l);F!==null;){if(F.callback===null)n(l);else if(F.startTime<=k)n(l),F.sortIndex=F.expirationTime,e(a,F);else break;F=t(l)}}function B(k){if(m=!1,y(k),!h)if(t(a)!==null)h=!0,q(v);else{var F=t(l);F!==null&&ne(B,F.startTime-k)}}function v(k,F){h=!1,m&&(m=!1,G(Z),Z=-1),A=!0;var z=u;try{for(y(F),C=t(a);C!==null&&(!(C.expirationTime>F)||k&&!P());){var X=C.callback;if(typeof X=="function"){C.callback=null,u=C.priorityLevel;var T=X(C.expirationTime<=F);F=i.unstable_now(),typeof T=="function"?C.callback=T:C===t(a)&&n(a),y(F)}else n(a);C=t(a)}if(C!==null)var Q=!0;else{var ee=t(l);ee!==null&&ne(B,ee.startTime-F),Q=!1}return Q}finally{C=null,u=z,A=!1}}var W=!1,R=null,Z=-1,V=5,H=-1;function P(){return!(i.unstable_now()-H<V)}function E(){if(R!==null){var k=i.unstable_now();H=k;var F=!0;try{F=R(!0,k)}finally{F?L():(W=!1,R=null)}}else W=!1}var L;if(typeof f=="function")L=function(){f(E)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,O=K.port2;K.port1.onmessage=E,L=function(){O.postMessage(null)}}else L=function(){b(E,0)};function q(k){R=k,W||(W=!0,L())}function ne(k,F){Z=b(function(){k(i.unstable_now())},F)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(k){k.callback=null},i.unstable_continueExecution=function(){h||A||(h=!0,q(v))},i.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<k?Math.floor(1e3/k):5},i.unstable_getCurrentPriorityLevel=function(){return u},i.unstable_getFirstCallbackNode=function(){return t(a)},i.unstable_next=function(k){switch(u){case 1:case 2:case 3:var F=3;break;default:F=u}var z=u;u=F;try{return k()}finally{u=z}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(k,F){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var z=u;u=k;try{return F()}finally{u=z}},i.unstable_scheduleCallback=function(k,F,z){var X=i.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?X+z:X):z=X,k){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=z+T,k={id:I++,callback:F,priorityLevel:k,startTime:z,expirationTime:T,sortIndex:-1},z>X?(k.sortIndex=z,e(l,k),t(a)===null&&k===t(l)&&(m?(G(Z),Z=-1):m=!0,ne(B,z-X))):(k.sortIndex=T,e(a,k),h||A||(h=!0,q(v))),k},i.unstable_shouldYield=P,i.unstable_wrapCallback=function(k){var F=u;return function(){var z=u;u=F;try{return k.apply(this,arguments)}finally{u=z}}}})(m2);(function(i){i.exports=m2})(p2);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f2=Je.exports,ns=p2.exports;function Me(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b2=new Set,Yc={};function Wa(i,e){Nl(i,e),Nl(i+"Capture",e)}function Nl(i,e){for(Yc[i]=e,i=0;i<e.length;i++)b2.add(e[i])}var nr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fm=Object.prototype.hasOwnProperty,g1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xy={},Yy={};function a1(i){return Fm.call(Yy,i)?!0:Fm.call(Xy,i)?!1:g1.test(i)?Yy[i]=!0:(Xy[i]=!0,!1)}function l1(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function I1(i,e,t,n){if(e===null||typeof e>"u"||l1(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xi(i,e,t,n,s,o,r){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=o,this.removeEmptyString=r}var ri={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ri[i]=new Xi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];ri[e]=new Xi(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ri[i]=new Xi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ri[i]=new Xi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ri[i]=new Xi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ri[i]=new Xi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ri[i]=new Xi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ri[i]=new Xi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ri[i]=new Xi(i,5,!1,i.toLowerCase(),null,!1,!1)});var V0=/[\-:]([a-z])/g;function x0(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(V0,x0);ri[e]=new Xi(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(V0,x0);ri[e]=new Xi(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(V0,x0);ri[e]=new Xi(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ri[i]=new Xi(i,1,!1,i.toLowerCase(),null,!1,!1)});ri.xlinkHref=new Xi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ri[i]=new Xi(i,1,!1,i.toLowerCase(),null,!0,!0)});function X0(i,e,t,n){var s=ri.hasOwnProperty(e)?ri[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(I1(e,t,s,n)&&(t=null),n||s===null?a1(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):s.mustUseProperty?i[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?i.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var cr=f2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,bu=Symbol.for("react.element"),cl=Symbol.for("react.portal"),Cl=Symbol.for("react.fragment"),Y0=Symbol.for("react.strict_mode"),Km=Symbol.for("react.profiler"),G2=Symbol.for("react.provider"),y2=Symbol.for("react.context"),H0=Symbol.for("react.forward_ref"),Nm=Symbol.for("react.suspense"),Mm=Symbol.for("react.suspense_list"),F0=Symbol.for("react.memo"),Jr=Symbol.for("react.lazy"),B2=Symbol.for("react.offscreen"),Hy=Symbol.iterator;function TI(i){return i===null||typeof i!="object"?null:(i=Hy&&i[Hy]||i["@@iterator"],typeof i=="function"?i:null)}var cn=Object.assign,dp;function Cc(i){if(dp===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);dp=e&&e[1]||""}return`
`+dp+i}var Ap=!1;function hp(i,e){if(!i||Ap)return"";Ap=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var n=l}Reflect.construct(i,[],e)}else{try{e.call()}catch(l){n=l}i.call(e.prototype)}else{try{throw Error()}catch(l){n=l}i()}}catch(l){if(l&&n&&typeof l.stack=="string"){for(var s=l.stack.split(`
`),o=n.stack.split(`
`),r=s.length-1,g=o.length-1;1<=r&&0<=g&&s[r]!==o[g];)g--;for(;1<=r&&0<=g;r--,g--)if(s[r]!==o[g]){if(r!==1||g!==1)do if(r--,g--,0>g||s[r]!==o[g]){var a=`
`+s[r].replace(" at new "," at ");return i.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",i.displayName)),a}while(1<=r&&0<=g);break}}}finally{Ap=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?Cc(i):""}function c1(i){switch(i.tag){case 5:return Cc(i.type);case 16:return Cc("Lazy");case 13:return Cc("Suspense");case 19:return Cc("SuspenseList");case 0:case 2:case 15:return i=hp(i.type,!1),i;case 11:return i=hp(i.type.render,!1),i;case 1:return i=hp(i.type,!0),i;default:return""}}function Lm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Cl:return"Fragment";case cl:return"Portal";case Km:return"Profiler";case Y0:return"StrictMode";case Nm:return"Suspense";case Mm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case y2:return(i.displayName||"Context")+".Consumer";case G2:return(i._context.displayName||"Context")+".Provider";case H0:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case F0:return e=i.displayName||null,e!==null?e:Lm(i.type)||"Memo";case Jr:e=i._payload,i=i._init;try{return Lm(i(e))}catch{}}return null}function C1(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lm(e);case 8:return e===Y0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ag(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function v2(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function u1(i){var e=v2(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,o=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(r){n=""+r,o.call(this,r)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(r){n=""+r},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function Gu(i){i._valueTracker||(i._valueTracker=u1(i))}function Z2(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=v2(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function oA(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function zm(i,e){var t=e.checked;return cn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t!=null?t:i._wrapperState.initialChecked})}function Fy(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Ag(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function w2(i,e){e=e.checked,e!=null&&X0(i,"checked",e,!1)}function km(i,e){w2(i,e);var t=Ag(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?Tm(i,e.type,t):e.hasOwnProperty("defaultValue")&&Tm(i,e.type,Ag(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function Ky(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function Tm(i,e,t){(e!=="number"||oA(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var uc=Array.isArray;function Sl(i,e,t,n){if(i=i.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<i.length;t++)s=e.hasOwnProperty("$"+i[t].value),i[t].selected!==s&&(i[t].selected=s),s&&n&&(i[t].defaultSelected=!0)}else{for(t=""+Ag(t),e=null,s=0;s<i.length;s++){if(i[s].value===t){i[s].selected=!0,n&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function Em(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Me(91));return cn({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ny(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Me(92));if(uc(t)){if(1<t.length)throw Error(Me(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:Ag(t)}}function W2(i,e){var t=Ag(e.value),n=Ag(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function My(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function S2(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _m(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?S2(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var yu,R2=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,s)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(yu=yu||document.createElement("div"),yu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yu.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function Hc(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var mc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},d1=["Webkit","ms","Moz","O"];Object.keys(mc).forEach(function(i){d1.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),mc[e]=mc[i]})});function V2(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||mc.hasOwnProperty(i)&&mc[i]?(""+e).trim():e+"px"}function x2(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=V2(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,s):i[t]=s}}var A1=cn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jm(i,e){if(e){if(A1[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Me(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Me(62))}}function Um(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dm=null;function K0(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Pm=null,Rl=null,Vl=null;function Ly(i){if(i=AC(i)){if(typeof Pm!="function")throw Error(Me(280));var e=i.stateNode;e&&(e=MA(e),Pm(i.stateNode,i.type,e))}}function X2(i){Rl?Vl?Vl.push(i):Vl=[i]:Rl=i}function Y2(){if(Rl){var i=Rl,e=Vl;if(Vl=Rl=null,Ly(i),e)for(i=0;i<e.length;i++)Ly(e[i])}}function H2(i,e){return i(e)}function F2(){}var pp=!1;function K2(i,e,t){if(pp)return i(e,t);pp=!0;try{return H2(i,e,t)}finally{pp=!1,(Rl!==null||Vl!==null)&&(F2(),Y2())}}function Fc(i,e){var t=i.stateNode;if(t===null)return null;var n=MA(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(Me(231,e,typeof t));return t}var Qm=!1;if(nr)try{var EI={};Object.defineProperty(EI,"passive",{get:function(){Qm=!0}}),window.addEventListener("test",EI,EI),window.removeEventListener("test",EI,EI)}catch{Qm=!1}function h1(i,e,t,n,s,o,r,g,a){var l=Array.prototype.slice.call(arguments,3);try{e.apply(t,l)}catch(I){this.onError(I)}}var fc=!1,rA=null,gA=!1,Om=null,p1={onError:function(i){fc=!0,rA=i}};function m1(i,e,t,n,s,o,r,g,a){fc=!1,rA=null,h1.apply(p1,arguments)}function f1(i,e,t,n,s,o,r,g,a){if(m1.apply(this,arguments),fc){if(fc){var l=rA;fc=!1,rA=null}else throw Error(Me(198));gA||(gA=!0,Om=l)}}function Sa(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,(e.flags&4098)!==0&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function N2(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function zy(i){if(Sa(i)!==i)throw Error(Me(188))}function b1(i){var e=i.alternate;if(!e){if(e=Sa(i),e===null)throw Error(Me(188));return e!==i?null:i}for(var t=i,n=e;;){var s=t.return;if(s===null)break;var o=s.alternate;if(o===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===t)return zy(s),i;if(o===n)return zy(s),e;o=o.sibling}throw Error(Me(188))}if(t.return!==n.return)t=s,n=o;else{for(var r=!1,g=s.child;g;){if(g===t){r=!0,t=s,n=o;break}if(g===n){r=!0,n=s,t=o;break}g=g.sibling}if(!r){for(g=o.child;g;){if(g===t){r=!0,t=o,n=s;break}if(g===n){r=!0,n=o,t=s;break}g=g.sibling}if(!r)throw Error(Me(189))}}if(t.alternate!==n)throw Error(Me(190))}if(t.tag!==3)throw Error(Me(188));return t.stateNode.current===t?i:e}function M2(i){return i=b1(i),i!==null?L2(i):null}function L2(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=L2(i);if(e!==null)return e;i=i.sibling}return null}var z2=ns.unstable_scheduleCallback,ky=ns.unstable_cancelCallback,G1=ns.unstable_shouldYield,y1=ns.unstable_requestPaint,Wn=ns.unstable_now,B1=ns.unstable_getCurrentPriorityLevel,N0=ns.unstable_ImmediatePriority,k2=ns.unstable_UserBlockingPriority,aA=ns.unstable_NormalPriority,v1=ns.unstable_LowPriority,T2=ns.unstable_IdlePriority,HA=null,Ao=null;function Z1(i){if(Ao&&typeof Ao.onCommitFiberRoot=="function")try{Ao.onCommitFiberRoot(HA,i,void 0,(i.current.flags&128)===128)}catch{}}var _s=Math.clz32?Math.clz32:S1,w1=Math.log,W1=Math.LN2;function S1(i){return i>>>=0,i===0?32:31-(w1(i)/W1|0)|0}var Bu=64,vu=4194304;function dc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function lA(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,s=i.suspendedLanes,o=i.pingedLanes,r=t&268435455;if(r!==0){var g=r&~s;g!==0?n=dc(g):(o&=r,o!==0&&(n=dc(o)))}else r=t&~s,r!==0?n=dc(r):o!==0&&(n=dc(o));if(n===0)return 0;if(e!==0&&e!==n&&(e&s)===0&&(s=n&-n,o=e&-e,s>=o||s===16&&(o&4194240)!==0))return e;if((n&4)!==0&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-_s(e),s=1<<t,n|=i[t],e&=~s;return n}function R1(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function V1(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,s=i.expirationTimes,o=i.pendingLanes;0<o;){var r=31-_s(o),g=1<<r,a=s[r];a===-1?((g&t)===0||(g&n)!==0)&&(s[r]=R1(g,e)):a<=e&&(i.expiredLanes|=g),o&=~g}}function jm(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function E2(){var i=Bu;return Bu<<=1,(Bu&4194240)===0&&(Bu=64),i}function mp(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function uC(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-_s(e),i[e]=t}function x1(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var s=31-_s(t),o=1<<s;e[s]=0,n[s]=-1,i[s]=-1,t&=~o}}function M0(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-_s(t),s=1<<n;s&e|i[n]&e&&(i[n]|=e),t&=~s}}var Jt=0;function _2(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var J2,L0,U2,D2,P2,qm=!1,Zu=[],og=null,rg=null,gg=null,Kc=new Map,Nc=new Map,Pr=[],X1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ty(i,e){switch(i){case"focusin":case"focusout":og=null;break;case"dragenter":case"dragleave":rg=null;break;case"mouseover":case"mouseout":gg=null;break;case"pointerover":case"pointerout":Kc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nc.delete(e.pointerId)}}function _I(i,e,t,n,s,o){return i===null||i.nativeEvent!==o?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:o,targetContainers:[s]},e!==null&&(e=AC(e),e!==null&&L0(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function Y1(i,e,t,n,s){switch(e){case"focusin":return og=_I(og,i,e,t,n,s),!0;case"dragenter":return rg=_I(rg,i,e,t,n,s),!0;case"mouseover":return gg=_I(gg,i,e,t,n,s),!0;case"pointerover":var o=s.pointerId;return Kc.set(o,_I(Kc.get(o)||null,i,e,t,n,s)),!0;case"gotpointercapture":return o=s.pointerId,Nc.set(o,_I(Nc.get(o)||null,i,e,t,n,s)),!0}return!1}function Q2(i){var e=na(i.target);if(e!==null){var t=Sa(e);if(t!==null){if(e=t.tag,e===13){if(e=N2(t),e!==null){i.blockedOn=e,P2(i.priority,function(){U2(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Kd(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=$m(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);Dm=n,t.target.dispatchEvent(n),Dm=null}else return e=AC(t),e!==null&&L0(e),i.blockedOn=t,!1;e.shift()}return!0}function Ey(i,e,t){Kd(i)&&t.delete(e)}function H1(){qm=!1,og!==null&&Kd(og)&&(og=null),rg!==null&&Kd(rg)&&(rg=null),gg!==null&&Kd(gg)&&(gg=null),Kc.forEach(Ey),Nc.forEach(Ey)}function JI(i,e){i.blockedOn===e&&(i.blockedOn=null,qm||(qm=!0,ns.unstable_scheduleCallback(ns.unstable_NormalPriority,H1)))}function Mc(i){function e(s){return JI(s,i)}if(0<Zu.length){JI(Zu[0],i);for(var t=1;t<Zu.length;t++){var n=Zu[t];n.blockedOn===i&&(n.blockedOn=null)}}for(og!==null&&JI(og,i),rg!==null&&JI(rg,i),gg!==null&&JI(gg,i),Kc.forEach(e),Nc.forEach(e),t=0;t<Pr.length;t++)n=Pr[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<Pr.length&&(t=Pr[0],t.blockedOn===null);)Q2(t),t.blockedOn===null&&Pr.shift()}var xl=cr.ReactCurrentBatchConfig,IA=!0;function F1(i,e,t,n){var s=Jt,o=xl.transition;xl.transition=null;try{Jt=1,z0(i,e,t,n)}finally{Jt=s,xl.transition=o}}function K1(i,e,t,n){var s=Jt,o=xl.transition;xl.transition=null;try{Jt=4,z0(i,e,t,n)}finally{Jt=s,xl.transition=o}}function z0(i,e,t,n){if(IA){var s=$m(i,e,t,n);if(s===null)Sp(i,e,n,cA,t),Ty(i,n);else if(Y1(s,i,e,t,n))n.stopPropagation();else if(Ty(i,n),e&4&&-1<X1.indexOf(i)){for(;s!==null;){var o=AC(s);if(o!==null&&J2(o),o=$m(i,e,t,n),o===null&&Sp(i,e,n,cA,t),o===s)break;s=o}s!==null&&n.stopPropagation()}else Sp(i,e,n,null,t)}}var cA=null;function $m(i,e,t,n){if(cA=null,i=K0(n),i=na(i),i!==null)if(e=Sa(i),e===null)i=null;else if(t=e.tag,t===13){if(i=N2(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return cA=i,null}function O2(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(B1()){case N0:return 1;case k2:return 4;case aA:case v1:return 16;case T2:return 536870912;default:return 16}default:return 16}}var qr=null,k0=null,Nd=null;function j2(){if(Nd)return Nd;var i,e=k0,t=e.length,n,s="value"in qr?qr.value:qr.textContent,o=s.length;for(i=0;i<t&&e[i]===s[i];i++);var r=t-i;for(n=1;n<=r&&e[t-n]===s[o-n];n++);return Nd=s.slice(i,1<n?1-n:void 0)}function Md(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function wu(){return!0}function _y(){return!1}function os(i){function e(t,n,s,o,r){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=o,this.target=r,this.currentTarget=null;for(var g in i)i.hasOwnProperty(g)&&(t=i[g],this[g]=t?t(o):o[g]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?wu:_y,this.isPropagationStopped=_y,this}return cn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=wu)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=wu)},persist:function(){},isPersistent:wu}),e}var $l={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},T0=os($l),dC=cn({},$l,{view:0,detail:0}),N1=os(dC),fp,bp,UI,FA=cn({},dC,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:E0,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==UI&&(UI&&i.type==="mousemove"?(fp=i.screenX-UI.screenX,bp=i.screenY-UI.screenY):bp=fp=0,UI=i),fp)},movementY:function(i){return"movementY"in i?i.movementY:bp}}),Jy=os(FA),M1=cn({},FA,{dataTransfer:0}),L1=os(M1),z1=cn({},dC,{relatedTarget:0}),Gp=os(z1),k1=cn({},$l,{animationName:0,elapsedTime:0,pseudoElement:0}),T1=os(k1),E1=cn({},$l,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),_1=os(E1),J1=cn({},$l,{data:0}),Uy=os(J1),U1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},D1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},P1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Q1(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=P1[i])?!!e[i]:!1}function E0(){return Q1}var O1=cn({},dC,{key:function(i){if(i.key){var e=U1[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=Md(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?D1[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:E0,charCode:function(i){return i.type==="keypress"?Md(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Md(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),j1=os(O1),q1=cn({},FA,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dy=os(q1),$1=cn({},dC,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:E0}),ex=os($1),tx=cn({},$l,{propertyName:0,elapsedTime:0,pseudoElement:0}),nx=os(tx),ix=cn({},FA,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),sx=os(ix),ox=[9,13,27,32],_0=nr&&"CompositionEvent"in window,bc=null;nr&&"documentMode"in document&&(bc=document.documentMode);var rx=nr&&"TextEvent"in window&&!bc,q2=nr&&(!_0||bc&&8<bc&&11>=bc),Py=String.fromCharCode(32),Qy=!1;function $2(i,e){switch(i){case"keyup":return ox.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ew(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ul=!1;function gx(i,e){switch(i){case"compositionend":return ew(e);case"keypress":return e.which!==32?null:(Qy=!0,Py);case"textInput":return i=e.data,i===Py&&Qy?null:i;default:return null}}function ax(i,e){if(ul)return i==="compositionend"||!_0&&$2(i,e)?(i=j2(),Nd=k0=qr=null,ul=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return q2&&e.locale!=="ko"?null:e.data;default:return null}}var lx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Oy(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!lx[i.type]:e==="textarea"}function tw(i,e,t,n){X2(n),e=CA(e,"onChange"),0<e.length&&(t=new T0("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var Gc=null,Lc=null;function Ix(i){Cw(i,0)}function KA(i){var e=hl(i);if(Z2(e))return i}function cx(i,e){if(i==="change")return e}var nw=!1;if(nr){var yp;if(nr){var Bp="oninput"in document;if(!Bp){var jy=document.createElement("div");jy.setAttribute("oninput","return;"),Bp=typeof jy.oninput=="function"}yp=Bp}else yp=!1;nw=yp&&(!document.documentMode||9<document.documentMode)}function qy(){Gc&&(Gc.detachEvent("onpropertychange",iw),Lc=Gc=null)}function iw(i){if(i.propertyName==="value"&&KA(Lc)){var e=[];tw(e,Lc,i,K0(i)),K2(Ix,e)}}function Cx(i,e,t){i==="focusin"?(qy(),Gc=e,Lc=t,Gc.attachEvent("onpropertychange",iw)):i==="focusout"&&qy()}function ux(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return KA(Lc)}function dx(i,e){if(i==="click")return KA(e)}function Ax(i,e){if(i==="input"||i==="change")return KA(e)}function hx(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var Us=typeof Object.is=="function"?Object.is:hx;function zc(i,e){if(Us(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!Fm.call(e,s)||!Us(i[s],e[s]))return!1}return!0}function $y(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function eB(i,e){var t=$y(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=$y(t)}}function sw(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?sw(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function ow(){for(var i=window,e=oA();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=oA(i.document)}return e}function J0(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function px(i){var e=ow(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&sw(t.ownerDocument.documentElement,t)){if(n!==null&&J0(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var s=t.textContent.length,o=Math.min(n.start,s);n=n.end===void 0?o:Math.min(n.end,s),!i.extend&&o>n&&(s=n,n=o,o=s),s=eB(t,o);var r=eB(t,n);s&&r&&(i.rangeCount!==1||i.anchorNode!==s.node||i.anchorOffset!==s.offset||i.focusNode!==r.node||i.focusOffset!==r.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),i.removeAllRanges(),o>n?(i.addRange(e),i.extend(r.node,r.offset)):(e.setEnd(r.node,r.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var mx=nr&&"documentMode"in document&&11>=document.documentMode,dl=null,ef=null,yc=null,tf=!1;function tB(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;tf||dl==null||dl!==oA(n)||(n=dl,"selectionStart"in n&&J0(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),yc&&zc(yc,n)||(yc=n,n=CA(ef,"onSelect"),0<n.length&&(e=new T0("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=dl)))}function Wu(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var Al={animationend:Wu("Animation","AnimationEnd"),animationiteration:Wu("Animation","AnimationIteration"),animationstart:Wu("Animation","AnimationStart"),transitionend:Wu("Transition","TransitionEnd")},vp={},rw={};nr&&(rw=document.createElement("div").style,"AnimationEvent"in window||(delete Al.animationend.animation,delete Al.animationiteration.animation,delete Al.animationstart.animation),"TransitionEvent"in window||delete Al.transitionend.transition);function NA(i){if(vp[i])return vp[i];if(!Al[i])return i;var e=Al[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in rw)return vp[i]=e[t];return i}var gw=NA("animationend"),aw=NA("animationiteration"),lw=NA("animationstart"),Iw=NA("transitionend"),cw=new Map,nB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vg(i,e){cw.set(i,e),Wa(e,[i])}for(var Zp=0;Zp<nB.length;Zp++){var wp=nB[Zp],fx=wp.toLowerCase(),bx=wp[0].toUpperCase()+wp.slice(1);vg(fx,"on"+bx)}vg(gw,"onAnimationEnd");vg(aw,"onAnimationIteration");vg(lw,"onAnimationStart");vg("dblclick","onDoubleClick");vg("focusin","onFocus");vg("focusout","onBlur");vg(Iw,"onTransitionEnd");Nl("onMouseEnter",["mouseout","mouseover"]);Nl("onMouseLeave",["mouseout","mouseover"]);Nl("onPointerEnter",["pointerout","pointerover"]);Nl("onPointerLeave",["pointerout","pointerover"]);Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ac="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ac));function iB(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,f1(n,e,void 0,i),i.currentTarget=null}function Cw(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],s=n.event;n=n.listeners;e:{var o=void 0;if(e)for(var r=n.length-1;0<=r;r--){var g=n[r],a=g.instance,l=g.currentTarget;if(g=g.listener,a!==o&&s.isPropagationStopped())break e;iB(s,g,l),o=a}else for(r=0;r<n.length;r++){if(g=n[r],a=g.instance,l=g.currentTarget,g=g.listener,a!==o&&s.isPropagationStopped())break e;iB(s,g,l),o=a}}}if(gA)throw i=Om,gA=!1,Om=null,i}function $t(i,e){var t=e[gf];t===void 0&&(t=e[gf]=new Set);var n=i+"__bubble";t.has(n)||(uw(e,i,2,!1),t.add(n))}function Wp(i,e,t){var n=0;e&&(n|=4),uw(t,i,n,e)}var Su="_reactListening"+Math.random().toString(36).slice(2);function kc(i){if(!i[Su]){i[Su]=!0,b2.forEach(function(t){t!=="selectionchange"&&(Gx.has(t)||Wp(t,!1,i),Wp(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[Su]||(e[Su]=!0,Wp("selectionchange",!1,e))}}function uw(i,e,t,n){switch(O2(e)){case 1:var s=F1;break;case 4:s=K1;break;default:s=z0}t=s.bind(null,e,t,i),s=void 0,!Qm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?i.addEventListener(e,t,{capture:!0,passive:s}):i.addEventListener(e,t,!0):s!==void 0?i.addEventListener(e,t,{passive:s}):i.addEventListener(e,t,!1)}function Sp(i,e,t,n,s){var o=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var r=n.tag;if(r===3||r===4){var g=n.stateNode.containerInfo;if(g===s||g.nodeType===8&&g.parentNode===s)break;if(r===4)for(r=n.return;r!==null;){var a=r.tag;if((a===3||a===4)&&(a=r.stateNode.containerInfo,a===s||a.nodeType===8&&a.parentNode===s))return;r=r.return}for(;g!==null;){if(r=na(g),r===null)return;if(a=r.tag,a===5||a===6){n=o=r;continue e}g=g.parentNode}}n=n.return}K2(function(){var l=o,I=K0(t),C=[];e:{var u=cw.get(i);if(u!==void 0){var A=T0,h=i;switch(i){case"keypress":if(Md(t)===0)break e;case"keydown":case"keyup":A=j1;break;case"focusin":h="focus",A=Gp;break;case"focusout":h="blur",A=Gp;break;case"beforeblur":case"afterblur":A=Gp;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=Jy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=L1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=ex;break;case gw:case aw:case lw:A=T1;break;case Iw:A=nx;break;case"scroll":A=N1;break;case"wheel":A=sx;break;case"copy":case"cut":case"paste":A=_1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=Dy}var m=(e&4)!==0,b=!m&&i==="scroll",G=m?u!==null?u+"Capture":null:u;m=[];for(var f=l,y;f!==null;){y=f;var B=y.stateNode;if(y.tag===5&&B!==null&&(y=B,G!==null&&(B=Fc(f,G),B!=null&&m.push(Tc(f,B,y)))),b)break;f=f.return}0<m.length&&(u=new A(u,h,null,t,I),C.push({event:u,listeners:m}))}}if((e&7)===0){e:{if(u=i==="mouseover"||i==="pointerover",A=i==="mouseout"||i==="pointerout",u&&t!==Dm&&(h=t.relatedTarget||t.fromElement)&&(na(h)||h[ir]))break e;if((A||u)&&(u=I.window===I?I:(u=I.ownerDocument)?u.defaultView||u.parentWindow:window,A?(h=t.relatedTarget||t.toElement,A=l,h=h?na(h):null,h!==null&&(b=Sa(h),h!==b||h.tag!==5&&h.tag!==6)&&(h=null)):(A=null,h=l),A!==h)){if(m=Jy,B="onMouseLeave",G="onMouseEnter",f="mouse",(i==="pointerout"||i==="pointerover")&&(m=Dy,B="onPointerLeave",G="onPointerEnter",f="pointer"),b=A==null?u:hl(A),y=h==null?u:hl(h),u=new m(B,f+"leave",A,t,I),u.target=b,u.relatedTarget=y,B=null,na(I)===l&&(m=new m(G,f+"enter",h,t,I),m.target=y,m.relatedTarget=b,B=m),b=B,A&&h)t:{for(m=A,G=h,f=0,y=m;y;y=Ja(y))f++;for(y=0,B=G;B;B=Ja(B))y++;for(;0<f-y;)m=Ja(m),f--;for(;0<y-f;)G=Ja(G),y--;for(;f--;){if(m===G||G!==null&&m===G.alternate)break t;m=Ja(m),G=Ja(G)}m=null}else m=null;A!==null&&sB(C,u,A,m,!1),h!==null&&b!==null&&sB(C,b,h,m,!0)}}e:{if(u=l?hl(l):window,A=u.nodeName&&u.nodeName.toLowerCase(),A==="select"||A==="input"&&u.type==="file")var v=cx;else if(Oy(u))if(nw)v=Ax;else{v=ux;var W=Cx}else(A=u.nodeName)&&A.toLowerCase()==="input"&&(u.type==="checkbox"||u.type==="radio")&&(v=dx);if(v&&(v=v(i,l))){tw(C,v,t,I);break e}W&&W(i,u,l),i==="focusout"&&(W=u._wrapperState)&&W.controlled&&u.type==="number"&&Tm(u,"number",u.value)}switch(W=l?hl(l):window,i){case"focusin":(Oy(W)||W.contentEditable==="true")&&(dl=W,ef=l,yc=null);break;case"focusout":yc=ef=dl=null;break;case"mousedown":tf=!0;break;case"contextmenu":case"mouseup":case"dragend":tf=!1,tB(C,t,I);break;case"selectionchange":if(mx)break;case"keydown":case"keyup":tB(C,t,I)}var R;if(_0)e:{switch(i){case"compositionstart":var Z="onCompositionStart";break e;case"compositionend":Z="onCompositionEnd";break e;case"compositionupdate":Z="onCompositionUpdate";break e}Z=void 0}else ul?$2(i,t)&&(Z="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(Z="onCompositionStart");Z&&(q2&&t.locale!=="ko"&&(ul||Z!=="onCompositionStart"?Z==="onCompositionEnd"&&ul&&(R=j2()):(qr=I,k0="value"in qr?qr.value:qr.textContent,ul=!0)),W=CA(l,Z),0<W.length&&(Z=new Uy(Z,i,null,t,I),C.push({event:Z,listeners:W}),R?Z.data=R:(R=ew(t),R!==null&&(Z.data=R)))),(R=rx?gx(i,t):ax(i,t))&&(l=CA(l,"onBeforeInput"),0<l.length&&(I=new Uy("onBeforeInput","beforeinput",null,t,I),C.push({event:I,listeners:l}),I.data=R))}Cw(C,e)})}function Tc(i,e,t){return{instance:i,listener:e,currentTarget:t}}function CA(i,e){for(var t=e+"Capture",n=[];i!==null;){var s=i,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=Fc(i,t),o!=null&&n.unshift(Tc(i,o,s)),o=Fc(i,e),o!=null&&n.push(Tc(i,o,s))),i=i.return}return n}function Ja(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function sB(i,e,t,n,s){for(var o=e._reactName,r=[];t!==null&&t!==n;){var g=t,a=g.alternate,l=g.stateNode;if(a!==null&&a===n)break;g.tag===5&&l!==null&&(g=l,s?(a=Fc(t,o),a!=null&&r.unshift(Tc(t,a,g))):s||(a=Fc(t,o),a!=null&&r.push(Tc(t,a,g)))),t=t.return}r.length!==0&&i.push({event:e,listeners:r})}var yx=/\r\n?/g,Bx=/\u0000|\uFFFD/g;function oB(i){return(typeof i=="string"?i:""+i).replace(yx,`
`).replace(Bx,"")}function Ru(i,e,t){if(e=oB(e),oB(i)!==e&&t)throw Error(Me(425))}function uA(){}var nf=null,sf=null;function of(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rf=typeof setTimeout=="function"?setTimeout:void 0,vx=typeof clearTimeout=="function"?clearTimeout:void 0,rB=typeof Promise=="function"?Promise:void 0,Zx=typeof queueMicrotask=="function"?queueMicrotask:typeof rB<"u"?function(i){return rB.resolve(null).then(i).catch(wx)}:rf;function wx(i){setTimeout(function(){throw i})}function Rp(i,e){var t=e,n=0;do{var s=t.nextSibling;if(i.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){i.removeChild(s),Mc(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);Mc(e)}function ag(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function gB(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var eI=Math.random().toString(36).slice(2),uo="__reactFiber$"+eI,Ec="__reactProps$"+eI,ir="__reactContainer$"+eI,gf="__reactEvents$"+eI,Wx="__reactListeners$"+eI,Sx="__reactHandles$"+eI;function na(i){var e=i[uo];if(e)return e;for(var t=i.parentNode;t;){if(e=t[ir]||t[uo]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=gB(i);i!==null;){if(t=i[uo])return t;i=gB(i)}return e}i=t,t=i.parentNode}return null}function AC(i){return i=i[uo]||i[ir],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function hl(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Me(33))}function MA(i){return i[Ec]||null}var af=[],pl=-1;function Zg(i){return{current:i}}function tn(i){0>pl||(i.current=af[pl],af[pl]=null,pl--)}function jt(i,e){pl++,af[pl]=i.current,i.current=e}var hg={},fi=Zg(hg),Ui=Zg(!1),ma=hg;function Ml(i,e){var t=i.type.contextTypes;if(!t)return hg;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in t)s[o]=e[o];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=s),s}function Di(i){return i=i.childContextTypes,i!=null}function dA(){tn(Ui),tn(fi)}function aB(i,e,t){if(fi.current!==hg)throw Error(Me(168));jt(fi,e),jt(Ui,t)}function dw(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(Me(108,C1(i)||"Unknown",s));return cn({},t,n)}function AA(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||hg,ma=fi.current,jt(fi,i),jt(Ui,Ui.current),!0}function lB(i,e,t){var n=i.stateNode;if(!n)throw Error(Me(169));t?(i=dw(i,e,ma),n.__reactInternalMemoizedMergedChildContext=i,tn(Ui),tn(fi),jt(fi,i)):tn(Ui),jt(Ui,t)}var Jo=null,LA=!1,Vp=!1;function Aw(i){Jo===null?Jo=[i]:Jo.push(i)}function Rx(i){LA=!0,Aw(i)}function wg(){if(!Vp&&Jo!==null){Vp=!0;var i=0,e=Jt;try{var t=Jo;for(Jt=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}Jo=null,LA=!1}catch(s){throw Jo!==null&&(Jo=Jo.slice(i+1)),z2(N0,wg),s}finally{Jt=e,Vp=!1}}return null}var ml=[],fl=0,hA=null,pA=0,ds=[],As=0,fa=null,Do=1,Po="";function Pg(i,e){ml[fl++]=pA,ml[fl++]=hA,hA=i,pA=e}function hw(i,e,t){ds[As++]=Do,ds[As++]=Po,ds[As++]=fa,fa=i;var n=Do;i=Po;var s=32-_s(n)-1;n&=~(1<<s),t+=1;var o=32-_s(e)+s;if(30<o){var r=s-s%5;o=(n&(1<<r)-1).toString(32),n>>=r,s-=r,Do=1<<32-_s(e)+s|t<<s|n,Po=o+i}else Do=1<<o|t<<s|n,Po=i}function U0(i){i.return!==null&&(Pg(i,1),hw(i,1,0))}function D0(i){for(;i===hA;)hA=ml[--fl],ml[fl]=null,pA=ml[--fl],ml[fl]=null;for(;i===fa;)fa=ds[--As],ds[As]=null,Po=ds[--As],ds[As]=null,Do=ds[--As],ds[As]=null}var es=null,$i=null,sn=!1,Ts=null;function pw(i,e){var t=ps(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function IB(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,es=i,$i=ag(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,es=i,$i=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=fa!==null?{id:Do,overflow:Po}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ps(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,es=i,$i=null,!0):!1;default:return!1}}function lf(i){return(i.mode&1)!==0&&(i.flags&128)===0}function If(i){if(sn){var e=$i;if(e){var t=e;if(!IB(i,e)){if(lf(i))throw Error(Me(418));e=ag(t.nextSibling);var n=es;e&&IB(i,e)?pw(n,t):(i.flags=i.flags&-4097|2,sn=!1,es=i)}}else{if(lf(i))throw Error(Me(418));i.flags=i.flags&-4097|2,sn=!1,es=i}}}function cB(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;es=i}function Vu(i){if(i!==es)return!1;if(!sn)return cB(i),sn=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!of(i.type,i.memoizedProps)),e&&(e=$i)){if(lf(i))throw mw(),Error(Me(418));for(;e;)pw(i,e),e=ag(e.nextSibling)}if(cB(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Me(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){$i=ag(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}$i=null}}else $i=es?ag(i.stateNode.nextSibling):null;return!0}function mw(){for(var i=$i;i;)i=ag(i.nextSibling)}function Ll(){$i=es=null,sn=!1}function P0(i){Ts===null?Ts=[i]:Ts.push(i)}var Vx=cr.ReactCurrentBatchConfig;function Ls(i,e){if(i&&i.defaultProps){e=cn({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}var mA=Zg(null),fA=null,bl=null,Q0=null;function O0(){Q0=bl=fA=null}function j0(i){var e=mA.current;tn(mA),i._currentValue=e}function cf(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function Xl(i,e){fA=i,Q0=bl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&e)!==0&&(_i=!0),i.firstContext=null)}function Gs(i){var e=i._currentValue;if(Q0!==i)if(i={context:i,memoizedValue:e,next:null},bl===null){if(fA===null)throw Error(Me(308));bl=i,fA.dependencies={lanes:0,firstContext:i}}else bl=bl.next=i;return e}var ia=null;function q0(i){ia===null?ia=[i]:ia.push(i)}function fw(i,e,t,n){var s=e.interleaved;return s===null?(t.next=t,q0(e)):(t.next=s.next,s.next=t),e.interleaved=t,sr(i,n)}function sr(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Ur=!1;function $0(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bw(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function er(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function lg(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,(Xt&2)!==0){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,sr(i,t)}return s=n.interleaved,s===null?(e.next=e,q0(n)):(e.next=s.next,s.next=e),n.interleaved=e,sr(i,t)}function Ld(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,M0(i,t)}}function CB(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var r={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?s=o=r:o=o.next=r,t=t.next}while(t!==null);o===null?s=o=e:o=o.next=e}else s=o=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function bA(i,e,t,n){var s=i.updateQueue;Ur=!1;var o=s.firstBaseUpdate,r=s.lastBaseUpdate,g=s.shared.pending;if(g!==null){s.shared.pending=null;var a=g,l=a.next;a.next=null,r===null?o=l:r.next=l,r=a;var I=i.alternate;I!==null&&(I=I.updateQueue,g=I.lastBaseUpdate,g!==r&&(g===null?I.firstBaseUpdate=l:g.next=l,I.lastBaseUpdate=a))}if(o!==null){var C=s.baseState;r=0,I=l=a=null,g=o;do{var u=g.lane,A=g.eventTime;if((n&u)===u){I!==null&&(I=I.next={eventTime:A,lane:0,tag:g.tag,payload:g.payload,callback:g.callback,next:null});e:{var h=i,m=g;switch(u=e,A=t,m.tag){case 1:if(h=m.payload,typeof h=="function"){C=h.call(A,C,u);break e}C=h;break e;case 3:h.flags=h.flags&-65537|128;case 0:if(h=m.payload,u=typeof h=="function"?h.call(A,C,u):h,u==null)break e;C=cn({},C,u);break e;case 2:Ur=!0}}g.callback!==null&&g.lane!==0&&(i.flags|=64,u=s.effects,u===null?s.effects=[g]:u.push(g))}else A={eventTime:A,lane:u,tag:g.tag,payload:g.payload,callback:g.callback,next:null},I===null?(l=I=A,a=C):I=I.next=A,r|=u;if(g=g.next,g===null){if(g=s.shared.pending,g===null)break;u=g,g=u.next,u.next=null,s.lastBaseUpdate=u,s.shared.pending=null}}while(1);if(I===null&&(a=C),s.baseState=a,s.firstBaseUpdate=l,s.lastBaseUpdate=I,e=s.shared.interleaved,e!==null){s=e;do r|=s.lane,s=s.next;while(s!==e)}else o===null&&(s.shared.lanes=0);Ga|=r,i.lanes=r,i.memoizedState=C}}function uB(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(Me(191,s));s.call(n)}}}var Gw=new f2.Component().refs;function Cf(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:cn({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var zA={isMounted:function(i){return(i=i._reactInternals)?Sa(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=Ri(),s=cg(i),o=er(n,s);o.payload=e,t!=null&&(o.callback=t),e=lg(i,o,s),e!==null&&(Js(e,i,s,n),Ld(e,i,s))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=Ri(),s=cg(i),o=er(n,s);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=lg(i,o,s),e!==null&&(Js(e,i,s,n),Ld(e,i,s))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=Ri(),n=cg(i),s=er(t,n);s.tag=2,e!=null&&(s.callback=e),e=lg(i,s,n),e!==null&&(Js(e,i,n,t),Ld(e,i,n))}};function dB(i,e,t,n,s,o,r){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,o,r):e.prototype&&e.prototype.isPureReactComponent?!zc(t,n)||!zc(s,o):!0}function yw(i,e,t){var n=!1,s=hg,o=e.contextType;return typeof o=="object"&&o!==null?o=Gs(o):(s=Di(e)?ma:fi.current,n=e.contextTypes,o=(n=n!=null)?Ml(i,s):hg),e=new e(t,o),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=zA,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=o),e}function AB(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&zA.enqueueReplaceState(e,e.state,null)}function uf(i,e,t,n){var s=i.stateNode;s.props=t,s.state=i.memoizedState,s.refs=Gw,$0(i);var o=e.contextType;typeof o=="object"&&o!==null?s.context=Gs(o):(o=Di(e)?ma:fi.current,s.context=Ml(i,o)),s.state=i.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Cf(i,e,o,t),s.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&zA.enqueueReplaceState(s,s.state,null),bA(i,t,s,n),s.state=i.memoizedState),typeof s.componentDidMount=="function"&&(i.flags|=4194308)}function DI(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Me(309));var n=t.stateNode}if(!n)throw Error(Me(147,i));var s=n,o=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(r){var g=s.refs;g===Gw&&(g=s.refs={}),r===null?delete g[o]:g[o]=r},e._stringRef=o,e)}if(typeof i!="string")throw Error(Me(284));if(!t._owner)throw Error(Me(290,i))}return i}function xu(i,e){throw i=Object.prototype.toString.call(e),Error(Me(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function hB(i){var e=i._init;return e(i._payload)}function Bw(i){function e(G,f){if(i){var y=G.deletions;y===null?(G.deletions=[f],G.flags|=16):y.push(f)}}function t(G,f){if(!i)return null;for(;f!==null;)e(G,f),f=f.sibling;return null}function n(G,f){for(G=new Map;f!==null;)f.key!==null?G.set(f.key,f):G.set(f.index,f),f=f.sibling;return G}function s(G,f){return G=Cg(G,f),G.index=0,G.sibling=null,G}function o(G,f,y){return G.index=y,i?(y=G.alternate,y!==null?(y=y.index,y<f?(G.flags|=2,f):y):(G.flags|=2,f)):(G.flags|=1048576,f)}function r(G){return i&&G.alternate===null&&(G.flags|=2),G}function g(G,f,y,B){return f===null||f.tag!==6?(f=Np(y,G.mode,B),f.return=G,f):(f=s(f,y),f.return=G,f)}function a(G,f,y,B){var v=y.type;return v===Cl?I(G,f,y.props.children,B,y.key):f!==null&&(f.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Jr&&hB(v)===f.type)?(B=s(f,y.props),B.ref=DI(G,f,y),B.return=G,B):(B=Jd(y.type,y.key,y.props,null,G.mode,B),B.ref=DI(G,f,y),B.return=G,B)}function l(G,f,y,B){return f===null||f.tag!==4||f.stateNode.containerInfo!==y.containerInfo||f.stateNode.implementation!==y.implementation?(f=Mp(y,G.mode,B),f.return=G,f):(f=s(f,y.children||[]),f.return=G,f)}function I(G,f,y,B,v){return f===null||f.tag!==7?(f=ca(y,G.mode,B,v),f.return=G,f):(f=s(f,y),f.return=G,f)}function C(G,f,y){if(typeof f=="string"&&f!==""||typeof f=="number")return f=Np(""+f,G.mode,y),f.return=G,f;if(typeof f=="object"&&f!==null){switch(f.$$typeof){case bu:return y=Jd(f.type,f.key,f.props,null,G.mode,y),y.ref=DI(G,null,f),y.return=G,y;case cl:return f=Mp(f,G.mode,y),f.return=G,f;case Jr:var B=f._init;return C(G,B(f._payload),y)}if(uc(f)||TI(f))return f=ca(f,G.mode,y,null),f.return=G,f;xu(G,f)}return null}function u(G,f,y,B){var v=f!==null?f.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return v!==null?null:g(G,f,""+y,B);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case bu:return y.key===v?a(G,f,y,B):null;case cl:return y.key===v?l(G,f,y,B):null;case Jr:return v=y._init,u(G,f,v(y._payload),B)}if(uc(y)||TI(y))return v!==null?null:I(G,f,y,B,null);xu(G,y)}return null}function A(G,f,y,B,v){if(typeof B=="string"&&B!==""||typeof B=="number")return G=G.get(y)||null,g(f,G,""+B,v);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case bu:return G=G.get(B.key===null?y:B.key)||null,a(f,G,B,v);case cl:return G=G.get(B.key===null?y:B.key)||null,l(f,G,B,v);case Jr:var W=B._init;return A(G,f,y,W(B._payload),v)}if(uc(B)||TI(B))return G=G.get(y)||null,I(f,G,B,v,null);xu(f,B)}return null}function h(G,f,y,B){for(var v=null,W=null,R=f,Z=f=0,V=null;R!==null&&Z<y.length;Z++){R.index>Z?(V=R,R=null):V=R.sibling;var H=u(G,R,y[Z],B);if(H===null){R===null&&(R=V);break}i&&R&&H.alternate===null&&e(G,R),f=o(H,f,Z),W===null?v=H:W.sibling=H,W=H,R=V}if(Z===y.length)return t(G,R),sn&&Pg(G,Z),v;if(R===null){for(;Z<y.length;Z++)R=C(G,y[Z],B),R!==null&&(f=o(R,f,Z),W===null?v=R:W.sibling=R,W=R);return sn&&Pg(G,Z),v}for(R=n(G,R);Z<y.length;Z++)V=A(R,G,Z,y[Z],B),V!==null&&(i&&V.alternate!==null&&R.delete(V.key===null?Z:V.key),f=o(V,f,Z),W===null?v=V:W.sibling=V,W=V);return i&&R.forEach(function(P){return e(G,P)}),sn&&Pg(G,Z),v}function m(G,f,y,B){var v=TI(y);if(typeof v!="function")throw Error(Me(150));if(y=v.call(y),y==null)throw Error(Me(151));for(var W=v=null,R=f,Z=f=0,V=null,H=y.next();R!==null&&!H.done;Z++,H=y.next()){R.index>Z?(V=R,R=null):V=R.sibling;var P=u(G,R,H.value,B);if(P===null){R===null&&(R=V);break}i&&R&&P.alternate===null&&e(G,R),f=o(P,f,Z),W===null?v=P:W.sibling=P,W=P,R=V}if(H.done)return t(G,R),sn&&Pg(G,Z),v;if(R===null){for(;!H.done;Z++,H=y.next())H=C(G,H.value,B),H!==null&&(f=o(H,f,Z),W===null?v=H:W.sibling=H,W=H);return sn&&Pg(G,Z),v}for(R=n(G,R);!H.done;Z++,H=y.next())H=A(R,G,Z,H.value,B),H!==null&&(i&&H.alternate!==null&&R.delete(H.key===null?Z:H.key),f=o(H,f,Z),W===null?v=H:W.sibling=H,W=H);return i&&R.forEach(function(E){return e(G,E)}),sn&&Pg(G,Z),v}function b(G,f,y,B){if(typeof y=="object"&&y!==null&&y.type===Cl&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case bu:e:{for(var v=y.key,W=f;W!==null;){if(W.key===v){if(v=y.type,v===Cl){if(W.tag===7){t(G,W.sibling),f=s(W,y.props.children),f.return=G,G=f;break e}}else if(W.elementType===v||typeof v=="object"&&v!==null&&v.$$typeof===Jr&&hB(v)===W.type){t(G,W.sibling),f=s(W,y.props),f.ref=DI(G,W,y),f.return=G,G=f;break e}t(G,W);break}else e(G,W);W=W.sibling}y.type===Cl?(f=ca(y.props.children,G.mode,B,y.key),f.return=G,G=f):(B=Jd(y.type,y.key,y.props,null,G.mode,B),B.ref=DI(G,f,y),B.return=G,G=B)}return r(G);case cl:e:{for(W=y.key;f!==null;){if(f.key===W)if(f.tag===4&&f.stateNode.containerInfo===y.containerInfo&&f.stateNode.implementation===y.implementation){t(G,f.sibling),f=s(f,y.children||[]),f.return=G,G=f;break e}else{t(G,f);break}else e(G,f);f=f.sibling}f=Mp(y,G.mode,B),f.return=G,G=f}return r(G);case Jr:return W=y._init,b(G,f,W(y._payload),B)}if(uc(y))return h(G,f,y,B);if(TI(y))return m(G,f,y,B);xu(G,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,f!==null&&f.tag===6?(t(G,f.sibling),f=s(f,y),f.return=G,G=f):(t(G,f),f=Np(y,G.mode,B),f.return=G,G=f),r(G)):t(G,f)}return b}var zl=Bw(!0),vw=Bw(!1),hC={},ho=Zg(hC),_c=Zg(hC),Jc=Zg(hC);function sa(i){if(i===hC)throw Error(Me(174));return i}function eb(i,e){switch(jt(Jc,e),jt(_c,i),jt(ho,hC),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_m(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=_m(e,i)}tn(ho),jt(ho,e)}function kl(){tn(ho),tn(_c),tn(Jc)}function Zw(i){sa(Jc.current);var e=sa(ho.current),t=_m(e,i.type);e!==t&&(jt(_c,i),jt(ho,t))}function tb(i){_c.current===i&&(tn(ho),tn(_c))}var an=Zg(0);function GA(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xp=[];function nb(){for(var i=0;i<xp.length;i++)xp[i]._workInProgressVersionPrimary=null;xp.length=0}var zd=cr.ReactCurrentDispatcher,Xp=cr.ReactCurrentBatchConfig,ba=0,In=null,Ln=null,Dn=null,yA=!1,Bc=!1,Uc=0,xx=0;function ci(){throw Error(Me(321))}function ib(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!Us(i[t],e[t]))return!1;return!0}function sb(i,e,t,n,s,o){if(ba=o,In=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,zd.current=i===null||i.memoizedState===null?Fx:Kx,i=t(n,s),Bc){o=0;do{if(Bc=!1,Uc=0,25<=o)throw Error(Me(301));o+=1,Dn=Ln=null,e.updateQueue=null,zd.current=Nx,i=t(n,s)}while(Bc)}if(zd.current=BA,e=Ln!==null&&Ln.next!==null,ba=0,Dn=Ln=In=null,yA=!1,e)throw Error(Me(300));return i}function ob(){var i=Uc!==0;return Uc=0,i}function co(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dn===null?In.memoizedState=Dn=i:Dn=Dn.next=i,Dn}function ys(){if(Ln===null){var i=In.alternate;i=i!==null?i.memoizedState:null}else i=Ln.next;var e=Dn===null?In.memoizedState:Dn.next;if(e!==null)Dn=e,Ln=i;else{if(i===null)throw Error(Me(310));Ln=i,i={memoizedState:Ln.memoizedState,baseState:Ln.baseState,baseQueue:Ln.baseQueue,queue:Ln.queue,next:null},Dn===null?In.memoizedState=Dn=i:Dn=Dn.next=i}return Dn}function Dc(i,e){return typeof e=="function"?e(i):e}function Yp(i){var e=ys(),t=e.queue;if(t===null)throw Error(Me(311));t.lastRenderedReducer=i;var n=Ln,s=n.baseQueue,o=t.pending;if(o!==null){if(s!==null){var r=s.next;s.next=o.next,o.next=r}n.baseQueue=s=o,t.pending=null}if(s!==null){o=s.next,n=n.baseState;var g=r=null,a=null,l=o;do{var I=l.lane;if((ba&I)===I)a!==null&&(a=a.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),n=l.hasEagerState?l.eagerState:i(n,l.action);else{var C={lane:I,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};a===null?(g=a=C,r=n):a=a.next=C,In.lanes|=I,Ga|=I}l=l.next}while(l!==null&&l!==o);a===null?r=n:a.next=g,Us(n,e.memoizedState)||(_i=!0),e.memoizedState=n,e.baseState=r,e.baseQueue=a,t.lastRenderedState=n}if(i=t.interleaved,i!==null){s=i;do o=s.lane,In.lanes|=o,Ga|=o,s=s.next;while(s!==i)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Hp(i){var e=ys(),t=e.queue;if(t===null)throw Error(Me(311));t.lastRenderedReducer=i;var n=t.dispatch,s=t.pending,o=e.memoizedState;if(s!==null){t.pending=null;var r=s=s.next;do o=i(o,r.action),r=r.next;while(r!==s);Us(o,e.memoizedState)||(_i=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,n]}function ww(){}function Ww(i,e){var t=In,n=ys(),s=e(),o=!Us(n.memoizedState,s);if(o&&(n.memoizedState=s,_i=!0),n=n.queue,rb(Vw.bind(null,t,n,i),[i]),n.getSnapshot!==e||o||Dn!==null&&Dn.memoizedState.tag&1){if(t.flags|=2048,Pc(9,Rw.bind(null,t,n,s,e),void 0,null),Pn===null)throw Error(Me(349));(ba&30)!==0||Sw(t,e,s)}return s}function Sw(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=In.updateQueue,e===null?(e={lastEffect:null,stores:null},In.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function Rw(i,e,t,n){e.value=t,e.getSnapshot=n,xw(e)&&Xw(i)}function Vw(i,e,t){return t(function(){xw(e)&&Xw(i)})}function xw(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!Us(i,t)}catch{return!0}}function Xw(i){var e=sr(i,1);e!==null&&Js(e,i,1,-1)}function pB(i){var e=co();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dc,lastRenderedState:i},e.queue=i,i=i.dispatch=Hx.bind(null,In,i),[e.memoizedState,i]}function Pc(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=In.updateQueue,e===null?(e={lastEffect:null,stores:null},In.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function Yw(){return ys().memoizedState}function kd(i,e,t,n){var s=co();In.flags|=i,s.memoizedState=Pc(1|e,t,void 0,n===void 0?null:n)}function kA(i,e,t,n){var s=ys();n=n===void 0?null:n;var o=void 0;if(Ln!==null){var r=Ln.memoizedState;if(o=r.destroy,n!==null&&ib(n,r.deps)){s.memoizedState=Pc(e,t,o,n);return}}In.flags|=i,s.memoizedState=Pc(1|e,t,o,n)}function mB(i,e){return kd(8390656,8,i,e)}function rb(i,e){return kA(2048,8,i,e)}function Hw(i,e){return kA(4,2,i,e)}function Fw(i,e){return kA(4,4,i,e)}function Kw(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function Nw(i,e,t){return t=t!=null?t.concat([i]):null,kA(4,4,Kw.bind(null,e,i),t)}function gb(){}function Mw(i,e){var t=ys();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ib(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function Lw(i,e){var t=ys();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&ib(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function zw(i,e,t){return(ba&21)===0?(i.baseState&&(i.baseState=!1,_i=!0),i.memoizedState=t):(Us(t,e)||(t=E2(),In.lanes|=t,Ga|=t,i.baseState=!0),e)}function Xx(i,e){var t=Jt;Jt=t!==0&&4>t?t:4,i(!0);var n=Xp.transition;Xp.transition={};try{i(!1),e()}finally{Jt=t,Xp.transition=n}}function kw(){return ys().memoizedState}function Yx(i,e,t){var n=cg(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},Tw(i))Ew(e,t);else if(t=fw(i,e,t,n),t!==null){var s=Ri();Js(t,i,n,s),_w(t,e,n)}}function Hx(i,e,t){var n=cg(i),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(Tw(i))Ew(e,s);else{var o=i.alternate;if(i.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var r=e.lastRenderedState,g=o(r,t);if(s.hasEagerState=!0,s.eagerState=g,Us(g,r)){var a=e.interleaved;a===null?(s.next=s,q0(e)):(s.next=a.next,a.next=s),e.interleaved=s;return}}catch{}finally{}t=fw(i,e,s,n),t!==null&&(s=Ri(),Js(t,i,n,s),_w(t,e,n))}}function Tw(i){var e=i.alternate;return i===In||e!==null&&e===In}function Ew(i,e){Bc=yA=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function _w(i,e,t){if((t&4194240)!==0){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,M0(i,t)}}var BA={readContext:Gs,useCallback:ci,useContext:ci,useEffect:ci,useImperativeHandle:ci,useInsertionEffect:ci,useLayoutEffect:ci,useMemo:ci,useReducer:ci,useRef:ci,useState:ci,useDebugValue:ci,useDeferredValue:ci,useTransition:ci,useMutableSource:ci,useSyncExternalStore:ci,useId:ci,unstable_isNewReconciler:!1},Fx={readContext:Gs,useCallback:function(i,e){return co().memoizedState=[i,e===void 0?null:e],i},useContext:Gs,useEffect:mB,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,kd(4194308,4,Kw.bind(null,e,i),t)},useLayoutEffect:function(i,e){return kd(4194308,4,i,e)},useInsertionEffect:function(i,e){return kd(4,2,i,e)},useMemo:function(i,e){var t=co();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=co();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=Yx.bind(null,In,i),[n.memoizedState,i]},useRef:function(i){var e=co();return i={current:i},e.memoizedState=i},useState:pB,useDebugValue:gb,useDeferredValue:function(i){return co().memoizedState=i},useTransition:function(){var i=pB(!1),e=i[0];return i=Xx.bind(null,i[1]),co().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=In,s=co();if(sn){if(t===void 0)throw Error(Me(407));t=t()}else{if(t=e(),Pn===null)throw Error(Me(349));(ba&30)!==0||Sw(n,e,t)}s.memoizedState=t;var o={value:t,getSnapshot:e};return s.queue=o,mB(Vw.bind(null,n,o,i),[i]),n.flags|=2048,Pc(9,Rw.bind(null,n,o,t,e),void 0,null),t},useId:function(){var i=co(),e=Pn.identifierPrefix;if(sn){var t=Po,n=Do;t=(n&~(1<<32-_s(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Uc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=xx++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},Kx={readContext:Gs,useCallback:Mw,useContext:Gs,useEffect:rb,useImperativeHandle:Nw,useInsertionEffect:Hw,useLayoutEffect:Fw,useMemo:Lw,useReducer:Yp,useRef:Yw,useState:function(){return Yp(Dc)},useDebugValue:gb,useDeferredValue:function(i){var e=ys();return zw(e,Ln.memoizedState,i)},useTransition:function(){var i=Yp(Dc)[0],e=ys().memoizedState;return[i,e]},useMutableSource:ww,useSyncExternalStore:Ww,useId:kw,unstable_isNewReconciler:!1},Nx={readContext:Gs,useCallback:Mw,useContext:Gs,useEffect:rb,useImperativeHandle:Nw,useInsertionEffect:Hw,useLayoutEffect:Fw,useMemo:Lw,useReducer:Hp,useRef:Yw,useState:function(){return Hp(Dc)},useDebugValue:gb,useDeferredValue:function(i){var e=ys();return Ln===null?e.memoizedState=i:zw(e,Ln.memoizedState,i)},useTransition:function(){var i=Hp(Dc)[0],e=ys().memoizedState;return[i,e]},useMutableSource:ww,useSyncExternalStore:Ww,useId:kw,unstable_isNewReconciler:!1};function Tl(i,e){try{var t="",n=e;do t+=c1(n),n=n.return;while(n);var s=t}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:i,source:e,stack:s,digest:null}}function Fp(i,e,t){return{value:i,source:null,stack:t!=null?t:null,digest:e!=null?e:null}}function df(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Mx=typeof WeakMap=="function"?WeakMap:Map;function Jw(i,e,t){t=er(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){ZA||(ZA=!0,vf=n),df(i,e)},t}function Uw(i,e,t){t=er(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){df(i,e)}}var o=i.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){df(i,e),typeof n!="function"&&(Ig===null?Ig=new Set([this]):Ig.add(this));var r=e.stack;this.componentDidCatch(e.value,{componentStack:r!==null?r:""})}),t}function fB(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new Mx;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),i=qx.bind(null,i,e,t),e.then(i,i))}function bB(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function GB(i,e,t,n,s){return(i.mode&1)===0?(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=er(-1,1),e.tag=2,lg(t,e,1))),t.lanes|=1),i):(i.flags|=65536,i.lanes=s,i)}var Lx=cr.ReactCurrentOwner,_i=!1;function Zi(i,e,t,n){e.child=i===null?vw(e,null,t,n):zl(e,i.child,t,n)}function yB(i,e,t,n,s){t=t.render;var o=e.ref;return Xl(e,s),n=sb(i,e,t,n,o,s),t=ob(),i!==null&&!_i?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,or(i,e,s)):(sn&&t&&U0(e),e.flags|=1,Zi(i,e,n,s),e.child)}function BB(i,e,t,n,s){if(i===null){var o=t.type;return typeof o=="function"&&!Ab(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,Dw(i,e,o,n,s)):(i=Jd(t.type,null,n,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(o=i.child,(i.lanes&s)===0){var r=o.memoizedProps;if(t=t.compare,t=t!==null?t:zc,t(r,n)&&i.ref===e.ref)return or(i,e,s)}return e.flags|=1,i=Cg(o,n),i.ref=e.ref,i.return=e,e.child=i}function Dw(i,e,t,n,s){if(i!==null){var o=i.memoizedProps;if(zc(o,n)&&i.ref===e.ref)if(_i=!1,e.pendingProps=n=o,(i.lanes&s)!==0)(i.flags&131072)!==0&&(_i=!0);else return e.lanes=i.lanes,or(i,e,s)}return Af(i,e,t,n,s)}function Pw(i,e,t){var n=e.pendingProps,s=n.children,o=i!==null?i.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(yl,qi),qi|=t;else{if((t&1073741824)===0)return i=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,jt(yl,qi),qi|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:t,jt(yl,qi),qi|=n}else o!==null?(n=o.baseLanes|t,e.memoizedState=null):n=t,jt(yl,qi),qi|=n;return Zi(i,e,s,t),e.child}function Qw(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Af(i,e,t,n,s){var o=Di(t)?ma:fi.current;return o=Ml(e,o),Xl(e,s),t=sb(i,e,t,n,o,s),n=ob(),i!==null&&!_i?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,or(i,e,s)):(sn&&n&&U0(e),e.flags|=1,Zi(i,e,t,s),e.child)}function vB(i,e,t,n,s){if(Di(t)){var o=!0;AA(e)}else o=!1;if(Xl(e,s),e.stateNode===null)Td(i,e),yw(e,t,n),uf(e,t,n,s),n=!0;else if(i===null){var r=e.stateNode,g=e.memoizedProps;r.props=g;var a=r.context,l=t.contextType;typeof l=="object"&&l!==null?l=Gs(l):(l=Di(t)?ma:fi.current,l=Ml(e,l));var I=t.getDerivedStateFromProps,C=typeof I=="function"||typeof r.getSnapshotBeforeUpdate=="function";C||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(g!==n||a!==l)&&AB(e,r,n,l),Ur=!1;var u=e.memoizedState;r.state=u,bA(e,n,r,s),a=e.memoizedState,g!==n||u!==a||Ui.current||Ur?(typeof I=="function"&&(Cf(e,t,I,n),a=e.memoizedState),(g=Ur||dB(e,t,g,n,u,a,l))?(C||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=a),r.props=n,r.state=a,r.context=l,n=g):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{r=e.stateNode,bw(i,e),g=e.memoizedProps,l=e.type===e.elementType?g:Ls(e.type,g),r.props=l,C=e.pendingProps,u=r.context,a=t.contextType,typeof a=="object"&&a!==null?a=Gs(a):(a=Di(t)?ma:fi.current,a=Ml(e,a));var A=t.getDerivedStateFromProps;(I=typeof A=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(g!==C||u!==a)&&AB(e,r,n,a),Ur=!1,u=e.memoizedState,r.state=u,bA(e,n,r,s);var h=e.memoizedState;g!==C||u!==h||Ui.current||Ur?(typeof A=="function"&&(Cf(e,t,A,n),h=e.memoizedState),(l=Ur||dB(e,t,l,n,u,h,a)||!1)?(I||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(n,h,a),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(n,h,a)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||g===i.memoizedProps&&u===i.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||g===i.memoizedProps&&u===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=h),r.props=n,r.state=h,r.context=a,n=l):(typeof r.componentDidUpdate!="function"||g===i.memoizedProps&&u===i.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||g===i.memoizedProps&&u===i.memoizedState||(e.flags|=1024),n=!1)}return hf(i,e,t,n,o,s)}function hf(i,e,t,n,s,o){Qw(i,e);var r=(e.flags&128)!==0;if(!n&&!r)return s&&lB(e,t,!1),or(i,e,o);n=e.stateNode,Lx.current=e;var g=r&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&r?(e.child=zl(e,i.child,null,o),e.child=zl(e,null,g,o)):Zi(i,e,g,o),e.memoizedState=n.state,s&&lB(e,t,!0),e.child}function Ow(i){var e=i.stateNode;e.pendingContext?aB(i,e.pendingContext,e.pendingContext!==e.context):e.context&&aB(i,e.context,!1),eb(i,e.containerInfo)}function ZB(i,e,t,n,s){return Ll(),P0(s),e.flags|=256,Zi(i,e,t,n),e.child}var pf={dehydrated:null,treeContext:null,retryLane:0};function mf(i){return{baseLanes:i,cachePool:null,transitions:null}}function jw(i,e,t){var n=e.pendingProps,s=an.current,o=!1,r=(e.flags&128)!==0,g;if((g=r)||(g=i!==null&&i.memoizedState===null?!1:(s&2)!==0),g?(o=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(s|=1),jt(an,s&1),i===null)return If(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((e.mode&1)===0?e.lanes=1:i.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(r=n.children,i=n.fallback,o?(n=e.mode,o=e.child,r={mode:"hidden",children:r},(n&1)===0&&o!==null?(o.childLanes=0,o.pendingProps=r):o=_A(r,n,0,null),i=ca(i,n,t,null),o.return=e,i.return=e,o.sibling=i,e.child=o,e.child.memoizedState=mf(t),e.memoizedState=pf,i):ab(e,r));if(s=i.memoizedState,s!==null&&(g=s.dehydrated,g!==null))return zx(i,e,r,n,g,s,t);if(o){o=n.fallback,r=e.mode,s=i.child,g=s.sibling;var a={mode:"hidden",children:n.children};return(r&1)===0&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=a,e.deletions=null):(n=Cg(s,a),n.subtreeFlags=s.subtreeFlags&14680064),g!==null?o=Cg(g,o):(o=ca(o,r,t,null),o.flags|=2),o.return=e,n.return=e,n.sibling=o,e.child=n,n=o,o=e.child,r=i.child.memoizedState,r=r===null?mf(t):{baseLanes:r.baseLanes|t,cachePool:null,transitions:r.transitions},o.memoizedState=r,o.childLanes=i.childLanes&~t,e.memoizedState=pf,n}return o=i.child,i=o.sibling,n=Cg(o,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function ab(i,e){return e=_A({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function Xu(i,e,t,n){return n!==null&&P0(n),zl(e,i.child,null,t),i=ab(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function zx(i,e,t,n,s,o,r){if(t)return e.flags&256?(e.flags&=-257,n=Fp(Error(Me(422))),Xu(i,e,r,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(o=n.fallback,s=e.mode,n=_A({mode:"visible",children:n.children},s,0,null),o=ca(o,s,r,null),o.flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,(e.mode&1)!==0&&zl(e,i.child,null,r),e.child.memoizedState=mf(r),e.memoizedState=pf,o);if((e.mode&1)===0)return Xu(i,e,r,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var g=n.dgst;return n=g,o=Error(Me(419)),n=Fp(o,n,void 0),Xu(i,e,r,n)}if(g=(r&i.childLanes)!==0,_i||g){if(n=Pn,n!==null){switch(r&-r){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=(s&(n.suspendedLanes|r))!==0?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,sr(i,s),Js(n,i,s,-1))}return db(),n=Fp(Error(Me(421))),Xu(i,e,r,n)}return s.data==="$?"?(e.flags|=128,e.child=i.child,e=$x.bind(null,i),s._reactRetry=e,null):(i=o.treeContext,$i=ag(s.nextSibling),es=e,sn=!0,Ts=null,i!==null&&(ds[As++]=Do,ds[As++]=Po,ds[As++]=fa,Do=i.id,Po=i.overflow,fa=e),e=ab(e,n.children),e.flags|=4096,e)}function wB(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),cf(i.return,e,t)}function Kp(i,e,t,n,s){var o=i.memoizedState;o===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=t,o.tailMode=s)}function qw(i,e,t){var n=e.pendingProps,s=n.revealOrder,o=n.tail;if(Zi(i,e,n.children,t),n=an.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&wB(i,t,e);else if(i.tag===19)wB(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(jt(an,n),(e.mode&1)===0)e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)i=t.alternate,i!==null&&GA(i)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Kp(e,!1,s,t,o);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&GA(i)===null){e.child=s;break}i=s.sibling,s.sibling=t,t=s,s=i}Kp(e,!0,t,null,o);break;case"together":Kp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Td(i,e){(e.mode&1)===0&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function or(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),Ga|=e.lanes,(t&e.childLanes)===0)return null;if(i!==null&&e.child!==i.child)throw Error(Me(153));if(e.child!==null){for(i=e.child,t=Cg(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=Cg(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function kx(i,e,t){switch(e.tag){case 3:Ow(e),Ll();break;case 5:Zw(e);break;case 1:Di(e.type)&&AA(e);break;case 4:eb(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;jt(mA,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(jt(an,an.current&1),e.flags|=128,null):(t&e.child.childLanes)!==0?jw(i,e,t):(jt(an,an.current&1),i=or(i,e,t),i!==null?i.sibling:null);jt(an,an.current&1);break;case 19:if(n=(t&e.childLanes)!==0,(i.flags&128)!==0){if(n)return qw(i,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),jt(an,an.current),n)break;return null;case 22:case 23:return e.lanes=0,Pw(i,e,t)}return or(i,e,t)}var $w,ff,eW,tW;$w=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};ff=function(){};eW=function(i,e,t,n){var s=i.memoizedProps;if(s!==n){i=e.stateNode,sa(ho.current);var o=null;switch(t){case"input":s=zm(i,s),n=zm(i,n),o=[];break;case"select":s=cn({},s,{value:void 0}),n=cn({},n,{value:void 0}),o=[];break;case"textarea":s=Em(i,s),n=Em(i,n),o=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=uA)}Jm(t,n);var r;t=null;for(l in s)if(!n.hasOwnProperty(l)&&s.hasOwnProperty(l)&&s[l]!=null)if(l==="style"){var g=s[l];for(r in g)g.hasOwnProperty(r)&&(t||(t={}),t[r]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(Yc.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in n){var a=n[l];if(g=s!=null?s[l]:void 0,n.hasOwnProperty(l)&&a!==g&&(a!=null||g!=null))if(l==="style")if(g){for(r in g)!g.hasOwnProperty(r)||a&&a.hasOwnProperty(r)||(t||(t={}),t[r]="");for(r in a)a.hasOwnProperty(r)&&g[r]!==a[r]&&(t||(t={}),t[r]=a[r])}else t||(o||(o=[]),o.push(l,t)),t=a;else l==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,g=g?g.__html:void 0,a!=null&&g!==a&&(o=o||[]).push(l,a)):l==="children"?typeof a!="string"&&typeof a!="number"||(o=o||[]).push(l,""+a):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(Yc.hasOwnProperty(l)?(a!=null&&l==="onScroll"&&$t("scroll",i),o||g===a||(o=[])):(o=o||[]).push(l,a))}t&&(o=o||[]).push("style",t);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};tW=function(i,e,t,n){t!==n&&(e.flags|=4)};function PI(i,e){if(!sn)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function Ci(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function Tx(i,e,t){var n=e.pendingProps;switch(D0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ci(e),null;case 1:return Di(e.type)&&dA(),Ci(e),null;case 3:return n=e.stateNode,kl(),tn(Ui),tn(fi),nb(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(Vu(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Ts!==null&&(Wf(Ts),Ts=null))),ff(i,e),Ci(e),null;case 5:tb(e);var s=sa(Jc.current);if(t=e.type,i!==null&&e.stateNode!=null)eW(i,e,t,n,s),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Me(166));return Ci(e),null}if(i=sa(ho.current),Vu(e)){n=e.stateNode,t=e.type;var o=e.memoizedProps;switch(n[uo]=e,n[Ec]=o,i=(e.mode&1)!==0,t){case"dialog":$t("cancel",n),$t("close",n);break;case"iframe":case"object":case"embed":$t("load",n);break;case"video":case"audio":for(s=0;s<Ac.length;s++)$t(Ac[s],n);break;case"source":$t("error",n);break;case"img":case"image":case"link":$t("error",n),$t("load",n);break;case"details":$t("toggle",n);break;case"input":Fy(n,o),$t("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},$t("invalid",n);break;case"textarea":Ny(n,o),$t("invalid",n)}Jm(t,o),s=null;for(var r in o)if(o.hasOwnProperty(r)){var g=o[r];r==="children"?typeof g=="string"?n.textContent!==g&&(o.suppressHydrationWarning!==!0&&Ru(n.textContent,g,i),s=["children",g]):typeof g=="number"&&n.textContent!==""+g&&(o.suppressHydrationWarning!==!0&&Ru(n.textContent,g,i),s=["children",""+g]):Yc.hasOwnProperty(r)&&g!=null&&r==="onScroll"&&$t("scroll",n)}switch(t){case"input":Gu(n),Ky(n,o,!0);break;case"textarea":Gu(n),My(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=uA)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{r=s.nodeType===9?s:s.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=S2(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=r.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=r.createElement(t,{is:n.is}):(i=r.createElement(t),t==="select"&&(r=i,n.multiple?r.multiple=!0:n.size&&(r.size=n.size))):i=r.createElementNS(i,t),i[uo]=e,i[Ec]=n,$w(i,e,!1,!1),e.stateNode=i;e:{switch(r=Um(t,n),t){case"dialog":$t("cancel",i),$t("close",i),s=n;break;case"iframe":case"object":case"embed":$t("load",i),s=n;break;case"video":case"audio":for(s=0;s<Ac.length;s++)$t(Ac[s],i);s=n;break;case"source":$t("error",i),s=n;break;case"img":case"image":case"link":$t("error",i),$t("load",i),s=n;break;case"details":$t("toggle",i),s=n;break;case"input":Fy(i,n),s=zm(i,n),$t("invalid",i);break;case"option":s=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},s=cn({},n,{value:void 0}),$t("invalid",i);break;case"textarea":Ny(i,n),s=Em(i,n),$t("invalid",i);break;default:s=n}Jm(t,s),g=s;for(o in g)if(g.hasOwnProperty(o)){var a=g[o];o==="style"?x2(i,a):o==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&R2(i,a)):o==="children"?typeof a=="string"?(t!=="textarea"||a!=="")&&Hc(i,a):typeof a=="number"&&Hc(i,""+a):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Yc.hasOwnProperty(o)?a!=null&&o==="onScroll"&&$t("scroll",i):a!=null&&X0(i,o,a,r))}switch(t){case"input":Gu(i),Ky(i,n,!1);break;case"textarea":Gu(i),My(i);break;case"option":n.value!=null&&i.setAttribute("value",""+Ag(n.value));break;case"select":i.multiple=!!n.multiple,o=n.value,o!=null?Sl(i,!!n.multiple,o,!1):n.defaultValue!=null&&Sl(i,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(i.onclick=uA)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ci(e),null;case 6:if(i&&e.stateNode!=null)tW(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Me(166));if(t=sa(Jc.current),sa(ho.current),Vu(e)){if(n=e.stateNode,t=e.memoizedProps,n[uo]=e,(o=n.nodeValue!==t)&&(i=es,i!==null))switch(i.tag){case 3:Ru(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Ru(n.nodeValue,t,(i.mode&1)!==0)}o&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[uo]=e,e.stateNode=n}return Ci(e),null;case 13:if(tn(an),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(sn&&$i!==null&&(e.mode&1)!==0&&(e.flags&128)===0)mw(),Ll(),e.flags|=98560,o=!1;else if(o=Vu(e),n!==null&&n.dehydrated!==null){if(i===null){if(!o)throw Error(Me(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Me(317));o[uo]=e}else Ll(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Ci(e),o=!1}else Ts!==null&&(Wf(Ts),Ts=null),o=!0;if(!o)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(i===null||(an.current&1)!==0?kn===0&&(kn=3):db())),e.updateQueue!==null&&(e.flags|=4),Ci(e),null);case 4:return kl(),ff(i,e),i===null&&kc(e.stateNode.containerInfo),Ci(e),null;case 10:return j0(e.type._context),Ci(e),null;case 17:return Di(e.type)&&dA(),Ci(e),null;case 19:if(tn(an),o=e.memoizedState,o===null)return Ci(e),null;if(n=(e.flags&128)!==0,r=o.rendering,r===null)if(n)PI(o,!1);else{if(kn!==0||i!==null&&(i.flags&128)!==0)for(i=e.child;i!==null;){if(r=GA(i),r!==null){for(e.flags|=128,PI(o,!1),n=r.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)o=t,i=n,o.flags&=14680066,r=o.alternate,r===null?(o.childLanes=0,o.lanes=i,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,o.type=r.type,i=r.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return jt(an,an.current&1|2),e.child}i=i.sibling}o.tail!==null&&Wn()>El&&(e.flags|=128,n=!0,PI(o,!1),e.lanes=4194304)}else{if(!n)if(i=GA(r),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),PI(o,!0),o.tail===null&&o.tailMode==="hidden"&&!r.alternate&&!sn)return Ci(e),null}else 2*Wn()-o.renderingStartTime>El&&t!==1073741824&&(e.flags|=128,n=!0,PI(o,!1),e.lanes=4194304);o.isBackwards?(r.sibling=e.child,e.child=r):(t=o.last,t!==null?t.sibling=r:e.child=r,o.last=r)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Wn(),e.sibling=null,t=an.current,jt(an,n?t&1|2:t&1),e):(Ci(e),null);case 22:case 23:return ub(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(qi&1073741824)!==0&&(Ci(e),e.subtreeFlags&6&&(e.flags|=8192)):Ci(e),null;case 24:return null;case 25:return null}throw Error(Me(156,e.tag))}function Ex(i,e){switch(D0(e),e.tag){case 1:return Di(e.type)&&dA(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return kl(),tn(Ui),tn(fi),nb(),i=e.flags,(i&65536)!==0&&(i&128)===0?(e.flags=i&-65537|128,e):null;case 5:return tb(e),null;case 13:if(tn(an),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(Me(340));Ll()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return tn(an),null;case 4:return kl(),null;case 10:return j0(e.type._context),null;case 22:case 23:return ub(),null;case 24:return null;default:return null}}var Yu=!1,pi=!1,_x=typeof WeakSet=="function"?WeakSet:Set,qe=null;function Gl(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){mn(i,e,n)}else t.current=null}function bf(i,e,t){try{t()}catch(n){mn(i,e,n)}}var WB=!1;function Jx(i,e){if(nf=IA,i=ow(),J0(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var r=0,g=-1,a=-1,l=0,I=0,C=i,u=null;t:for(;;){for(var A;C!==t||s!==0&&C.nodeType!==3||(g=r+s),C!==o||n!==0&&C.nodeType!==3||(a=r+n),C.nodeType===3&&(r+=C.nodeValue.length),(A=C.firstChild)!==null;)u=C,C=A;for(;;){if(C===i)break t;if(u===t&&++l===s&&(g=r),u===o&&++I===n&&(a=r),(A=C.nextSibling)!==null)break;C=u,u=C.parentNode}C=A}t=g===-1||a===-1?null:{start:g,end:a}}else t=null}t=t||{start:0,end:0}}else t=null;for(sf={focusedElem:i,selectionRange:t},IA=!1,qe=e;qe!==null;)if(e=qe,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,qe=i;else for(;qe!==null;){e=qe;try{var h=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(h!==null){var m=h.memoizedProps,b=h.memoizedState,G=e.stateNode,f=G.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ls(e.type,m),b);G.__reactInternalSnapshotBeforeUpdate=f}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Me(163))}}catch(B){mn(e,e.return,B)}if(i=e.sibling,i!==null){i.return=e.return,qe=i;break}qe=e.return}return h=WB,WB=!1,h}function vc(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&i)===i){var o=s.destroy;s.destroy=void 0,o!==void 0&&bf(e,t,o)}s=s.next}while(s!==n)}}function TA(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Gf(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function nW(i){var e=i.alternate;e!==null&&(i.alternate=null,nW(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[uo],delete e[Ec],delete e[gf],delete e[Wx],delete e[Sx])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function iW(i){return i.tag===5||i.tag===3||i.tag===4}function SB(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||iW(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function yf(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=uA));else if(n!==4&&(i=i.child,i!==null))for(yf(i,e,t),i=i.sibling;i!==null;)yf(i,e,t),i=i.sibling}function Bf(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(Bf(i,e,t),i=i.sibling;i!==null;)Bf(i,e,t),i=i.sibling}var si=null,zs=!1;function Fr(i,e,t){for(t=t.child;t!==null;)sW(i,e,t),t=t.sibling}function sW(i,e,t){if(Ao&&typeof Ao.onCommitFiberUnmount=="function")try{Ao.onCommitFiberUnmount(HA,t)}catch{}switch(t.tag){case 5:pi||Gl(t,e);case 6:var n=si,s=zs;si=null,Fr(i,e,t),si=n,zs=s,si!==null&&(zs?(i=si,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):si.removeChild(t.stateNode));break;case 18:si!==null&&(zs?(i=si,t=t.stateNode,i.nodeType===8?Rp(i.parentNode,t):i.nodeType===1&&Rp(i,t),Mc(i)):Rp(si,t.stateNode));break;case 4:n=si,s=zs,si=t.stateNode.containerInfo,zs=!0,Fr(i,e,t),si=n,zs=s;break;case 0:case 11:case 14:case 15:if(!pi&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var o=s,r=o.destroy;o=o.tag,r!==void 0&&((o&2)!==0||(o&4)!==0)&&bf(t,e,r),s=s.next}while(s!==n)}Fr(i,e,t);break;case 1:if(!pi&&(Gl(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(g){mn(t,e,g)}Fr(i,e,t);break;case 21:Fr(i,e,t);break;case 22:t.mode&1?(pi=(n=pi)||t.memoizedState!==null,Fr(i,e,t),pi=n):Fr(i,e,t);break;default:Fr(i,e,t)}}function RB(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new _x),e.forEach(function(n){var s=eX.bind(null,i,n);t.has(n)||(t.add(n),n.then(s,s))})}}function Ys(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var o=i,r=e,g=r;e:for(;g!==null;){switch(g.tag){case 5:si=g.stateNode,zs=!1;break e;case 3:si=g.stateNode.containerInfo,zs=!0;break e;case 4:si=g.stateNode.containerInfo,zs=!0;break e}g=g.return}if(si===null)throw Error(Me(160));sW(o,r,s),si=null,zs=!1;var a=s.alternate;a!==null&&(a.return=null),s.return=null}catch(l){mn(s,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oW(e,i),e=e.sibling}function oW(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Ys(e,i),ro(i),n&4){try{vc(3,i,i.return),TA(3,i)}catch(m){mn(i,i.return,m)}try{vc(5,i,i.return)}catch(m){mn(i,i.return,m)}}break;case 1:Ys(e,i),ro(i),n&512&&t!==null&&Gl(t,t.return);break;case 5:if(Ys(e,i),ro(i),n&512&&t!==null&&Gl(t,t.return),i.flags&32){var s=i.stateNode;try{Hc(s,"")}catch(m){mn(i,i.return,m)}}if(n&4&&(s=i.stateNode,s!=null)){var o=i.memoizedProps,r=t!==null?t.memoizedProps:o,g=i.type,a=i.updateQueue;if(i.updateQueue=null,a!==null)try{g==="input"&&o.type==="radio"&&o.name!=null&&w2(s,o),Um(g,r);var l=Um(g,o);for(r=0;r<a.length;r+=2){var I=a[r],C=a[r+1];I==="style"?x2(s,C):I==="dangerouslySetInnerHTML"?R2(s,C):I==="children"?Hc(s,C):X0(s,I,C,l)}switch(g){case"input":km(s,o);break;case"textarea":W2(s,o);break;case"select":var u=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?Sl(s,!!o.multiple,A,!1):u!==!!o.multiple&&(o.defaultValue!=null?Sl(s,!!o.multiple,o.defaultValue,!0):Sl(s,!!o.multiple,o.multiple?[]:"",!1))}s[Ec]=o}catch(m){mn(i,i.return,m)}}break;case 6:if(Ys(e,i),ro(i),n&4){if(i.stateNode===null)throw Error(Me(162));s=i.stateNode,o=i.memoizedProps;try{s.nodeValue=o}catch(m){mn(i,i.return,m)}}break;case 3:if(Ys(e,i),ro(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Mc(e.containerInfo)}catch(m){mn(i,i.return,m)}break;case 4:Ys(e,i),ro(i);break;case 13:Ys(e,i),ro(i),s=i.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(cb=Wn())),n&4&&RB(i);break;case 22:if(I=t!==null&&t.memoizedState!==null,i.mode&1?(pi=(l=pi)||I,Ys(e,i),pi=l):Ys(e,i),ro(i),n&8192){if(l=i.memoizedState!==null,(i.stateNode.isHidden=l)&&!I&&(i.mode&1)!==0)for(qe=i,I=i.child;I!==null;){for(C=qe=I;qe!==null;){switch(u=qe,A=u.child,u.tag){case 0:case 11:case 14:case 15:vc(4,u,u.return);break;case 1:Gl(u,u.return);var h=u.stateNode;if(typeof h.componentWillUnmount=="function"){n=u,t=u.return;try{e=n,h.props=e.memoizedProps,h.state=e.memoizedState,h.componentWillUnmount()}catch(m){mn(n,t,m)}}break;case 5:Gl(u,u.return);break;case 22:if(u.memoizedState!==null){xB(C);continue}}A!==null?(A.return=u,qe=A):xB(C)}I=I.sibling}e:for(I=null,C=i;;){if(C.tag===5){if(I===null){I=C;try{s=C.stateNode,l?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(g=C.stateNode,a=C.memoizedProps.style,r=a!=null&&a.hasOwnProperty("display")?a.display:null,g.style.display=V2("display",r))}catch(m){mn(i,i.return,m)}}}else if(C.tag===6){if(I===null)try{C.stateNode.nodeValue=l?"":C.memoizedProps}catch(m){mn(i,i.return,m)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===i)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===i)break e;for(;C.sibling===null;){if(C.return===null||C.return===i)break e;I===C&&(I=null),C=C.return}I===C&&(I=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Ys(e,i),ro(i),n&4&&RB(i);break;case 21:break;default:Ys(e,i),ro(i)}}function ro(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(iW(t)){var n=t;break e}t=t.return}throw Error(Me(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(Hc(s,""),n.flags&=-33);var o=SB(i);Bf(i,o,s);break;case 3:case 4:var r=n.stateNode.containerInfo,g=SB(i);yf(i,g,r);break;default:throw Error(Me(161))}}catch(a){mn(i,i.return,a)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function Ux(i,e,t){qe=i,rW(i)}function rW(i,e,t){for(var n=(i.mode&1)!==0;qe!==null;){var s=qe,o=s.child;if(s.tag===22&&n){var r=s.memoizedState!==null||Yu;if(!r){var g=s.alternate,a=g!==null&&g.memoizedState!==null||pi;g=Yu;var l=pi;if(Yu=r,(pi=a)&&!l)for(qe=s;qe!==null;)r=qe,a=r.child,r.tag===22&&r.memoizedState!==null?XB(s):a!==null?(a.return=r,qe=a):XB(s);for(;o!==null;)qe=o,rW(o),o=o.sibling;qe=s,Yu=g,pi=l}VB(i)}else(s.subtreeFlags&8772)!==0&&o!==null?(o.return=s,qe=o):VB(i)}}function VB(i){for(;qe!==null;){var e=qe;if((e.flags&8772)!==0){var t=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:pi||TA(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!pi)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Ls(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&uB(e,o,n);break;case 3:var r=e.updateQueue;if(r!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}uB(e,r,t)}break;case 5:var g=e.stateNode;if(t===null&&e.flags&4){t=g;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&t.focus();break;case"img":a.src&&(t.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var I=l.memoizedState;if(I!==null){var C=I.dehydrated;C!==null&&Mc(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Me(163))}pi||e.flags&512&&Gf(e)}catch(u){mn(e,e.return,u)}}if(e===i){qe=null;break}if(t=e.sibling,t!==null){t.return=e.return,qe=t;break}qe=e.return}}function xB(i){for(;qe!==null;){var e=qe;if(e===i){qe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,qe=t;break}qe=e.return}}function XB(i){for(;qe!==null;){var e=qe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{TA(4,e)}catch(a){mn(e,t,a)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(a){mn(e,s,a)}}var o=e.return;try{Gf(e)}catch(a){mn(e,o,a)}break;case 5:var r=e.return;try{Gf(e)}catch(a){mn(e,r,a)}}}catch(a){mn(e,e.return,a)}if(e===i){qe=null;break}var g=e.sibling;if(g!==null){g.return=e.return,qe=g;break}qe=e.return}}var Dx=Math.ceil,vA=cr.ReactCurrentDispatcher,lb=cr.ReactCurrentOwner,bs=cr.ReactCurrentBatchConfig,Xt=0,Pn=null,Hn=null,oi=0,qi=0,yl=Zg(0),kn=0,Qc=null,Ga=0,EA=0,Ib=0,Zc=null,Ei=null,cb=0,El=1/0,_o=null,ZA=!1,vf=null,Ig=null,Hu=!1,$r=null,wA=0,wc=0,Zf=null,Ed=-1,_d=0;function Ri(){return(Xt&6)!==0?Wn():Ed!==-1?Ed:Ed=Wn()}function cg(i){return(i.mode&1)===0?1:(Xt&2)!==0&&oi!==0?oi&-oi:Vx.transition!==null?(_d===0&&(_d=E2()),_d):(i=Jt,i!==0||(i=window.event,i=i===void 0?16:O2(i.type)),i)}function Js(i,e,t,n){if(50<wc)throw wc=0,Zf=null,Error(Me(185));uC(i,t,n),((Xt&2)===0||i!==Pn)&&(i===Pn&&((Xt&2)===0&&(EA|=t),kn===4&&Qr(i,oi)),Pi(i,n),t===1&&Xt===0&&(e.mode&1)===0&&(El=Wn()+500,LA&&wg()))}function Pi(i,e){var t=i.callbackNode;V1(i,e);var n=lA(i,i===Pn?oi:0);if(n===0)t!==null&&ky(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&ky(t),e===1)i.tag===0?Rx(YB.bind(null,i)):Aw(YB.bind(null,i)),Zx(function(){(Xt&6)===0&&wg()}),t=null;else{switch(_2(n)){case 1:t=N0;break;case 4:t=k2;break;case 16:t=aA;break;case 536870912:t=T2;break;default:t=aA}t=dW(t,gW.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function gW(i,e){if(Ed=-1,_d=0,(Xt&6)!==0)throw Error(Me(327));var t=i.callbackNode;if(Yl()&&i.callbackNode!==t)return null;var n=lA(i,i===Pn?oi:0);if(n===0)return null;if((n&30)!==0||(n&i.expiredLanes)!==0||e)e=WA(i,n);else{e=n;var s=Xt;Xt|=2;var o=lW();(Pn!==i||oi!==e)&&(_o=null,El=Wn()+500,Ia(i,e));do try{Ox();break}catch(g){aW(i,g)}while(1);O0(),vA.current=o,Xt=s,Hn!==null?e=0:(Pn=null,oi=0,e=kn)}if(e!==0){if(e===2&&(s=jm(i),s!==0&&(n=s,e=wf(i,s))),e===1)throw t=Qc,Ia(i,0),Qr(i,n),Pi(i,Wn()),t;if(e===6)Qr(i,n);else{if(s=i.current.alternate,(n&30)===0&&!Px(s)&&(e=WA(i,n),e===2&&(o=jm(i),o!==0&&(n=o,e=wf(i,o))),e===1))throw t=Qc,Ia(i,0),Qr(i,n),Pi(i,Wn()),t;switch(i.finishedWork=s,i.finishedLanes=n,e){case 0:case 1:throw Error(Me(345));case 2:Qg(i,Ei,_o);break;case 3:if(Qr(i,n),(n&130023424)===n&&(e=cb+500-Wn(),10<e)){if(lA(i,0)!==0)break;if(s=i.suspendedLanes,(s&n)!==n){Ri(),i.pingedLanes|=i.suspendedLanes&s;break}i.timeoutHandle=rf(Qg.bind(null,i,Ei,_o),e);break}Qg(i,Ei,_o);break;case 4:if(Qr(i,n),(n&4194240)===n)break;for(e=i.eventTimes,s=-1;0<n;){var r=31-_s(n);o=1<<r,r=e[r],r>s&&(s=r),n&=~o}if(n=s,n=Wn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Dx(n/1960))-n,10<n){i.timeoutHandle=rf(Qg.bind(null,i,Ei,_o),n);break}Qg(i,Ei,_o);break;case 5:Qg(i,Ei,_o);break;default:throw Error(Me(329))}}}return Pi(i,Wn()),i.callbackNode===t?gW.bind(null,i):null}function wf(i,e){var t=Zc;return i.current.memoizedState.isDehydrated&&(Ia(i,e).flags|=256),i=WA(i,e),i!==2&&(e=Ei,Ei=t,e!==null&&Wf(e)),i}function Wf(i){Ei===null?Ei=i:Ei.push.apply(Ei,i)}function Px(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],o=s.getSnapshot;s=s.value;try{if(!Us(o(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qr(i,e){for(e&=~Ib,e&=~EA,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-_s(e),n=1<<t;i[t]=-1,e&=~n}}function YB(i){if((Xt&6)!==0)throw Error(Me(327));Yl();var e=lA(i,0);if((e&1)===0)return Pi(i,Wn()),null;var t=WA(i,e);if(i.tag!==0&&t===2){var n=jm(i);n!==0&&(e=n,t=wf(i,n))}if(t===1)throw t=Qc,Ia(i,0),Qr(i,e),Pi(i,Wn()),t;if(t===6)throw Error(Me(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,Qg(i,Ei,_o),Pi(i,Wn()),null}function Cb(i,e){var t=Xt;Xt|=1;try{return i(e)}finally{Xt=t,Xt===0&&(El=Wn()+500,LA&&wg())}}function ya(i){$r!==null&&$r.tag===0&&(Xt&6)===0&&Yl();var e=Xt;Xt|=1;var t=bs.transition,n=Jt;try{if(bs.transition=null,Jt=1,i)return i()}finally{Jt=n,bs.transition=t,Xt=e,(Xt&6)===0&&wg()}}function ub(){qi=yl.current,tn(yl)}function Ia(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,vx(t)),Hn!==null)for(t=Hn.return;t!==null;){var n=t;switch(D0(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&dA();break;case 3:kl(),tn(Ui),tn(fi),nb();break;case 5:tb(n);break;case 4:kl();break;case 13:tn(an);break;case 19:tn(an);break;case 10:j0(n.type._context);break;case 22:case 23:ub()}t=t.return}if(Pn=i,Hn=i=Cg(i.current,null),oi=qi=e,kn=0,Qc=null,Ib=EA=Ga=0,Ei=Zc=null,ia!==null){for(e=0;e<ia.length;e++)if(t=ia[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,o=t.pending;if(o!==null){var r=o.next;o.next=s,n.next=r}t.pending=n}ia=null}return i}function aW(i,e){do{var t=Hn;try{if(O0(),zd.current=BA,yA){for(var n=In.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}yA=!1}if(ba=0,Dn=Ln=In=null,Bc=!1,Uc=0,lb.current=null,t===null||t.return===null){kn=1,Qc=e,Hn=null;break}e:{var o=i,r=t.return,g=t,a=e;if(e=oi,g.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var l=a,I=g,C=I.tag;if((I.mode&1)===0&&(C===0||C===11||C===15)){var u=I.alternate;u?(I.updateQueue=u.updateQueue,I.memoizedState=u.memoizedState,I.lanes=u.lanes):(I.updateQueue=null,I.memoizedState=null)}var A=bB(r);if(A!==null){A.flags&=-257,GB(A,r,g,o,e),A.mode&1&&fB(o,l,e),e=A,a=l;var h=e.updateQueue;if(h===null){var m=new Set;m.add(a),e.updateQueue=m}else h.add(a);break e}else{if((e&1)===0){fB(o,l,e),db();break e}a=Error(Me(426))}}else if(sn&&g.mode&1){var b=bB(r);if(b!==null){(b.flags&65536)===0&&(b.flags|=256),GB(b,r,g,o,e),P0(Tl(a,g));break e}}o=a=Tl(a,g),kn!==4&&(kn=2),Zc===null?Zc=[o]:Zc.push(o),o=r;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var G=Jw(o,a,e);CB(o,G);break e;case 1:g=a;var f=o.type,y=o.stateNode;if((o.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ig===null||!Ig.has(y)))){o.flags|=65536,e&=-e,o.lanes|=e;var B=Uw(o,g,e);CB(o,B);break e}}o=o.return}while(o!==null)}cW(t)}catch(v){e=v,Hn===t&&t!==null&&(Hn=t=t.return);continue}break}while(1)}function lW(){var i=vA.current;return vA.current=BA,i===null?BA:i}function db(){(kn===0||kn===3||kn===2)&&(kn=4),Pn===null||(Ga&268435455)===0&&(EA&268435455)===0||Qr(Pn,oi)}function WA(i,e){var t=Xt;Xt|=2;var n=lW();(Pn!==i||oi!==e)&&(_o=null,Ia(i,e));do try{Qx();break}catch(s){aW(i,s)}while(1);if(O0(),Xt=t,vA.current=n,Hn!==null)throw Error(Me(261));return Pn=null,oi=0,kn}function Qx(){for(;Hn!==null;)IW(Hn)}function Ox(){for(;Hn!==null&&!G1();)IW(Hn)}function IW(i){var e=uW(i.alternate,i,qi);i.memoizedProps=i.pendingProps,e===null?cW(i):Hn=e,lb.current=null}function cW(i){var e=i;do{var t=e.alternate;if(i=e.return,(e.flags&32768)===0){if(t=Tx(t,e,qi),t!==null){Hn=t;return}}else{if(t=Ex(t,e),t!==null){t.flags&=32767,Hn=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{kn=6,Hn=null;return}}if(e=e.sibling,e!==null){Hn=e;return}Hn=e=i}while(e!==null);kn===0&&(kn=5)}function Qg(i,e,t){var n=Jt,s=bs.transition;try{bs.transition=null,Jt=1,jx(i,e,t,n)}finally{bs.transition=s,Jt=n}return null}function jx(i,e,t,n){do Yl();while($r!==null);if((Xt&6)!==0)throw Error(Me(327));t=i.finishedWork;var s=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(Me(177));i.callbackNode=null,i.callbackPriority=0;var o=t.lanes|t.childLanes;if(x1(i,o),i===Pn&&(Hn=Pn=null,oi=0),(t.subtreeFlags&2064)===0&&(t.flags&2064)===0||Hu||(Hu=!0,dW(aA,function(){return Yl(),null})),o=(t.flags&15990)!==0,(t.subtreeFlags&15990)!==0||o){o=bs.transition,bs.transition=null;var r=Jt;Jt=1;var g=Xt;Xt|=4,lb.current=null,Jx(i,t),oW(t,i),px(sf),IA=!!nf,sf=nf=null,i.current=t,Ux(t),y1(),Xt=g,Jt=r,bs.transition=o}else i.current=t;if(Hu&&(Hu=!1,$r=i,wA=s),o=i.pendingLanes,o===0&&(Ig=null),Z1(t.stateNode),Pi(i,Wn()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(ZA)throw ZA=!1,i=vf,vf=null,i;return(wA&1)!==0&&i.tag!==0&&Yl(),o=i.pendingLanes,(o&1)!==0?i===Zf?wc++:(wc=0,Zf=i):wc=0,wg(),null}function Yl(){if($r!==null){var i=_2(wA),e=bs.transition,t=Jt;try{if(bs.transition=null,Jt=16>i?16:i,$r===null)var n=!1;else{if(i=$r,$r=null,wA=0,(Xt&6)!==0)throw Error(Me(331));var s=Xt;for(Xt|=4,qe=i.current;qe!==null;){var o=qe,r=o.child;if((qe.flags&16)!==0){var g=o.deletions;if(g!==null){for(var a=0;a<g.length;a++){var l=g[a];for(qe=l;qe!==null;){var I=qe;switch(I.tag){case 0:case 11:case 15:vc(8,I,o)}var C=I.child;if(C!==null)C.return=I,qe=C;else for(;qe!==null;){I=qe;var u=I.sibling,A=I.return;if(nW(I),I===l){qe=null;break}if(u!==null){u.return=A,qe=u;break}qe=A}}}var h=o.alternate;if(h!==null){var m=h.child;if(m!==null){h.child=null;do{var b=m.sibling;m.sibling=null,m=b}while(m!==null)}}qe=o}}if((o.subtreeFlags&2064)!==0&&r!==null)r.return=o,qe=r;else e:for(;qe!==null;){if(o=qe,(o.flags&2048)!==0)switch(o.tag){case 0:case 11:case 15:vc(9,o,o.return)}var G=o.sibling;if(G!==null){G.return=o.return,qe=G;break e}qe=o.return}}var f=i.current;for(qe=f;qe!==null;){r=qe;var y=r.child;if((r.subtreeFlags&2064)!==0&&y!==null)y.return=r,qe=y;else e:for(r=f;qe!==null;){if(g=qe,(g.flags&2048)!==0)try{switch(g.tag){case 0:case 11:case 15:TA(9,g)}}catch(v){mn(g,g.return,v)}if(g===r){qe=null;break e}var B=g.sibling;if(B!==null){B.return=g.return,qe=B;break e}qe=g.return}}if(Xt=s,wg(),Ao&&typeof Ao.onPostCommitFiberRoot=="function")try{Ao.onPostCommitFiberRoot(HA,i)}catch{}n=!0}return n}finally{Jt=t,bs.transition=e}}return!1}function HB(i,e,t){e=Tl(t,e),e=Jw(i,e,1),i=lg(i,e,1),e=Ri(),i!==null&&(uC(i,1,e),Pi(i,e))}function mn(i,e,t){if(i.tag===3)HB(i,i,t);else for(;e!==null;){if(e.tag===3){HB(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ig===null||!Ig.has(n))){i=Tl(t,i),i=Uw(e,i,1),e=lg(e,i,1),i=Ri(),e!==null&&(uC(e,1,i),Pi(e,i));break}}e=e.return}}function qx(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=Ri(),i.pingedLanes|=i.suspendedLanes&t,Pn===i&&(oi&t)===t&&(kn===4||kn===3&&(oi&130023424)===oi&&500>Wn()-cb?Ia(i,0):Ib|=t),Pi(i,e)}function CW(i,e){e===0&&((i.mode&1)===0?e=1:(e=vu,vu<<=1,(vu&130023424)===0&&(vu=4194304)));var t=Ri();i=sr(i,e),i!==null&&(uC(i,e,t),Pi(i,t))}function $x(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),CW(i,t)}function eX(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,s=i.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(Me(314))}n!==null&&n.delete(e),CW(i,t)}var uW;uW=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Ui.current)_i=!0;else{if((i.lanes&t)===0&&(e.flags&128)===0)return _i=!1,kx(i,e,t);_i=(i.flags&131072)!==0}else _i=!1,sn&&(e.flags&1048576)!==0&&hw(e,pA,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Td(i,e),i=e.pendingProps;var s=Ml(e,fi.current);Xl(e,t),s=sb(null,e,n,i,s,t);var o=ob();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Di(n)?(o=!0,AA(e)):o=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,$0(e),s.updater=zA,e.stateNode=s,s._reactInternals=e,uf(e,n,i,t),e=hf(null,e,n,!0,o,t)):(e.tag=0,sn&&o&&U0(e),Zi(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Td(i,e),i=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=nX(n),i=Ls(n,i),s){case 0:e=Af(null,e,n,i,t);break e;case 1:e=vB(null,e,n,i,t);break e;case 11:e=yB(null,e,n,i,t);break e;case 14:e=BB(null,e,n,Ls(n.type,i),t);break e}throw Error(Me(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Ls(n,s),Af(i,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Ls(n,s),vB(i,e,n,s,t);case 3:e:{if(Ow(e),i===null)throw Error(Me(387));n=e.pendingProps,o=e.memoizedState,s=o.element,bw(i,e),bA(e,n,null,t);var r=e.memoizedState;if(n=r.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:r.cache,pendingSuspenseBoundaries:r.pendingSuspenseBoundaries,transitions:r.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){s=Tl(Error(Me(423)),e),e=ZB(i,e,n,t,s);break e}else if(n!==s){s=Tl(Error(Me(424)),e),e=ZB(i,e,n,t,s);break e}else for($i=ag(e.stateNode.containerInfo.firstChild),es=e,sn=!0,Ts=null,t=vw(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ll(),n===s){e=or(i,e,t);break e}Zi(i,e,n,t)}e=e.child}return e;case 5:return Zw(e),i===null&&If(e),n=e.type,s=e.pendingProps,o=i!==null?i.memoizedProps:null,r=s.children,of(n,s)?r=null:o!==null&&of(n,o)&&(e.flags|=32),Qw(i,e),Zi(i,e,r,t),e.child;case 6:return i===null&&If(e),null;case 13:return jw(i,e,t);case 4:return eb(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=zl(e,null,n,t):Zi(i,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Ls(n,s),yB(i,e,n,s,t);case 7:return Zi(i,e,e.pendingProps,t),e.child;case 8:return Zi(i,e,e.pendingProps.children,t),e.child;case 12:return Zi(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,o=e.memoizedProps,r=s.value,jt(mA,n._currentValue),n._currentValue=r,o!==null)if(Us(o.value,r)){if(o.children===s.children&&!Ui.current){e=or(i,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var g=o.dependencies;if(g!==null){r=o.child;for(var a=g.firstContext;a!==null;){if(a.context===n){if(o.tag===1){a=er(-1,t&-t),a.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var I=l.pending;I===null?a.next=a:(a.next=I.next,I.next=a),l.pending=a}}o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),cf(o.return,t,e),g.lanes|=t;break}a=a.next}}else if(o.tag===10)r=o.type===e.type?null:o.child;else if(o.tag===18){if(r=o.return,r===null)throw Error(Me(341));r.lanes|=t,g=r.alternate,g!==null&&(g.lanes|=t),cf(r,t,e),r=o.sibling}else r=o.child;if(r!==null)r.return=o;else for(r=o;r!==null;){if(r===e){r=null;break}if(o=r.sibling,o!==null){o.return=r.return,r=o;break}r=r.return}o=r}Zi(i,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Xl(e,t),s=Gs(s),n=n(s),e.flags|=1,Zi(i,e,n,t),e.child;case 14:return n=e.type,s=Ls(n,e.pendingProps),s=Ls(n.type,s),BB(i,e,n,s,t);case 15:return Dw(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:Ls(n,s),Td(i,e),e.tag=1,Di(n)?(i=!0,AA(e)):i=!1,Xl(e,t),yw(e,n,s),uf(e,n,s,t),hf(null,e,n,!0,i,t);case 19:return qw(i,e,t);case 22:return Pw(i,e,t)}throw Error(Me(156,e.tag))};function dW(i,e){return z2(i,e)}function tX(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ps(i,e,t,n){return new tX(i,e,t,n)}function Ab(i){return i=i.prototype,!(!i||!i.isReactComponent)}function nX(i){if(typeof i=="function")return Ab(i)?1:0;if(i!=null){if(i=i.$$typeof,i===H0)return 11;if(i===F0)return 14}return 2}function Cg(i,e){var t=i.alternate;return t===null?(t=ps(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function Jd(i,e,t,n,s,o){var r=2;if(n=i,typeof i=="function")Ab(i)&&(r=1);else if(typeof i=="string")r=5;else e:switch(i){case Cl:return ca(t.children,s,o,e);case Y0:r=8,s|=8;break;case Km:return i=ps(12,t,e,s|2),i.elementType=Km,i.lanes=o,i;case Nm:return i=ps(13,t,e,s),i.elementType=Nm,i.lanes=o,i;case Mm:return i=ps(19,t,e,s),i.elementType=Mm,i.lanes=o,i;case B2:return _A(t,s,o,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case G2:r=10;break e;case y2:r=9;break e;case H0:r=11;break e;case F0:r=14;break e;case Jr:r=16,n=null;break e}throw Error(Me(130,i==null?i:typeof i,""))}return e=ps(r,t,e,s),e.elementType=i,e.type=n,e.lanes=o,e}function ca(i,e,t,n){return i=ps(7,i,n,e),i.lanes=t,i}function _A(i,e,t,n){return i=ps(22,i,n,e),i.elementType=B2,i.lanes=t,i.stateNode={isHidden:!1},i}function Np(i,e,t){return i=ps(6,i,null,e),i.lanes=t,i}function Mp(i,e,t){return e=ps(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function iX(i,e,t,n,s){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mp(0),this.expirationTimes=mp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mp(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function hb(i,e,t,n,s,o,r,g,a){return i=new iX(i,e,t,g,a),e===1?(e=1,o===!0&&(e|=8)):e=0,o=ps(3,null,null,e),i.current=o,o.stateNode=i,o.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},$0(o),i}function sX(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cl,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function AW(i){if(!i)return hg;i=i._reactInternals;e:{if(Sa(i)!==i||i.tag!==1)throw Error(Me(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Di(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Me(171))}if(i.tag===1){var t=i.type;if(Di(t))return dw(i,t,e)}return e}function hW(i,e,t,n,s,o,r,g,a){return i=hb(t,n,!0,i,s,o,r,g,a),i.context=AW(null),t=i.current,n=Ri(),s=cg(t),o=er(n,s),o.callback=e!=null?e:null,lg(t,o,s),i.current.lanes=s,uC(i,s,n),Pi(i,n),i}function JA(i,e,t,n){var s=e.current,o=Ri(),r=cg(s);return t=AW(t),e.context===null?e.context=t:e.pendingContext=t,e=er(o,r),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=lg(s,e,r),i!==null&&(Js(i,s,r,o),Ld(i,s,r)),r}function SA(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function FB(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function pb(i,e){FB(i,e),(i=i.alternate)&&FB(i,e)}function oX(){return null}var pW=typeof reportError=="function"?reportError:function(i){console.error(i)};function mb(i){this._internalRoot=i}UA.prototype.render=mb.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(Me(409));JA(i,e,null,null)};UA.prototype.unmount=mb.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;ya(function(){JA(null,i,null,null)}),e[ir]=null}};function UA(i){this._internalRoot=i}UA.prototype.unstable_scheduleHydration=function(i){if(i){var e=D2();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Pr.length&&e!==0&&e<Pr[t].priority;t++);Pr.splice(t,0,i),t===0&&Q2(i)}};function fb(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function DA(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function KB(){}function rX(i,e,t,n,s){if(s){if(typeof n=="function"){var o=n;n=function(){var l=SA(r);o.call(l)}}var r=hW(e,n,i,0,null,!1,!1,"",KB);return i._reactRootContainer=r,i[ir]=r.current,kc(i.nodeType===8?i.parentNode:i),ya(),r}for(;s=i.lastChild;)i.removeChild(s);if(typeof n=="function"){var g=n;n=function(){var l=SA(a);g.call(l)}}var a=hb(i,0,!1,null,null,!1,!1,"",KB);return i._reactRootContainer=a,i[ir]=a.current,kc(i.nodeType===8?i.parentNode:i),ya(function(){JA(e,a,t,n)}),a}function PA(i,e,t,n,s){var o=t._reactRootContainer;if(o){var r=o;if(typeof s=="function"){var g=s;s=function(){var a=SA(r);g.call(a)}}JA(e,r,i,s)}else r=rX(t,e,i,s,n);return SA(r)}J2=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=dc(e.pendingLanes);t!==0&&(M0(e,t|1),Pi(e,Wn()),(Xt&6)===0&&(El=Wn()+500,wg()))}break;case 13:ya(function(){var n=sr(i,1);if(n!==null){var s=Ri();Js(n,i,1,s)}}),pb(i,1)}};L0=function(i){if(i.tag===13){var e=sr(i,134217728);if(e!==null){var t=Ri();Js(e,i,134217728,t)}pb(i,134217728)}};U2=function(i){if(i.tag===13){var e=cg(i),t=sr(i,e);if(t!==null){var n=Ri();Js(t,i,e,n)}pb(i,e)}};D2=function(){return Jt};P2=function(i,e){var t=Jt;try{return Jt=i,e()}finally{Jt=t}};Pm=function(i,e,t){switch(e){case"input":if(km(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var s=MA(n);if(!s)throw Error(Me(90));Z2(n),km(n,s)}}}break;case"textarea":W2(i,t);break;case"select":e=t.value,e!=null&&Sl(i,!!t.multiple,e,!1)}};H2=Cb;F2=ya;var gX={usingClientEntryPoint:!1,Events:[AC,hl,MA,X2,Y2,Cb]},QI={findFiberByHostInstance:na,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},aX={bundleType:QI.bundleType,version:QI.version,rendererPackageName:QI.rendererPackageName,rendererConfig:QI.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:cr.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=M2(i),i===null?null:i.stateNode},findFiberByHostInstance:QI.findFiberByHostInstance||oX,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fu.isDisabled&&Fu.supportsFiber)try{HA=Fu.inject(aX),Ao=Fu}catch{}}ss.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gX;ss.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fb(e))throw Error(Me(200));return sX(i,e,null,t)};ss.createRoot=function(i,e){if(!fb(i))throw Error(Me(299));var t=!1,n="",s=pW;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=hb(i,1,!1,null,null,t,!1,n,s),i[ir]=e.current,kc(i.nodeType===8?i.parentNode:i),new mb(e)};ss.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(Me(188)):(i=Object.keys(i).join(","),Error(Me(268,i)));return i=M2(e),i=i===null?null:i.stateNode,i};ss.flushSync=function(i){return ya(i)};ss.hydrate=function(i,e,t){if(!DA(e))throw Error(Me(200));return PA(null,i,e,!0,t)};ss.hydrateRoot=function(i,e,t){if(!fb(i))throw Error(Me(405));var n=t!=null&&t.hydratedSources||null,s=!1,o="",r=pW;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),e=hW(e,null,i,1,t!=null?t:null,s,!1,o,r),i[ir]=e.current,kc(i),n)for(i=0;i<n.length;i++)t=n[i],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new UA(e)};ss.render=function(i,e,t){if(!DA(e))throw Error(Me(200));return PA(null,i,e,!1,t)};ss.unmountComponentAtNode=function(i){if(!DA(i))throw Error(Me(40));return i._reactRootContainer?(ya(function(){PA(null,null,i,!1,function(){i._reactRootContainer=null,i[ir]=null})}),!0):!1};ss.unstable_batchedUpdates=Cb;ss.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!DA(t))throw Error(Me(200));if(i==null||i._reactInternals===void 0)throw Error(Me(38));return PA(i,e,t,!1,n)};ss.version="18.2.0-next-9e3b772b8-20220608";(function(i){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}e(),i.exports=ss})(h2);const lX=a2(h2.exports);/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const QA="145",IX={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},cX={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},mW=0,Sf=1,fW=2,CX=3,uX=0,bb=1,Gb=2,Bl=3,rr=0,Vi=1,ms=2,tr=0,Ca=1,Rf=2,Vf=3,xf=4,bW=5,qg=100,GW=101,yW=102,Xf=103,Yf=104,BW=200,vW=201,ZW=202,wW=203,yb=204,Bb=205,WW=206,SW=207,RW=208,VW=209,xW=210,XW=0,YW=1,HW=2,RA=3,FW=4,KW=5,NW=6,MW=7,pC=0,LW=1,zW=2,po=0,kW=1,TW=2,EW=3,vb=4,_W=5,OA=300,pg=301,mg=302,Oc=303,jc=304,tI=306,gr=1e3,mi=1001,_l=1002,Sn=1003,qc=1004,dX=1004,$c=1005,AX=1005,en=1006,jA=1007,hX=1007,Cr=1008,pX=1008,fg=1009,JW=1010,UW=1011,Zb=1012,DW=1013,eg=1014,Qo=1015,Jl=1016,PW=1017,QW=1018,ua=1020,OW=1021,jW=1022,fs=1023,qW=1024,$W=1025,ug=1026,Ba=1027,eS=1028,tS=1029,nS=1030,iS=1031,sS=1033,Ud=33776,Dd=33777,Pd=33778,Qd=33779,Hf=35840,Ff=35841,Kf=35842,Nf=35843,oS=36196,Mf=37492,Lf=37496,zf=37808,kf=37809,Tf=37810,Ef=37811,_f=37812,Jf=37813,Uf=37814,Df=37815,Pf=37816,Qf=37817,Of=37818,jf=37819,qf=37820,$f=37821,e0=36492,rS=2200,gS=2201,aS=2202,Ul=2300,va=2301,Od=2302,oa=2400,ra=2401,eC=2402,qA=2500,wb=2501,mX=0,lS=1,Wb=2,bg=3e3,Yt=3001,IS=3200,Sb=3201,ur=0,cS=1,fX="",Co="srgb",tg="srgb-linear",bX=0,jd=7680,GX=7681,yX=7682,BX=7683,vX=34055,ZX=34056,wX=5386,WX=512,SX=513,RX=514,VX=515,xX=516,XX=517,YX=518,CS=519,tC=35044,uS=35048,HX=35040,FX=35045,KX=35049,NX=35041,MX=35046,LX=35050,zX=35042,kX="100",t0="300 es",VA=1035;class yo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(t);o!==-1&&s.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const s=n.slice(0);for(let o=0,r=s.length;o<r;o++)s[o].call(this,e);e.target=null}}}const ui=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let NB=1234567;const da=Math.PI/180,nC=180/Math.PI;function ts(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ui[i&255]+ui[i>>8&255]+ui[i>>16&255]+ui[i>>24&255]+"-"+ui[e&255]+ui[e>>8&255]+"-"+ui[e>>16&15|64]+ui[e>>24&255]+"-"+ui[t&63|128]+ui[t>>8&255]+"-"+ui[t>>16&255]+ui[t>>24&255]+ui[n&255]+ui[n>>8&255]+ui[n>>16&255]+ui[n>>24&255]).toLowerCase()}function Rn(i,e,t){return Math.max(e,Math.min(t,i))}function Rb(i,e){return(i%e+e)%e}function TX(i,e,t,n,s){return n+(i-e)*(s-n)/(t-e)}function EX(i,e,t){return i!==e?(t-i)/(e-i):0}function Wc(i,e,t){return(1-t)*i+t*e}function _X(i,e,t,n){return Wc(i,e,1-Math.exp(-t*n))}function JX(i,e=1){return e-Math.abs(Rb(i,e*2)-e)}function UX(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*(3-2*i))}function DX(i,e,t){return i<=e?0:i>=t?1:(i=(i-e)/(t-e),i*i*i*(i*(i*6-15)+10))}function PX(i,e){return i+Math.floor(Math.random()*(e-i+1))}function QX(i,e){return i+Math.random()*(e-i)}function OX(i){return i*(.5-Math.random())}function jX(i){i!==void 0&&(NB=i);let e=NB+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function qX(i){return i*da}function $X(i){return i*nC}function n0(i){return(i&i-1)===0&&i!==0}function dS(i){return Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function xA(i){return Math.pow(2,Math.floor(Math.log(i)/Math.LN2))}function e9(i,e,t,n,s){const o=Math.cos,r=Math.sin,g=o(t/2),a=r(t/2),l=o((e+n)/2),I=r((e+n)/2),C=o((e-n)/2),u=r((e-n)/2),A=o((n-e)/2),h=r((n-e)/2);switch(s){case"XYX":i.set(g*I,a*C,a*u,g*l);break;case"YZY":i.set(a*u,g*I,a*C,g*l);break;case"ZXZ":i.set(a*C,a*u,g*I,g*l);break;case"XZX":i.set(g*I,a*h,a*A,g*l);break;case"YXY":i.set(a*A,g*I,a*h,g*l);break;case"ZYZ":i.set(a*h,a*A,g*I,g*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Oo(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return i/65535;case Uint8Array:return i/255;case Int16Array:return Math.max(i/32767,-1);case Int8Array:return Math.max(i/127,-1);default:throw new Error("Invalid component type.")}}function Pt(i,e){switch(e.constructor){case Float32Array:return i;case Uint16Array:return Math.round(i*65535);case Uint8Array:return Math.round(i*255);case Int16Array:return Math.round(i*32767);case Int8Array:return Math.round(i*127);default:throw new Error("Invalid component type.")}}var Vb=Object.freeze({__proto__:null,DEG2RAD:da,RAD2DEG:nC,generateUUID:ts,clamp:Rn,euclideanModulo:Rb,mapLinear:TX,inverseLerp:EX,lerp:Wc,damp:_X,pingpong:JX,smoothstep:UX,smootherstep:DX,randInt:PX,randFloat:QX,randFloatSpread:OX,seededRandom:jX,degToRad:qX,radToDeg:$X,isPowerOfTwo:n0,ceilPowerOfTwo:dS,floorPowerOfTwo:xA,setQuaternionFromProperEuler:e9,normalize:Pt,denormalize:Oo});class Se{constructor(e=0,t=0){Se.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),s=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*n-r*s+e.x,this.y=o*s+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Si{constructor(){Si.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,s,o,r,g,a,l){const I=this.elements;return I[0]=e,I[1]=s,I[2]=g,I[3]=t,I[4]=o,I[5]=a,I[6]=n,I[7]=r,I[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,o=this.elements,r=n[0],g=n[3],a=n[6],l=n[1],I=n[4],C=n[7],u=n[2],A=n[5],h=n[8],m=s[0],b=s[3],G=s[6],f=s[1],y=s[4],B=s[7],v=s[2],W=s[5],R=s[8];return o[0]=r*m+g*f+a*v,o[3]=r*b+g*y+a*W,o[6]=r*G+g*B+a*R,o[1]=l*m+I*f+C*v,o[4]=l*b+I*y+C*W,o[7]=l*G+I*B+C*R,o[2]=u*m+A*f+h*v,o[5]=u*b+A*y+h*W,o[8]=u*G+A*B+h*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],s=e[2],o=e[3],r=e[4],g=e[5],a=e[6],l=e[7],I=e[8];return t*r*I-t*g*l-n*o*I+n*g*a+s*o*l-s*r*a}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],o=e[3],r=e[4],g=e[5],a=e[6],l=e[7],I=e[8],C=I*r-g*l,u=g*a-I*o,A=l*o-r*a,h=t*C+n*u+s*A;if(h===0)return this.set(0,0,0,0,0,0,0,0,0);const m=1/h;return e[0]=C*m,e[1]=(s*l-I*n)*m,e[2]=(g*n-s*r)*m,e[3]=u*m,e[4]=(I*t-s*a)*m,e[5]=(s*o-g*t)*m,e[6]=A*m,e[7]=(n*a-l*t)*m,e[8]=(r*t-n*o)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,o,r,g){const a=Math.cos(o),l=Math.sin(o);return this.set(n*a,n*l,-n*(a*r+l*g)+r+e,-s*l,s*a,-s*(-l*r+a*g)+g+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),s=this.elements,o=s[0],r=s[3],g=s[6],a=s[1],l=s[4],I=s[7];return s[0]=t*o+n*a,s[3]=t*r+n*l,s[6]=t*g+n*I,s[1]=-n*o+t*a,s[4]=-n*r+t*l,s[7]=-n*g+t*I,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function AS(i){for(let e=i.length-1;e>=0;--e)if(i[e]>=65535)return!0;return!1}const t9={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function vl(i,e){return new t9[i](e)}function iC(i){return document.createElementNS("http://www.w3.org/1999/xhtml",i)}function Aa(i){return i<.04045?i*.0773993808:Math.pow(i*.9478672986+.0521327014,2.4)}function qd(i){return i<.0031308?i*12.92:1.055*Math.pow(i,.41666)-.055}const Lp={[Co]:{[tg]:Aa},[tg]:{[Co]:qd}},Cs={legacyMode:!0,get workingColorSpace(){return tg},set workingColorSpace(i){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(i,e,t){if(this.legacyMode||e===t||!e||!t)return i;if(Lp[e]&&Lp[e][t]!==void 0){const n=Lp[e][t];return i.r=n(i.r),i.g=n(i.g),i.b=n(i.b),i}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(i,e){return this.convert(i,this.workingColorSpace,e)},toWorkingColorSpace:function(i,e){return this.convert(i,e,this.workingColorSpace)}},hS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mn={r:0,g:0,b:0},Hs={h:0,s:0,l:0},Ku={h:0,s:0,l:0};function zp(i,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?i+(e-i)*6*t:t<1/2?e:t<2/3?i+(e-i)*6*(2/3-t):i}function Nu(i,e){return e.r=i.r,e.g=i.g,e.b=i.b,e}class Ee{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Co){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Cs.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=tg){return this.r=e,this.g=t,this.b=n,Cs.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=tg){if(e=Rb(e,1),t=Rn(t,0,1),n=Rn(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,r=2*n-o;this.r=zp(r,o,e+1/3),this.g=zp(r,o,e),this.b=zp(r,o,e-1/3)}return Cs.toWorkingColorSpace(this,s),this}setStyle(e,t=Co){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const r=s[1],g=s[2];switch(r){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Cs.toWorkingColorSpace(this,t),n(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Cs.toWorkingColorSpace(this,t),n(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(g)){const a=parseFloat(o[1])/360,l=parseFloat(o[2])/100,I=parseFloat(o[3])/100;return n(o[4]),this.setHSL(a,l,I,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],r=o.length;if(r===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Cs.toWorkingColorSpace(this,t),this;if(r===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Cs.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=Co){const n=hS[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Aa(e.r),this.g=Aa(e.g),this.b=Aa(e.b),this}copyLinearToSRGB(e){return this.r=qd(e.r),this.g=qd(e.g),this.b=qd(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Co){return Cs.fromWorkingColorSpace(Nu(this,Mn),e),Rn(Mn.r*255,0,255)<<16^Rn(Mn.g*255,0,255)<<8^Rn(Mn.b*255,0,255)<<0}getHexString(e=Co){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=tg){Cs.fromWorkingColorSpace(Nu(this,Mn),t);const n=Mn.r,s=Mn.g,o=Mn.b,r=Math.max(n,s,o),g=Math.min(n,s,o);let a,l;const I=(g+r)/2;if(g===r)a=0,l=0;else{const C=r-g;switch(l=I<=.5?C/(r+g):C/(2-r-g),r){case n:a=(s-o)/C+(s<o?6:0);break;case s:a=(o-n)/C+2;break;case o:a=(n-s)/C+4;break}a/=6}return e.h=a,e.s=l,e.l=I,e}getRGB(e,t=tg){return Cs.fromWorkingColorSpace(Nu(this,Mn),t),e.r=Mn.r,e.g=Mn.g,e.b=Mn.b,e}getStyle(e=Co){return Cs.fromWorkingColorSpace(Nu(this,Mn),e),e!==Co?`color(${e} ${Mn.r} ${Mn.g} ${Mn.b})`:`rgb(${Mn.r*255|0},${Mn.g*255|0},${Mn.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(Hs),Hs.h+=e,Hs.s+=t,Hs.l+=n,this.setHSL(Hs.h,Hs.s,Hs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Hs),e.getHSL(Ku);const n=Wc(Hs.h,Ku.h,t),s=Wc(Hs.s,Ku.s,t),o=Wc(Hs.l,Ku.l,t);return this.setHSL(n,s,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}Ee.NAMES=hS;let Ua;class xb{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ua===void 0&&(Ua=iC("canvas")),Ua.width=e.width,Ua.height=e.height;const n=Ua.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Ua}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=iC("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const s=n.getImageData(0,0,e.width,e.height),o=s.data;for(let r=0;r<o.length;r++)o[r]=Aa(o[r]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Aa(t[n]/255)*255):t[n]=Aa(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ga{constructor(e=null){this.isSource=!0,this.uuid=ts(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let o;if(Array.isArray(s)){o=[];for(let r=0,g=s.length;r<g;r++)s[r].isDataTexture?o.push(kp(s[r].image)):o.push(kp(s[r]))}else o=kp(s);n.url=o}return t||(e.images[this.uuid]=n),n}}function kp(i){return typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap?xb.getDataURL(i):i.data?{data:Array.from(i.data),width:i.width,height:i.height,type:i.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let n9=0;class Cn extends yo{constructor(e=Cn.DEFAULT_IMAGE,t=Cn.DEFAULT_MAPPING,n=mi,s=mi,o=en,r=Cr,g=fs,a=fg,l=1,I=bg){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:n9++}),this.uuid=ts(),this.name="",this.source=new ga(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=s,this.magFilter=o,this.minFilter=r,this.anisotropy=l,this.format=g,this.internalFormat=null,this.type=a,this.offset=new Se(0,0),this.repeat=new Se(1,1),this.center=new Se(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Si,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=I,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==OA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case gr:e.x=e.x-Math.floor(e.x);break;case mi:e.x=e.x<0?0:1;break;case _l:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case gr:e.y=e.y-Math.floor(e.y);break;case mi:e.y=e.y<0?0:1;break;case _l:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Cn.DEFAULT_IMAGE=null;Cn.DEFAULT_MAPPING=OA;class Ht{constructor(e=0,t=0,n=0,s=1){Ht.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,o=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*s+r[12]*o,this.y=r[1]*t+r[5]*n+r[9]*s+r[13]*o,this.z=r[2]*t+r[6]*n+r[10]*s+r[14]*o,this.w=r[3]*t+r[7]*n+r[11]*s+r[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,o;const a=e.elements,l=a[0],I=a[4],C=a[8],u=a[1],A=a[5],h=a[9],m=a[2],b=a[6],G=a[10];if(Math.abs(I-u)<.01&&Math.abs(C-m)<.01&&Math.abs(h-b)<.01){if(Math.abs(I+u)<.1&&Math.abs(C+m)<.1&&Math.abs(h+b)<.1&&Math.abs(l+A+G-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(l+1)/2,B=(A+1)/2,v=(G+1)/2,W=(I+u)/4,R=(C+m)/4,Z=(h+b)/4;return y>B&&y>v?y<.01?(n=0,s=.707106781,o=.707106781):(n=Math.sqrt(y),s=W/n,o=R/n):B>v?B<.01?(n=.707106781,s=0,o=.707106781):(s=Math.sqrt(B),n=W/s,o=Z/s):v<.01?(n=.707106781,s=.707106781,o=0):(o=Math.sqrt(v),n=R/o,s=Z/o),this.set(n,s,o,t),this}let f=Math.sqrt((b-h)*(b-h)+(C-m)*(C-m)+(u-I)*(u-I));return Math.abs(f)<.001&&(f=1),this.x=(b-h)/f,this.y=(C-m)/f,this.z=(u-I)/f,this.w=Math.acos((l+A+G-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Bs extends yo{constructor(e,t,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ht(0,0,e,t),this.scissorTest=!1,this.viewport=new Ht(0,0,e,t);const s={width:e,height:t,depth:1};this.texture=new Cn(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:en,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ga(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class mC extends Cn{constructor(e=null,t=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Sn,this.minFilter=Sn,this.wrapR=mi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class i9 extends Bs{constructor(e,t,n){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new mC(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class $A extends Cn{constructor(e=null,t=1,n=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:s},this.magFilter=Sn,this.minFilter=Sn,this.wrapR=mi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class s9 extends Bs{constructor(e,t,n){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new $A(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class o9 extends Bs{constructor(e,t,n,s={}){super(e,t,s),this.isWebGLMultipleRenderTargets=!0;const o=this.texture;this.texture=[];for(let r=0;r<n;r++)this.texture[r]=o.clone(),this.texture[r].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,o=this.texture.length;s<o;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Qn{constructor(e=0,t=0,n=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=s}static slerpFlat(e,t,n,s,o,r,g){let a=n[s+0],l=n[s+1],I=n[s+2],C=n[s+3];const u=o[r+0],A=o[r+1],h=o[r+2],m=o[r+3];if(g===0){e[t+0]=a,e[t+1]=l,e[t+2]=I,e[t+3]=C;return}if(g===1){e[t+0]=u,e[t+1]=A,e[t+2]=h,e[t+3]=m;return}if(C!==m||a!==u||l!==A||I!==h){let b=1-g;const G=a*u+l*A+I*h+C*m,f=G>=0?1:-1,y=1-G*G;if(y>Number.EPSILON){const v=Math.sqrt(y),W=Math.atan2(v,G*f);b=Math.sin(b*W)/v,g=Math.sin(g*W)/v}const B=g*f;if(a=a*b+u*B,l=l*b+A*B,I=I*b+h*B,C=C*b+m*B,b===1-g){const v=1/Math.sqrt(a*a+l*l+I*I+C*C);a*=v,l*=v,I*=v,C*=v}}e[t]=a,e[t+1]=l,e[t+2]=I,e[t+3]=C}static multiplyQuaternionsFlat(e,t,n,s,o,r){const g=n[s],a=n[s+1],l=n[s+2],I=n[s+3],C=o[r],u=o[r+1],A=o[r+2],h=o[r+3];return e[t]=g*h+I*C+a*A-l*u,e[t+1]=a*h+I*u+l*C-g*A,e[t+2]=l*h+I*A+g*u-a*C,e[t+3]=I*h-g*C-a*u-l*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,s=e._y,o=e._z,r=e._order,g=Math.cos,a=Math.sin,l=g(n/2),I=g(s/2),C=g(o/2),u=a(n/2),A=a(s/2),h=a(o/2);switch(r){case"XYZ":this._x=u*I*C+l*A*h,this._y=l*A*C-u*I*h,this._z=l*I*h+u*A*C,this._w=l*I*C-u*A*h;break;case"YXZ":this._x=u*I*C+l*A*h,this._y=l*A*C-u*I*h,this._z=l*I*h-u*A*C,this._w=l*I*C+u*A*h;break;case"ZXY":this._x=u*I*C-l*A*h,this._y=l*A*C+u*I*h,this._z=l*I*h+u*A*C,this._w=l*I*C-u*A*h;break;case"ZYX":this._x=u*I*C-l*A*h,this._y=l*A*C+u*I*h,this._z=l*I*h-u*A*C,this._w=l*I*C+u*A*h;break;case"YZX":this._x=u*I*C+l*A*h,this._y=l*A*C+u*I*h,this._z=l*I*h-u*A*C,this._w=l*I*C-u*A*h;break;case"XZY":this._x=u*I*C-l*A*h,this._y=l*A*C-u*I*h,this._z=l*I*h+u*A*C,this._w=l*I*C+u*A*h;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],s=t[4],o=t[8],r=t[1],g=t[5],a=t[9],l=t[2],I=t[6],C=t[10],u=n+g+C;if(u>0){const A=.5/Math.sqrt(u+1);this._w=.25/A,this._x=(I-a)*A,this._y=(o-l)*A,this._z=(r-s)*A}else if(n>g&&n>C){const A=2*Math.sqrt(1+n-g-C);this._w=(I-a)/A,this._x=.25*A,this._y=(s+r)/A,this._z=(o+l)/A}else if(g>C){const A=2*Math.sqrt(1+g-n-C);this._w=(o-l)/A,this._x=(s+r)/A,this._y=.25*A,this._z=(a+I)/A}else{const A=2*Math.sqrt(1+C-n-g);this._w=(r-s)/A,this._x=(o+l)/A,this._y=(a+I)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,s=e._y,o=e._z,r=e._w,g=t._x,a=t._y,l=t._z,I=t._w;return this._x=n*I+r*g+s*l-o*a,this._y=s*I+r*a+o*g-n*l,this._z=o*I+r*l+n*a-s*g,this._w=r*I-n*g-s*a-o*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,s=this._y,o=this._z,r=this._w;let g=r*e._w+n*e._x+s*e._y+o*e._z;if(g<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,g=-g):this.copy(e),g>=1)return this._w=r,this._x=n,this._y=s,this._z=o,this;const a=1-g*g;if(a<=Number.EPSILON){const A=1-t;return this._w=A*r+t*this._w,this._x=A*n+t*this._x,this._y=A*s+t*this._y,this._z=A*o+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),I=Math.atan2(l,g),C=Math.sin((1-t)*I)/l,u=Math.sin(t*I)/l;return this._w=r*C+this._w*u,this._x=n*C+this._x*u,this._y=s*C+this._y*u,this._z=o*C+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),o=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(o),n*Math.cos(o),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class N{constructor(e=0,t=0,n=0){N.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(MB.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(MB.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*s,this.y=o[1]*t+o[4]*n+o[7]*s,this.z=o[2]*t+o[5]*n+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,s=this.z,o=e.elements,r=1/(o[3]*t+o[7]*n+o[11]*s+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*s+o[12])*r,this.y=(o[1]*t+o[5]*n+o[9]*s+o[13])*r,this.z=(o[2]*t+o[6]*n+o[10]*s+o[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,s=this.z,o=e.x,r=e.y,g=e.z,a=e.w,l=a*t+r*s-g*n,I=a*n+g*t-o*s,C=a*s+o*n-r*t,u=-o*t-r*n-g*s;return this.x=l*a+u*-o+I*-g-C*-r,this.y=I*a+u*-r+C*-o-l*-g,this.z=C*a+u*-g+l*-r-I*-o,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s,this.y=o[1]*t+o[5]*n+o[9]*s,this.z=o[2]*t+o[6]*n+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,s=e.y,o=e.z,r=t.x,g=t.y,a=t.z;return this.x=s*a-o*g,this.y=o*r-n*a,this.z=n*g-s*r,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Tp.copy(this).projectOnVector(e),this.sub(Tp)}reflect(e){return this.sub(Tp.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Rn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Tp=new N,MB=new Qn;class dr{constructor(e=new N(1/0,1/0,1/0),t=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,o=-1/0,r=-1/0,g=-1/0;for(let a=0,l=e.length;a<l;a+=3){const I=e[a],C=e[a+1],u=e[a+2];I<t&&(t=I),C<n&&(n=C),u<s&&(s=u),I>o&&(o=I),C>r&&(r=C),u>g&&(g=u)}return this.min.set(t,n,s),this.max.set(o,r,g),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,o=-1/0,r=-1/0,g=-1/0;for(let a=0,l=e.count;a<l;a++){const I=e.getX(a),C=e.getY(a),u=e.getZ(a);I<t&&(t=I),C<n&&(n=C),u<s&&(s=u),I>o&&(o=I),C>r&&(r=C),u>g&&(g=u)}return this.min.set(t,n,s),this.max.set(o,r,g),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Lg.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const o=n.attributes.position;for(let r=0,g=o.count;r<g;r++)Lg.fromBufferAttribute(o,r).applyMatrix4(e.matrixWorld),this.expandByPoint(Lg)}else n.boundingBox===null&&n.computeBoundingBox(),Ep.copy(n.boundingBox),Ep.applyMatrix4(e.matrixWorld),this.union(Ep);const s=e.children;for(let o=0,r=s.length;o<r;o++)this.expandByObject(s[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Lg),Lg.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(OI),Mu.subVectors(this.max,OI),Da.subVectors(e.a,OI),Pa.subVectors(e.b,OI),Qa.subVectors(e.c,OI),Kr.subVectors(Pa,Da),Nr.subVectors(Qa,Pa),zg.subVectors(Da,Qa);let t=[0,-Kr.z,Kr.y,0,-Nr.z,Nr.y,0,-zg.z,zg.y,Kr.z,0,-Kr.x,Nr.z,0,-Nr.x,zg.z,0,-zg.x,-Kr.y,Kr.x,0,-Nr.y,Nr.x,0,-zg.y,zg.x,0];return!_p(t,Da,Pa,Qa,Mu)||(t=[1,0,0,0,1,0,0,0,1],!_p(t,Da,Pa,Qa,Mu))?!1:(Lu.crossVectors(Kr,Nr),t=[Lu.x,Lu.y,Lu.z],_p(t,Da,Pa,Qa,Mu))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Lg.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Lg).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(No[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),No[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),No[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),No[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),No[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),No[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),No[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),No[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(No),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const No=[new N,new N,new N,new N,new N,new N,new N,new N],Lg=new N,Ep=new dr,Da=new N,Pa=new N,Qa=new N,Kr=new N,Nr=new N,zg=new N,OI=new N,Mu=new N,Lu=new N,kg=new N;function _p(i,e,t,n,s){for(let o=0,r=i.length-3;o<=r;o+=3){kg.fromArray(i,o);const g=s.x*Math.abs(kg.x)+s.y*Math.abs(kg.y)+s.z*Math.abs(kg.z),a=e.dot(kg),l=t.dot(kg),I=n.dot(kg);if(Math.max(-Math.max(a,l,I),Math.min(a,l,I))>g)return!1}return!0}const r9=new dr,LB=new N,zu=new N,Jp=new N;class Ar{constructor(e=new N,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):r9.setFromPoints(e).getCenter(n);let s=0;for(let o=0,r=e.length;o<r;o++)s=Math.max(s,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Jp.subVectors(e,this.center);const t=Jp.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.add(Jp.multiplyScalar(s/n)),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?zu.set(0,0,1).multiplyScalar(e.radius):zu.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(LB.copy(e.center).add(zu)),this.expandByPoint(LB.copy(e.center).sub(zu)),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Mo=new N,Up=new N,ku=new N,Mr=new N,Dp=new N,Tu=new N,Pp=new N;class fC{constructor(e=new N,t=new N(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Mo)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Mo.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Mo.copy(this.direction).multiplyScalar(t).add(this.origin),Mo.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Up.copy(e).add(t).multiplyScalar(.5),ku.copy(t).sub(e).normalize(),Mr.copy(this.origin).sub(Up);const o=e.distanceTo(t)*.5,r=-this.direction.dot(ku),g=Mr.dot(this.direction),a=-Mr.dot(ku),l=Mr.lengthSq(),I=Math.abs(1-r*r);let C,u,A,h;if(I>0)if(C=r*a-g,u=r*g-a,h=o*I,C>=0)if(u>=-h)if(u<=h){const m=1/I;C*=m,u*=m,A=C*(C+r*u+2*g)+u*(r*C+u+2*a)+l}else u=o,C=Math.max(0,-(r*u+g)),A=-C*C+u*(u+2*a)+l;else u=-o,C=Math.max(0,-(r*u+g)),A=-C*C+u*(u+2*a)+l;else u<=-h?(C=Math.max(0,-(-r*o+g)),u=C>0?-o:Math.min(Math.max(-o,-a),o),A=-C*C+u*(u+2*a)+l):u<=h?(C=0,u=Math.min(Math.max(-o,-a),o),A=u*(u+2*a)+l):(C=Math.max(0,-(r*o+g)),u=C>0?o:Math.min(Math.max(-o,-a),o),A=-C*C+u*(u+2*a)+l);else u=r>0?-o:o,C=Math.max(0,-(r*u+g)),A=-C*C+u*(u+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(C).add(this.origin),s&&s.copy(ku).multiplyScalar(u).add(Up),A}intersectSphere(e,t){Mo.subVectors(e.center,this.origin);const n=Mo.dot(this.direction),s=Mo.dot(Mo)-n*n,o=e.radius*e.radius;if(s>o)return null;const r=Math.sqrt(o-s),g=n-r,a=n+r;return g<0&&a<0?null:g<0?this.at(a,t):this.at(g,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,o,r,g,a;const l=1/this.direction.x,I=1/this.direction.y,C=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,s=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,s=(e.min.x-u.x)*l),I>=0?(o=(e.min.y-u.y)*I,r=(e.max.y-u.y)*I):(o=(e.max.y-u.y)*I,r=(e.min.y-u.y)*I),n>r||o>s||((o>n||n!==n)&&(n=o),(r<s||s!==s)&&(s=r),C>=0?(g=(e.min.z-u.z)*C,a=(e.max.z-u.z)*C):(g=(e.max.z-u.z)*C,a=(e.min.z-u.z)*C),n>a||g>s)||((g>n||n!==n)&&(n=g),(a<s||s!==s)&&(s=a),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,Mo)!==null}intersectTriangle(e,t,n,s,o){Dp.subVectors(t,e),Tu.subVectors(n,e),Pp.crossVectors(Dp,Tu);let r=this.direction.dot(Pp),g;if(r>0){if(s)return null;g=1}else if(r<0)g=-1,r=-r;else return null;Mr.subVectors(this.origin,e);const a=g*this.direction.dot(Tu.crossVectors(Mr,Tu));if(a<0)return null;const l=g*this.direction.dot(Dp.cross(Mr));if(l<0||a+l>r)return null;const I=-g*Mr.dot(Pp);return I<0?null:this.at(I/r,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class dt{constructor(){dt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,s,o,r,g,a,l,I,C,u,A,h,m,b){const G=this.elements;return G[0]=e,G[4]=t,G[8]=n,G[12]=s,G[1]=o,G[5]=r,G[9]=g,G[13]=a,G[2]=l,G[6]=I,G[10]=C,G[14]=u,G[3]=A,G[7]=h,G[11]=m,G[15]=b,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new dt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,s=1/Oa.setFromMatrixColumn(e,0).length(),o=1/Oa.setFromMatrixColumn(e,1).length(),r=1/Oa.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,s=e.y,o=e.z,r=Math.cos(n),g=Math.sin(n),a=Math.cos(s),l=Math.sin(s),I=Math.cos(o),C=Math.sin(o);if(e.order==="XYZ"){const u=r*I,A=r*C,h=g*I,m=g*C;t[0]=a*I,t[4]=-a*C,t[8]=l,t[1]=A+h*l,t[5]=u-m*l,t[9]=-g*a,t[2]=m-u*l,t[6]=h+A*l,t[10]=r*a}else if(e.order==="YXZ"){const u=a*I,A=a*C,h=l*I,m=l*C;t[0]=u+m*g,t[4]=h*g-A,t[8]=r*l,t[1]=r*C,t[5]=r*I,t[9]=-g,t[2]=A*g-h,t[6]=m+u*g,t[10]=r*a}else if(e.order==="ZXY"){const u=a*I,A=a*C,h=l*I,m=l*C;t[0]=u-m*g,t[4]=-r*C,t[8]=h+A*g,t[1]=A+h*g,t[5]=r*I,t[9]=m-u*g,t[2]=-r*l,t[6]=g,t[10]=r*a}else if(e.order==="ZYX"){const u=r*I,A=r*C,h=g*I,m=g*C;t[0]=a*I,t[4]=h*l-A,t[8]=u*l+m,t[1]=a*C,t[5]=m*l+u,t[9]=A*l-h,t[2]=-l,t[6]=g*a,t[10]=r*a}else if(e.order==="YZX"){const u=r*a,A=r*l,h=g*a,m=g*l;t[0]=a*I,t[4]=m-u*C,t[8]=h*C+A,t[1]=C,t[5]=r*I,t[9]=-g*I,t[2]=-l*I,t[6]=A*C+h,t[10]=u-m*C}else if(e.order==="XZY"){const u=r*a,A=r*l,h=g*a,m=g*l;t[0]=a*I,t[4]=-C,t[8]=l*I,t[1]=u*C+m,t[5]=r*I,t[9]=A*C-h,t[2]=h*C-A,t[6]=g*I,t[10]=m*C+u}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(g9,e,a9)}lookAt(e,t,n){const s=this.elements;return Oi.subVectors(e,t),Oi.lengthSq()===0&&(Oi.z=1),Oi.normalize(),Lr.crossVectors(n,Oi),Lr.lengthSq()===0&&(Math.abs(n.z)===1?Oi.x+=1e-4:Oi.z+=1e-4,Oi.normalize(),Lr.crossVectors(n,Oi)),Lr.normalize(),Eu.crossVectors(Oi,Lr),s[0]=Lr.x,s[4]=Eu.x,s[8]=Oi.x,s[1]=Lr.y,s[5]=Eu.y,s[9]=Oi.y,s[2]=Lr.z,s[6]=Eu.z,s[10]=Oi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,s=t.elements,o=this.elements,r=n[0],g=n[4],a=n[8],l=n[12],I=n[1],C=n[5],u=n[9],A=n[13],h=n[2],m=n[6],b=n[10],G=n[14],f=n[3],y=n[7],B=n[11],v=n[15],W=s[0],R=s[4],Z=s[8],V=s[12],H=s[1],P=s[5],E=s[9],L=s[13],K=s[2],O=s[6],q=s[10],ne=s[14],k=s[3],F=s[7],z=s[11],X=s[15];return o[0]=r*W+g*H+a*K+l*k,o[4]=r*R+g*P+a*O+l*F,o[8]=r*Z+g*E+a*q+l*z,o[12]=r*V+g*L+a*ne+l*X,o[1]=I*W+C*H+u*K+A*k,o[5]=I*R+C*P+u*O+A*F,o[9]=I*Z+C*E+u*q+A*z,o[13]=I*V+C*L+u*ne+A*X,o[2]=h*W+m*H+b*K+G*k,o[6]=h*R+m*P+b*O+G*F,o[10]=h*Z+m*E+b*q+G*z,o[14]=h*V+m*L+b*ne+G*X,o[3]=f*W+y*H+B*K+v*k,o[7]=f*R+y*P+B*O+v*F,o[11]=f*Z+y*E+B*q+v*z,o[15]=f*V+y*L+B*ne+v*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],s=e[8],o=e[12],r=e[1],g=e[5],a=e[9],l=e[13],I=e[2],C=e[6],u=e[10],A=e[14],h=e[3],m=e[7],b=e[11],G=e[15];return h*(+o*a*C-s*l*C-o*g*u+n*l*u+s*g*A-n*a*A)+m*(+t*a*A-t*l*u+o*r*u-s*r*A+s*l*I-o*a*I)+b*(+t*l*C-t*g*A-o*r*C+n*r*A+o*g*I-n*l*I)+G*(-s*g*I-t*a*C+t*g*u+s*r*C-n*r*u+n*a*I)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],s=e[2],o=e[3],r=e[4],g=e[5],a=e[6],l=e[7],I=e[8],C=e[9],u=e[10],A=e[11],h=e[12],m=e[13],b=e[14],G=e[15],f=C*b*l-m*u*l+m*a*A-g*b*A-C*a*G+g*u*G,y=h*u*l-I*b*l-h*a*A+r*b*A+I*a*G-r*u*G,B=I*m*l-h*C*l+h*g*A-r*m*A-I*g*G+r*C*G,v=h*C*a-I*m*a-h*g*u+r*m*u+I*g*b-r*C*b,W=t*f+n*y+s*B+o*v;if(W===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/W;return e[0]=f*R,e[1]=(m*u*o-C*b*o-m*s*A+n*b*A+C*s*G-n*u*G)*R,e[2]=(g*b*o-m*a*o+m*s*l-n*b*l-g*s*G+n*a*G)*R,e[3]=(C*a*o-g*u*o-C*s*l+n*u*l+g*s*A-n*a*A)*R,e[4]=y*R,e[5]=(I*b*o-h*u*o+h*s*A-t*b*A-I*s*G+t*u*G)*R,e[6]=(h*a*o-r*b*o-h*s*l+t*b*l+r*s*G-t*a*G)*R,e[7]=(r*u*o-I*a*o+I*s*l-t*u*l-r*s*A+t*a*A)*R,e[8]=B*R,e[9]=(h*C*o-I*m*o-h*n*A+t*m*A+I*n*G-t*C*G)*R,e[10]=(r*m*o-h*g*o+h*n*l-t*m*l-r*n*G+t*g*G)*R,e[11]=(I*g*o-r*C*o-I*n*l+t*C*l+r*n*A-t*g*A)*R,e[12]=v*R,e[13]=(I*m*s-h*C*s+h*n*u-t*m*u-I*n*b+t*C*b)*R,e[14]=(h*g*s-r*m*s-h*n*a+t*m*a+r*n*b-t*g*b)*R,e[15]=(r*C*s-I*g*s+I*n*a-t*C*a-r*n*u+t*g*u)*R,this}scale(e){const t=this.elements,n=e.x,s=e.y,o=e.z;return t[0]*=n,t[4]*=s,t[8]*=o,t[1]*=n,t[5]*=s,t[9]*=o,t[2]*=n,t[6]*=s,t[10]*=o,t[3]*=n,t[7]*=s,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),s=Math.sin(t),o=1-n,r=e.x,g=e.y,a=e.z,l=o*r,I=o*g;return this.set(l*r+n,l*g-s*a,l*a+s*g,0,l*g+s*a,I*g+n,I*a-s*r,0,l*a-s*g,I*a+s*r,o*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,o,r){return this.set(1,n,o,0,e,1,r,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){const s=this.elements,o=t._x,r=t._y,g=t._z,a=t._w,l=o+o,I=r+r,C=g+g,u=o*l,A=o*I,h=o*C,m=r*I,b=r*C,G=g*C,f=a*l,y=a*I,B=a*C,v=n.x,W=n.y,R=n.z;return s[0]=(1-(m+G))*v,s[1]=(A+B)*v,s[2]=(h-y)*v,s[3]=0,s[4]=(A-B)*W,s[5]=(1-(u+G))*W,s[6]=(b+f)*W,s[7]=0,s[8]=(h+y)*R,s[9]=(b-f)*R,s[10]=(1-(u+m))*R,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){const s=this.elements;let o=Oa.set(s[0],s[1],s[2]).length();const r=Oa.set(s[4],s[5],s[6]).length(),g=Oa.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],Fs.copy(this);const l=1/o,I=1/r,C=1/g;return Fs.elements[0]*=l,Fs.elements[1]*=l,Fs.elements[2]*=l,Fs.elements[4]*=I,Fs.elements[5]*=I,Fs.elements[6]*=I,Fs.elements[8]*=C,Fs.elements[9]*=C,Fs.elements[10]*=C,t.setFromRotationMatrix(Fs),n.x=o,n.y=r,n.z=g,this}makePerspective(e,t,n,s,o,r){const g=this.elements,a=2*o/(t-e),l=2*o/(n-s),I=(t+e)/(t-e),C=(n+s)/(n-s),u=-(r+o)/(r-o),A=-2*r*o/(r-o);return g[0]=a,g[4]=0,g[8]=I,g[12]=0,g[1]=0,g[5]=l,g[9]=C,g[13]=0,g[2]=0,g[6]=0,g[10]=u,g[14]=A,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this}makeOrthographic(e,t,n,s,o,r){const g=this.elements,a=1/(t-e),l=1/(n-s),I=1/(r-o),C=(t+e)*a,u=(n+s)*l,A=(r+o)*I;return g[0]=2*a,g[4]=0,g[8]=0,g[12]=-C,g[1]=0,g[5]=2*l,g[9]=0,g[13]=-u,g[2]=0,g[6]=0,g[10]=-2*I,g[14]=-A,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Oa=new N,Fs=new dt,g9=new N(0,0,0),a9=new N(1,1,1),Lr=new N,Eu=new N,Oi=new N,zB=new dt,kB=new Qn;class Wg{constructor(e=0,t=0,n=0,s=Wg.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const s=e.elements,o=s[0],r=s[4],g=s[8],a=s[1],l=s[5],I=s[9],C=s[2],u=s[6],A=s[10];switch(t){case"XYZ":this._y=Math.asin(Rn(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(-I,A),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Rn(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(g,A),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-C,o),this._z=0);break;case"ZXY":this._x=Math.asin(Rn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-C,A),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(a,o));break;case"ZYX":this._y=Math.asin(-Rn(C,-1,1)),Math.abs(C)<.9999999?(this._x=Math.atan2(u,A),this._z=Math.atan2(a,o)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Rn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-I,l),this._y=Math.atan2(-C,o)):(this._x=0,this._y=Math.atan2(g,A));break;case"XZY":this._z=Math.asin(-Rn(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(g,o)):(this._x=Math.atan2(-I,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return zB.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zB,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return kB.setFromEuler(this),this.setFromQuaternion(kB,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Wg.DefaultOrder="XYZ";Wg.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ha{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let l9=0;const TB=new N,ja=new Qn,Lo=new dt,_u=new N,jI=new N,I9=new N,c9=new Qn,EB=new N(1,0,0),_B=new N(0,1,0),JB=new N(0,0,1),C9={type:"added"},UB={type:"removed"};class St extends yo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:l9++}),this.uuid=ts(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=St.DefaultUp.clone();const e=new N,t=new Wg,n=new Qn,s=new N(1,1,1);function o(){n.setFromEuler(t,!1)}function r(){t.setFromQuaternion(n,void 0,!1)}t._onChange(o),n._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new dt},normalMatrix:{value:new Si}}),this.matrix=new dt,this.matrixWorld=new dt,this.matrixAutoUpdate=St.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=St.DefaultMatrixWorldAutoUpdate,this.layers=new ha,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return ja.setFromAxisAngle(e,t),this.quaternion.multiply(ja),this}rotateOnWorldAxis(e,t){return ja.setFromAxisAngle(e,t),this.quaternion.premultiply(ja),this}rotateX(e){return this.rotateOnAxis(EB,e)}rotateY(e){return this.rotateOnAxis(_B,e)}rotateZ(e){return this.rotateOnAxis(JB,e)}translateOnAxis(e,t){return TB.copy(e).applyQuaternion(this.quaternion),this.position.add(TB.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(EB,e)}translateY(e){return this.translateOnAxis(_B,e)}translateZ(e){return this.translateOnAxis(JB,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Lo.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?_u.copy(e):_u.set(e,t,n);const s=this.parent;this.updateWorldMatrix(!0,!1),jI.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Lo.lookAt(jI,_u,this.up):Lo.lookAt(_u,jI,this.up),this.quaternion.setFromRotationMatrix(Lo),s&&(Lo.extractRotation(s.matrixWorld),ja.setFromRotationMatrix(Lo),this.quaternion.premultiply(ja.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(C9)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(UB)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(UB)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Lo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Lo.multiply(e.parent.matrixWorld)),e.applyMatrix4(Lo),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){const r=this.children[n].getObjectByProperty(e,t);if(r!==void 0)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jI,e,I9),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(jI,c9,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,s=t.length;n<s;n++){const o=t[n];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const s=this.children;for(let o=0,r=s.length;o<r;o++){const g=s[o];g.matrixWorldAutoUpdate===!0&&g.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function o(g,a){return g[a.uuid]===void 0&&(g[a.uuid]=a.toJSON(e)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const g=this.geometry.parameters;if(g!==void 0&&g.shapes!==void 0){const a=g.shapes;if(Array.isArray(a))for(let l=0,I=a.length;l<I;l++){const C=a[l];o(e.shapes,C)}else o(e.shapes,a)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const g=[];for(let a=0,l=this.material.length;a<l;a++)g.push(o(e.materials,this.material[a]));s.material=g}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let g=0;g<this.children.length;g++)s.children.push(this.children[g].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let g=0;g<this.animations.length;g++){const a=this.animations[g];s.animations.push(o(e.animations,a))}}if(t){const g=r(e.geometries),a=r(e.materials),l=r(e.textures),I=r(e.images),C=r(e.shapes),u=r(e.skeletons),A=r(e.animations),h=r(e.nodes);g.length>0&&(n.geometries=g),a.length>0&&(n.materials=a),l.length>0&&(n.textures=l),I.length>0&&(n.images=I),C.length>0&&(n.shapes=C),u.length>0&&(n.skeletons=u),A.length>0&&(n.animations=A),h.length>0&&(n.nodes=h)}return n.object=s,n;function r(g){const a=[];for(const l in g){const I=g[l];delete I.metadata,a.push(I)}return a}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const s=e.children[n];this.add(s.clone())}return this}}St.DefaultUp=new N(0,1,0);St.DefaultMatrixAutoUpdate=!0;St.DefaultMatrixWorldAutoUpdate=!0;const Ks=new N,zo=new N,Qp=new N,ko=new N,qa=new N,$a=new N,DB=new N,Op=new N,jp=new N,qp=new N;class hs{constructor(e=new N,t=new N,n=new N){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),Ks.subVectors(e,t),s.cross(Ks);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,t,n,s,o){Ks.subVectors(s,t),zo.subVectors(n,t),Qp.subVectors(e,t);const r=Ks.dot(Ks),g=Ks.dot(zo),a=Ks.dot(Qp),l=zo.dot(zo),I=zo.dot(Qp),C=r*l-g*g;if(C===0)return o.set(-2,-1,-1);const u=1/C,A=(l*a-g*I)*u,h=(r*I-g*a)*u;return o.set(1-A-h,h,A)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,ko),ko.x>=0&&ko.y>=0&&ko.x+ko.y<=1}static getUV(e,t,n,s,o,r,g,a){return this.getBarycoord(e,t,n,s,ko),a.set(0,0),a.addScaledVector(o,ko.x),a.addScaledVector(r,ko.y),a.addScaledVector(g,ko.z),a}static isFrontFacing(e,t,n,s){return Ks.subVectors(n,t),zo.subVectors(e,t),Ks.cross(zo).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ks.subVectors(this.c,this.b),zo.subVectors(this.a,this.b),Ks.cross(zo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return hs.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return hs.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,o){return hs.getUV(e,this.a,this.b,this.c,t,n,s,o)}containsPoint(e){return hs.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return hs.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,s=this.b,o=this.c;let r,g;qa.subVectors(s,n),$a.subVectors(o,n),Op.subVectors(e,n);const a=qa.dot(Op),l=$a.dot(Op);if(a<=0&&l<=0)return t.copy(n);jp.subVectors(e,s);const I=qa.dot(jp),C=$a.dot(jp);if(I>=0&&C<=I)return t.copy(s);const u=a*C-I*l;if(u<=0&&a>=0&&I<=0)return r=a/(a-I),t.copy(n).addScaledVector(qa,r);qp.subVectors(e,o);const A=qa.dot(qp),h=$a.dot(qp);if(h>=0&&A<=h)return t.copy(o);const m=A*l-a*h;if(m<=0&&l>=0&&h<=0)return g=l/(l-h),t.copy(n).addScaledVector($a,g);const b=I*h-A*C;if(b<=0&&C-I>=0&&A-h>=0)return DB.subVectors(o,s),g=(C-I)/(C-I+(A-h)),t.copy(s).addScaledVector(DB,g);const G=1/(b+m+u);return r=m*G,g=u*G,t.copy(n).addScaledVector(qa,r).addScaledVector($a,g)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let u9=0;class Tn extends yo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:u9++}),this.uuid=ts(),this.name="",this.type="Material",this.blending=Ca,this.side=rr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=yb,this.blendDst=Bb,this.blendEquation=qg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=RA,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=CS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jd,this.stencilZFail=jd,this.stencilZPass=jd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ca&&(n.blending=this.blending),this.side!==rr&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function s(o){const r=[];for(const g in o){const a=o[g];delete a.metadata,r.push(a)}return r}if(t){const o=s(e.textures),r=s(e.images);o.length>0&&(n.textures=o),r.length>0&&(n.images=r)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const s=t.length;n=new Array(s);for(let o=0;o!==s;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Ji extends Tn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ee(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Yn=new N,Ju=new Se;class Ft{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=tC,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ju.fromBufferAttribute(this,t),Ju.applyMatrix3(e),this.setXY(t,Ju.x,Ju.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Yn.fromBufferAttribute(this,t),Yn.applyMatrix3(e),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Yn.fromBufferAttribute(this,t),Yn.applyMatrix4(e),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Yn.fromBufferAttribute(this,t),Yn.applyNormalMatrix(e),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Yn.fromBufferAttribute(this,t),Yn.transformDirection(e),this.setXYZ(t,Yn.x,Yn.y,Yn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Oo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Oo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Oo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Oo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Pt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),s=Pt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,o){return e*=this.itemSize,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),s=Pt(s,this.array),o=Pt(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==tC&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class d9 extends Ft{constructor(e,t,n){super(new Int8Array(e),t,n)}}class A9 extends Ft{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class h9 extends Ft{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class p9 extends Ft{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Xb extends Ft{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class m9 extends Ft{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Yb extends Ft{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class f9 extends Ft{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class tt extends Ft{constructor(e,t,n){super(new Float32Array(e),t,n)}}class b9 extends Ft{constructor(e,t,n){super(new Float64Array(e),t,n)}}let G9=0;const cs=new dt,$p=new St,el=new N,ji=new dr,qI=new dr,Un=new N;class bt extends yo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:G9++}),this.uuid=ts(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(AS(e)?Yb:Xb)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Si().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return cs.makeRotationFromQuaternion(e),this.applyMatrix4(cs),this}rotateX(e){return cs.makeRotationX(e),this.applyMatrix4(cs),this}rotateY(e){return cs.makeRotationY(e),this.applyMatrix4(cs),this}rotateZ(e){return cs.makeRotationZ(e),this.applyMatrix4(cs),this}translate(e,t,n){return cs.makeTranslation(e,t,n),this.applyMatrix4(cs),this}scale(e,t,n){return cs.makeScale(e,t,n),this.applyMatrix4(cs),this}lookAt(e){return $p.lookAt(e),$p.updateMatrix(),this.applyMatrix4($p.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(el).negate(),this.translate(el.x,el.y,el.z),this}setFromPoints(e){const t=[];for(let n=0,s=e.length;n<s;n++){const o=e[n];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new tt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new dr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){const o=t[n];ji.setFromBufferAttribute(o),this.morphTargetsRelative?(Un.addVectors(this.boundingBox.min,ji.min),this.boundingBox.expandByPoint(Un),Un.addVectors(this.boundingBox.max,ji.max),this.boundingBox.expandByPoint(Un)):(this.boundingBox.expandByPoint(ji.min),this.boundingBox.expandByPoint(ji.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ar);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new N,1/0);return}if(e){const n=this.boundingSphere.center;if(ji.setFromBufferAttribute(e),t)for(let o=0,r=t.length;o<r;o++){const g=t[o];qI.setFromBufferAttribute(g),this.morphTargetsRelative?(Un.addVectors(ji.min,qI.min),ji.expandByPoint(Un),Un.addVectors(ji.max,qI.max),ji.expandByPoint(Un)):(ji.expandByPoint(qI.min),ji.expandByPoint(qI.max))}ji.getCenter(n);let s=0;for(let o=0,r=e.count;o<r;o++)Un.fromBufferAttribute(e,o),s=Math.max(s,n.distanceToSquared(Un));if(t)for(let o=0,r=t.length;o<r;o++){const g=t[o],a=this.morphTargetsRelative;for(let l=0,I=g.count;l<I;l++)Un.fromBufferAttribute(g,l),a&&(el.fromBufferAttribute(e,l),Un.add(el)),s=Math.max(s,n.distanceToSquared(Un))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,s=t.position.array,o=t.normal.array,r=t.uv.array,g=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ft(new Float32Array(4*g),4));const a=this.getAttribute("tangent").array,l=[],I=[];for(let H=0;H<g;H++)l[H]=new N,I[H]=new N;const C=new N,u=new N,A=new N,h=new Se,m=new Se,b=new Se,G=new N,f=new N;function y(H,P,E){C.fromArray(s,H*3),u.fromArray(s,P*3),A.fromArray(s,E*3),h.fromArray(r,H*2),m.fromArray(r,P*2),b.fromArray(r,E*2),u.sub(C),A.sub(C),m.sub(h),b.sub(h);const L=1/(m.x*b.y-b.x*m.y);!isFinite(L)||(G.copy(u).multiplyScalar(b.y).addScaledVector(A,-m.y).multiplyScalar(L),f.copy(A).multiplyScalar(m.x).addScaledVector(u,-b.x).multiplyScalar(L),l[H].add(G),l[P].add(G),l[E].add(G),I[H].add(f),I[P].add(f),I[E].add(f))}let B=this.groups;B.length===0&&(B=[{start:0,count:n.length}]);for(let H=0,P=B.length;H<P;++H){const E=B[H],L=E.start,K=E.count;for(let O=L,q=L+K;O<q;O+=3)y(n[O+0],n[O+1],n[O+2])}const v=new N,W=new N,R=new N,Z=new N;function V(H){R.fromArray(o,H*3),Z.copy(R);const P=l[H];v.copy(P),v.sub(R.multiplyScalar(R.dot(P))).normalize(),W.crossVectors(Z,P);const L=W.dot(I[H])<0?-1:1;a[H*4]=v.x,a[H*4+1]=v.y,a[H*4+2]=v.z,a[H*4+3]=L}for(let H=0,P=B.length;H<P;++H){const E=B[H],L=E.start,K=E.count;for(let O=L,q=L+K;O<q;O+=3)V(n[O+0]),V(n[O+1]),V(n[O+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Ft(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let u=0,A=n.count;u<A;u++)n.setXYZ(u,0,0,0);const s=new N,o=new N,r=new N,g=new N,a=new N,l=new N,I=new N,C=new N;if(e)for(let u=0,A=e.count;u<A;u+=3){const h=e.getX(u+0),m=e.getX(u+1),b=e.getX(u+2);s.fromBufferAttribute(t,h),o.fromBufferAttribute(t,m),r.fromBufferAttribute(t,b),I.subVectors(r,o),C.subVectors(s,o),I.cross(C),g.fromBufferAttribute(n,h),a.fromBufferAttribute(n,m),l.fromBufferAttribute(n,b),g.add(I),a.add(I),l.add(I),n.setXYZ(h,g.x,g.y,g.z),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(b,l.x,l.y,l.z)}else for(let u=0,A=t.count;u<A;u+=3)s.fromBufferAttribute(t,u+0),o.fromBufferAttribute(t,u+1),r.fromBufferAttribute(t,u+2),I.subVectors(r,o),C.subVectors(s,o),I.cross(C),n.setXYZ(u+0,I.x,I.y,I.z),n.setXYZ(u+1,I.x,I.y,I.z),n.setXYZ(u+2,I.x,I.y,I.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)Un.fromBufferAttribute(e,t),Un.normalize(),e.setXYZ(t,Un.x,Un.y,Un.z)}toNonIndexed(){function e(g,a){const l=g.array,I=g.itemSize,C=g.normalized,u=new l.constructor(a.length*I);let A=0,h=0;for(let m=0,b=a.length;m<b;m++){g.isInterleavedBufferAttribute?A=a[m]*g.data.stride+g.offset:A=a[m]*I;for(let G=0;G<I;G++)u[h++]=l[A++]}return new Ft(u,I,C)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new bt,n=this.index.array,s=this.attributes;for(const g in s){const a=s[g],l=e(a,n);t.setAttribute(g,l)}const o=this.morphAttributes;for(const g in o){const a=[],l=o[g];for(let I=0,C=l.length;I<C;I++){const u=l[I],A=e(u,n);a.push(A)}t.morphAttributes[g]=a}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let g=0,a=r.length;g<a;g++){const l=r[g];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const l in a)a[l]!==void 0&&(e[l]=a[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const a in n){const l=n[a];e.data.attributes[a]=l.toJSON(e.data)}const s={};let o=!1;for(const a in this.morphAttributes){const l=this.morphAttributes[a],I=[];for(let C=0,u=l.length;C<u;C++){const A=l[C];I.push(A.toJSON(e.data))}I.length>0&&(s[a]=I,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const g=this.boundingSphere;return g!==null&&(e.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const s=e.attributes;for(const l in s){const I=s[l];this.setAttribute(l,I.clone(t))}const o=e.morphAttributes;for(const l in o){const I=[],C=o[l];for(let u=0,A=C.length;u<A;u++)I.push(C[u].clone(t));this.morphAttributes[l]=I}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let l=0,I=r.length;l<I;l++){const C=r[l];this.addGroup(C.start,C.count,C.materialIndex)}const g=e.boundingBox;g!==null&&(this.boundingBox=g.clone());const a=e.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const PB=new dt,tl=new fC,em=new Ar,zr=new N,kr=new N,Tr=new N,tm=new N,nm=new N,im=new N,Uu=new N,Du=new N,Pu=new N,Qu=new Se,Ou=new Se,ju=new Se,sm=new N,qu=new N;class fn extends St{constructor(e=new bt,t=new Ji){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const g=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=o}}}}raycast(e,t){const n=this.geometry,s=this.material,o=this.matrixWorld;if(s===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),em.copy(n.boundingSphere),em.applyMatrix4(o),e.ray.intersectsSphere(em)===!1)||(PB.copy(o).invert(),tl.copy(e.ray).applyMatrix4(PB),n.boundingBox!==null&&tl.intersectsBox(n.boundingBox)===!1))return;let r;const g=n.index,a=n.attributes.position,l=n.morphAttributes.position,I=n.morphTargetsRelative,C=n.attributes.uv,u=n.attributes.uv2,A=n.groups,h=n.drawRange;if(g!==null)if(Array.isArray(s))for(let m=0,b=A.length;m<b;m++){const G=A[m],f=s[G.materialIndex],y=Math.max(G.start,h.start),B=Math.min(g.count,Math.min(G.start+G.count,h.start+h.count));for(let v=y,W=B;v<W;v+=3){const R=g.getX(v),Z=g.getX(v+1),V=g.getX(v+2);r=$u(this,f,e,tl,a,l,I,C,u,R,Z,V),r&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=G.materialIndex,t.push(r))}}else{const m=Math.max(0,h.start),b=Math.min(g.count,h.start+h.count);for(let G=m,f=b;G<f;G+=3){const y=g.getX(G),B=g.getX(G+1),v=g.getX(G+2);r=$u(this,s,e,tl,a,l,I,C,u,y,B,v),r&&(r.faceIndex=Math.floor(G/3),t.push(r))}}else if(a!==void 0)if(Array.isArray(s))for(let m=0,b=A.length;m<b;m++){const G=A[m],f=s[G.materialIndex],y=Math.max(G.start,h.start),B=Math.min(a.count,Math.min(G.start+G.count,h.start+h.count));for(let v=y,W=B;v<W;v+=3){const R=v,Z=v+1,V=v+2;r=$u(this,f,e,tl,a,l,I,C,u,R,Z,V),r&&(r.faceIndex=Math.floor(v/3),r.face.materialIndex=G.materialIndex,t.push(r))}}else{const m=Math.max(0,h.start),b=Math.min(a.count,h.start+h.count);for(let G=m,f=b;G<f;G+=3){const y=G,B=G+1,v=G+2;r=$u(this,s,e,tl,a,l,I,C,u,y,B,v),r&&(r.faceIndex=Math.floor(G/3),t.push(r))}}}}function y9(i,e,t,n,s,o,r,g){let a;if(e.side===Vi?a=n.intersectTriangle(r,o,s,!0,g):a=n.intersectTriangle(s,o,r,e.side!==ms,g),a===null)return null;qu.copy(g),qu.applyMatrix4(i.matrixWorld);const l=t.ray.origin.distanceTo(qu);return l<t.near||l>t.far?null:{distance:l,point:qu.clone(),object:i}}function $u(i,e,t,n,s,o,r,g,a,l,I,C){zr.fromBufferAttribute(s,l),kr.fromBufferAttribute(s,I),Tr.fromBufferAttribute(s,C);const u=i.morphTargetInfluences;if(o&&u){Uu.set(0,0,0),Du.set(0,0,0),Pu.set(0,0,0);for(let h=0,m=o.length;h<m;h++){const b=u[h],G=o[h];b!==0&&(tm.fromBufferAttribute(G,l),nm.fromBufferAttribute(G,I),im.fromBufferAttribute(G,C),r?(Uu.addScaledVector(tm,b),Du.addScaledVector(nm,b),Pu.addScaledVector(im,b)):(Uu.addScaledVector(tm.sub(zr),b),Du.addScaledVector(nm.sub(kr),b),Pu.addScaledVector(im.sub(Tr),b)))}zr.add(Uu),kr.add(Du),Tr.add(Pu)}i.isSkinnedMesh&&(i.boneTransform(l,zr),i.boneTransform(I,kr),i.boneTransform(C,Tr));const A=y9(i,e,t,n,zr,kr,Tr,sm);if(A){g&&(Qu.fromBufferAttribute(g,l),Ou.fromBufferAttribute(g,I),ju.fromBufferAttribute(g,C),A.uv=hs.getUV(sm,zr,kr,Tr,Qu,Ou,ju,new Se)),a&&(Qu.fromBufferAttribute(a,l),Ou.fromBufferAttribute(a,I),ju.fromBufferAttribute(a,C),A.uv2=hs.getUV(sm,zr,kr,Tr,Qu,Ou,ju,new Se));const h={a:l,b:I,c:C,normal:new N,materialIndex:0};hs.getNormal(zr,kr,Tr,h.normal),A.face=h}return A}class hr extends bt{constructor(e=1,t=1,n=1,s=1,o=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:o,depthSegments:r};const g=this;s=Math.floor(s),o=Math.floor(o),r=Math.floor(r);const a=[],l=[],I=[],C=[];let u=0,A=0;h("z","y","x",-1,-1,n,t,e,r,o,0),h("z","y","x",1,-1,n,t,-e,r,o,1),h("x","z","y",1,1,e,n,t,s,r,2),h("x","z","y",1,-1,e,n,-t,s,r,3),h("x","y","z",1,-1,e,t,n,s,o,4),h("x","y","z",-1,-1,e,t,-n,s,o,5),this.setIndex(a),this.setAttribute("position",new tt(l,3)),this.setAttribute("normal",new tt(I,3)),this.setAttribute("uv",new tt(C,2));function h(m,b,G,f,y,B,v,W,R,Z,V){const H=B/R,P=v/Z,E=B/2,L=v/2,K=W/2,O=R+1,q=Z+1;let ne=0,k=0;const F=new N;for(let z=0;z<q;z++){const X=z*P-L;for(let T=0;T<O;T++){const Q=T*H-E;F[m]=Q*f,F[b]=X*y,F[G]=K,l.push(F.x,F.y,F.z),F[m]=0,F[b]=0,F[G]=W>0?1:-1,I.push(F.x,F.y,F.z),C.push(T/R),C.push(1-z/Z),ne+=1}}for(let z=0;z<Z;z++)for(let X=0;X<R;X++){const T=u+X+O*z,Q=u+X+O*(z+1),ee=u+(X+1)+O*(z+1),oe=u+(X+1)+O*z;a.push(T,Q,oe),a.push(Q,ee,oe),k+=6}g.addGroup(A,k,V),A+=k,u+=ne}}static fromJSON(e){return new hr(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Dl(i){const e={};for(const t in i){e[t]={};for(const n in i[t]){const s=i[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function di(i){const e={};for(let t=0;t<i.length;t++){const n=Dl(i[t]);for(const s in n)e[s]=n[s]}return e}function B9(i){const e=[];for(let t=0;t<i.length;t++)e.push(i[t].clone());return e}const eh={clone:Dl,merge:di};var v9=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Z9=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ds extends Tn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=v9,this.fragmentShader=Z9,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Dl(e.uniforms),this.uniformsGroups=B9(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const r=this.uniforms[s].value;r&&r.isTexture?t.uniforms[s]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[s]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[s]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[s]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[s]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[s]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[s]={type:"m4",value:r.toArray()}:t.uniforms[s]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Pl extends St{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new dt,this.projectionMatrix=new dt,this.projectionMatrixInverse=new dt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class zn extends Pl{constructor(e=50,t=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=nC*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(da*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return nC*2*Math.atan(Math.tan(da*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,o,r){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(da*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,o=-.5*s;const r=this.view;if(this.view!==null&&this.view.enabled){const a=r.fullWidth,l=r.fullHeight;o+=r.offsetX*s/a,t-=r.offsetY*n/l,s*=r.width/a,n*=r.height/l}const g=this.filmOffset;g!==0&&(o+=e*g/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const nl=90,il=1;class pS extends St{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const s=new zn(nl,il,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new N(1,0,0)),this.add(s);const o=new zn(nl,il,e,t);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new N(-1,0,0)),this.add(o);const r=new zn(nl,il,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new N(0,1,0)),this.add(r);const g=new zn(nl,il,e,t);g.layers=this.layers,g.up.set(0,0,-1),g.lookAt(new N(0,-1,0)),this.add(g);const a=new zn(nl,il,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new N(0,0,1)),this.add(a);const l=new zn(nl,il,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new N(0,0,-1)),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[s,o,r,g,a,l]=this.children,I=e.getRenderTarget(),C=e.toneMapping,u=e.xr.enabled;e.toneMapping=po,e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,o),e.setRenderTarget(n,2),e.render(t,r),e.setRenderTarget(n,3),e.render(t,g),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=A,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(I),e.toneMapping=C,e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class bC extends Cn{constructor(e,t,n,s,o,r,g,a,l,I){e=e!==void 0?e:[],t=t!==void 0?t:pg,super(e,t,n,s,o,r,g,a,l,I),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class mS extends Bs{constructor(e,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new bC(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:en}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new hr(5,5,5),o=new Ds({name:"CubemapFromEquirect",uniforms:Dl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Vi,blending:tr});o.uniforms.tEquirect.value=t;const r=new fn(s,o),g=t.minFilter;return t.minFilter===Cr&&(t.minFilter=en),new pS(1,10,this).update(e,r),t.minFilter=g,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,s){const o=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,s);e.setRenderTarget(o)}}const om=new N,w9=new N,W9=new Si;class Dr{constructor(e=new N(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const s=om.subVectors(n,t).cross(w9.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(om),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:t.copy(n).multiplyScalar(o).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||W9.getNormalMatrix(e),s=this.coplanarPoint(om).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const sl=new Ar,ed=new N;class th{constructor(e=new Dr,t=new Dr,n=new Dr,s=new Dr,o=new Dr,r=new Dr){this.planes=[e,t,n,s,o,r]}set(e,t,n,s,o,r){const g=this.planes;return g[0].copy(e),g[1].copy(t),g[2].copy(n),g[3].copy(s),g[4].copy(o),g[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,s=n[0],o=n[1],r=n[2],g=n[3],a=n[4],l=n[5],I=n[6],C=n[7],u=n[8],A=n[9],h=n[10],m=n[11],b=n[12],G=n[13],f=n[14],y=n[15];return t[0].setComponents(g-s,C-a,m-u,y-b).normalize(),t[1].setComponents(g+s,C+a,m+u,y+b).normalize(),t[2].setComponents(g+o,C+l,m+A,y+G).normalize(),t[3].setComponents(g-o,C-l,m-A,y-G).normalize(),t[4].setComponents(g-r,C-I,m-h,y-f).normalize(),t[5].setComponents(g+r,C+I,m+h,y+f).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),sl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(sl)}intersectsSprite(e){return sl.center.set(0,0,0),sl.radius=.7071067811865476,sl.applyMatrix4(e.matrixWorld),this.intersectsSphere(sl)}intersectsSphere(e){const t=this.planes,n=e.center,s=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const s=t[n];if(ed.x=s.normal.x>0?e.max.x:e.min.x,ed.y=s.normal.y>0?e.max.y:e.min.y,ed.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(ed)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function fS(){let i=null,e=!1,t=null,n=null;function s(o,r){t(o,r),n=i.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=i.requestAnimationFrame(s),e=!0)},stop:function(){i.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){i=o}}}function S9(i,e){const t=e.isWebGL2,n=new WeakMap;function s(l,I){const C=l.array,u=l.usage,A=i.createBuffer();i.bindBuffer(I,A),i.bufferData(I,C,u),l.onUploadCallback();let h;if(C instanceof Float32Array)h=5126;else if(C instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)h=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else h=5123;else if(C instanceof Int16Array)h=5122;else if(C instanceof Uint32Array)h=5125;else if(C instanceof Int32Array)h=5124;else if(C instanceof Int8Array)h=5120;else if(C instanceof Uint8Array)h=5121;else if(C instanceof Uint8ClampedArray)h=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+C);return{buffer:A,type:h,bytesPerElement:C.BYTES_PER_ELEMENT,version:l.version}}function o(l,I,C){const u=I.array,A=I.updateRange;i.bindBuffer(C,l),A.count===-1?i.bufferSubData(C,0,u):(t?i.bufferSubData(C,A.offset*u.BYTES_PER_ELEMENT,u,A.offset,A.count):i.bufferSubData(C,A.offset*u.BYTES_PER_ELEMENT,u.subarray(A.offset,A.offset+A.count)),A.count=-1)}function r(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function g(l){l.isInterleavedBufferAttribute&&(l=l.data);const I=n.get(l);I&&(i.deleteBuffer(I.buffer),n.delete(l))}function a(l,I){if(l.isGLBufferAttribute){const u=n.get(l);(!u||u.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const C=n.get(l);C===void 0?n.set(l,s(l,I)):C.version<l.version&&(o(C.buffer,l,I),C.version=l.version)}return{get:r,remove:g,update:a}}class nI extends bt{constructor(e=1,t=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};const o=e/2,r=t/2,g=Math.floor(n),a=Math.floor(s),l=g+1,I=a+1,C=e/g,u=t/a,A=[],h=[],m=[],b=[];for(let G=0;G<I;G++){const f=G*u-r;for(let y=0;y<l;y++){const B=y*C-o;h.push(B,-f,0),m.push(0,0,1),b.push(y/g),b.push(1-G/a)}}for(let G=0;G<a;G++)for(let f=0;f<g;f++){const y=f+l*G,B=f+l*(G+1),v=f+1+l*(G+1),W=f+1+l*G;A.push(y,B,W),A.push(B,v,W)}this.setIndex(A),this.setAttribute("position",new tt(h,3)),this.setAttribute("normal",new tt(m,3)),this.setAttribute("uv",new tt(b,2))}static fromJSON(e){return new nI(e.width,e.height,e.widthSegments,e.heightSegments)}}var R9=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,V9=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,x9=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,X9=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Y9=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,H9=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,F9="vec3 transformed = vec3( position );",K9=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,N9=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,M9=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,L9=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,z9=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,k9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,T9=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,E9=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,_9=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,J9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,U9=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,D9=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,P9=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,Q9=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,O9=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,j9=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,q9=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,$9=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,eY=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,tY="gl_FragColor = linearToOutputTexel( gl_FragColor );",nY=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,iY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,sY=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,oY=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rY=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,gY=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,aY=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,lY=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,IY=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,cY=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,CY=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,uY=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,dY=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,AY=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,hY=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,pY=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,mY=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,fY=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,bY=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,GY=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yY=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,BY=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,vY=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ZY=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,wY=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,WY=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,SY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,RY=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,VY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,xY=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,XY=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,YY=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,HY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,FY=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,KY=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,NY=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,MY=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,LY=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,zY=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,kY=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,TY=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,EY=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,_Y=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,JY=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UY=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,DY=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,PY=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,QY=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,OY=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,jY=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,qY=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,$Y=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,eH=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,tH=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,nH=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,iH=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,sH=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,oH=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,rH=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,gH=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,aH=`#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,lH=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,IH=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,cH=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,CH=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,uH=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,dH=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,AH=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,hH=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pH=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,mH=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,fH=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,bH=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,GH=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,yH=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,BH=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,vH=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,ZH=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,wH=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const WH=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,SH=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,RH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,VH=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,xH=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,XH=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,YH=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,HH=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,FH=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,KH=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,NH=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,MH=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LH=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,zH=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kH=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TH=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EH=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,_H=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,JH=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,UH=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,DH=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PH=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,QH=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,OH=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jH=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qH=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$H=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,eF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,tF=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,nF=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,iF=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,yt={alphamap_fragment:R9,alphamap_pars_fragment:V9,alphatest_fragment:x9,alphatest_pars_fragment:X9,aomap_fragment:Y9,aomap_pars_fragment:H9,begin_vertex:F9,beginnormal_vertex:K9,bsdfs:N9,iridescence_fragment:M9,bumpmap_pars_fragment:L9,clipping_planes_fragment:z9,clipping_planes_pars_fragment:k9,clipping_planes_pars_vertex:T9,clipping_planes_vertex:E9,color_fragment:_9,color_pars_fragment:J9,color_pars_vertex:U9,color_vertex:D9,common:P9,cube_uv_reflection_fragment:Q9,defaultnormal_vertex:O9,displacementmap_pars_vertex:j9,displacementmap_vertex:q9,emissivemap_fragment:$9,emissivemap_pars_fragment:eY,encodings_fragment:tY,encodings_pars_fragment:nY,envmap_fragment:iY,envmap_common_pars_fragment:sY,envmap_pars_fragment:oY,envmap_pars_vertex:rY,envmap_physical_pars_fragment:mY,envmap_vertex:gY,fog_vertex:aY,fog_pars_vertex:lY,fog_fragment:IY,fog_pars_fragment:cY,gradientmap_pars_fragment:CY,lightmap_fragment:uY,lightmap_pars_fragment:dY,lights_lambert_fragment:AY,lights_lambert_pars_fragment:hY,lights_pars_begin:pY,lights_toon_fragment:fY,lights_toon_pars_fragment:bY,lights_phong_fragment:GY,lights_phong_pars_fragment:yY,lights_physical_fragment:BY,lights_physical_pars_fragment:vY,lights_fragment_begin:ZY,lights_fragment_maps:wY,lights_fragment_end:WY,logdepthbuf_fragment:SY,logdepthbuf_pars_fragment:RY,logdepthbuf_pars_vertex:VY,logdepthbuf_vertex:xY,map_fragment:XY,map_pars_fragment:YY,map_particle_fragment:HY,map_particle_pars_fragment:FY,metalnessmap_fragment:KY,metalnessmap_pars_fragment:NY,morphcolor_vertex:MY,morphnormal_vertex:LY,morphtarget_pars_vertex:zY,morphtarget_vertex:kY,normal_fragment_begin:TY,normal_fragment_maps:EY,normal_pars_fragment:_Y,normal_pars_vertex:JY,normal_vertex:UY,normalmap_pars_fragment:DY,clearcoat_normal_fragment_begin:PY,clearcoat_normal_fragment_maps:QY,clearcoat_pars_fragment:OY,iridescence_pars_fragment:jY,output_fragment:qY,packing:$Y,premultiplied_alpha_fragment:eH,project_vertex:tH,dithering_fragment:nH,dithering_pars_fragment:iH,roughnessmap_fragment:sH,roughnessmap_pars_fragment:oH,shadowmap_pars_fragment:rH,shadowmap_pars_vertex:gH,shadowmap_vertex:aH,shadowmask_pars_fragment:lH,skinbase_vertex:IH,skinning_pars_vertex:cH,skinning_vertex:CH,skinnormal_vertex:uH,specularmap_fragment:dH,specularmap_pars_fragment:AH,tonemapping_fragment:hH,tonemapping_pars_fragment:pH,transmission_fragment:mH,transmission_pars_fragment:fH,uv_pars_fragment:bH,uv_pars_vertex:GH,uv_vertex:yH,uv2_pars_fragment:BH,uv2_pars_vertex:vH,uv2_vertex:ZH,worldpos_vertex:wH,background_vert:WH,background_frag:SH,cube_vert:RH,cube_frag:VH,depth_vert:xH,depth_frag:XH,distanceRGBA_vert:YH,distanceRGBA_frag:HH,equirect_vert:FH,equirect_frag:KH,linedashed_vert:NH,linedashed_frag:MH,meshbasic_vert:LH,meshbasic_frag:zH,meshlambert_vert:kH,meshlambert_frag:TH,meshmatcap_vert:EH,meshmatcap_frag:_H,meshnormal_vert:JH,meshnormal_frag:UH,meshphong_vert:DH,meshphong_frag:PH,meshphysical_vert:QH,meshphysical_frag:OH,meshtoon_vert:jH,meshtoon_frag:qH,points_vert:$H,points_frag:eF,shadow_vert:tF,shadow_frag:nF,sprite_vert:iF,sprite_frag:sF},_e={common:{diffuse:{value:new Ee(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Si},uv2Transform:{value:new Si},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Se(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ee(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ee(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}},sprite:{diffuse:{value:new Ee(16777215)},opacity:{value:1},center:{value:new Se(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Si}}},Es={basic:{uniforms:di([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.fog]),vertexShader:yt.meshbasic_vert,fragmentShader:yt.meshbasic_frag},lambert:{uniforms:di([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,_e.lights,{emissive:{value:new Ee(0)}}]),vertexShader:yt.meshlambert_vert,fragmentShader:yt.meshlambert_frag},phong:{uniforms:di([_e.common,_e.specularmap,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,_e.lights,{emissive:{value:new Ee(0)},specular:{value:new Ee(1118481)},shininess:{value:30}}]),vertexShader:yt.meshphong_vert,fragmentShader:yt.meshphong_frag},standard:{uniforms:di([_e.common,_e.envmap,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.roughnessmap,_e.metalnessmap,_e.fog,_e.lights,{emissive:{value:new Ee(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag},toon:{uniforms:di([_e.common,_e.aomap,_e.lightmap,_e.emissivemap,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.gradientmap,_e.fog,_e.lights,{emissive:{value:new Ee(0)}}]),vertexShader:yt.meshtoon_vert,fragmentShader:yt.meshtoon_frag},matcap:{uniforms:di([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,_e.fog,{matcap:{value:null}}]),vertexShader:yt.meshmatcap_vert,fragmentShader:yt.meshmatcap_frag},points:{uniforms:di([_e.points,_e.fog]),vertexShader:yt.points_vert,fragmentShader:yt.points_frag},dashed:{uniforms:di([_e.common,_e.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:yt.linedashed_vert,fragmentShader:yt.linedashed_frag},depth:{uniforms:di([_e.common,_e.displacementmap]),vertexShader:yt.depth_vert,fragmentShader:yt.depth_frag},normal:{uniforms:di([_e.common,_e.bumpmap,_e.normalmap,_e.displacementmap,{opacity:{value:1}}]),vertexShader:yt.meshnormal_vert,fragmentShader:yt.meshnormal_frag},sprite:{uniforms:di([_e.sprite,_e.fog]),vertexShader:yt.sprite_vert,fragmentShader:yt.sprite_frag},background:{uniforms:{uvTransform:{value:new Si},t2D:{value:null}},vertexShader:yt.background_vert,fragmentShader:yt.background_frag},cube:{uniforms:di([_e.envmap,{opacity:{value:1}}]),vertexShader:yt.cube_vert,fragmentShader:yt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:yt.equirect_vert,fragmentShader:yt.equirect_frag},distanceRGBA:{uniforms:di([_e.common,_e.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:yt.distanceRGBA_vert,fragmentShader:yt.distanceRGBA_frag},shadow:{uniforms:di([_e.lights,_e.fog,{color:{value:new Ee(0)},opacity:{value:1}}]),vertexShader:yt.shadow_vert,fragmentShader:yt.shadow_frag}};Es.physical={uniforms:di([Es.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Se(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ee(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Se},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ee(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ee(1,1,1)},specularColorMap:{value:null}}]),vertexShader:yt.meshphysical_vert,fragmentShader:yt.meshphysical_frag};function oF(i,e,t,n,s,o){const r=new Ee(0);let g=s===!0?0:1,a,l,I=null,C=0,u=null;function A(m,b){let G=!1,f=b.isScene===!0?b.background:null;f&&f.isTexture&&(f=e.get(f));const y=i.xr,B=y.getSession&&y.getSession();B&&B.environmentBlendMode==="additive"&&(f=null),f===null?h(r,g):f&&f.isColor&&(h(f,1),G=!0),(i.autoClear||G)&&i.clear(i.autoClearColor,i.autoClearDepth,i.autoClearStencil),f&&(f.isCubeTexture||f.mapping===tI)?(l===void 0&&(l=new fn(new hr(1,1,1),new Ds({name:"BackgroundCubeMaterial",uniforms:Dl(Es.cube.uniforms),vertexShader:Es.cube.vertexShader,fragmentShader:Es.cube.fragmentShader,side:Vi,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(v,W,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=f,l.material.uniforms.flipEnvMap.value=f.isCubeTexture&&f.isRenderTargetTexture===!1?-1:1,(I!==f||C!==f.version||u!==i.toneMapping)&&(l.material.needsUpdate=!0,I=f,C=f.version,u=i.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null)):f&&f.isTexture&&(a===void 0&&(a=new fn(new nI(2,2),new Ds({name:"BackgroundMaterial",uniforms:Dl(Es.background.uniforms),vertexShader:Es.background.vertexShader,fragmentShader:Es.background.fragmentShader,side:rr,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(a)),a.material.uniforms.t2D.value=f,f.matrixAutoUpdate===!0&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),(I!==f||C!==f.version||u!==i.toneMapping)&&(a.material.needsUpdate=!0,I=f,C=f.version,u=i.toneMapping),a.layers.enableAll(),m.unshift(a,a.geometry,a.material,0,0,null))}function h(m,b){t.buffers.color.setClear(m.r,m.g,m.b,b,o)}return{getClearColor:function(){return r},setClearColor:function(m,b=1){r.set(m),g=b,h(r,g)},getClearAlpha:function(){return g},setClearAlpha:function(m){g=m,h(r,g)},render:A}}function rF(i,e,t,n){const s=i.getParameter(34921),o=n.isWebGL2?null:e.get("OES_vertex_array_object"),r=n.isWebGL2||o!==null,g={},a=b(null);let l=a,I=!1;function C(K,O,q,ne,k){let F=!1;if(r){const z=m(ne,q,O);l!==z&&(l=z,A(l.object)),F=G(K,ne,q,k),F&&f(K,ne,q,k)}else{const z=O.wireframe===!0;(l.geometry!==ne.id||l.program!==q.id||l.wireframe!==z)&&(l.geometry=ne.id,l.program=q.id,l.wireframe=z,F=!0)}k!==null&&t.update(k,34963),(F||I)&&(I=!1,Z(K,O,q,ne),k!==null&&i.bindBuffer(34963,t.get(k).buffer))}function u(){return n.isWebGL2?i.createVertexArray():o.createVertexArrayOES()}function A(K){return n.isWebGL2?i.bindVertexArray(K):o.bindVertexArrayOES(K)}function h(K){return n.isWebGL2?i.deleteVertexArray(K):o.deleteVertexArrayOES(K)}function m(K,O,q){const ne=q.wireframe===!0;let k=g[K.id];k===void 0&&(k={},g[K.id]=k);let F=k[O.id];F===void 0&&(F={},k[O.id]=F);let z=F[ne];return z===void 0&&(z=b(u()),F[ne]=z),z}function b(K){const O=[],q=[],ne=[];for(let k=0;k<s;k++)O[k]=0,q[k]=0,ne[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:q,attributeDivisors:ne,object:K,attributes:{},index:null}}function G(K,O,q,ne){const k=l.attributes,F=O.attributes;let z=0;const X=q.getAttributes();for(const T in X)if(X[T].location>=0){const ee=k[T];let oe=F[T];if(oe===void 0&&(T==="instanceMatrix"&&K.instanceMatrix&&(oe=K.instanceMatrix),T==="instanceColor"&&K.instanceColor&&(oe=K.instanceColor)),ee===void 0||ee.attribute!==oe||oe&&ee.data!==oe.data)return!0;z++}return l.attributesNum!==z||l.index!==ne}function f(K,O,q,ne){const k={},F=O.attributes;let z=0;const X=q.getAttributes();for(const T in X)if(X[T].location>=0){let ee=F[T];ee===void 0&&(T==="instanceMatrix"&&K.instanceMatrix&&(ee=K.instanceMatrix),T==="instanceColor"&&K.instanceColor&&(ee=K.instanceColor));const oe={};oe.attribute=ee,ee&&ee.data&&(oe.data=ee.data),k[T]=oe,z++}l.attributes=k,l.attributesNum=z,l.index=ne}function y(){const K=l.newAttributes;for(let O=0,q=K.length;O<q;O++)K[O]=0}function B(K){v(K,0)}function v(K,O){const q=l.newAttributes,ne=l.enabledAttributes,k=l.attributeDivisors;q[K]=1,ne[K]===0&&(i.enableVertexAttribArray(K),ne[K]=1),k[K]!==O&&((n.isWebGL2?i:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](K,O),k[K]=O)}function W(){const K=l.newAttributes,O=l.enabledAttributes;for(let q=0,ne=O.length;q<ne;q++)O[q]!==K[q]&&(i.disableVertexAttribArray(q),O[q]=0)}function R(K,O,q,ne,k,F){n.isWebGL2===!0&&(q===5124||q===5125)?i.vertexAttribIPointer(K,O,q,k,F):i.vertexAttribPointer(K,O,q,ne,k,F)}function Z(K,O,q,ne){if(n.isWebGL2===!1&&(K.isInstancedMesh||ne.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;y();const k=ne.attributes,F=q.getAttributes(),z=O.defaultAttributeValues;for(const X in F){const T=F[X];if(T.location>=0){let Q=k[X];if(Q===void 0&&(X==="instanceMatrix"&&K.instanceMatrix&&(Q=K.instanceMatrix),X==="instanceColor"&&K.instanceColor&&(Q=K.instanceColor)),Q!==void 0){const ee=Q.normalized,oe=Q.itemSize,j=t.get(Q);if(j===void 0)continue;const ge=j.buffer,Ie=j.type,Be=j.bytesPerElement;if(Q.isInterleavedBufferAttribute){const ve=Q.data,Ye=ve.stride,se=Q.offset;if(ve.isInstancedInterleavedBuffer){for(let ue=0;ue<T.locationSize;ue++)v(T.location+ue,ve.meshPerAttribute);K.isInstancedMesh!==!0&&ne._maxInstanceCount===void 0&&(ne._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let ue=0;ue<T.locationSize;ue++)B(T.location+ue);i.bindBuffer(34962,ge);for(let ue=0;ue<T.locationSize;ue++)R(T.location+ue,oe/T.locationSize,Ie,ee,Ye*Be,(se+oe/T.locationSize*ue)*Be)}else{if(Q.isInstancedBufferAttribute){for(let ve=0;ve<T.locationSize;ve++)v(T.location+ve,Q.meshPerAttribute);K.isInstancedMesh!==!0&&ne._maxInstanceCount===void 0&&(ne._maxInstanceCount=Q.meshPerAttribute*Q.count)}else for(let ve=0;ve<T.locationSize;ve++)B(T.location+ve);i.bindBuffer(34962,ge);for(let ve=0;ve<T.locationSize;ve++)R(T.location+ve,oe/T.locationSize,Ie,ee,oe*Be,oe/T.locationSize*ve*Be)}}else if(z!==void 0){const ee=z[X];if(ee!==void 0)switch(ee.length){case 2:i.vertexAttrib2fv(T.location,ee);break;case 3:i.vertexAttrib3fv(T.location,ee);break;case 4:i.vertexAttrib4fv(T.location,ee);break;default:i.vertexAttrib1fv(T.location,ee)}}}}W()}function V(){E();for(const K in g){const O=g[K];for(const q in O){const ne=O[q];for(const k in ne)h(ne[k].object),delete ne[k];delete O[q]}delete g[K]}}function H(K){if(g[K.id]===void 0)return;const O=g[K.id];for(const q in O){const ne=O[q];for(const k in ne)h(ne[k].object),delete ne[k];delete O[q]}delete g[K.id]}function P(K){for(const O in g){const q=g[O];if(q[K.id]===void 0)continue;const ne=q[K.id];for(const k in ne)h(ne[k].object),delete ne[k];delete q[K.id]}}function E(){L(),I=!0,l!==a&&(l=a,A(l.object))}function L(){a.geometry=null,a.program=null,a.wireframe=!1}return{setup:C,reset:E,resetDefaultState:L,dispose:V,releaseStatesOfGeometry:H,releaseStatesOfProgram:P,initAttributes:y,enableAttribute:B,disableUnusedAttributes:W}}function gF(i,e,t,n){const s=n.isWebGL2;let o;function r(l){o=l}function g(l,I){i.drawArrays(o,l,I),t.update(I,o,1)}function a(l,I,C){if(C===0)return;let u,A;if(s)u=i,A="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),A="drawArraysInstancedANGLE",u===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}u[A](o,l,I,C),t.update(I,o,C)}this.setMode=r,this.render=g,this.renderInstances=a}function aF(i,e,t){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");n=i.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function o(R){if(R==="highp"){if(i.getShaderPrecisionFormat(35633,36338).precision>0&&i.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";R="mediump"}return R==="mediump"&&i.getShaderPrecisionFormat(35633,36337).precision>0&&i.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r=typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&i instanceof WebGL2ComputeRenderingContext;let g=t.precision!==void 0?t.precision:"highp";const a=o(g);a!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",a,"instead."),g=a);const l=r||e.has("WEBGL_draw_buffers"),I=t.logarithmicDepthBuffer===!0,C=i.getParameter(34930),u=i.getParameter(35660),A=i.getParameter(3379),h=i.getParameter(34076),m=i.getParameter(34921),b=i.getParameter(36347),G=i.getParameter(36348),f=i.getParameter(36349),y=u>0,B=r||e.has("OES_texture_float"),v=y&&B,W=r?i.getParameter(36183):0;return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:o,precision:g,logarithmicDepthBuffer:I,maxTextures:C,maxVertexTextures:u,maxTextureSize:A,maxCubemapSize:h,maxAttributes:m,maxVertexUniforms:b,maxVaryings:G,maxFragmentUniforms:f,vertexTextures:y,floatFragmentTextures:B,floatVertexTextures:v,maxSamples:W}}function lF(i){const e=this;let t=null,n=0,s=!1,o=!1;const r=new Dr,g=new Si,a={value:null,needsUpdate:!1};this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(C,u,A){const h=C.length!==0||u||n!==0||s;return s=u,t=I(C,A,0),n=C.length,h},this.beginShadows=function(){o=!0,I(null)},this.endShadows=function(){o=!1,l()},this.setState=function(C,u,A){const h=C.clippingPlanes,m=C.clipIntersection,b=C.clipShadows,G=i.get(C);if(!s||h===null||h.length===0||o&&!b)o?I(null):l();else{const f=o?0:n,y=f*4;let B=G.clippingState||null;a.value=B,B=I(h,u,y,A);for(let v=0;v!==y;++v)B[v]=t[v];G.clippingState=B,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=f}};function l(){a.value!==t&&(a.value=t,a.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function I(C,u,A,h){const m=C!==null?C.length:0;let b=null;if(m!==0){if(b=a.value,h!==!0||b===null){const G=A+m*4,f=u.matrixWorldInverse;g.getNormalMatrix(f),(b===null||b.length<G)&&(b=new Float32Array(G));for(let y=0,B=A;y!==m;++y,B+=4)r.copy(C[y]).applyMatrix4(f,g),r.normal.toArray(b,B),b[B+3]=r.constant}a.value=b,a.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,b}}function IF(i){let e=new WeakMap;function t(r,g){return g===Oc?r.mapping=pg:g===jc&&(r.mapping=mg),r}function n(r){if(r&&r.isTexture&&r.isRenderTargetTexture===!1){const g=r.mapping;if(g===Oc||g===jc)if(e.has(r)){const a=e.get(r).texture;return t(a,r.mapping)}else{const a=r.image;if(a&&a.height>0){const l=new mS(a.height/2);return l.fromEquirectangularTexture(i,r),e.set(r,l),r.addEventListener("dispose",s),t(l.texture,r.mapping)}else return null}}return r}function s(r){const g=r.target;g.removeEventListener("dispose",s);const a=e.get(g);a!==void 0&&(e.delete(g),a.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}class iI extends Pl{constructor(e=-1,t=1,n=1,s=-1,o=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=o,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,o,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=n-e,r=n+e,g=s+t,a=s-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,I=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=l*this.view.offsetX,r=o+l*this.view.width,g-=I*this.view.offsetY,a=g-I*this.view.height}this.projectionMatrix.makeOrthographic(o,r,g,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Zl=4,QB=[.125,.215,.35,.446,.526,.582],$g=20,rm=new iI,OB=new Ee;let gm=null;const Og=(1+Math.sqrt(5))/2,ol=1/Og,jB=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,Og,ol),new N(0,Og,-ol),new N(ol,0,Og),new N(-ol,0,Og),new N(Og,ol,0),new N(-Og,ol,0)];class i0{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){gm=this._renderer.getRenderTarget(),this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,s,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=ev(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=$B(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(gm),e.scissorTest=!1,td(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===pg||e.mapping===mg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),gm=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:en,minFilter:en,generateMipmaps:!1,type:Jl,format:fs,encoding:bg,depthBuffer:!1},s=qB(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=qB(e,t,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=cF(o)),this._blurMaterial=CF(o,e,t)}return s}_compileMaterial(e){const t=new fn(this._lodPlanes[0],e);this._renderer.compile(t,rm)}_sceneToCubeUV(e,t,n,s){const g=new zn(90,1,t,n),a=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],I=this._renderer,C=I.autoClear,u=I.toneMapping;I.getClearColor(OB),I.toneMapping=po,I.autoClear=!1;const A=new Ji({name:"PMREM.Background",side:Vi,depthWrite:!1,depthTest:!1}),h=new fn(new hr,A);let m=!1;const b=e.background;b?b.isColor&&(A.color.copy(b),e.background=null,m=!0):(A.color.copy(OB),m=!0);for(let G=0;G<6;G++){const f=G%3;f===0?(g.up.set(0,a[G],0),g.lookAt(l[G],0,0)):f===1?(g.up.set(0,0,a[G]),g.lookAt(0,l[G],0)):(g.up.set(0,a[G],0),g.lookAt(0,0,l[G]));const y=this._cubeSize;td(s,f*y,G>2?y:0,y,y),I.setRenderTarget(s),m&&I.render(h,g),I.render(e,g)}h.geometry.dispose(),h.material.dispose(),I.toneMapping=u,I.autoClear=C,e.background=b}_textureToCubeUV(e,t){const n=this._renderer,s=e.mapping===pg||e.mapping===mg;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=ev()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=$B());const o=s?this._cubemapMaterial:this._equirectMaterial,r=new fn(this._lodPlanes[0],o),g=o.uniforms;g.envMap.value=e;const a=this._cubeSize;td(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(r,rm)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),r=jB[(s-1)%jB.length];this._blur(e,s-1,s,o,r)}t.autoClear=n}_blur(e,t,n,s,o){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,n,s,"latitudinal",o),this._halfBlur(r,e,n,n,s,"longitudinal",o)}_halfBlur(e,t,n,s,o,r,g){const a=this._renderer,l=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const I=3,C=new fn(this._lodPlanes[s],l),u=l.uniforms,A=this._sizeLods[n]-1,h=isFinite(o)?Math.PI/(2*A):2*Math.PI/(2*$g-1),m=o/h,b=isFinite(o)?1+Math.floor(I*m):$g;b>$g&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${b} samples when the maximum is set to ${$g}`);const G=[];let f=0;for(let R=0;R<$g;++R){const Z=R/m,V=Math.exp(-Z*Z/2);G.push(V),R===0?f+=V:R<b&&(f+=2*V)}for(let R=0;R<G.length;R++)G[R]=G[R]/f;u.envMap.value=e.texture,u.samples.value=b,u.weights.value=G,u.latitudinal.value=r==="latitudinal",g&&(u.poleAxis.value=g);const{_lodMax:y}=this;u.dTheta.value=h,u.mipInt.value=y-n;const B=this._sizeLods[s],v=3*B*(s>y-Zl?s-y+Zl:0),W=4*(this._cubeSize-B);td(t,v,W,3*B,2*B),a.setRenderTarget(t),a.render(C,rm)}}function cF(i){const e=[],t=[],n=[];let s=i;const o=i-Zl+1+QB.length;for(let r=0;r<o;r++){const g=Math.pow(2,s);t.push(g);let a=1/g;r>i-Zl?a=QB[r-i+Zl-1]:r===0&&(a=0),n.push(a);const l=1/(g-2),I=-l,C=1+l,u=[I,I,C,I,C,C,I,I,C,C,I,C],A=6,h=6,m=3,b=2,G=1,f=new Float32Array(m*h*A),y=new Float32Array(b*h*A),B=new Float32Array(G*h*A);for(let W=0;W<A;W++){const R=W%3*2/3-1,Z=W>2?0:-1,V=[R,Z,0,R+2/3,Z,0,R+2/3,Z+1,0,R,Z,0,R+2/3,Z+1,0,R,Z+1,0];f.set(V,m*h*W),y.set(u,b*h*W);const H=[W,W,W,W,W,W];B.set(H,G*h*W)}const v=new bt;v.setAttribute("position",new Ft(f,m)),v.setAttribute("uv",new Ft(y,b)),v.setAttribute("faceIndex",new Ft(B,G)),e.push(v),s>Zl&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function qB(i,e,t){const n=new Bs(i,e,t);return n.texture.mapping=tI,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function td(i,e,t,n,s){i.viewport.set(e,t,n,s),i.scissor.set(e,t,n,s)}function CF(i,e,t){const n=new Float32Array($g),s=new N(0,1,0);return new Ds({name:"SphericalGaussianBlur",defines:{n:$g,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${i}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Hb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function $B(){return new Ds({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Hb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function ev(){return new Ds({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Hb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:tr,depthTest:!1,depthWrite:!1})}function Hb(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function uF(i){let e=new WeakMap,t=null;function n(g){if(g&&g.isTexture){const a=g.mapping,l=a===Oc||a===jc,I=a===pg||a===mg;if(l||I)if(g.isRenderTargetTexture&&g.needsPMREMUpdate===!0){g.needsPMREMUpdate=!1;let C=e.get(g);return t===null&&(t=new i0(i)),C=l?t.fromEquirectangular(g,C):t.fromCubemap(g,C),e.set(g,C),C.texture}else{if(e.has(g))return e.get(g).texture;{const C=g.image;if(l&&C&&C.height>0||I&&C&&s(C)){t===null&&(t=new i0(i));const u=l?t.fromEquirectangular(g):t.fromCubemap(g);return e.set(g,u),g.addEventListener("dispose",o),u.texture}else return null}}}return g}function s(g){let a=0;const l=6;for(let I=0;I<l;I++)g[I]!==void 0&&a++;return a===l}function o(g){const a=g.target;a.removeEventListener("dispose",o);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function r(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:r}}function dF(i){const e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=i.getExtension("WEBGL_depth_texture")||i.getExtension("MOZ_WEBGL_depth_texture")||i.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=i.getExtension("WEBGL_compressed_texture_s3tc")||i.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=i.getExtension("WEBGL_compressed_texture_pvrtc")||i.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=i.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function AF(i,e,t,n){const s={},o=new WeakMap;function r(C){const u=C.target;u.index!==null&&e.remove(u.index);for(const h in u.attributes)e.remove(u.attributes[h]);u.removeEventListener("dispose",r),delete s[u.id];const A=o.get(u);A&&(e.remove(A),o.delete(u)),n.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function g(C,u){return s[u.id]===!0||(u.addEventListener("dispose",r),s[u.id]=!0,t.memory.geometries++),u}function a(C){const u=C.attributes;for(const h in u)e.update(u[h],34962);const A=C.morphAttributes;for(const h in A){const m=A[h];for(let b=0,G=m.length;b<G;b++)e.update(m[b],34962)}}function l(C){const u=[],A=C.index,h=C.attributes.position;let m=0;if(A!==null){const f=A.array;m=A.version;for(let y=0,B=f.length;y<B;y+=3){const v=f[y+0],W=f[y+1],R=f[y+2];u.push(v,W,W,R,R,v)}}else{const f=h.array;m=h.version;for(let y=0,B=f.length/3-1;y<B;y+=3){const v=y+0,W=y+1,R=y+2;u.push(v,W,W,R,R,v)}}const b=new(AS(u)?Yb:Xb)(u,1);b.version=m;const G=o.get(C);G&&e.remove(G),o.set(C,b)}function I(C){const u=o.get(C);if(u){const A=C.index;A!==null&&u.version<A.version&&l(C)}else l(C);return o.get(C)}return{get:g,update:a,getWireframeAttribute:I}}function hF(i,e,t,n){const s=n.isWebGL2;let o;function r(u){o=u}let g,a;function l(u){g=u.type,a=u.bytesPerElement}function I(u,A){i.drawElements(o,A,g,u*a),t.update(A,o,1)}function C(u,A,h){if(h===0)return;let m,b;if(s)m=i,b="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),b="drawElementsInstancedANGLE",m===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}m[b](o,A,g,u*a,h),t.update(A,o,h)}this.setMode=r,this.setIndex=l,this.render=I,this.renderInstances=C}function pF(i){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,r,g){switch(t.calls++,r){case 4:t.triangles+=g*(o/3);break;case 1:t.lines+=g*(o/2);break;case 3:t.lines+=g*(o-1);break;case 2:t.lines+=g*o;break;case 0:t.points+=g*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function mF(i,e){return i[0]-e[0]}function fF(i,e){return Math.abs(e[1])-Math.abs(i[1])}function bF(i,e,t){const n={},s=new Float32Array(8),o=new WeakMap,r=new Ht,g=[];for(let l=0;l<8;l++)g[l]=[l,0];function a(l,I,C,u){const A=l.morphTargetInfluences;if(e.isWebGL2===!0){const m=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,b=m!==void 0?m.length:0;let G=o.get(I);if(G===void 0||G.count!==b){let q=function(){K.dispose(),o.delete(I),I.removeEventListener("dispose",q)};var h=q;G!==void 0&&G.texture.dispose();const B=I.morphAttributes.position!==void 0,v=I.morphAttributes.normal!==void 0,W=I.morphAttributes.color!==void 0,R=I.morphAttributes.position||[],Z=I.morphAttributes.normal||[],V=I.morphAttributes.color||[];let H=0;B===!0&&(H=1),v===!0&&(H=2),W===!0&&(H=3);let P=I.attributes.position.count*H,E=1;P>e.maxTextureSize&&(E=Math.ceil(P/e.maxTextureSize),P=e.maxTextureSize);const L=new Float32Array(P*E*4*b),K=new mC(L,P,E,b);K.type=Qo,K.needsUpdate=!0;const O=H*4;for(let ne=0;ne<b;ne++){const k=R[ne],F=Z[ne],z=V[ne],X=P*E*4*ne;for(let T=0;T<k.count;T++){const Q=T*O;B===!0&&(r.fromBufferAttribute(k,T),L[X+Q+0]=r.x,L[X+Q+1]=r.y,L[X+Q+2]=r.z,L[X+Q+3]=0),v===!0&&(r.fromBufferAttribute(F,T),L[X+Q+4]=r.x,L[X+Q+5]=r.y,L[X+Q+6]=r.z,L[X+Q+7]=0),W===!0&&(r.fromBufferAttribute(z,T),L[X+Q+8]=r.x,L[X+Q+9]=r.y,L[X+Q+10]=r.z,L[X+Q+11]=z.itemSize===4?r.w:1)}}G={count:b,texture:K,size:new Se(P,E)},o.set(I,G),I.addEventListener("dispose",q)}let f=0;for(let B=0;B<A.length;B++)f+=A[B];const y=I.morphTargetsRelative?1:1-f;u.getUniforms().setValue(i,"morphTargetBaseInfluence",y),u.getUniforms().setValue(i,"morphTargetInfluences",A),u.getUniforms().setValue(i,"morphTargetsTexture",G.texture,t),u.getUniforms().setValue(i,"morphTargetsTextureSize",G.size)}else{const m=A===void 0?0:A.length;let b=n[I.id];if(b===void 0||b.length!==m){b=[];for(let v=0;v<m;v++)b[v]=[v,0];n[I.id]=b}for(let v=0;v<m;v++){const W=b[v];W[0]=v,W[1]=A[v]}b.sort(fF);for(let v=0;v<8;v++)v<m&&b[v][1]?(g[v][0]=b[v][0],g[v][1]=b[v][1]):(g[v][0]=Number.MAX_SAFE_INTEGER,g[v][1]=0);g.sort(mF);const G=I.morphAttributes.position,f=I.morphAttributes.normal;let y=0;for(let v=0;v<8;v++){const W=g[v],R=W[0],Z=W[1];R!==Number.MAX_SAFE_INTEGER&&Z?(G&&I.getAttribute("morphTarget"+v)!==G[R]&&I.setAttribute("morphTarget"+v,G[R]),f&&I.getAttribute("morphNormal"+v)!==f[R]&&I.setAttribute("morphNormal"+v,f[R]),s[v]=Z,y+=Z):(G&&I.hasAttribute("morphTarget"+v)===!0&&I.deleteAttribute("morphTarget"+v),f&&I.hasAttribute("morphNormal"+v)===!0&&I.deleteAttribute("morphNormal"+v),s[v]=0)}const B=I.morphTargetsRelative?1:1-y;u.getUniforms().setValue(i,"morphTargetBaseInfluence",B),u.getUniforms().setValue(i,"morphTargetInfluences",s)}}return{update:a}}function GF(i,e,t,n){let s=new WeakMap;function o(a){const l=n.render.frame,I=a.geometry,C=e.get(a,I);return s.get(C)!==l&&(e.update(C),s.set(C,l)),a.isInstancedMesh&&(a.hasEventListener("dispose",g)===!1&&a.addEventListener("dispose",g),t.update(a.instanceMatrix,34962),a.instanceColor!==null&&t.update(a.instanceColor,34962)),C}function r(){s=new WeakMap}function g(a){const l=a.target;l.removeEventListener("dispose",g),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:o,dispose:r}}const bS=new Cn,GS=new mC,yS=new $A,BS=new bC,tv=[],nv=[],iv=new Float32Array(16),sv=new Float32Array(9),ov=new Float32Array(4);function sI(i,e,t){const n=i[0];if(n<=0||n>0)return i;const s=e*t;let o=tv[s];if(o===void 0&&(o=new Float32Array(s),tv[s]=o),e!==0){n.toArray(o,0);for(let r=1,g=0;r!==e;++r)g+=t,i[r].toArray(o,g)}return o}function En(i,e){if(i.length!==e.length)return!1;for(let t=0,n=i.length;t<n;t++)if(i[t]!==e[t])return!1;return!0}function _n(i,e){for(let t=0,n=e.length;t<n;t++)i[t]=e[t]}function nh(i,e){let t=nv[e];t===void 0&&(t=new Int32Array(e),nv[e]=t);for(let n=0;n!==e;++n)t[n]=i.allocateTextureUnit();return t}function yF(i,e){const t=this.cache;t[0]!==e&&(i.uniform1f(this.addr,e),t[0]=e)}function BF(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(i.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(En(t,e))return;i.uniform2fv(this.addr,e),_n(t,e)}}function vF(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(i.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(i.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(En(t,e))return;i.uniform3fv(this.addr,e),_n(t,e)}}function ZF(i,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(i.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(En(t,e))return;i.uniform4fv(this.addr,e),_n(t,e)}}function wF(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(En(t,e))return;i.uniformMatrix2fv(this.addr,!1,e),_n(t,e)}else{if(En(t,n))return;ov.set(n),i.uniformMatrix2fv(this.addr,!1,ov),_n(t,n)}}function WF(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(En(t,e))return;i.uniformMatrix3fv(this.addr,!1,e),_n(t,e)}else{if(En(t,n))return;sv.set(n),i.uniformMatrix3fv(this.addr,!1,sv),_n(t,n)}}function SF(i,e){const t=this.cache,n=e.elements;if(n===void 0){if(En(t,e))return;i.uniformMatrix4fv(this.addr,!1,e),_n(t,e)}else{if(En(t,n))return;iv.set(n),i.uniformMatrix4fv(this.addr,!1,iv),_n(t,n)}}function RF(i,e){const t=this.cache;t[0]!==e&&(i.uniform1i(this.addr,e),t[0]=e)}function VF(i,e){const t=this.cache;En(t,e)||(i.uniform2iv(this.addr,e),_n(t,e))}function xF(i,e){const t=this.cache;En(t,e)||(i.uniform3iv(this.addr,e),_n(t,e))}function XF(i,e){const t=this.cache;En(t,e)||(i.uniform4iv(this.addr,e),_n(t,e))}function YF(i,e){const t=this.cache;t[0]!==e&&(i.uniform1ui(this.addr,e),t[0]=e)}function HF(i,e){const t=this.cache;En(t,e)||(i.uniform2uiv(this.addr,e),_n(t,e))}function FF(i,e){const t=this.cache;En(t,e)||(i.uniform3uiv(this.addr,e),_n(t,e))}function KF(i,e){const t=this.cache;En(t,e)||(i.uniform4uiv(this.addr,e),_n(t,e))}function NF(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||bS,s)}function MF(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||yS,s)}function LF(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||BS,s)}function zF(i,e,t){const n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(i.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||GS,s)}function kF(i){switch(i){case 5126:return yF;case 35664:return BF;case 35665:return vF;case 35666:return ZF;case 35674:return wF;case 35675:return WF;case 35676:return SF;case 5124:case 35670:return RF;case 35667:case 35671:return VF;case 35668:case 35672:return xF;case 35669:case 35673:return XF;case 5125:return YF;case 36294:return HF;case 36295:return FF;case 36296:return KF;case 35678:case 36198:case 36298:case 36306:case 35682:return NF;case 35679:case 36299:case 36307:return MF;case 35680:case 36300:case 36308:case 36293:return LF;case 36289:case 36303:case 36311:case 36292:return zF}}function TF(i,e){i.uniform1fv(this.addr,e)}function EF(i,e){const t=sI(e,this.size,2);i.uniform2fv(this.addr,t)}function _F(i,e){const t=sI(e,this.size,3);i.uniform3fv(this.addr,t)}function JF(i,e){const t=sI(e,this.size,4);i.uniform4fv(this.addr,t)}function UF(i,e){const t=sI(e,this.size,4);i.uniformMatrix2fv(this.addr,!1,t)}function DF(i,e){const t=sI(e,this.size,9);i.uniformMatrix3fv(this.addr,!1,t)}function PF(i,e){const t=sI(e,this.size,16);i.uniformMatrix4fv(this.addr,!1,t)}function QF(i,e){i.uniform1iv(this.addr,e)}function OF(i,e){i.uniform2iv(this.addr,e)}function jF(i,e){i.uniform3iv(this.addr,e)}function qF(i,e){i.uniform4iv(this.addr,e)}function $F(i,e){i.uniform1uiv(this.addr,e)}function eK(i,e){i.uniform2uiv(this.addr,e)}function tK(i,e){i.uniform3uiv(this.addr,e)}function nK(i,e){i.uniform4uiv(this.addr,e)}function iK(i,e,t){const n=this.cache,s=e.length,o=nh(t,s);En(n,o)||(i.uniform1iv(this.addr,o),_n(n,o));for(let r=0;r!==s;++r)t.setTexture2D(e[r]||bS,o[r])}function sK(i,e,t){const n=this.cache,s=e.length,o=nh(t,s);En(n,o)||(i.uniform1iv(this.addr,o),_n(n,o));for(let r=0;r!==s;++r)t.setTexture3D(e[r]||yS,o[r])}function oK(i,e,t){const n=this.cache,s=e.length,o=nh(t,s);En(n,o)||(i.uniform1iv(this.addr,o),_n(n,o));for(let r=0;r!==s;++r)t.setTextureCube(e[r]||BS,o[r])}function rK(i,e,t){const n=this.cache,s=e.length,o=nh(t,s);En(n,o)||(i.uniform1iv(this.addr,o),_n(n,o));for(let r=0;r!==s;++r)t.setTexture2DArray(e[r]||GS,o[r])}function gK(i){switch(i){case 5126:return TF;case 35664:return EF;case 35665:return _F;case 35666:return JF;case 35674:return UF;case 35675:return DF;case 35676:return PF;case 5124:case 35670:return QF;case 35667:case 35671:return OF;case 35668:case 35672:return jF;case 35669:case 35673:return qF;case 5125:return $F;case 36294:return eK;case 36295:return tK;case 36296:return nK;case 35678:case 36198:case 36298:case 36306:case 35682:return iK;case 35679:case 36299:case 36307:return sK;case 35680:case 36300:case 36308:case 36293:return oK;case 36289:case 36303:case 36311:case 36292:return rK}}class aK{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=kF(t.type)}}class lK{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=gK(t.type)}}class IK{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const s=this.seq;for(let o=0,r=s.length;o!==r;++o){const g=s[o];g.setValue(e,t[g.id],n)}}}const am=/(\w+)(\])?(\[|\.)?/g;function rv(i,e){i.seq.push(e),i.map[e.id]=e}function cK(i,e,t){const n=i.name,s=n.length;for(am.lastIndex=0;;){const o=am.exec(n),r=am.lastIndex;let g=o[1];const a=o[2]==="]",l=o[3];if(a&&(g=g|0),l===void 0||l==="["&&r+2===s){rv(t,l===void 0?new aK(g,i,e):new lK(g,i,e));break}else{let C=t.map[g];C===void 0&&(C=new IK(g),rv(t,C)),t=C}}}class $d{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let s=0;s<n;++s){const o=e.getActiveUniform(t,s),r=e.getUniformLocation(t,o.name);cK(o,r,this)}}setValue(e,t,n,s){const o=this.map[t];o!==void 0&&o.setValue(e,n,s)}setOptional(e,t,n){const s=t[n];s!==void 0&&this.setValue(e,n,s)}static upload(e,t,n,s){for(let o=0,r=t.length;o!==r;++o){const g=t[o],a=n[g.id];a.needsUpdate!==!1&&g.setValue(e,a.value,s)}}static seqWithValue(e,t){const n=[];for(let s=0,o=e.length;s!==o;++s){const r=e[s];r.id in t&&n.push(r)}return n}}function gv(i,e,t){const n=i.createShader(e);return i.shaderSource(n,t),i.compileShader(n),n}let CK=0;function uK(i,e){const t=i.split(`
`),n=[],s=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let r=s;r<o;r++){const g=r+1;n.push(`${g===e?">":" "} ${g}: ${t[r]}`)}return n.join(`
`)}function dK(i){switch(i){case bg:return["Linear","( value )"];case Yt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}}function av(i,e,t){const n=i.getShaderParameter(e,35713),s=i.getShaderInfoLog(e).trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const r=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+uK(i.getShaderSource(e),r)}else return s}function AK(i,e){const t=dK(e);return"vec4 "+i+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function hK(i,e){let t;switch(e){case kW:t="Linear";break;case TW:t="Reinhard";break;case EW:t="OptimizedCineon";break;case vb:t="ACESFilmic";break;case _W:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+i+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function pK(i){return[i.extensionDerivatives||!!i.envMapCubeUVHeight||i.bumpMap||i.tangentSpaceNormalMap||i.clearcoatNormalMap||i.flatShading||i.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(i.extensionFragDepth||i.logarithmicDepthBuffer)&&i.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",i.extensionDrawBuffers&&i.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(i.extensionShaderTextureLOD||i.envMap||i.transmission)&&i.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(hc).join(`
`)}function mK(i){const e=[];for(const t in i){const n=i[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function fK(i,e){const t={},n=i.getProgramParameter(e,35721);for(let s=0;s<n;s++){const o=i.getActiveAttrib(e,s),r=o.name;let g=1;o.type===35674&&(g=2),o.type===35675&&(g=3),o.type===35676&&(g=4),t[r]={type:o.type,location:i.getAttribLocation(e,r),locationSize:g}}return t}function hc(i){return i!==""}function lv(i,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return i.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Iv(i,e){return i.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const bK=/^[ \t]*#include +<([\w\d./]+)>/gm;function s0(i){return i.replace(bK,GK)}function GK(i,e){const t=yt[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return s0(t)}const yK=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function cv(i){return i.replace(yK,BK)}function BK(i,e,t,n){let s="";for(let o=parseInt(e);o<parseInt(t);o++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function Cv(i){let e="precision "+i.precision+` float;
precision `+i.precision+" int;";return i.precision==="highp"?e+=`
#define HIGH_PRECISION`:i.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:i.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function vK(i){let e="SHADOWMAP_TYPE_BASIC";return i.shadowMapType===bb?e="SHADOWMAP_TYPE_PCF":i.shadowMapType===Gb?e="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===Bl&&(e="SHADOWMAP_TYPE_VSM"),e}function ZK(i){let e="ENVMAP_TYPE_CUBE";if(i.envMap)switch(i.envMapMode){case pg:case mg:e="ENVMAP_TYPE_CUBE";break;case tI:e="ENVMAP_TYPE_CUBE_UV";break}return e}function wK(i){let e="ENVMAP_MODE_REFLECTION";if(i.envMap)switch(i.envMapMode){case mg:e="ENVMAP_MODE_REFRACTION";break}return e}function WK(i){let e="ENVMAP_BLENDING_NONE";if(i.envMap)switch(i.combine){case pC:e="ENVMAP_BLENDING_MULTIPLY";break;case LW:e="ENVMAP_BLENDING_MIX";break;case zW:e="ENVMAP_BLENDING_ADD";break}return e}function SK(i){const e=i.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function RK(i,e,t,n){const s=i.getContext(),o=t.defines;let r=t.vertexShader,g=t.fragmentShader;const a=vK(t),l=ZK(t),I=wK(t),C=WK(t),u=SK(t),A=t.isWebGL2?"":pK(t),h=mK(o),m=s.createProgram();let b,G,f=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=[h].filter(hc).join(`
`),b.length>0&&(b+=`
`),G=[A,h].filter(hc).join(`
`),G.length>0&&(G+=`
`)):(b=[Cv(t),"#define SHADER_NAME "+t.shaderName,h,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+I:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hc).join(`
`),G=[A,Cv(t),"#define SHADER_NAME "+t.shaderName,h,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+I:"",t.envMap?"#define "+C:"",u?"#define CUBEUV_TEXEL_WIDTH "+u.texelWidth:"",u?"#define CUBEUV_TEXEL_HEIGHT "+u.texelHeight:"",u?"#define CUBEUV_MAX_MIP "+u.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+a:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==po?"#define TONE_MAPPING":"",t.toneMapping!==po?yt.tonemapping_pars_fragment:"",t.toneMapping!==po?hK("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",yt.encodings_pars_fragment,AK("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hc).join(`
`)),r=s0(r),r=lv(r,t),r=Iv(r,t),g=s0(g),g=lv(g,t),g=Iv(g,t),r=cv(r),g=cv(g),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(f=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,G=["#define varying in",t.glslVersion===t0?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===t0?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+G);const y=f+b+r,B=f+G+g,v=gv(s,35633,y),W=gv(s,35632,B);if(s.attachShader(m,v),s.attachShader(m,W),t.index0AttributeName!==void 0?s.bindAttribLocation(m,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),i.debug.checkShaderErrors){const V=s.getProgramInfoLog(m).trim(),H=s.getShaderInfoLog(v).trim(),P=s.getShaderInfoLog(W).trim();let E=!0,L=!0;if(s.getProgramParameter(m,35714)===!1){E=!1;const K=av(s,v,"vertex"),O=av(s,W,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(m,35715)+`

Program Info Log: `+V+`
`+K+`
`+O)}else V!==""?console.warn("THREE.WebGLProgram: Program Info Log:",V):(H===""||P==="")&&(L=!1);L&&(this.diagnostics={runnable:E,programLog:V,vertexShader:{log:H,prefix:b},fragmentShader:{log:P,prefix:G}})}s.deleteShader(v),s.deleteShader(W);let R;this.getUniforms=function(){return R===void 0&&(R=new $d(s,m)),R};let Z;return this.getAttributes=function(){return Z===void 0&&(Z=fK(s,m)),Z},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=CK++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=v,this.fragmentShader=W,this}let VK=0;class xK{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),o=this._getShaderStage(n),r=this._getShaderCacheForMaterial(e);return r.has(s)===!1&&(r.add(s),s.usedTimes++),r.has(o)===!1&&(r.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new XK(e),t.set(e,n)),n}}class XK{constructor(e){this.id=VK++,this.code=e,this.usedTimes=0}}function YK(i,e,t,n,s,o,r){const g=new ha,a=new xK,l=[],I=s.isWebGL2,C=s.logarithmicDepthBuffer,u=s.vertexTextures;let A=s.precision;const h={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(Z,V,H,P,E){const L=P.fog,K=E.geometry,O=Z.isMeshStandardMaterial?P.environment:null,q=(Z.isMeshStandardMaterial?t:e).get(Z.envMap||O),ne=!!q&&q.mapping===tI?q.image.height:null,k=h[Z.type];Z.precision!==null&&(A=s.getMaxPrecision(Z.precision),A!==Z.precision&&console.warn("THREE.WebGLProgram.getParameters:",Z.precision,"not supported, using",A,"instead."));const F=K.morphAttributes.position||K.morphAttributes.normal||K.morphAttributes.color,z=F!==void 0?F.length:0;let X=0;K.morphAttributes.position!==void 0&&(X=1),K.morphAttributes.normal!==void 0&&(X=2),K.morphAttributes.color!==void 0&&(X=3);let T,Q,ee,oe;if(k){const Ye=Es[k];T=Ye.vertexShader,Q=Ye.fragmentShader}else T=Z.vertexShader,Q=Z.fragmentShader,a.update(Z),ee=a.getVertexShaderID(Z),oe=a.getFragmentShaderID(Z);const j=i.getRenderTarget(),ge=Z.alphaTest>0,Ie=Z.clearcoat>0,Be=Z.iridescence>0;return{isWebGL2:I,shaderID:k,shaderName:Z.type,vertexShader:T,fragmentShader:Q,defines:Z.defines,customVertexShaderID:ee,customFragmentShaderID:oe,isRawShaderMaterial:Z.isRawShaderMaterial===!0,glslVersion:Z.glslVersion,precision:A,instancing:E.isInstancedMesh===!0,instancingColor:E.isInstancedMesh===!0&&E.instanceColor!==null,supportsVertexTextures:u,outputEncoding:j===null?i.outputEncoding:j.isXRRenderTarget===!0?j.texture.encoding:bg,map:!!Z.map,matcap:!!Z.matcap,envMap:!!q,envMapMode:q&&q.mapping,envMapCubeUVHeight:ne,lightMap:!!Z.lightMap,aoMap:!!Z.aoMap,emissiveMap:!!Z.emissiveMap,bumpMap:!!Z.bumpMap,normalMap:!!Z.normalMap,objectSpaceNormalMap:Z.normalMapType===cS,tangentSpaceNormalMap:Z.normalMapType===ur,decodeVideoTexture:!!Z.map&&Z.map.isVideoTexture===!0&&Z.map.encoding===Yt,clearcoat:Ie,clearcoatMap:Ie&&!!Z.clearcoatMap,clearcoatRoughnessMap:Ie&&!!Z.clearcoatRoughnessMap,clearcoatNormalMap:Ie&&!!Z.clearcoatNormalMap,iridescence:Be,iridescenceMap:Be&&!!Z.iridescenceMap,iridescenceThicknessMap:Be&&!!Z.iridescenceThicknessMap,displacementMap:!!Z.displacementMap,roughnessMap:!!Z.roughnessMap,metalnessMap:!!Z.metalnessMap,specularMap:!!Z.specularMap,specularIntensityMap:!!Z.specularIntensityMap,specularColorMap:!!Z.specularColorMap,opaque:Z.transparent===!1&&Z.blending===Ca,alphaMap:!!Z.alphaMap,alphaTest:ge,gradientMap:!!Z.gradientMap,sheen:Z.sheen>0,sheenColorMap:!!Z.sheenColorMap,sheenRoughnessMap:!!Z.sheenRoughnessMap,transmission:Z.transmission>0,transmissionMap:!!Z.transmissionMap,thicknessMap:!!Z.thicknessMap,combine:Z.combine,vertexTangents:!!Z.normalMap&&!!K.attributes.tangent,vertexColors:Z.vertexColors,vertexAlphas:Z.vertexColors===!0&&!!K.attributes.color&&K.attributes.color.itemSize===4,vertexUvs:!!Z.map||!!Z.bumpMap||!!Z.normalMap||!!Z.specularMap||!!Z.alphaMap||!!Z.emissiveMap||!!Z.roughnessMap||!!Z.metalnessMap||!!Z.clearcoatMap||!!Z.clearcoatRoughnessMap||!!Z.clearcoatNormalMap||!!Z.iridescenceMap||!!Z.iridescenceThicknessMap||!!Z.displacementMap||!!Z.transmissionMap||!!Z.thicknessMap||!!Z.specularIntensityMap||!!Z.specularColorMap||!!Z.sheenColorMap||!!Z.sheenRoughnessMap,uvsVertexOnly:!(!!Z.map||!!Z.bumpMap||!!Z.normalMap||!!Z.specularMap||!!Z.alphaMap||!!Z.emissiveMap||!!Z.roughnessMap||!!Z.metalnessMap||!!Z.clearcoatNormalMap||!!Z.iridescenceMap||!!Z.iridescenceThicknessMap||Z.transmission>0||!!Z.transmissionMap||!!Z.thicknessMap||!!Z.specularIntensityMap||!!Z.specularColorMap||Z.sheen>0||!!Z.sheenColorMap||!!Z.sheenRoughnessMap)&&!!Z.displacementMap,fog:!!L,useFog:Z.fog===!0,fogExp2:L&&L.isFogExp2,flatShading:!!Z.flatShading,sizeAttenuation:Z.sizeAttenuation,logarithmicDepthBuffer:C,skinning:E.isSkinnedMesh===!0,morphTargets:K.morphAttributes.position!==void 0,morphNormals:K.morphAttributes.normal!==void 0,morphColors:K.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:X,numDirLights:V.directional.length,numPointLights:V.point.length,numSpotLights:V.spot.length,numSpotLightMaps:V.spotLightMap.length,numRectAreaLights:V.rectArea.length,numHemiLights:V.hemi.length,numDirLightShadows:V.directionalShadowMap.length,numPointLightShadows:V.pointShadowMap.length,numSpotLightShadows:V.spotShadowMap.length,numSpotLightShadowsWithMaps:V.numSpotLightShadowsWithMaps,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:Z.dithering,shadowMapEnabled:i.shadowMap.enabled&&H.length>0,shadowMapType:i.shadowMap.type,toneMapping:Z.toneMapped?i.toneMapping:po,physicallyCorrectLights:i.physicallyCorrectLights,premultipliedAlpha:Z.premultipliedAlpha,doubleSided:Z.side===ms,flipSided:Z.side===Vi,useDepthPacking:!!Z.depthPacking,depthPacking:Z.depthPacking||0,index0AttributeName:Z.index0AttributeName,extensionDerivatives:Z.extensions&&Z.extensions.derivatives,extensionFragDepth:Z.extensions&&Z.extensions.fragDepth,extensionDrawBuffers:Z.extensions&&Z.extensions.drawBuffers,extensionShaderTextureLOD:Z.extensions&&Z.extensions.shaderTextureLOD,rendererExtensionFragDepth:I||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:I||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:I||n.has("EXT_shader_texture_lod"),customProgramCacheKey:Z.customProgramCacheKey()}}function b(Z){const V=[];if(Z.shaderID?V.push(Z.shaderID):(V.push(Z.customVertexShaderID),V.push(Z.customFragmentShaderID)),Z.defines!==void 0)for(const H in Z.defines)V.push(H),V.push(Z.defines[H]);return Z.isRawShaderMaterial===!1&&(G(V,Z),f(V,Z),V.push(i.outputEncoding)),V.push(Z.customProgramCacheKey),V.join()}function G(Z,V){Z.push(V.precision),Z.push(V.outputEncoding),Z.push(V.envMapMode),Z.push(V.envMapCubeUVHeight),Z.push(V.combine),Z.push(V.vertexUvs),Z.push(V.fogExp2),Z.push(V.sizeAttenuation),Z.push(V.morphTargetsCount),Z.push(V.morphAttributeCount),Z.push(V.numDirLights),Z.push(V.numPointLights),Z.push(V.numSpotLights),Z.push(V.numSpotLightMaps),Z.push(V.numHemiLights),Z.push(V.numRectAreaLights),Z.push(V.numDirLightShadows),Z.push(V.numPointLightShadows),Z.push(V.numSpotLightShadows),Z.push(V.numSpotLightShadowsWithMaps),Z.push(V.shadowMapType),Z.push(V.toneMapping),Z.push(V.numClippingPlanes),Z.push(V.numClipIntersection),Z.push(V.depthPacking)}function f(Z,V){g.disableAll(),V.isWebGL2&&g.enable(0),V.supportsVertexTextures&&g.enable(1),V.instancing&&g.enable(2),V.instancingColor&&g.enable(3),V.map&&g.enable(4),V.matcap&&g.enable(5),V.envMap&&g.enable(6),V.lightMap&&g.enable(7),V.aoMap&&g.enable(8),V.emissiveMap&&g.enable(9),V.bumpMap&&g.enable(10),V.normalMap&&g.enable(11),V.objectSpaceNormalMap&&g.enable(12),V.tangentSpaceNormalMap&&g.enable(13),V.clearcoat&&g.enable(14),V.clearcoatMap&&g.enable(15),V.clearcoatRoughnessMap&&g.enable(16),V.clearcoatNormalMap&&g.enable(17),V.iridescence&&g.enable(18),V.iridescenceMap&&g.enable(19),V.iridescenceThicknessMap&&g.enable(20),V.displacementMap&&g.enable(21),V.specularMap&&g.enable(22),V.roughnessMap&&g.enable(23),V.metalnessMap&&g.enable(24),V.gradientMap&&g.enable(25),V.alphaMap&&g.enable(26),V.alphaTest&&g.enable(27),V.vertexColors&&g.enable(28),V.vertexAlphas&&g.enable(29),V.vertexUvs&&g.enable(30),V.vertexTangents&&g.enable(31),V.uvsVertexOnly&&g.enable(32),Z.push(g.mask),g.disableAll(),V.fog&&g.enable(0),V.useFog&&g.enable(1),V.flatShading&&g.enable(2),V.logarithmicDepthBuffer&&g.enable(3),V.skinning&&g.enable(4),V.morphTargets&&g.enable(5),V.morphNormals&&g.enable(6),V.morphColors&&g.enable(7),V.premultipliedAlpha&&g.enable(8),V.shadowMapEnabled&&g.enable(9),V.physicallyCorrectLights&&g.enable(10),V.doubleSided&&g.enable(11),V.flipSided&&g.enable(12),V.useDepthPacking&&g.enable(13),V.dithering&&g.enable(14),V.specularIntensityMap&&g.enable(15),V.specularColorMap&&g.enable(16),V.transmission&&g.enable(17),V.transmissionMap&&g.enable(18),V.thicknessMap&&g.enable(19),V.sheen&&g.enable(20),V.sheenColorMap&&g.enable(21),V.sheenRoughnessMap&&g.enable(22),V.decodeVideoTexture&&g.enable(23),V.opaque&&g.enable(24),Z.push(g.mask)}function y(Z){const V=h[Z.type];let H;if(V){const P=Es[V];H=eh.clone(P.uniforms)}else H=Z.uniforms;return H}function B(Z,V){let H;for(let P=0,E=l.length;P<E;P++){const L=l[P];if(L.cacheKey===V){H=L,++H.usedTimes;break}}return H===void 0&&(H=new RK(i,V,Z,o),l.push(H)),H}function v(Z){if(--Z.usedTimes===0){const V=l.indexOf(Z);l[V]=l[l.length-1],l.pop(),Z.destroy()}}function W(Z){a.remove(Z)}function R(){a.dispose()}return{getParameters:m,getProgramCacheKey:b,getUniforms:y,acquireProgram:B,releaseProgram:v,releaseShaderCache:W,programs:l,dispose:R}}function HK(){let i=new WeakMap;function e(o){let r=i.get(o);return r===void 0&&(r={},i.set(o,r)),r}function t(o){i.delete(o)}function n(o,r,g){i.get(o)[r]=g}function s(){i=new WeakMap}return{get:e,remove:t,update:n,dispose:s}}function FK(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.material.id!==e.material.id?i.material.id-e.material.id:i.z!==e.z?i.z-e.z:i.id-e.id}function uv(i,e){return i.groupOrder!==e.groupOrder?i.groupOrder-e.groupOrder:i.renderOrder!==e.renderOrder?i.renderOrder-e.renderOrder:i.z!==e.z?e.z-i.z:i.id-e.id}function dv(){const i=[];let e=0;const t=[],n=[],s=[];function o(){e=0,t.length=0,n.length=0,s.length=0}function r(C,u,A,h,m,b){let G=i[e];return G===void 0?(G={id:C.id,object:C,geometry:u,material:A,groupOrder:h,renderOrder:C.renderOrder,z:m,group:b},i[e]=G):(G.id=C.id,G.object=C,G.geometry=u,G.material=A,G.groupOrder=h,G.renderOrder=C.renderOrder,G.z=m,G.group=b),e++,G}function g(C,u,A,h,m,b){const G=r(C,u,A,h,m,b);A.transmission>0?n.push(G):A.transparent===!0?s.push(G):t.push(G)}function a(C,u,A,h,m,b){const G=r(C,u,A,h,m,b);A.transmission>0?n.unshift(G):A.transparent===!0?s.unshift(G):t.unshift(G)}function l(C,u){t.length>1&&t.sort(C||FK),n.length>1&&n.sort(u||uv),s.length>1&&s.sort(u||uv)}function I(){for(let C=e,u=i.length;C<u;C++){const A=i[C];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:n,transparent:s,init:o,push:g,unshift:a,finish:I,sort:l}}function KK(){let i=new WeakMap;function e(n,s){const o=i.get(n);let r;return o===void 0?(r=new dv,i.set(n,[r])):s>=o.length?(r=new dv,o.push(r)):r=o[s],r}function t(){i=new WeakMap}return{get:e,dispose:t}}function NK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new N,color:new Ee};break;case"SpotLight":t={position:new N,direction:new N,color:new Ee,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new N,color:new Ee,distance:0,decay:0};break;case"HemisphereLight":t={direction:new N,skyColor:new Ee,groundColor:new Ee};break;case"RectAreaLight":t={color:new Ee,position:new N,halfWidth:new N,halfHeight:new N};break}return i[e.id]=t,t}}}function MK(){const i={};return{get:function(e){if(i[e.id]!==void 0)return i[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Se,shadowCameraNear:1,shadowCameraFar:1e3};break}return i[e.id]=t,t}}}let LK=0;function zK(i,e){return(e.castShadow?2:0)-(i.castShadow?2:0)+(e.map?1:0)-(i.map?1:0)}function kK(i,e){const t=new NK,n=MK(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let I=0;I<9;I++)s.probe.push(new N);const o=new N,r=new dt,g=new dt;function a(I,C){let u=0,A=0,h=0;for(let P=0;P<9;P++)s.probe[P].set(0,0,0);let m=0,b=0,G=0,f=0,y=0,B=0,v=0,W=0,R=0,Z=0;I.sort(zK);const V=C!==!0?Math.PI:1;for(let P=0,E=I.length;P<E;P++){const L=I[P],K=L.color,O=L.intensity,q=L.distance,ne=L.shadow&&L.shadow.map?L.shadow.map.texture:null;if(L.isAmbientLight)u+=K.r*O*V,A+=K.g*O*V,h+=K.b*O*V;else if(L.isLightProbe)for(let k=0;k<9;k++)s.probe[k].addScaledVector(L.sh.coefficients[k],O);else if(L.isDirectionalLight){const k=t.get(L);if(k.color.copy(L.color).multiplyScalar(L.intensity*V),L.castShadow){const F=L.shadow,z=n.get(L);z.shadowBias=F.bias,z.shadowNormalBias=F.normalBias,z.shadowRadius=F.radius,z.shadowMapSize=F.mapSize,s.directionalShadow[m]=z,s.directionalShadowMap[m]=ne,s.directionalShadowMatrix[m]=L.shadow.matrix,B++}s.directional[m]=k,m++}else if(L.isSpotLight){const k=t.get(L);k.position.setFromMatrixPosition(L.matrixWorld),k.color.copy(K).multiplyScalar(O*V),k.distance=q,k.coneCos=Math.cos(L.angle),k.penumbraCos=Math.cos(L.angle*(1-L.penumbra)),k.decay=L.decay,s.spot[G]=k;const F=L.shadow;if(L.map&&(s.spotLightMap[R]=L.map,R++,F.updateMatrices(L),L.castShadow&&Z++),s.spotLightMatrix[G]=F.matrix,L.castShadow){const z=n.get(L);z.shadowBias=F.bias,z.shadowNormalBias=F.normalBias,z.shadowRadius=F.radius,z.shadowMapSize=F.mapSize,s.spotShadow[G]=z,s.spotShadowMap[G]=ne,W++}G++}else if(L.isRectAreaLight){const k=t.get(L);k.color.copy(K).multiplyScalar(O),k.halfWidth.set(L.width*.5,0,0),k.halfHeight.set(0,L.height*.5,0),s.rectArea[f]=k,f++}else if(L.isPointLight){const k=t.get(L);if(k.color.copy(L.color).multiplyScalar(L.intensity*V),k.distance=L.distance,k.decay=L.decay,L.castShadow){const F=L.shadow,z=n.get(L);z.shadowBias=F.bias,z.shadowNormalBias=F.normalBias,z.shadowRadius=F.radius,z.shadowMapSize=F.mapSize,z.shadowCameraNear=F.camera.near,z.shadowCameraFar=F.camera.far,s.pointShadow[b]=z,s.pointShadowMap[b]=ne,s.pointShadowMatrix[b]=L.shadow.matrix,v++}s.point[b]=k,b++}else if(L.isHemisphereLight){const k=t.get(L);k.skyColor.copy(L.color).multiplyScalar(O*V),k.groundColor.copy(L.groundColor).multiplyScalar(O*V),s.hemi[y]=k,y++}}f>0&&(e.isWebGL2||i.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=_e.LTC_FLOAT_1,s.rectAreaLTC2=_e.LTC_FLOAT_2):i.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=_e.LTC_HALF_1,s.rectAreaLTC2=_e.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=u,s.ambient[1]=A,s.ambient[2]=h;const H=s.hash;(H.directionalLength!==m||H.pointLength!==b||H.spotLength!==G||H.rectAreaLength!==f||H.hemiLength!==y||H.numDirectionalShadows!==B||H.numPointShadows!==v||H.numSpotShadows!==W||H.numSpotMaps!==R)&&(s.directional.length=m,s.spot.length=G,s.rectArea.length=f,s.point.length=b,s.hemi.length=y,s.directionalShadow.length=B,s.directionalShadowMap.length=B,s.pointShadow.length=v,s.pointShadowMap.length=v,s.spotShadow.length=W,s.spotShadowMap.length=W,s.directionalShadowMatrix.length=B,s.pointShadowMatrix.length=v,s.spotLightMatrix.length=W+R-Z,s.spotLightMap.length=R,s.numSpotLightShadowsWithMaps=Z,H.directionalLength=m,H.pointLength=b,H.spotLength=G,H.rectAreaLength=f,H.hemiLength=y,H.numDirectionalShadows=B,H.numPointShadows=v,H.numSpotShadows=W,H.numSpotMaps=R,s.version=LK++)}function l(I,C){let u=0,A=0,h=0,m=0,b=0;const G=C.matrixWorldInverse;for(let f=0,y=I.length;f<y;f++){const B=I[f];if(B.isDirectionalLight){const v=s.directional[u];v.direction.setFromMatrixPosition(B.matrixWorld),o.setFromMatrixPosition(B.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(G),u++}else if(B.isSpotLight){const v=s.spot[h];v.position.setFromMatrixPosition(B.matrixWorld),v.position.applyMatrix4(G),v.direction.setFromMatrixPosition(B.matrixWorld),o.setFromMatrixPosition(B.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(G),h++}else if(B.isRectAreaLight){const v=s.rectArea[m];v.position.setFromMatrixPosition(B.matrixWorld),v.position.applyMatrix4(G),g.identity(),r.copy(B.matrixWorld),r.premultiply(G),g.extractRotation(r),v.halfWidth.set(B.width*.5,0,0),v.halfHeight.set(0,B.height*.5,0),v.halfWidth.applyMatrix4(g),v.halfHeight.applyMatrix4(g),m++}else if(B.isPointLight){const v=s.point[A];v.position.setFromMatrixPosition(B.matrixWorld),v.position.applyMatrix4(G),A++}else if(B.isHemisphereLight){const v=s.hemi[b];v.direction.setFromMatrixPosition(B.matrixWorld),v.direction.transformDirection(G),b++}}}return{setup:a,setupView:l,state:s}}function Av(i,e){const t=new kK(i,e),n=[],s=[];function o(){n.length=0,s.length=0}function r(C){n.push(C)}function g(C){s.push(C)}function a(C){t.setup(n,C)}function l(C){t.setupView(n,C)}return{init:o,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:a,setupLightsView:l,pushLight:r,pushShadow:g}}function TK(i,e){let t=new WeakMap;function n(o,r=0){const g=t.get(o);let a;return g===void 0?(a=new Av(i,e),t.set(o,[a])):r>=g.length?(a=new Av(i,e),g.push(a)):a=g[r],a}function s(){t=new WeakMap}return{get:n,dispose:s}}class ih extends Tn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=IS,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class sh extends Tn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new N,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const EK=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,_K=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function JK(i,e,t){let n=new th;const s=new Se,o=new Se,r=new Ht,g=new ih({depthPacking:Sb}),a=new sh,l={},I=t.maxTextureSize,C={0:Vi,1:rr,2:ms},u=new Ds({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Se},radius:{value:4}},vertexShader:EK,fragmentShader:_K}),A=u.clone();A.defines.HORIZONTAL_PASS=1;const h=new bt;h.setAttribute("position",new Ft(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new fn(h,u),b=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=bb,this.render=function(B,v,W){if(b.enabled===!1||b.autoUpdate===!1&&b.needsUpdate===!1||B.length===0)return;const R=i.getRenderTarget(),Z=i.getActiveCubeFace(),V=i.getActiveMipmapLevel(),H=i.state;H.setBlending(tr),H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);for(let P=0,E=B.length;P<E;P++){const L=B[P],K=L.shadow;if(K===void 0){console.warn("THREE.WebGLShadowMap:",L,"has no shadow.");continue}if(K.autoUpdate===!1&&K.needsUpdate===!1)continue;s.copy(K.mapSize);const O=K.getFrameExtents();if(s.multiply(O),o.copy(K.mapSize),(s.x>I||s.y>I)&&(s.x>I&&(o.x=Math.floor(I/O.x),s.x=o.x*O.x,K.mapSize.x=o.x),s.y>I&&(o.y=Math.floor(I/O.y),s.y=o.y*O.y,K.mapSize.y=o.y)),K.map===null){const ne=this.type!==Bl?{minFilter:Sn,magFilter:Sn}:{};K.map=new Bs(s.x,s.y,ne),K.map.texture.name=L.name+".shadowMap",K.camera.updateProjectionMatrix()}i.setRenderTarget(K.map),i.clear();const q=K.getViewportCount();for(let ne=0;ne<q;ne++){const k=K.getViewport(ne);r.set(o.x*k.x,o.y*k.y,o.x*k.z,o.y*k.w),H.viewport(r),K.updateMatrices(L,ne),n=K.getFrustum(),y(v,W,K.camera,L,this.type)}K.isPointLightShadow!==!0&&this.type===Bl&&G(K,W),K.needsUpdate=!1}b.needsUpdate=!1,i.setRenderTarget(R,Z,V)};function G(B,v){const W=e.update(m);u.defines.VSM_SAMPLES!==B.blurSamples&&(u.defines.VSM_SAMPLES=B.blurSamples,A.defines.VSM_SAMPLES=B.blurSamples,u.needsUpdate=!0,A.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new Bs(s.x,s.y)),u.uniforms.shadow_pass.value=B.map.texture,u.uniforms.resolution.value=B.mapSize,u.uniforms.radius.value=B.radius,i.setRenderTarget(B.mapPass),i.clear(),i.renderBufferDirect(v,null,W,u,m,null),A.uniforms.shadow_pass.value=B.mapPass.texture,A.uniforms.resolution.value=B.mapSize,A.uniforms.radius.value=B.radius,i.setRenderTarget(B.map),i.clear(),i.renderBufferDirect(v,null,W,A,m,null)}function f(B,v,W,R,Z,V){let H=null;const P=W.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(P!==void 0?H=P:H=W.isPointLight===!0?a:g,i.localClippingEnabled&&v.clipShadows===!0&&Array.isArray(v.clippingPlanes)&&v.clippingPlanes.length!==0||v.displacementMap&&v.displacementScale!==0||v.alphaMap&&v.alphaTest>0){const E=H.uuid,L=v.uuid;let K=l[E];K===void 0&&(K={},l[E]=K);let O=K[L];O===void 0&&(O=H.clone(),K[L]=O),H=O}return H.visible=v.visible,H.wireframe=v.wireframe,V===Bl?H.side=v.shadowSide!==null?v.shadowSide:v.side:H.side=v.shadowSide!==null?v.shadowSide:C[v.side],H.alphaMap=v.alphaMap,H.alphaTest=v.alphaTest,H.clipShadows=v.clipShadows,H.clippingPlanes=v.clippingPlanes,H.clipIntersection=v.clipIntersection,H.displacementMap=v.displacementMap,H.displacementScale=v.displacementScale,H.displacementBias=v.displacementBias,H.wireframeLinewidth=v.wireframeLinewidth,H.linewidth=v.linewidth,W.isPointLight===!0&&H.isMeshDistanceMaterial===!0&&(H.referencePosition.setFromMatrixPosition(W.matrixWorld),H.nearDistance=R,H.farDistance=Z),H}function y(B,v,W,R,Z){if(B.visible===!1)return;if(B.layers.test(v.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&Z===Bl)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(W.matrixWorldInverse,B.matrixWorld);const P=e.update(B),E=B.material;if(Array.isArray(E)){const L=P.groups;for(let K=0,O=L.length;K<O;K++){const q=L[K],ne=E[q.materialIndex];if(ne&&ne.visible){const k=f(B,ne,R,W.near,W.far,Z);i.renderBufferDirect(W,null,P,k,B,q)}}}else if(E.visible){const L=f(B,E,R,W.near,W.far,Z);i.renderBufferDirect(W,null,P,L,B,null)}}const H=B.children;for(let P=0,E=H.length;P<E;P++)y(H[P],v,W,R,Z)}}function UK(i,e,t){const n=t.isWebGL2;function s(){let $=!1;const De=new Ht;let He=null;const Ae=new Ht(0,0,0,0);return{setMask:function(ke){He!==ke&&!$&&(i.colorMask(ke,ke,ke,ke),He=ke)},setLocked:function(ke){$=ke},setClear:function(ke,gt,At,Tt,Bt){Bt===!0&&(ke*=Tt,gt*=Tt,At*=Tt),De.set(ke,gt,At,Tt),Ae.equals(De)===!1&&(i.clearColor(ke,gt,At,Tt),Ae.copy(De))},reset:function(){$=!1,He=null,Ae.set(-1,0,0,0)}}}function o(){let $=!1,De=null,He=null,Ae=null;return{setTest:function(ke){ke?ge(2929):Ie(2929)},setMask:function(ke){De!==ke&&!$&&(i.depthMask(ke),De=ke)},setFunc:function(ke){if(He!==ke){switch(ke){case XW:i.depthFunc(512);break;case YW:i.depthFunc(519);break;case HW:i.depthFunc(513);break;case RA:i.depthFunc(515);break;case FW:i.depthFunc(514);break;case KW:i.depthFunc(518);break;case NW:i.depthFunc(516);break;case MW:i.depthFunc(517);break;default:i.depthFunc(515)}He=ke}},setLocked:function(ke){$=ke},setClear:function(ke){Ae!==ke&&(i.clearDepth(ke),Ae=ke)},reset:function(){$=!1,De=null,He=null,Ae=null}}}function r(){let $=!1,De=null,He=null,Ae=null,ke=null,gt=null,At=null,Tt=null,Bt=null;return{setTest:function(rt){$||(rt?ge(2960):Ie(2960))},setMask:function(rt){De!==rt&&!$&&(i.stencilMask(rt),De=rt)},setFunc:function(rt,Kt,Et){(He!==rt||Ae!==Kt||ke!==Et)&&(i.stencilFunc(rt,Kt,Et),He=rt,Ae=Kt,ke=Et)},setOp:function(rt,Kt,Et){(gt!==rt||At!==Kt||Tt!==Et)&&(i.stencilOp(rt,Kt,Et),gt=rt,At=Kt,Tt=Et)},setLocked:function(rt){$=rt},setClear:function(rt){Bt!==rt&&(i.clearStencil(rt),Bt=rt)},reset:function(){$=!1,De=null,He=null,Ae=null,ke=null,gt=null,At=null,Tt=null,Bt=null}}}const g=new s,a=new o,l=new r,I=new WeakMap,C=new WeakMap;let u={},A={},h=new WeakMap,m=[],b=null,G=!1,f=null,y=null,B=null,v=null,W=null,R=null,Z=null,V=!1,H=null,P=null,E=null,L=null,K=null;const O=i.getParameter(35661);let q=!1,ne=0;const k=i.getParameter(7938);k.indexOf("WebGL")!==-1?(ne=parseFloat(/^WebGL (\d)/.exec(k)[1]),q=ne>=1):k.indexOf("OpenGL ES")!==-1&&(ne=parseFloat(/^OpenGL ES (\d)/.exec(k)[1]),q=ne>=2);let F=null,z={};const X=i.getParameter(3088),T=i.getParameter(2978),Q=new Ht().fromArray(X),ee=new Ht().fromArray(T);function oe($,De,He){const Ae=new Uint8Array(4),ke=i.createTexture();i.bindTexture($,ke),i.texParameteri($,10241,9728),i.texParameteri($,10240,9728);for(let gt=0;gt<He;gt++)i.texImage2D(De+gt,0,6408,1,1,0,6408,5121,Ae);return ke}const j={};j[3553]=oe(3553,3553,1),j[34067]=oe(34067,34069,6),g.setClear(0,0,0,1),a.setClear(1),l.setClear(0),ge(2929),a.setFunc(RA),fe(!1),Qe(Sf),ge(2884),Ge(tr);function ge($){u[$]!==!0&&(i.enable($),u[$]=!0)}function Ie($){u[$]!==!1&&(i.disable($),u[$]=!1)}function Be($,De){return A[$]!==De?(i.bindFramebuffer($,De),A[$]=De,n&&($===36009&&(A[36160]=De),$===36160&&(A[36009]=De)),!0):!1}function ve($,De){let He=m,Ae=!1;if($)if(He=h.get(De),He===void 0&&(He=[],h.set(De,He)),$.isWebGLMultipleRenderTargets){const ke=$.texture;if(He.length!==ke.length||He[0]!==36064){for(let gt=0,At=ke.length;gt<At;gt++)He[gt]=36064+gt;He.length=ke.length,Ae=!0}}else He[0]!==36064&&(He[0]=36064,Ae=!0);else He[0]!==1029&&(He[0]=1029,Ae=!0);Ae&&(t.isWebGL2?i.drawBuffers(He):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(He))}function Ye($){return b!==$?(i.useProgram($),b=$,!0):!1}const se={[qg]:32774,[GW]:32778,[yW]:32779};if(n)se[Xf]=32775,se[Yf]=32776;else{const $=e.get("EXT_blend_minmax");$!==null&&(se[Xf]=$.MIN_EXT,se[Yf]=$.MAX_EXT)}const ue={[BW]:0,[vW]:1,[ZW]:768,[yb]:770,[xW]:776,[RW]:774,[WW]:772,[wW]:769,[Bb]:771,[VW]:775,[SW]:773};function Ge($,De,He,Ae,ke,gt,At,Tt){if($===tr){G===!0&&(Ie(3042),G=!1);return}if(G===!1&&(ge(3042),G=!0),$!==bW){if($!==f||Tt!==V){if((y!==qg||W!==qg)&&(i.blendEquation(32774),y=qg,W=qg),Tt)switch($){case Ca:i.blendFuncSeparate(1,771,1,771);break;case Rf:i.blendFunc(1,1);break;case Vf:i.blendFuncSeparate(0,769,0,1);break;case xf:i.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}else switch($){case Ca:i.blendFuncSeparate(770,771,1,771);break;case Rf:i.blendFunc(770,1);break;case Vf:i.blendFuncSeparate(0,769,0,1);break;case xf:i.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}B=null,v=null,R=null,Z=null,f=$,V=Tt}return}ke=ke||De,gt=gt||He,At=At||Ae,(De!==y||ke!==W)&&(i.blendEquationSeparate(se[De],se[ke]),y=De,W=ke),(He!==B||Ae!==v||gt!==R||At!==Z)&&(i.blendFuncSeparate(ue[He],ue[Ae],ue[gt],ue[At]),B=He,v=Ae,R=gt,Z=At),f=$,V=null}function xe($,De){$.side===ms?Ie(2884):ge(2884);let He=$.side===Vi;De&&(He=!He),fe(He),$.blending===Ca&&$.transparent===!1?Ge(tr):Ge($.blending,$.blendEquation,$.blendSrc,$.blendDst,$.blendEquationAlpha,$.blendSrcAlpha,$.blendDstAlpha,$.premultipliedAlpha),a.setFunc($.depthFunc),a.setTest($.depthTest),a.setMask($.depthWrite),g.setMask($.colorWrite);const Ae=$.stencilWrite;l.setTest(Ae),Ae&&(l.setMask($.stencilWriteMask),l.setFunc($.stencilFunc,$.stencilRef,$.stencilFuncMask),l.setOp($.stencilFail,$.stencilZFail,$.stencilZPass)),Xe($.polygonOffset,$.polygonOffsetFactor,$.polygonOffsetUnits),$.alphaToCoverage===!0?ge(32926):Ie(32926)}function fe($){H!==$&&($?i.frontFace(2304):i.frontFace(2305),H=$)}function Qe($){$!==mW?(ge(2884),$!==P&&($===Sf?i.cullFace(1029):$===fW?i.cullFace(1028):i.cullFace(1032))):Ie(2884),P=$}function de($){$!==E&&(q&&i.lineWidth($),E=$)}function Xe($,De,He){$?(ge(32823),(L!==De||K!==He)&&(i.polygonOffset(De,He),L=De,K=He)):Ie(32823)}function Le($){$?ge(3089):Ie(3089)}function me($){$===void 0&&($=33984+O-1),F!==$&&(i.activeTexture($),F=$)}function M($,De,He){He===void 0&&(F===null?He=33984+O-1:He=F);let Ae=z[He];Ae===void 0&&(Ae={type:void 0,texture:void 0},z[He]=Ae),(Ae.type!==$||Ae.texture!==De)&&(F!==He&&(i.activeTexture(He),F=He),i.bindTexture($,De||j[$]),Ae.type=$,Ae.texture=De)}function Y(){const $=z[F];$!==void 0&&$.type!==void 0&&(i.bindTexture($.type,null),$.type=void 0,$.texture=void 0)}function te(){try{i.compressedTexImage2D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function ce(){try{i.texSubImage2D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function we(){try{i.texSubImage3D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Re(){try{i.compressedTexSubImage2D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Ve(){try{i.texStorage2D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function We(){try{i.texStorage3D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function he(){try{i.texImage2D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function ze(){try{i.texImage3D.apply(i,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Pe($){Q.equals($)===!1&&(i.scissor($.x,$.y,$.z,$.w),Q.copy($))}function Te($){ee.equals($)===!1&&(i.viewport($.x,$.y,$.z,$.w),ee.copy($))}function Fe($,De){let He=C.get(De);He===void 0&&(He=new WeakMap,C.set(De,He));let Ae=He.get($);Ae===void 0&&(Ae=i.getUniformBlockIndex(De,$.name),He.set($,Ae))}function Ke($,De){const Ae=C.get(De).get($);I.get($)!==Ae&&(i.uniformBlockBinding(De,Ae,$.__bindingPointIndex),I.set($,Ae))}function $e(){i.disable(3042),i.disable(2884),i.disable(2929),i.disable(32823),i.disable(3089),i.disable(2960),i.disable(32926),i.blendEquation(32774),i.blendFunc(1,0),i.blendFuncSeparate(1,0,1,0),i.colorMask(!0,!0,!0,!0),i.clearColor(0,0,0,0),i.depthMask(!0),i.depthFunc(513),i.clearDepth(1),i.stencilMask(4294967295),i.stencilFunc(519,0,4294967295),i.stencilOp(7680,7680,7680),i.clearStencil(0),i.cullFace(1029),i.frontFace(2305),i.polygonOffset(0,0),i.activeTexture(33984),i.bindFramebuffer(36160,null),n===!0&&(i.bindFramebuffer(36009,null),i.bindFramebuffer(36008,null)),i.useProgram(null),i.lineWidth(1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.viewport(0,0,i.canvas.width,i.canvas.height),u={},F=null,z={},A={},h=new WeakMap,m=[],b=null,G=!1,f=null,y=null,B=null,v=null,W=null,R=null,Z=null,V=!1,H=null,P=null,E=null,L=null,K=null,Q.set(0,0,i.canvas.width,i.canvas.height),ee.set(0,0,i.canvas.width,i.canvas.height),g.reset(),a.reset(),l.reset()}return{buffers:{color:g,depth:a,stencil:l},enable:ge,disable:Ie,bindFramebuffer:Be,drawBuffers:ve,useProgram:Ye,setBlending:Ge,setMaterial:xe,setFlipSided:fe,setCullFace:Qe,setLineWidth:de,setPolygonOffset:Xe,setScissorTest:Le,activeTexture:me,bindTexture:M,unbindTexture:Y,compressedTexImage2D:te,texImage2D:he,texImage3D:ze,updateUBOMapping:Fe,uniformBlockBinding:Ke,texStorage2D:Ve,texStorage3D:We,texSubImage2D:ce,texSubImage3D:we,compressedTexSubImage2D:Re,scissor:Pe,viewport:Te,reset:$e}}function DK(i,e,t,n,s,o,r){const g=s.isWebGL2,a=s.maxTextures,l=s.maxCubemapSize,I=s.maxTextureSize,C=s.maxSamples,u=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,A=/OculusBrowser/g.test(navigator.userAgent),h=new WeakMap;let m;const b=new WeakMap;let G=!1;try{G=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function f(M,Y){return G?new OffscreenCanvas(M,Y):iC("canvas")}function y(M,Y,te,ce){let we=1;if((M.width>ce||M.height>ce)&&(we=ce/Math.max(M.width,M.height)),we<1||Y===!0)if(typeof HTMLImageElement<"u"&&M instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&M instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&M instanceof ImageBitmap){const Re=Y?xA:Math.floor,Ve=Re(we*M.width),We=Re(we*M.height);m===void 0&&(m=f(Ve,We));const he=te?f(Ve,We):m;return he.width=Ve,he.height=We,he.getContext("2d").drawImage(M,0,0,Ve,We),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+M.width+"x"+M.height+") to ("+Ve+"x"+We+")."),he}else return"data"in M&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+M.width+"x"+M.height+")."),M;return M}function B(M){return n0(M.width)&&n0(M.height)}function v(M){return g?!1:M.wrapS!==mi||M.wrapT!==mi||M.minFilter!==Sn&&M.minFilter!==en}function W(M,Y){return M.generateMipmaps&&Y&&M.minFilter!==Sn&&M.minFilter!==en}function R(M){i.generateMipmap(M)}function Z(M,Y,te,ce,we=!1){if(g===!1)return Y;if(M!==null){if(i[M]!==void 0)return i[M];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+M+"'")}let Re=Y;return Y===6403&&(te===5126&&(Re=33326),te===5131&&(Re=33325),te===5121&&(Re=33321)),Y===33319&&(te===5126&&(Re=33328),te===5131&&(Re=33327),te===5121&&(Re=33323)),Y===6408&&(te===5126&&(Re=34836),te===5131&&(Re=34842),te===5121&&(Re=ce===Yt&&we===!1?35907:32856),te===32819&&(Re=32854),te===32820&&(Re=32855)),(Re===33325||Re===33326||Re===33327||Re===33328||Re===34842||Re===34836)&&e.get("EXT_color_buffer_float"),Re}function V(M,Y,te){return W(M,te)===!0||M.isFramebufferTexture&&M.minFilter!==Sn&&M.minFilter!==en?Math.log2(Math.max(Y.width,Y.height))+1:M.mipmaps!==void 0&&M.mipmaps.length>0?M.mipmaps.length:M.isCompressedTexture&&Array.isArray(M.image)?Y.mipmaps.length:1}function H(M){return M===Sn||M===qc||M===$c?9728:9729}function P(M){const Y=M.target;Y.removeEventListener("dispose",P),L(Y),Y.isVideoTexture&&h.delete(Y)}function E(M){const Y=M.target;Y.removeEventListener("dispose",E),O(Y)}function L(M){const Y=n.get(M);if(Y.__webglInit===void 0)return;const te=M.source,ce=b.get(te);if(ce){const we=ce[Y.__cacheKey];we.usedTimes--,we.usedTimes===0&&K(M),Object.keys(ce).length===0&&b.delete(te)}n.remove(M)}function K(M){const Y=n.get(M);i.deleteTexture(Y.__webglTexture);const te=M.source,ce=b.get(te);delete ce[Y.__cacheKey],r.memory.textures--}function O(M){const Y=M.texture,te=n.get(M),ce=n.get(Y);if(ce.__webglTexture!==void 0&&(i.deleteTexture(ce.__webglTexture),r.memory.textures--),M.depthTexture&&M.depthTexture.dispose(),M.isWebGLCubeRenderTarget)for(let we=0;we<6;we++)i.deleteFramebuffer(te.__webglFramebuffer[we]),te.__webglDepthbuffer&&i.deleteRenderbuffer(te.__webglDepthbuffer[we]);else{if(i.deleteFramebuffer(te.__webglFramebuffer),te.__webglDepthbuffer&&i.deleteRenderbuffer(te.__webglDepthbuffer),te.__webglMultisampledFramebuffer&&i.deleteFramebuffer(te.__webglMultisampledFramebuffer),te.__webglColorRenderbuffer)for(let we=0;we<te.__webglColorRenderbuffer.length;we++)te.__webglColorRenderbuffer[we]&&i.deleteRenderbuffer(te.__webglColorRenderbuffer[we]);te.__webglDepthRenderbuffer&&i.deleteRenderbuffer(te.__webglDepthRenderbuffer)}if(M.isWebGLMultipleRenderTargets)for(let we=0,Re=Y.length;we<Re;we++){const Ve=n.get(Y[we]);Ve.__webglTexture&&(i.deleteTexture(Ve.__webglTexture),r.memory.textures--),n.remove(Y[we])}n.remove(Y),n.remove(M)}let q=0;function ne(){q=0}function k(){const M=q;return M>=a&&console.warn("THREE.WebGLTextures: Trying to use "+M+" texture units while this GPU supports only "+a),q+=1,M}function F(M){const Y=[];return Y.push(M.wrapS),Y.push(M.wrapT),Y.push(M.magFilter),Y.push(M.minFilter),Y.push(M.anisotropy),Y.push(M.internalFormat),Y.push(M.format),Y.push(M.type),Y.push(M.generateMipmaps),Y.push(M.premultiplyAlpha),Y.push(M.flipY),Y.push(M.unpackAlignment),Y.push(M.encoding),Y.join()}function z(M,Y){const te=n.get(M);if(M.isVideoTexture&&Le(M),M.isRenderTargetTexture===!1&&M.version>0&&te.__version!==M.version){const ce=M.image;if(ce===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ce.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ie(te,M,Y);return}}t.bindTexture(3553,te.__webglTexture,33984+Y)}function X(M,Y){const te=n.get(M);if(M.version>0&&te.__version!==M.version){Ie(te,M,Y);return}t.bindTexture(35866,te.__webglTexture,33984+Y)}function T(M,Y){const te=n.get(M);if(M.version>0&&te.__version!==M.version){Ie(te,M,Y);return}t.bindTexture(32879,te.__webglTexture,33984+Y)}function Q(M,Y){const te=n.get(M);if(M.version>0&&te.__version!==M.version){Be(te,M,Y);return}t.bindTexture(34067,te.__webglTexture,33984+Y)}const ee={[gr]:10497,[mi]:33071,[_l]:33648},oe={[Sn]:9728,[qc]:9984,[$c]:9986,[en]:9729,[jA]:9985,[Cr]:9987};function j(M,Y,te){if(te?(i.texParameteri(M,10242,ee[Y.wrapS]),i.texParameteri(M,10243,ee[Y.wrapT]),(M===32879||M===35866)&&i.texParameteri(M,32882,ee[Y.wrapR]),i.texParameteri(M,10240,oe[Y.magFilter]),i.texParameteri(M,10241,oe[Y.minFilter])):(i.texParameteri(M,10242,33071),i.texParameteri(M,10243,33071),(M===32879||M===35866)&&i.texParameteri(M,32882,33071),(Y.wrapS!==mi||Y.wrapT!==mi)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),i.texParameteri(M,10240,H(Y.magFilter)),i.texParameteri(M,10241,H(Y.minFilter)),Y.minFilter!==Sn&&Y.minFilter!==en&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const ce=e.get("EXT_texture_filter_anisotropic");if(Y.type===Qo&&e.has("OES_texture_float_linear")===!1||g===!1&&Y.type===Jl&&e.has("OES_texture_half_float_linear")===!1)return;(Y.anisotropy>1||n.get(Y).__currentAnisotropy)&&(i.texParameterf(M,ce.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Y.anisotropy,s.getMaxAnisotropy())),n.get(Y).__currentAnisotropy=Y.anisotropy)}}function ge(M,Y){let te=!1;M.__webglInit===void 0&&(M.__webglInit=!0,Y.addEventListener("dispose",P));const ce=Y.source;let we=b.get(ce);we===void 0&&(we={},b.set(ce,we));const Re=F(Y);if(Re!==M.__cacheKey){we[Re]===void 0&&(we[Re]={texture:i.createTexture(),usedTimes:0},r.memory.textures++,te=!0),we[Re].usedTimes++;const Ve=we[M.__cacheKey];Ve!==void 0&&(we[M.__cacheKey].usedTimes--,Ve.usedTimes===0&&K(Y)),M.__cacheKey=Re,M.__webglTexture=we[Re].texture}return te}function Ie(M,Y,te){let ce=3553;Y.isDataArrayTexture&&(ce=35866),Y.isData3DTexture&&(ce=32879);const we=ge(M,Y),Re=Y.source;t.bindTexture(ce,M.__webglTexture,33984+te);const Ve=n.get(Re);if(Re.version!==Ve.__version||we===!0){t.activeTexture(33984+te),i.pixelStorei(37440,Y.flipY),i.pixelStorei(37441,Y.premultiplyAlpha),i.pixelStorei(3317,Y.unpackAlignment),i.pixelStorei(37443,0);const We=v(Y)&&B(Y.image)===!1;let he=y(Y.image,We,!1,I);he=me(Y,he);const ze=B(he)||g,Pe=o.convert(Y.format,Y.encoding);let Te=o.convert(Y.type),Fe=Z(Y.internalFormat,Pe,Te,Y.encoding,Y.isVideoTexture);j(ce,Y,ze);let Ke;const $e=Y.mipmaps,$=g&&Y.isVideoTexture!==!0,De=Ve.__version===void 0||we===!0,He=V(Y,he,ze);if(Y.isDepthTexture)Fe=6402,g?Y.type===Qo?Fe=36012:Y.type===eg?Fe=33190:Y.type===ua?Fe=35056:Fe=33189:Y.type===Qo&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Y.format===ug&&Fe===6402&&Y.type!==Zb&&Y.type!==eg&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Y.type=eg,Te=o.convert(Y.type)),Y.format===Ba&&Fe===6402&&(Fe=34041,Y.type!==ua&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Y.type=ua,Te=o.convert(Y.type))),De&&($?t.texStorage2D(3553,1,Fe,he.width,he.height):t.texImage2D(3553,0,Fe,he.width,he.height,0,Pe,Te,null));else if(Y.isDataTexture)if($e.length>0&&ze){$&&De&&t.texStorage2D(3553,He,Fe,$e[0].width,$e[0].height);for(let Ae=0,ke=$e.length;Ae<ke;Ae++)Ke=$e[Ae],$?t.texSubImage2D(3553,Ae,0,0,Ke.width,Ke.height,Pe,Te,Ke.data):t.texImage2D(3553,Ae,Fe,Ke.width,Ke.height,0,Pe,Te,Ke.data);Y.generateMipmaps=!1}else $?(De&&t.texStorage2D(3553,He,Fe,he.width,he.height),t.texSubImage2D(3553,0,0,0,he.width,he.height,Pe,Te,he.data)):t.texImage2D(3553,0,Fe,he.width,he.height,0,Pe,Te,he.data);else if(Y.isCompressedTexture){$&&De&&t.texStorage2D(3553,He,Fe,$e[0].width,$e[0].height);for(let Ae=0,ke=$e.length;Ae<ke;Ae++)Ke=$e[Ae],Y.format!==fs?Pe!==null?$?t.compressedTexSubImage2D(3553,Ae,0,0,Ke.width,Ke.height,Pe,Ke.data):t.compressedTexImage2D(3553,Ae,Fe,Ke.width,Ke.height,0,Ke.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):$?t.texSubImage2D(3553,Ae,0,0,Ke.width,Ke.height,Pe,Te,Ke.data):t.texImage2D(3553,Ae,Fe,Ke.width,Ke.height,0,Pe,Te,Ke.data)}else if(Y.isDataArrayTexture)$?(De&&t.texStorage3D(35866,He,Fe,he.width,he.height,he.depth),t.texSubImage3D(35866,0,0,0,0,he.width,he.height,he.depth,Pe,Te,he.data)):t.texImage3D(35866,0,Fe,he.width,he.height,he.depth,0,Pe,Te,he.data);else if(Y.isData3DTexture)$?(De&&t.texStorage3D(32879,He,Fe,he.width,he.height,he.depth),t.texSubImage3D(32879,0,0,0,0,he.width,he.height,he.depth,Pe,Te,he.data)):t.texImage3D(32879,0,Fe,he.width,he.height,he.depth,0,Pe,Te,he.data);else if(Y.isFramebufferTexture){if(De)if($)t.texStorage2D(3553,He,Fe,he.width,he.height);else{let Ae=he.width,ke=he.height;for(let gt=0;gt<He;gt++)t.texImage2D(3553,gt,Fe,Ae,ke,0,Pe,Te,null),Ae>>=1,ke>>=1}}else if($e.length>0&&ze){$&&De&&t.texStorage2D(3553,He,Fe,$e[0].width,$e[0].height);for(let Ae=0,ke=$e.length;Ae<ke;Ae++)Ke=$e[Ae],$?t.texSubImage2D(3553,Ae,0,0,Pe,Te,Ke):t.texImage2D(3553,Ae,Fe,Pe,Te,Ke);Y.generateMipmaps=!1}else $?(De&&t.texStorage2D(3553,He,Fe,he.width,he.height),t.texSubImage2D(3553,0,0,0,Pe,Te,he)):t.texImage2D(3553,0,Fe,Pe,Te,he);W(Y,ze)&&R(ce),Ve.__version=Re.version,Y.onUpdate&&Y.onUpdate(Y)}M.__version=Y.version}function Be(M,Y,te){if(Y.image.length!==6)return;const ce=ge(M,Y),we=Y.source;t.bindTexture(34067,M.__webglTexture,33984+te);const Re=n.get(we);if(we.version!==Re.__version||ce===!0){t.activeTexture(33984+te),i.pixelStorei(37440,Y.flipY),i.pixelStorei(37441,Y.premultiplyAlpha),i.pixelStorei(3317,Y.unpackAlignment),i.pixelStorei(37443,0);const Ve=Y.isCompressedTexture||Y.image[0].isCompressedTexture,We=Y.image[0]&&Y.image[0].isDataTexture,he=[];for(let Ae=0;Ae<6;Ae++)!Ve&&!We?he[Ae]=y(Y.image[Ae],!1,!0,l):he[Ae]=We?Y.image[Ae].image:Y.image[Ae],he[Ae]=me(Y,he[Ae]);const ze=he[0],Pe=B(ze)||g,Te=o.convert(Y.format,Y.encoding),Fe=o.convert(Y.type),Ke=Z(Y.internalFormat,Te,Fe,Y.encoding),$e=g&&Y.isVideoTexture!==!0,$=Re.__version===void 0||ce===!0;let De=V(Y,ze,Pe);j(34067,Y,Pe);let He;if(Ve){$e&&$&&t.texStorage2D(34067,De,Ke,ze.width,ze.height);for(let Ae=0;Ae<6;Ae++){He=he[Ae].mipmaps;for(let ke=0;ke<He.length;ke++){const gt=He[ke];Y.format!==fs?Te!==null?$e?t.compressedTexSubImage2D(34069+Ae,ke,0,0,gt.width,gt.height,Te,gt.data):t.compressedTexImage2D(34069+Ae,ke,Ke,gt.width,gt.height,0,gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):$e?t.texSubImage2D(34069+Ae,ke,0,0,gt.width,gt.height,Te,Fe,gt.data):t.texImage2D(34069+Ae,ke,Ke,gt.width,gt.height,0,Te,Fe,gt.data)}}}else{He=Y.mipmaps,$e&&$&&(He.length>0&&De++,t.texStorage2D(34067,De,Ke,he[0].width,he[0].height));for(let Ae=0;Ae<6;Ae++)if(We){$e?t.texSubImage2D(34069+Ae,0,0,0,he[Ae].width,he[Ae].height,Te,Fe,he[Ae].data):t.texImage2D(34069+Ae,0,Ke,he[Ae].width,he[Ae].height,0,Te,Fe,he[Ae].data);for(let ke=0;ke<He.length;ke++){const At=He[ke].image[Ae].image;$e?t.texSubImage2D(34069+Ae,ke+1,0,0,At.width,At.height,Te,Fe,At.data):t.texImage2D(34069+Ae,ke+1,Ke,At.width,At.height,0,Te,Fe,At.data)}}else{$e?t.texSubImage2D(34069+Ae,0,0,0,Te,Fe,he[Ae]):t.texImage2D(34069+Ae,0,Ke,Te,Fe,he[Ae]);for(let ke=0;ke<He.length;ke++){const gt=He[ke];$e?t.texSubImage2D(34069+Ae,ke+1,0,0,Te,Fe,gt.image[Ae]):t.texImage2D(34069+Ae,ke+1,Ke,Te,Fe,gt.image[Ae])}}}W(Y,Pe)&&R(34067),Re.__version=we.version,Y.onUpdate&&Y.onUpdate(Y)}M.__version=Y.version}function ve(M,Y,te,ce,we){const Re=o.convert(te.format,te.encoding),Ve=o.convert(te.type),We=Z(te.internalFormat,Re,Ve,te.encoding);n.get(Y).__hasExternalTextures||(we===32879||we===35866?t.texImage3D(we,0,We,Y.width,Y.height,Y.depth,0,Re,Ve,null):t.texImage2D(we,0,We,Y.width,Y.height,0,Re,Ve,null)),t.bindFramebuffer(36160,M),Xe(Y)?u.framebufferTexture2DMultisampleEXT(36160,ce,we,n.get(te).__webglTexture,0,de(Y)):i.framebufferTexture2D(36160,ce,we,n.get(te).__webglTexture,0),t.bindFramebuffer(36160,null)}function Ye(M,Y,te){if(i.bindRenderbuffer(36161,M),Y.depthBuffer&&!Y.stencilBuffer){let ce=33189;if(te||Xe(Y)){const we=Y.depthTexture;we&&we.isDepthTexture&&(we.type===Qo?ce=36012:we.type===eg&&(ce=33190));const Re=de(Y);Xe(Y)?u.renderbufferStorageMultisampleEXT(36161,Re,ce,Y.width,Y.height):i.renderbufferStorageMultisample(36161,Re,ce,Y.width,Y.height)}else i.renderbufferStorage(36161,ce,Y.width,Y.height);i.framebufferRenderbuffer(36160,36096,36161,M)}else if(Y.depthBuffer&&Y.stencilBuffer){const ce=de(Y);te&&Xe(Y)===!1?i.renderbufferStorageMultisample(36161,ce,35056,Y.width,Y.height):Xe(Y)?u.renderbufferStorageMultisampleEXT(36161,ce,35056,Y.width,Y.height):i.renderbufferStorage(36161,34041,Y.width,Y.height),i.framebufferRenderbuffer(36160,33306,36161,M)}else{const ce=Y.isWebGLMultipleRenderTargets===!0?Y.texture:[Y.texture];for(let we=0;we<ce.length;we++){const Re=ce[we],Ve=o.convert(Re.format,Re.encoding),We=o.convert(Re.type),he=Z(Re.internalFormat,Ve,We,Re.encoding),ze=de(Y);te&&Xe(Y)===!1?i.renderbufferStorageMultisample(36161,ze,he,Y.width,Y.height):Xe(Y)?u.renderbufferStorageMultisampleEXT(36161,ze,he,Y.width,Y.height):i.renderbufferStorage(36161,he,Y.width,Y.height)}}i.bindRenderbuffer(36161,null)}function se(M,Y){if(Y&&Y.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,M),!(Y.depthTexture&&Y.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(Y.depthTexture).__webglTexture||Y.depthTexture.image.width!==Y.width||Y.depthTexture.image.height!==Y.height)&&(Y.depthTexture.image.width=Y.width,Y.depthTexture.image.height=Y.height,Y.depthTexture.needsUpdate=!0),z(Y.depthTexture,0);const ce=n.get(Y.depthTexture).__webglTexture,we=de(Y);if(Y.depthTexture.format===ug)Xe(Y)?u.framebufferTexture2DMultisampleEXT(36160,36096,3553,ce,0,we):i.framebufferTexture2D(36160,36096,3553,ce,0);else if(Y.depthTexture.format===Ba)Xe(Y)?u.framebufferTexture2DMultisampleEXT(36160,33306,3553,ce,0,we):i.framebufferTexture2D(36160,33306,3553,ce,0);else throw new Error("Unknown depthTexture format")}function ue(M){const Y=n.get(M),te=M.isWebGLCubeRenderTarget===!0;if(M.depthTexture&&!Y.__autoAllocateDepthBuffer){if(te)throw new Error("target.depthTexture not supported in Cube render targets");se(Y.__webglFramebuffer,M)}else if(te){Y.__webglDepthbuffer=[];for(let ce=0;ce<6;ce++)t.bindFramebuffer(36160,Y.__webglFramebuffer[ce]),Y.__webglDepthbuffer[ce]=i.createRenderbuffer(),Ye(Y.__webglDepthbuffer[ce],M,!1)}else t.bindFramebuffer(36160,Y.__webglFramebuffer),Y.__webglDepthbuffer=i.createRenderbuffer(),Ye(Y.__webglDepthbuffer,M,!1);t.bindFramebuffer(36160,null)}function Ge(M,Y,te){const ce=n.get(M);Y!==void 0&&ve(ce.__webglFramebuffer,M,M.texture,36064,3553),te!==void 0&&ue(M)}function xe(M){const Y=M.texture,te=n.get(M),ce=n.get(Y);M.addEventListener("dispose",E),M.isWebGLMultipleRenderTargets!==!0&&(ce.__webglTexture===void 0&&(ce.__webglTexture=i.createTexture()),ce.__version=Y.version,r.memory.textures++);const we=M.isWebGLCubeRenderTarget===!0,Re=M.isWebGLMultipleRenderTargets===!0,Ve=B(M)||g;if(we){te.__webglFramebuffer=[];for(let We=0;We<6;We++)te.__webglFramebuffer[We]=i.createFramebuffer()}else{if(te.__webglFramebuffer=i.createFramebuffer(),Re)if(s.drawBuffers){const We=M.texture;for(let he=0,ze=We.length;he<ze;he++){const Pe=n.get(We[he]);Pe.__webglTexture===void 0&&(Pe.__webglTexture=i.createTexture(),r.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(g&&M.samples>0&&Xe(M)===!1){const We=Re?Y:[Y];te.__webglMultisampledFramebuffer=i.createFramebuffer(),te.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,te.__webglMultisampledFramebuffer);for(let he=0;he<We.length;he++){const ze=We[he];te.__webglColorRenderbuffer[he]=i.createRenderbuffer(),i.bindRenderbuffer(36161,te.__webglColorRenderbuffer[he]);const Pe=o.convert(ze.format,ze.encoding),Te=o.convert(ze.type),Fe=Z(ze.internalFormat,Pe,Te,ze.encoding,M.isXRRenderTarget===!0),Ke=de(M);i.renderbufferStorageMultisample(36161,Ke,Fe,M.width,M.height),i.framebufferRenderbuffer(36160,36064+he,36161,te.__webglColorRenderbuffer[he])}i.bindRenderbuffer(36161,null),M.depthBuffer&&(te.__webglDepthRenderbuffer=i.createRenderbuffer(),Ye(te.__webglDepthRenderbuffer,M,!0)),t.bindFramebuffer(36160,null)}}if(we){t.bindTexture(34067,ce.__webglTexture),j(34067,Y,Ve);for(let We=0;We<6;We++)ve(te.__webglFramebuffer[We],M,Y,36064,34069+We);W(Y,Ve)&&R(34067),t.unbindTexture()}else if(Re){const We=M.texture;for(let he=0,ze=We.length;he<ze;he++){const Pe=We[he],Te=n.get(Pe);t.bindTexture(3553,Te.__webglTexture),j(3553,Pe,Ve),ve(te.__webglFramebuffer,M,Pe,36064+he,3553),W(Pe,Ve)&&R(3553)}t.unbindTexture()}else{let We=3553;(M.isWebGL3DRenderTarget||M.isWebGLArrayRenderTarget)&&(g?We=M.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(We,ce.__webglTexture),j(We,Y,Ve),ve(te.__webglFramebuffer,M,Y,36064,We),W(Y,Ve)&&R(We),t.unbindTexture()}M.depthBuffer&&ue(M)}function fe(M){const Y=B(M)||g,te=M.isWebGLMultipleRenderTargets===!0?M.texture:[M.texture];for(let ce=0,we=te.length;ce<we;ce++){const Re=te[ce];if(W(Re,Y)){const Ve=M.isWebGLCubeRenderTarget?34067:3553,We=n.get(Re).__webglTexture;t.bindTexture(Ve,We),R(Ve),t.unbindTexture()}}}function Qe(M){if(g&&M.samples>0&&Xe(M)===!1){const Y=M.isWebGLMultipleRenderTargets?M.texture:[M.texture],te=M.width,ce=M.height;let we=16384;const Re=[],Ve=M.stencilBuffer?33306:36096,We=n.get(M),he=M.isWebGLMultipleRenderTargets===!0;if(he)for(let ze=0;ze<Y.length;ze++)t.bindFramebuffer(36160,We.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+ze,36161,null),t.bindFramebuffer(36160,We.__webglFramebuffer),i.framebufferTexture2D(36009,36064+ze,3553,null,0);t.bindFramebuffer(36008,We.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,We.__webglFramebuffer);for(let ze=0;ze<Y.length;ze++){Re.push(36064+ze),M.depthBuffer&&Re.push(Ve);const Pe=We.__ignoreDepthValues!==void 0?We.__ignoreDepthValues:!1;if(Pe===!1&&(M.depthBuffer&&(we|=256),M.stencilBuffer&&(we|=1024)),he&&i.framebufferRenderbuffer(36008,36064,36161,We.__webglColorRenderbuffer[ze]),Pe===!0&&(i.invalidateFramebuffer(36008,[Ve]),i.invalidateFramebuffer(36009,[Ve])),he){const Te=n.get(Y[ze]).__webglTexture;i.framebufferTexture2D(36009,36064,3553,Te,0)}i.blitFramebuffer(0,0,te,ce,0,0,te,ce,we,9728),A&&i.invalidateFramebuffer(36008,Re)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),he)for(let ze=0;ze<Y.length;ze++){t.bindFramebuffer(36160,We.__webglMultisampledFramebuffer),i.framebufferRenderbuffer(36160,36064+ze,36161,We.__webglColorRenderbuffer[ze]);const Pe=n.get(Y[ze]).__webglTexture;t.bindFramebuffer(36160,We.__webglFramebuffer),i.framebufferTexture2D(36009,36064+ze,3553,Pe,0)}t.bindFramebuffer(36009,We.__webglMultisampledFramebuffer)}}function de(M){return Math.min(C,M.samples)}function Xe(M){const Y=n.get(M);return g&&M.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Y.__useRenderToTexture!==!1}function Le(M){const Y=r.render.frame;h.get(M)!==Y&&(h.set(M,Y),M.update())}function me(M,Y){const te=M.encoding,ce=M.format,we=M.type;return M.isCompressedTexture===!0||M.isVideoTexture===!0||M.format===VA||te!==bg&&(te===Yt?g===!1?e.has("EXT_sRGB")===!0&&ce===fs?(M.format=VA,M.minFilter=en,M.generateMipmaps=!1):Y=xb.sRGBToLinear(Y):(ce!==fs||we!==fg)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",te)),Y}this.allocateTextureUnit=k,this.resetTextureUnits=ne,this.setTexture2D=z,this.setTexture2DArray=X,this.setTexture3D=T,this.setTextureCube=Q,this.rebindTextures=Ge,this.setupRenderTarget=xe,this.updateRenderTargetMipmap=fe,this.updateMultisampleRenderTarget=Qe,this.setupDepthRenderbuffer=ue,this.setupFrameBufferTexture=ve,this.useMultisampledRTT=Xe}function vS(i,e,t){const n=t.isWebGL2;function s(o,r=null){let g;if(o===fg)return 5121;if(o===PW)return 32819;if(o===QW)return 32820;if(o===JW)return 5120;if(o===UW)return 5122;if(o===Zb)return 5123;if(o===DW)return 5124;if(o===eg)return 5125;if(o===Qo)return 5126;if(o===Jl)return n?5131:(g=e.get("OES_texture_half_float"),g!==null?g.HALF_FLOAT_OES:null);if(o===OW)return 6406;if(o===fs)return 6408;if(o===qW)return 6409;if(o===$W)return 6410;if(o===ug)return 6402;if(o===Ba)return 34041;if(o===eS)return 6403;if(o===jW)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(o===VA)return g=e.get("EXT_sRGB"),g!==null?g.SRGB_ALPHA_EXT:null;if(o===tS)return 36244;if(o===nS)return 33319;if(o===iS)return 33320;if(o===sS)return 36249;if(o===Ud||o===Dd||o===Pd||o===Qd)if(r===Yt)if(g=e.get("WEBGL_compressed_texture_s3tc_srgb"),g!==null){if(o===Ud)return g.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(o===Dd)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(o===Pd)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(o===Qd)return g.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(g=e.get("WEBGL_compressed_texture_s3tc"),g!==null){if(o===Ud)return g.COMPRESSED_RGB_S3TC_DXT1_EXT;if(o===Dd)return g.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(o===Pd)return g.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(o===Qd)return g.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(o===Hf||o===Ff||o===Kf||o===Nf)if(g=e.get("WEBGL_compressed_texture_pvrtc"),g!==null){if(o===Hf)return g.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(o===Ff)return g.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(o===Kf)return g.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(o===Nf)return g.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(o===oS)return g=e.get("WEBGL_compressed_texture_etc1"),g!==null?g.COMPRESSED_RGB_ETC1_WEBGL:null;if(o===Mf||o===Lf)if(g=e.get("WEBGL_compressed_texture_etc"),g!==null){if(o===Mf)return r===Yt?g.COMPRESSED_SRGB8_ETC2:g.COMPRESSED_RGB8_ETC2;if(o===Lf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:g.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(o===zf||o===kf||o===Tf||o===Ef||o===_f||o===Jf||o===Uf||o===Df||o===Pf||o===Qf||o===Of||o===jf||o===qf||o===$f)if(g=e.get("WEBGL_compressed_texture_astc"),g!==null){if(o===zf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:g.COMPRESSED_RGBA_ASTC_4x4_KHR;if(o===kf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:g.COMPRESSED_RGBA_ASTC_5x4_KHR;if(o===Tf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:g.COMPRESSED_RGBA_ASTC_5x5_KHR;if(o===Ef)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:g.COMPRESSED_RGBA_ASTC_6x5_KHR;if(o===_f)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:g.COMPRESSED_RGBA_ASTC_6x6_KHR;if(o===Jf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:g.COMPRESSED_RGBA_ASTC_8x5_KHR;if(o===Uf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:g.COMPRESSED_RGBA_ASTC_8x6_KHR;if(o===Df)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:g.COMPRESSED_RGBA_ASTC_8x8_KHR;if(o===Pf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:g.COMPRESSED_RGBA_ASTC_10x5_KHR;if(o===Qf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:g.COMPRESSED_RGBA_ASTC_10x6_KHR;if(o===Of)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:g.COMPRESSED_RGBA_ASTC_10x8_KHR;if(o===jf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:g.COMPRESSED_RGBA_ASTC_10x10_KHR;if(o===qf)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:g.COMPRESSED_RGBA_ASTC_12x10_KHR;if(o===$f)return r===Yt?g.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:g.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(o===e0)if(g=e.get("EXT_texture_compression_bptc"),g!==null){if(o===e0)return r===Yt?g.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:g.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;return o===ua?n?34042:(g=e.get("WEBGL_depth_texture"),g!==null?g.UNSIGNED_INT_24_8_WEBGL:null):i[o]!==void 0?i[o]:null}return{convert:s}}class ZS extends zn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class jo extends St{constructor(){super(),this.isGroup=!0,this.type="Group"}}const PK={type:"move"};class lm{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new jo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new jo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new jo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,o=null,r=null;const g=this._targetRay,a=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){r=!0;for(const m of e.hand.values()){const b=t.getJointPose(m,n);if(l.joints[m.jointName]===void 0){const f=new jo;f.matrixAutoUpdate=!1,f.visible=!1,l.joints[m.jointName]=f,l.add(f)}const G=l.joints[m.jointName];b!==null&&(G.matrix.fromArray(b.transform.matrix),G.matrix.decompose(G.position,G.rotation,G.scale),G.jointRadius=b.radius),G.visible=b!==null}const I=l.joints["index-finger-tip"],C=l.joints["thumb-tip"],u=I.position.distanceTo(C.position),A=.02,h=.005;l.inputState.pinching&&u>A+h?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&u<=A-h&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else a!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(a.matrix.fromArray(o.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),o.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(o.linearVelocity)):a.hasLinearVelocity=!1,o.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(o.angularVelocity)):a.hasAngularVelocity=!1));g!==null&&(s=t.getPose(e.targetRaySpace,n),s===null&&o!==null&&(s=o),s!==null&&(g.matrix.fromArray(s.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),s.linearVelocity?(g.hasLinearVelocity=!0,g.linearVelocity.copy(s.linearVelocity)):g.hasLinearVelocity=!1,s.angularVelocity?(g.hasAngularVelocity=!0,g.angularVelocity.copy(s.angularVelocity)):g.hasAngularVelocity=!1,this.dispatchEvent(PK)))}return g!==null&&(g.visible=s!==null),a!==null&&(a.visible=o!==null),l!==null&&(l.visible=r!==null),this}}class wS extends Cn{constructor(e,t,n,s,o,r,g,a,l,I){if(I=I!==void 0?I:ug,I!==ug&&I!==Ba)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&I===ug&&(n=eg),n===void 0&&I===Ba&&(n=ua),super(null,s,o,r,g,a,I,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=g!==void 0?g:Sn,this.minFilter=a!==void 0?a:Sn,this.flipY=!1,this.generateMipmaps=!1}}class QK extends yo{constructor(e,t){super();const n=this;let s=null,o=1,r=null,g="local-floor",a=null,l=null,I=null,C=null,u=null,A=null;const h=t.getContextAttributes();let m=null,b=null;const G=[],f=[],y=new zn;y.layers.enable(1),y.viewport=new Ht;const B=new zn;B.layers.enable(2),B.viewport=new Ht;const v=[y,B],W=new ZS;W.layers.enable(1),W.layers.enable(2);let R=null,Z=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(F){let z=G[F];return z===void 0&&(z=new lm,G[F]=z),z.getTargetRaySpace()},this.getControllerGrip=function(F){let z=G[F];return z===void 0&&(z=new lm,G[F]=z),z.getGripSpace()},this.getHand=function(F){let z=G[F];return z===void 0&&(z=new lm,G[F]=z),z.getHandSpace()};function V(F){const z=f.indexOf(F.inputSource);if(z===-1)return;const X=G[z];X!==void 0&&X.dispatchEvent({type:F.type,data:F.inputSource})}function H(){s.removeEventListener("select",V),s.removeEventListener("selectstart",V),s.removeEventListener("selectend",V),s.removeEventListener("squeeze",V),s.removeEventListener("squeezestart",V),s.removeEventListener("squeezeend",V),s.removeEventListener("end",H),s.removeEventListener("inputsourceschange",P);for(let F=0;F<G.length;F++){const z=f[F];z!==null&&(f[F]=null,G[F].disconnect(z))}R=null,Z=null,e.setRenderTarget(m),u=null,C=null,I=null,s=null,b=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(F){o=F,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(F){g=F,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a||r},this.setReferenceSpace=function(F){a=F},this.getBaseLayer=function(){return C!==null?C:u},this.getBinding=function(){return I},this.getFrame=function(){return A},this.getSession=function(){return s},this.setSession=async function(F){if(s=F,s!==null){if(m=e.getRenderTarget(),s.addEventListener("select",V),s.addEventListener("selectstart",V),s.addEventListener("selectend",V),s.addEventListener("squeeze",V),s.addEventListener("squeezestart",V),s.addEventListener("squeezeend",V),s.addEventListener("end",H),s.addEventListener("inputsourceschange",P),h.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const z={antialias:s.renderState.layers===void 0?h.antialias:!0,alpha:h.alpha,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:o};u=new XRWebGLLayer(s,t,z),s.updateRenderState({baseLayer:u}),b=new Bs(u.framebufferWidth,u.framebufferHeight,{format:fs,type:fg,encoding:e.outputEncoding,stencilBuffer:h.stencil})}else{let z=null,X=null,T=null;h.depth&&(T=h.stencil?35056:33190,z=h.stencil?Ba:ug,X=h.stencil?ua:eg);const Q={colorFormat:32856,depthFormat:T,scaleFactor:o};I=new XRWebGLBinding(s,t),C=I.createProjectionLayer(Q),s.updateRenderState({layers:[C]}),b=new Bs(C.textureWidth,C.textureHeight,{format:fs,type:fg,depthTexture:new wS(C.textureWidth,C.textureHeight,X,void 0,void 0,void 0,void 0,void 0,void 0,z),stencilBuffer:h.stencil,encoding:e.outputEncoding,samples:h.antialias?4:0});const ee=e.properties.get(b);ee.__ignoreDepthValues=C.ignoreDepthValues}b.isXRRenderTarget=!0,this.setFoveation(1),a=null,r=await s.requestReferenceSpace(g),k.setContext(s),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function P(F){for(let z=0;z<F.removed.length;z++){const X=F.removed[z],T=f.indexOf(X);T>=0&&(f[T]=null,G[T].dispatchEvent({type:"disconnected",data:X}))}for(let z=0;z<F.added.length;z++){const X=F.added[z];let T=f.indexOf(X);if(T===-1){for(let ee=0;ee<G.length;ee++)if(ee>=f.length){f.push(X),T=ee;break}else if(f[ee]===null){f[ee]=X,T=ee;break}if(T===-1)break}const Q=G[T];Q&&Q.dispatchEvent({type:"connected",data:X})}}const E=new N,L=new N;function K(F,z,X){E.setFromMatrixPosition(z.matrixWorld),L.setFromMatrixPosition(X.matrixWorld);const T=E.distanceTo(L),Q=z.projectionMatrix.elements,ee=X.projectionMatrix.elements,oe=Q[14]/(Q[10]-1),j=Q[14]/(Q[10]+1),ge=(Q[9]+1)/Q[5],Ie=(Q[9]-1)/Q[5],Be=(Q[8]-1)/Q[0],ve=(ee[8]+1)/ee[0],Ye=oe*Be,se=oe*ve,ue=T/(-Be+ve),Ge=ue*-Be;z.matrixWorld.decompose(F.position,F.quaternion,F.scale),F.translateX(Ge),F.translateZ(ue),F.matrixWorld.compose(F.position,F.quaternion,F.scale),F.matrixWorldInverse.copy(F.matrixWorld).invert();const xe=oe+ue,fe=j+ue,Qe=Ye-Ge,de=se+(T-Ge),Xe=ge*j/fe*xe,Le=Ie*j/fe*xe;F.projectionMatrix.makePerspective(Qe,de,Xe,Le,xe,fe)}function O(F,z){z===null?F.matrixWorld.copy(F.matrix):F.matrixWorld.multiplyMatrices(z.matrixWorld,F.matrix),F.matrixWorldInverse.copy(F.matrixWorld).invert()}this.updateCamera=function(F){if(s===null)return;W.near=B.near=y.near=F.near,W.far=B.far=y.far=F.far,(R!==W.near||Z!==W.far)&&(s.updateRenderState({depthNear:W.near,depthFar:W.far}),R=W.near,Z=W.far);const z=F.parent,X=W.cameras;O(W,z);for(let Q=0;Q<X.length;Q++)O(X[Q],z);W.matrixWorld.decompose(W.position,W.quaternion,W.scale),F.matrix.copy(W.matrix),F.matrix.decompose(F.position,F.quaternion,F.scale);const T=F.children;for(let Q=0,ee=T.length;Q<ee;Q++)T[Q].updateMatrixWorld(!0);X.length===2?K(W,y,B):W.projectionMatrix.copy(y.projectionMatrix)},this.getCamera=function(){return W},this.getFoveation=function(){if(C!==null)return C.fixedFoveation;if(u!==null)return u.fixedFoveation},this.setFoveation=function(F){C!==null&&(C.fixedFoveation=F),u!==null&&u.fixedFoveation!==void 0&&(u.fixedFoveation=F)};let q=null;function ne(F,z){if(l=z.getViewerPose(a||r),A=z,l!==null){const X=l.views;u!==null&&(e.setRenderTargetFramebuffer(b,u.framebuffer),e.setRenderTarget(b));let T=!1;X.length!==W.cameras.length&&(W.cameras.length=0,T=!0);for(let Q=0;Q<X.length;Q++){const ee=X[Q];let oe=null;if(u!==null)oe=u.getViewport(ee);else{const ge=I.getViewSubImage(C,ee);oe=ge.viewport,Q===0&&(e.setRenderTargetTextures(b,ge.colorTexture,C.ignoreDepthValues?void 0:ge.depthStencilTexture),e.setRenderTarget(b))}let j=v[Q];j===void 0&&(j=new zn,j.layers.enable(Q),j.viewport=new Ht,v[Q]=j),j.matrix.fromArray(ee.transform.matrix),j.projectionMatrix.fromArray(ee.projectionMatrix),j.viewport.set(oe.x,oe.y,oe.width,oe.height),Q===0&&W.matrix.copy(j.matrix),T===!0&&W.cameras.push(j)}}for(let X=0;X<G.length;X++){const T=f[X],Q=G[X];T!==null&&Q!==void 0&&Q.update(T,z,a||r)}q&&q(F,z),A=null}const k=new fS;k.setAnimationLoop(ne),this.setAnimationLoop=function(F){q=F},this.dispose=function(){}}}function OK(i,e){function t(m,b){m.fogColor.value.copy(b.color),b.isFog?(m.fogNear.value=b.near,m.fogFar.value=b.far):b.isFogExp2&&(m.fogDensity.value=b.density)}function n(m,b,G,f,y){b.isMeshBasicMaterial||b.isMeshLambertMaterial?s(m,b):b.isMeshToonMaterial?(s(m,b),I(m,b)):b.isMeshPhongMaterial?(s(m,b),l(m,b)):b.isMeshStandardMaterial?(s(m,b),C(m,b),b.isMeshPhysicalMaterial&&u(m,b,y)):b.isMeshMatcapMaterial?(s(m,b),A(m,b)):b.isMeshDepthMaterial?s(m,b):b.isMeshDistanceMaterial?(s(m,b),h(m,b)):b.isMeshNormalMaterial?s(m,b):b.isLineBasicMaterial?(o(m,b),b.isLineDashedMaterial&&r(m,b)):b.isPointsMaterial?g(m,b,G,f):b.isSpriteMaterial?a(m,b):b.isShadowMaterial?(m.color.value.copy(b.color),m.opacity.value=b.opacity):b.isShaderMaterial&&(b.uniformsNeedUpdate=!1)}function s(m,b){m.opacity.value=b.opacity,b.color&&m.diffuse.value.copy(b.color),b.emissive&&m.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),b.map&&(m.map.value=b.map),b.alphaMap&&(m.alphaMap.value=b.alphaMap),b.bumpMap&&(m.bumpMap.value=b.bumpMap,m.bumpScale.value=b.bumpScale,b.side===Vi&&(m.bumpScale.value*=-1)),b.displacementMap&&(m.displacementMap.value=b.displacementMap,m.displacementScale.value=b.displacementScale,m.displacementBias.value=b.displacementBias),b.emissiveMap&&(m.emissiveMap.value=b.emissiveMap),b.normalMap&&(m.normalMap.value=b.normalMap,m.normalScale.value.copy(b.normalScale),b.side===Vi&&m.normalScale.value.negate()),b.specularMap&&(m.specularMap.value=b.specularMap),b.alphaTest>0&&(m.alphaTest.value=b.alphaTest);const G=e.get(b).envMap;if(G&&(m.envMap.value=G,m.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=b.reflectivity,m.ior.value=b.ior,m.refractionRatio.value=b.refractionRatio),b.lightMap){m.lightMap.value=b.lightMap;const B=i.physicallyCorrectLights!==!0?Math.PI:1;m.lightMapIntensity.value=b.lightMapIntensity*B}b.aoMap&&(m.aoMap.value=b.aoMap,m.aoMapIntensity.value=b.aoMapIntensity);let f;b.map?f=b.map:b.specularMap?f=b.specularMap:b.displacementMap?f=b.displacementMap:b.normalMap?f=b.normalMap:b.bumpMap?f=b.bumpMap:b.roughnessMap?f=b.roughnessMap:b.metalnessMap?f=b.metalnessMap:b.alphaMap?f=b.alphaMap:b.emissiveMap?f=b.emissiveMap:b.clearcoatMap?f=b.clearcoatMap:b.clearcoatNormalMap?f=b.clearcoatNormalMap:b.clearcoatRoughnessMap?f=b.clearcoatRoughnessMap:b.iridescenceMap?f=b.iridescenceMap:b.iridescenceThicknessMap?f=b.iridescenceThicknessMap:b.specularIntensityMap?f=b.specularIntensityMap:b.specularColorMap?f=b.specularColorMap:b.transmissionMap?f=b.transmissionMap:b.thicknessMap?f=b.thicknessMap:b.sheenColorMap?f=b.sheenColorMap:b.sheenRoughnessMap&&(f=b.sheenRoughnessMap),f!==void 0&&(f.isWebGLRenderTarget&&(f=f.texture),f.matrixAutoUpdate===!0&&f.updateMatrix(),m.uvTransform.value.copy(f.matrix));let y;b.aoMap?y=b.aoMap:b.lightMap&&(y=b.lightMap),y!==void 0&&(y.isWebGLRenderTarget&&(y=y.texture),y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uv2Transform.value.copy(y.matrix))}function o(m,b){m.diffuse.value.copy(b.color),m.opacity.value=b.opacity}function r(m,b){m.dashSize.value=b.dashSize,m.totalSize.value=b.dashSize+b.gapSize,m.scale.value=b.scale}function g(m,b,G,f){m.diffuse.value.copy(b.color),m.opacity.value=b.opacity,m.size.value=b.size*G,m.scale.value=f*.5,b.map&&(m.map.value=b.map),b.alphaMap&&(m.alphaMap.value=b.alphaMap),b.alphaTest>0&&(m.alphaTest.value=b.alphaTest);let y;b.map?y=b.map:b.alphaMap&&(y=b.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix))}function a(m,b){m.diffuse.value.copy(b.color),m.opacity.value=b.opacity,m.rotation.value=b.rotation,b.map&&(m.map.value=b.map),b.alphaMap&&(m.alphaMap.value=b.alphaMap),b.alphaTest>0&&(m.alphaTest.value=b.alphaTest);let G;b.map?G=b.map:b.alphaMap&&(G=b.alphaMap),G!==void 0&&(G.matrixAutoUpdate===!0&&G.updateMatrix(),m.uvTransform.value.copy(G.matrix))}function l(m,b){m.specular.value.copy(b.specular),m.shininess.value=Math.max(b.shininess,1e-4)}function I(m,b){b.gradientMap&&(m.gradientMap.value=b.gradientMap)}function C(m,b){m.roughness.value=b.roughness,m.metalness.value=b.metalness,b.roughnessMap&&(m.roughnessMap.value=b.roughnessMap),b.metalnessMap&&(m.metalnessMap.value=b.metalnessMap),e.get(b).envMap&&(m.envMapIntensity.value=b.envMapIntensity)}function u(m,b,G){m.ior.value=b.ior,b.sheen>0&&(m.sheenColor.value.copy(b.sheenColor).multiplyScalar(b.sheen),m.sheenRoughness.value=b.sheenRoughness,b.sheenColorMap&&(m.sheenColorMap.value=b.sheenColorMap),b.sheenRoughnessMap&&(m.sheenRoughnessMap.value=b.sheenRoughnessMap)),b.clearcoat>0&&(m.clearcoat.value=b.clearcoat,m.clearcoatRoughness.value=b.clearcoatRoughness,b.clearcoatMap&&(m.clearcoatMap.value=b.clearcoatMap),b.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=b.clearcoatRoughnessMap),b.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(b.clearcoatNormalScale),m.clearcoatNormalMap.value=b.clearcoatNormalMap,b.side===Vi&&m.clearcoatNormalScale.value.negate())),b.iridescence>0&&(m.iridescence.value=b.iridescence,m.iridescenceIOR.value=b.iridescenceIOR,m.iridescenceThicknessMinimum.value=b.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=b.iridescenceThicknessRange[1],b.iridescenceMap&&(m.iridescenceMap.value=b.iridescenceMap),b.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=b.iridescenceThicknessMap)),b.transmission>0&&(m.transmission.value=b.transmission,m.transmissionSamplerMap.value=G.texture,m.transmissionSamplerSize.value.set(G.width,G.height),b.transmissionMap&&(m.transmissionMap.value=b.transmissionMap),m.thickness.value=b.thickness,b.thicknessMap&&(m.thicknessMap.value=b.thicknessMap),m.attenuationDistance.value=b.attenuationDistance,m.attenuationColor.value.copy(b.attenuationColor)),m.specularIntensity.value=b.specularIntensity,m.specularColor.value.copy(b.specularColor),b.specularIntensityMap&&(m.specularIntensityMap.value=b.specularIntensityMap),b.specularColorMap&&(m.specularColorMap.value=b.specularColorMap)}function A(m,b){b.matcap&&(m.matcap.value=b.matcap)}function h(m,b){m.referencePosition.value.copy(b.referencePosition),m.nearDistance.value=b.nearDistance,m.farDistance.value=b.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function jK(i,e,t,n){let s={},o={},r=[];const g=t.isWebGL2?i.getParameter(35375):0;function a(f,y){const B=y.program;n.uniformBlockBinding(f,B)}function l(f,y){let B=s[f.id];B===void 0&&(h(f),B=I(f),s[f.id]=B,f.addEventListener("dispose",b));const v=y.program;n.updateUBOMapping(f,v);const W=e.render.frame;o[f.id]!==W&&(u(f),o[f.id]=W)}function I(f){const y=C();f.__bindingPointIndex=y;const B=i.createBuffer(),v=f.__size,W=f.usage;return i.bindBuffer(35345,B),i.bufferData(35345,v,W),i.bindBuffer(35345,null),i.bindBufferBase(35345,y,B),B}function C(){for(let f=0;f<g;f++)if(r.indexOf(f)===-1)return r.push(f),f;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function u(f){const y=s[f.id],B=f.uniforms,v=f.__cache;i.bindBuffer(35345,y);for(let W=0,R=B.length;W<R;W++){const Z=B[W];if(A(Z,W,v)===!0){const V=Z.value,H=Z.__offset;typeof V=="number"?(Z.__data[0]=V,i.bufferSubData(35345,H,Z.__data)):(Z.value.isMatrix3?(Z.__data[0]=Z.value.elements[0],Z.__data[1]=Z.value.elements[1],Z.__data[2]=Z.value.elements[2],Z.__data[3]=Z.value.elements[0],Z.__data[4]=Z.value.elements[3],Z.__data[5]=Z.value.elements[4],Z.__data[6]=Z.value.elements[5],Z.__data[7]=Z.value.elements[0],Z.__data[8]=Z.value.elements[6],Z.__data[9]=Z.value.elements[7],Z.__data[10]=Z.value.elements[8],Z.__data[11]=Z.value.elements[0]):V.toArray(Z.__data),i.bufferSubData(35345,H,Z.__data))}}i.bindBuffer(35345,null)}function A(f,y,B){const v=f.value;if(B[y]===void 0)return typeof v=="number"?B[y]=v:B[y]=v.clone(),!0;if(typeof v=="number"){if(B[y]!==v)return B[y]=v,!0}else{const W=B[y];if(W.equals(v)===!1)return W.copy(v),!0}return!1}function h(f){const y=f.uniforms;let B=0;const v=16;let W=0;for(let R=0,Z=y.length;R<Z;R++){const V=y[R],H=m(V);if(V.__data=new Float32Array(H.storage/Float32Array.BYTES_PER_ELEMENT),V.__offset=B,R>0){W=B%v;const P=v-W;W!==0&&P-H.boundary<0&&(B+=v-W,V.__offset=B)}B+=H.storage}return W=B%v,W>0&&(B+=v-W),f.__size=B,f.__cache={},this}function m(f){const y=f.value,B={boundary:0,storage:0};return typeof y=="number"?(B.boundary=4,B.storage=4):y.isVector2?(B.boundary=8,B.storage=8):y.isVector3||y.isColor?(B.boundary=16,B.storage=12):y.isVector4?(B.boundary=16,B.storage=16):y.isMatrix3?(B.boundary=48,B.storage=48):y.isMatrix4?(B.boundary=64,B.storage=64):y.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",y),B}function b(f){const y=f.target;y.removeEventListener("dispose",b);const B=r.indexOf(y.__bindingPointIndex);r.splice(B,1),i.deleteBuffer(s[y.id]),delete s[y.id],delete o[y.id]}function G(){for(const f in s)i.deleteBuffer(s[f]);r=[],s={},o={}}return{bind:a,update:l,dispose:G}}function qK(){const i=iC("canvas");return i.style.display="block",i}function Fb(i={}){this.isWebGLRenderer=!0;const e=i.canvas!==void 0?i.canvas:qK(),t=i.context!==void 0?i.context:null,n=i.depth!==void 0?i.depth:!0,s=i.stencil!==void 0?i.stencil:!0,o=i.antialias!==void 0?i.antialias:!1,r=i.premultipliedAlpha!==void 0?i.premultipliedAlpha:!0,g=i.preserveDrawingBuffer!==void 0?i.preserveDrawingBuffer:!1,a=i.powerPreference!==void 0?i.powerPreference:"default",l=i.failIfMajorPerformanceCaveat!==void 0?i.failIfMajorPerformanceCaveat:!1;let I;t!==null?I=t.getContextAttributes().alpha:I=i.alpha!==void 0?i.alpha:!1;let C=null,u=null;const A=[],h=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=bg,this.physicallyCorrectLights=!1,this.toneMapping=po,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const m=this;let b=!1,G=0,f=0,y=null,B=-1,v=null;const W=new Ht,R=new Ht;let Z=null,V=e.width,H=e.height,P=1,E=null,L=null;const K=new Ht(0,0,V,H),O=new Ht(0,0,V,H);let q=!1;const ne=new th;let k=!1,F=!1,z=null;const X=new dt,T=new Se,Q=new N,ee={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function oe(){return y===null?P:1}let j=t;function ge(_,le){for(let pe=0;pe<_.length;pe++){const ae=_[pe],Ze=e.getContext(ae,le);if(Ze!==null)return Ze}return null}try{const _={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:r,preserveDrawingBuffer:g,powerPreference:a,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${QA}`),e.addEventListener("webglcontextlost",Fe,!1),e.addEventListener("webglcontextrestored",Ke,!1),e.addEventListener("webglcontextcreationerror",$e,!1),j===null){const le=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&le.shift(),j=ge(le,_),j===null)throw ge(le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}j.getShaderPrecisionFormat===void 0&&(j.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(_){throw console.error("THREE.WebGLRenderer: "+_.message),_}let Ie,Be,ve,Ye,se,ue,Ge,xe,fe,Qe,de,Xe,Le,me,M,Y,te,ce,we,Re,Ve,We,he,ze;function Pe(){Ie=new dF(j),Be=new aF(j,Ie,i),Ie.init(Be),We=new vS(j,Ie,Be),ve=new UK(j,Ie,Be),Ye=new pF,se=new HK,ue=new DK(j,Ie,ve,se,Be,We,Ye),Ge=new IF(m),xe=new uF(m),fe=new S9(j,Be),he=new rF(j,Ie,fe,Be),Qe=new AF(j,fe,Ye,he),de=new GF(j,Qe,fe,Ye),we=new bF(j,Be,ue),Y=new lF(se),Xe=new YK(m,Ge,xe,Ie,Be,he,Y),Le=new OK(m,se),me=new KK,M=new TK(Ie,Be),ce=new oF(m,Ge,ve,de,I,r),te=new JK(m,de,Be),ze=new jK(j,Ye,Be,ve),Re=new gF(j,Ie,Ye,Be),Ve=new hF(j,Ie,Ye,Be),Ye.programs=Xe.programs,m.capabilities=Be,m.extensions=Ie,m.properties=se,m.renderLists=me,m.shadowMap=te,m.state=ve,m.info=Ye}Pe();const Te=new QK(m,j);this.xr=Te,this.getContext=function(){return j},this.getContextAttributes=function(){return j.getContextAttributes()},this.forceContextLoss=function(){const _=Ie.get("WEBGL_lose_context");_&&_.loseContext()},this.forceContextRestore=function(){const _=Ie.get("WEBGL_lose_context");_&&_.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(_){_!==void 0&&(P=_,this.setSize(V,H,!1))},this.getSize=function(_){return _.set(V,H)},this.setSize=function(_,le,pe){if(Te.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=_,H=le,e.width=Math.floor(_*P),e.height=Math.floor(le*P),pe!==!1&&(e.style.width=_+"px",e.style.height=le+"px"),this.setViewport(0,0,_,le)},this.getDrawingBufferSize=function(_){return _.set(V*P,H*P).floor()},this.setDrawingBufferSize=function(_,le,pe){V=_,H=le,P=pe,e.width=Math.floor(_*pe),e.height=Math.floor(le*pe),this.setViewport(0,0,_,le)},this.getCurrentViewport=function(_){return _.copy(W)},this.getViewport=function(_){return _.copy(K)},this.setViewport=function(_,le,pe,ae){_.isVector4?K.set(_.x,_.y,_.z,_.w):K.set(_,le,pe,ae),ve.viewport(W.copy(K).multiplyScalar(P).floor())},this.getScissor=function(_){return _.copy(O)},this.setScissor=function(_,le,pe,ae){_.isVector4?O.set(_.x,_.y,_.z,_.w):O.set(_,le,pe,ae),ve.scissor(R.copy(O).multiplyScalar(P).floor())},this.getScissorTest=function(){return q},this.setScissorTest=function(_){ve.setScissorTest(q=_)},this.setOpaqueSort=function(_){E=_},this.setTransparentSort=function(_){L=_},this.getClearColor=function(_){return _.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(_=!0,le=!0,pe=!0){let ae=0;_&&(ae|=16384),le&&(ae|=256),pe&&(ae|=1024),j.clear(ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Fe,!1),e.removeEventListener("webglcontextrestored",Ke,!1),e.removeEventListener("webglcontextcreationerror",$e,!1),me.dispose(),M.dispose(),se.dispose(),Ge.dispose(),xe.dispose(),de.dispose(),he.dispose(),ze.dispose(),Xe.dispose(),Te.dispose(),Te.removeEventListener("sessionstart",gt),Te.removeEventListener("sessionend",At),z&&(z.dispose(),z=null),Tt.stop()};function Fe(_){_.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function Ke(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const _=Ye.autoReset,le=te.enabled,pe=te.autoUpdate,ae=te.needsUpdate,Ze=te.type;Pe(),Ye.autoReset=_,te.enabled=le,te.autoUpdate=pe,te.needsUpdate=ae,te.type=Ze}function $e(_){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",_.statusMessage)}function $(_){const le=_.target;le.removeEventListener("dispose",$),De(le)}function De(_){He(_),se.remove(_)}function He(_){const le=se.get(_).programs;le!==void 0&&(le.forEach(function(pe){Xe.releaseProgram(pe)}),_.isShaderMaterial&&Xe.releaseShaderCache(_))}this.renderBufferDirect=function(_,le,pe,ae,Ze,ot){le===null&&(le=ee);const ct=Ze.isMesh&&Ze.matrixWorld.determinant()<0,pt=un(_,le,pe,ae,Ze);ve.setMaterial(ae,ct);let Ct=pe.index;const vt=pe.attributes.position;if(Ct===null){if(vt===void 0||vt.count===0)return}else if(Ct.count===0)return;let mt=1;ae.wireframe===!0&&(Ct=Qe.getWireframeAttribute(pe),mt=2),he.setup(Ze,ae,pt,pe,Ct);let Gt,Nt=Re;Ct!==null&&(Gt=fe.get(Ct),Nt=Ve,Nt.setIndex(Gt));const ai=Ct!==null?Ct.count:vt.count,jn=pe.drawRange.start*mt,Kn=pe.drawRange.count*mt,Ne=ot!==null?ot.start*mt:0,nt=ot!==null?ot.count*mt:1/0,qn=Math.max(jn,Ne),ft=Math.min(ai,jn+Kn,Ne+nt)-1,Mt=Math.max(0,ft-qn+1);if(Mt!==0){if(Ze.isMesh)ae.wireframe===!0?(ve.setLineWidth(ae.wireframeLinewidth*oe()),Nt.setMode(1)):Nt.setMode(4);else if(Ze.isLine){let Vn=ae.linewidth;Vn===void 0&&(Vn=1),ve.setLineWidth(Vn*oe()),Ze.isLineSegments?Nt.setMode(1):Ze.isLineLoop?Nt.setMode(2):Nt.setMode(3)}else Ze.isPoints?Nt.setMode(0):Ze.isSprite&&Nt.setMode(4);if(Ze.isInstancedMesh)Nt.renderInstances(qn,Mt,Ze.count);else if(pe.isInstancedBufferGeometry){const Vn=Math.min(pe.instanceCount,pe._maxInstanceCount);Nt.renderInstances(qn,Mt,Vn)}else Nt.render(qn,Mt)}},this.compile=function(_,le){function pe(ae,Ze,ot){ae.transparent===!0&&ae.side===ms?(ae.side=Vi,ae.needsUpdate=!0,on(ae,Ze,ot),ae.side=rr,ae.needsUpdate=!0,on(ae,Ze,ot),ae.side=ms):on(ae,Ze,ot)}u=M.get(_),u.init(),h.push(u),_.traverseVisible(function(ae){ae.isLight&&ae.layers.test(le.layers)&&(u.pushLight(ae),ae.castShadow&&u.pushShadow(ae))}),u.setupLights(m.physicallyCorrectLights),_.traverse(function(ae){const Ze=ae.material;if(Ze)if(Array.isArray(Ze))for(let ot=0;ot<Ze.length;ot++){const ct=Ze[ot];pe(ct,_,ae)}else pe(Ze,_,ae)}),h.pop(),u=null};let Ae=null;function ke(_){Ae&&Ae(_)}function gt(){Tt.stop()}function At(){Tt.start()}const Tt=new fS;Tt.setAnimationLoop(ke),typeof self<"u"&&Tt.setContext(self),this.setAnimationLoop=function(_){Ae=_,Te.setAnimationLoop(_),_===null?Tt.stop():Tt.start()},Te.addEventListener("sessionstart",gt),Te.addEventListener("sessionend",At),this.render=function(_,le){if(le!==void 0&&le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(b===!0)return;_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),le.parent===null&&le.matrixWorldAutoUpdate===!0&&le.updateMatrixWorld(),Te.enabled===!0&&Te.isPresenting===!0&&(Te.cameraAutoUpdate===!0&&Te.updateCamera(le),le=Te.getCamera()),_.isScene===!0&&_.onBeforeRender(m,_,le,y),u=M.get(_,h.length),u.init(),h.push(u),X.multiplyMatrices(le.projectionMatrix,le.matrixWorldInverse),ne.setFromProjectionMatrix(X),F=this.localClippingEnabled,k=Y.init(this.clippingPlanes,F,le),C=me.get(_,A.length),C.init(),A.push(C),Bt(_,le,0,m.sortObjects),C.finish(),m.sortObjects===!0&&C.sort(E,L),k===!0&&Y.beginShadows();const pe=u.state.shadowsArray;if(te.render(pe,_,le),k===!0&&Y.endShadows(),this.info.autoReset===!0&&this.info.reset(),ce.render(C,_),u.setupLights(m.physicallyCorrectLights),le.isArrayCamera){const ae=le.cameras;for(let Ze=0,ot=ae.length;Ze<ot;Ze++){const ct=ae[Ze];rt(C,_,ct,ct.viewport)}}else rt(C,_,le);y!==null&&(ue.updateMultisampleRenderTarget(y),ue.updateRenderTargetMipmap(y)),_.isScene===!0&&_.onAfterRender(m,_,le),he.resetDefaultState(),B=-1,v=null,h.pop(),h.length>0?u=h[h.length-1]:u=null,A.pop(),A.length>0?C=A[A.length-1]:C=null};function Bt(_,le,pe,ae){if(_.visible===!1)return;if(_.layers.test(le.layers)){if(_.isGroup)pe=_.renderOrder;else if(_.isLOD)_.autoUpdate===!0&&_.update(le);else if(_.isLight)u.pushLight(_),_.castShadow&&u.pushShadow(_);else if(_.isSprite){if(!_.frustumCulled||ne.intersectsSprite(_)){ae&&Q.setFromMatrixPosition(_.matrixWorld).applyMatrix4(X);const ct=de.update(_),pt=_.material;pt.visible&&C.push(_,ct,pt,pe,Q.z,null)}}else if((_.isMesh||_.isLine||_.isPoints)&&(_.isSkinnedMesh&&_.skeleton.frame!==Ye.render.frame&&(_.skeleton.update(),_.skeleton.frame=Ye.render.frame),!_.frustumCulled||ne.intersectsObject(_))){ae&&Q.setFromMatrixPosition(_.matrixWorld).applyMatrix4(X);const ct=de.update(_),pt=_.material;if(Array.isArray(pt)){const Ct=ct.groups;for(let vt=0,mt=Ct.length;vt<mt;vt++){const Gt=Ct[vt],Nt=pt[Gt.materialIndex];Nt&&Nt.visible&&C.push(_,ct,Nt,pe,Q.z,Gt)}}else pt.visible&&C.push(_,ct,pt,pe,Q.z,null)}}const ot=_.children;for(let ct=0,pt=ot.length;ct<pt;ct++)Bt(ot[ct],le,pe,ae)}function rt(_,le,pe,ae){const Ze=_.opaque,ot=_.transmissive,ct=_.transparent;u.setupLightsView(pe),ot.length>0&&Kt(Ze,le,pe),ae&&ve.viewport(W.copy(ae)),Ze.length>0&&Et(Ze,le,pe),ot.length>0&&Et(ot,le,pe),ct.length>0&&Et(ct,le,pe),ve.buffers.depth.setTest(!0),ve.buffers.depth.setMask(!0),ve.buffers.color.setMask(!0),ve.setPolygonOffset(!1)}function Kt(_,le,pe){const ae=Be.isWebGL2;z===null&&(z=new Bs(1,1,{generateMipmaps:!0,type:Ie.has("EXT_color_buffer_half_float")?Jl:fg,minFilter:Cr,samples:ae&&o===!0?4:0})),m.getDrawingBufferSize(T),ae?z.setSize(T.x,T.y):z.setSize(xA(T.x),xA(T.y));const Ze=m.getRenderTarget();m.setRenderTarget(z),m.clear();const ot=m.toneMapping;m.toneMapping=po,Et(_,le,pe),m.toneMapping=ot,ue.updateMultisampleRenderTarget(z),ue.updateRenderTargetMipmap(z),m.setRenderTarget(Ze)}function Et(_,le,pe){const ae=le.isScene===!0?le.overrideMaterial:null;for(let Ze=0,ot=_.length;Ze<ot;Ze++){const ct=_[Ze],pt=ct.object,Ct=ct.geometry,vt=ae===null?ct.material:ae,mt=ct.group;pt.layers.test(pe.layers)&&_t(pt,le,pe,Ct,vt,mt)}}function _t(_,le,pe,ae,Ze,ot){_.onBeforeRender(m,le,pe,ae,Ze,ot),_.modelViewMatrix.multiplyMatrices(pe.matrixWorldInverse,_.matrixWorld),_.normalMatrix.getNormalMatrix(_.modelViewMatrix),Ze.onBeforeRender(m,le,pe,ae,_,ot),Ze.transparent===!0&&Ze.side===ms?(Ze.side=Vi,Ze.needsUpdate=!0,m.renderBufferDirect(pe,le,ae,Ze,_,ot),Ze.side=rr,Ze.needsUpdate=!0,m.renderBufferDirect(pe,le,ae,Ze,_,ot),Ze.side=ms):m.renderBufferDirect(pe,le,ae,Ze,_,ot),_.onAfterRender(m,le,pe,ae,Ze,ot)}function on(_,le,pe){le.isScene!==!0&&(le=ee);const ae=se.get(_),Ze=u.state.lights,ot=u.state.shadowsArray,ct=Ze.state.version,pt=Xe.getParameters(_,Ze.state,ot,le,pe),Ct=Xe.getProgramCacheKey(pt);let vt=ae.programs;ae.environment=_.isMeshStandardMaterial?le.environment:null,ae.fog=le.fog,ae.envMap=(_.isMeshStandardMaterial?xe:Ge).get(_.envMap||ae.environment),vt===void 0&&(_.addEventListener("dispose",$),vt=new Map,ae.programs=vt);let mt=vt.get(Ct);if(mt!==void 0){if(ae.currentProgram===mt&&ae.lightsStateVersion===ct)return gi(_,pt),mt}else pt.uniforms=Xe.getUniforms(_),_.onBuild(pe,pt,m),_.onBeforeCompile(pt,m),mt=Xe.acquireProgram(pt,Ct),vt.set(Ct,mt),ae.uniforms=pt.uniforms;const Gt=ae.uniforms;(!_.isShaderMaterial&&!_.isRawShaderMaterial||_.clipping===!0)&&(Gt.clippingPlanes=Y.uniform),gi(_,pt),ae.needsLights=On(_),ae.lightsStateVersion=ct,ae.needsLights&&(Gt.ambientLightColor.value=Ze.state.ambient,Gt.lightProbe.value=Ze.state.probe,Gt.directionalLights.value=Ze.state.directional,Gt.directionalLightShadows.value=Ze.state.directionalShadow,Gt.spotLights.value=Ze.state.spot,Gt.spotLightShadows.value=Ze.state.spotShadow,Gt.rectAreaLights.value=Ze.state.rectArea,Gt.ltc_1.value=Ze.state.rectAreaLTC1,Gt.ltc_2.value=Ze.state.rectAreaLTC2,Gt.pointLights.value=Ze.state.point,Gt.pointLightShadows.value=Ze.state.pointShadow,Gt.hemisphereLights.value=Ze.state.hemi,Gt.directionalShadowMap.value=Ze.state.directionalShadowMap,Gt.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Gt.spotShadowMap.value=Ze.state.spotShadowMap,Gt.spotLightMatrix.value=Ze.state.spotLightMatrix,Gt.spotLightMap.value=Ze.state.spotLightMap,Gt.pointShadowMap.value=Ze.state.pointShadowMap,Gt.pointShadowMatrix.value=Ze.state.pointShadowMatrix);const Nt=mt.getUniforms(),ai=$d.seqWithValue(Nt.seq,Gt);return ae.currentProgram=mt,ae.uniformsList=ai,mt}function gi(_,le){const pe=se.get(_);pe.outputEncoding=le.outputEncoding,pe.instancing=le.instancing,pe.skinning=le.skinning,pe.morphTargets=le.morphTargets,pe.morphNormals=le.morphNormals,pe.morphColors=le.morphColors,pe.morphTargetsCount=le.morphTargetsCount,pe.numClippingPlanes=le.numClippingPlanes,pe.numIntersection=le.numClipIntersection,pe.vertexAlphas=le.vertexAlphas,pe.vertexTangents=le.vertexTangents,pe.toneMapping=le.toneMapping}function un(_,le,pe,ae,Ze){le.isScene!==!0&&(le=ee),ue.resetTextureUnits();const ot=le.fog,ct=ae.isMeshStandardMaterial?le.environment:null,pt=y===null?m.outputEncoding:y.isXRRenderTarget===!0?y.texture.encoding:bg,Ct=(ae.isMeshStandardMaterial?xe:Ge).get(ae.envMap||ct),vt=ae.vertexColors===!0&&!!pe.attributes.color&&pe.attributes.color.itemSize===4,mt=!!ae.normalMap&&!!pe.attributes.tangent,Gt=!!pe.morphAttributes.position,Nt=!!pe.morphAttributes.normal,ai=!!pe.morphAttributes.color,jn=ae.toneMapped?m.toneMapping:po,Kn=pe.morphAttributes.position||pe.morphAttributes.normal||pe.morphAttributes.color,Ne=Kn!==void 0?Kn.length:0,nt=se.get(ae),qn=u.state.lights;if(k===!0&&(F===!0||_!==v)){const An=_===v&&ae.id===B;Y.setState(ae,_,An)}let ft=!1;ae.version===nt.__version?(nt.needsLights&&nt.lightsStateVersion!==qn.state.version||nt.outputEncoding!==pt||Ze.isInstancedMesh&&nt.instancing===!1||!Ze.isInstancedMesh&&nt.instancing===!0||Ze.isSkinnedMesh&&nt.skinning===!1||!Ze.isSkinnedMesh&&nt.skinning===!0||nt.envMap!==Ct||ae.fog===!0&&nt.fog!==ot||nt.numClippingPlanes!==void 0&&(nt.numClippingPlanes!==Y.numPlanes||nt.numIntersection!==Y.numIntersection)||nt.vertexAlphas!==vt||nt.vertexTangents!==mt||nt.morphTargets!==Gt||nt.morphNormals!==Nt||nt.morphColors!==ai||nt.toneMapping!==jn||Be.isWebGL2===!0&&nt.morphTargetsCount!==Ne)&&(ft=!0):(ft=!0,nt.__version=ae.version);let Mt=nt.currentProgram;ft===!0&&(Mt=on(ae,le,Ze));let Vn=!1,$n=!1,rn=!1;const gn=Mt.getUniforms(),Gi=nt.uniforms;if(ve.useProgram(Mt.program)&&(Vn=!0,$n=!0,rn=!0),ae.id!==B&&(B=ae.id,$n=!0),Vn||v!==_){if(gn.setValue(j,"projectionMatrix",_.projectionMatrix),Be.logarithmicDepthBuffer&&gn.setValue(j,"logDepthBufFC",2/(Math.log(_.far+1)/Math.LN2)),v!==_&&(v=_,$n=!0,rn=!0),ae.isShaderMaterial||ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshStandardMaterial||ae.envMap){const An=gn.map.cameraPosition;An!==void 0&&An.setValue(j,Q.setFromMatrixPosition(_.matrixWorld))}(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial)&&gn.setValue(j,"isOrthographic",_.isOrthographicCamera===!0),(ae.isMeshPhongMaterial||ae.isMeshToonMaterial||ae.isMeshLambertMaterial||ae.isMeshBasicMaterial||ae.isMeshStandardMaterial||ae.isShaderMaterial||ae.isShadowMaterial||Ze.isSkinnedMesh)&&gn.setValue(j,"viewMatrix",_.matrixWorldInverse)}if(Ze.isSkinnedMesh){gn.setOptional(j,Ze,"bindMatrix"),gn.setOptional(j,Ze,"bindMatrixInverse");const An=Ze.skeleton;An&&(Be.floatVertexTextures?(An.boneTexture===null&&An.computeBoneTexture(),gn.setValue(j,"boneTexture",An.boneTexture,ue),gn.setValue(j,"boneTextureSize",An.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Bo=pe.morphAttributes;if((Bo.position!==void 0||Bo.normal!==void 0||Bo.color!==void 0&&Be.isWebGL2===!0)&&we.update(Ze,pe,ae,Mt),($n||nt.receiveShadow!==Ze.receiveShadow)&&(nt.receiveShadow=Ze.receiveShadow,gn.setValue(j,"receiveShadow",Ze.receiveShadow)),ae.isMeshGouraudMaterial&&ae.envMap!==null&&(Gi.envMap.value=Ct,Gi.flipEnvMap.value=Ct.isCubeTexture&&Ct.isRenderTargetTexture===!1?-1:1),$n&&(gn.setValue(j,"toneMappingExposure",m.toneMappingExposure),nt.needsLights&&dn(Gi,rn),ot&&ae.fog===!0&&Le.refreshFogUniforms(Gi,ot),Le.refreshMaterialUniforms(Gi,ae,P,H,z),$d.upload(j,nt.uniformsList,Gi,ue)),ae.isShaderMaterial&&ae.uniformsNeedUpdate===!0&&($d.upload(j,nt.uniformsList,Gi,ue),ae.uniformsNeedUpdate=!1),ae.isSpriteMaterial&&gn.setValue(j,"center",Ze.center),gn.setValue(j,"modelViewMatrix",Ze.modelViewMatrix),gn.setValue(j,"normalMatrix",Ze.normalMatrix),gn.setValue(j,"modelMatrix",Ze.matrixWorld),ae.isShaderMaterial||ae.isRawShaderMaterial){const An=ae.uniformsGroups;for(let vo=0,ws=An.length;vo<ws;vo++)if(Be.isWebGL2){const Hi=An[vo];ze.update(Hi,Mt),ze.bind(Hi,Mt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Mt}function dn(_,le){_.ambientLightColor.needsUpdate=le,_.lightProbe.needsUpdate=le,_.directionalLights.needsUpdate=le,_.directionalLightShadows.needsUpdate=le,_.pointLights.needsUpdate=le,_.pointLightShadows.needsUpdate=le,_.spotLights.needsUpdate=le,_.spotLightShadows.needsUpdate=le,_.rectAreaLights.needsUpdate=le,_.hemisphereLights.needsUpdate=le}function On(_){return _.isMeshLambertMaterial||_.isMeshToonMaterial||_.isMeshPhongMaterial||_.isMeshStandardMaterial||_.isShadowMaterial||_.isShaderMaterial&&_.lights===!0}this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return f},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(_,le,pe){se.get(_.texture).__webglTexture=le,se.get(_.depthTexture).__webglTexture=pe;const ae=se.get(_);ae.__hasExternalTextures=!0,ae.__hasExternalTextures&&(ae.__autoAllocateDepthBuffer=pe===void 0,ae.__autoAllocateDepthBuffer||Ie.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ae.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(_,le){const pe=se.get(_);pe.__webglFramebuffer=le,pe.__useDefaultFramebuffer=le===void 0},this.setRenderTarget=function(_,le=0,pe=0){y=_,G=le,f=pe;let ae=!0;if(_){const Ct=se.get(_);Ct.__useDefaultFramebuffer!==void 0?(ve.bindFramebuffer(36160,null),ae=!1):Ct.__webglFramebuffer===void 0?ue.setupRenderTarget(_):Ct.__hasExternalTextures&&ue.rebindTextures(_,se.get(_.texture).__webglTexture,se.get(_.depthTexture).__webglTexture)}let Ze=null,ot=!1,ct=!1;if(_){const Ct=_.texture;(Ct.isData3DTexture||Ct.isDataArrayTexture)&&(ct=!0);const vt=se.get(_).__webglFramebuffer;_.isWebGLCubeRenderTarget?(Ze=vt[le],ot=!0):Be.isWebGL2&&_.samples>0&&ue.useMultisampledRTT(_)===!1?Ze=se.get(_).__webglMultisampledFramebuffer:Ze=vt,W.copy(_.viewport),R.copy(_.scissor),Z=_.scissorTest}else W.copy(K).multiplyScalar(P).floor(),R.copy(O).multiplyScalar(P).floor(),Z=q;if(ve.bindFramebuffer(36160,Ze)&&Be.drawBuffers&&ae&&ve.drawBuffers(_,Ze),ve.viewport(W),ve.scissor(R),ve.setScissorTest(Z),ot){const Ct=se.get(_.texture);j.framebufferTexture2D(36160,36064,34069+le,Ct.__webglTexture,pe)}else if(ct){const Ct=se.get(_.texture),vt=le||0;j.framebufferTextureLayer(36160,36064,Ct.__webglTexture,pe||0,vt)}B=-1},this.readRenderTargetPixels=function(_,le,pe,ae,Ze,ot,ct){if(!(_&&_.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let pt=se.get(_).__webglFramebuffer;if(_.isWebGLCubeRenderTarget&&ct!==void 0&&(pt=pt[ct]),pt){ve.bindFramebuffer(36160,pt);try{const Ct=_.texture,vt=Ct.format,mt=Ct.type;if(vt!==fs&&We.convert(vt)!==j.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Gt=mt===Jl&&(Ie.has("EXT_color_buffer_half_float")||Be.isWebGL2&&Ie.has("EXT_color_buffer_float"));if(mt!==fg&&We.convert(mt)!==j.getParameter(35738)&&!(mt===Qo&&(Be.isWebGL2||Ie.has("OES_texture_float")||Ie.has("WEBGL_color_buffer_float")))&&!Gt){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}le>=0&&le<=_.width-ae&&pe>=0&&pe<=_.height-Ze&&j.readPixels(le,pe,ae,Ze,We.convert(vt),We.convert(mt),ot)}finally{const Ct=y!==null?se.get(y).__webglFramebuffer:null;ve.bindFramebuffer(36160,Ct)}}},this.copyFramebufferToTexture=function(_,le,pe=0){const ae=Math.pow(2,-pe),Ze=Math.floor(le.image.width*ae),ot=Math.floor(le.image.height*ae);ue.setTexture2D(le,0),j.copyTexSubImage2D(3553,pe,0,0,_.x,_.y,Ze,ot),ve.unbindTexture()},this.copyTextureToTexture=function(_,le,pe,ae=0){const Ze=le.image.width,ot=le.image.height,ct=We.convert(pe.format),pt=We.convert(pe.type);ue.setTexture2D(pe,0),j.pixelStorei(37440,pe.flipY),j.pixelStorei(37441,pe.premultiplyAlpha),j.pixelStorei(3317,pe.unpackAlignment),le.isDataTexture?j.texSubImage2D(3553,ae,_.x,_.y,Ze,ot,ct,pt,le.image.data):le.isCompressedTexture?j.compressedTexSubImage2D(3553,ae,_.x,_.y,le.mipmaps[0].width,le.mipmaps[0].height,ct,le.mipmaps[0].data):j.texSubImage2D(3553,ae,_.x,_.y,ct,pt,le.image),ae===0&&pe.generateMipmaps&&j.generateMipmap(3553),ve.unbindTexture()},this.copyTextureToTexture3D=function(_,le,pe,ae,Ze=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const ot=_.max.x-_.min.x+1,ct=_.max.y-_.min.y+1,pt=_.max.z-_.min.z+1,Ct=We.convert(ae.format),vt=We.convert(ae.type);let mt;if(ae.isData3DTexture)ue.setTexture3D(ae,0),mt=32879;else if(ae.isDataArrayTexture)ue.setTexture2DArray(ae,0),mt=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}j.pixelStorei(37440,ae.flipY),j.pixelStorei(37441,ae.premultiplyAlpha),j.pixelStorei(3317,ae.unpackAlignment);const Gt=j.getParameter(3314),Nt=j.getParameter(32878),ai=j.getParameter(3316),jn=j.getParameter(3315),Kn=j.getParameter(32877),Ne=pe.isCompressedTexture?pe.mipmaps[0]:pe.image;j.pixelStorei(3314,Ne.width),j.pixelStorei(32878,Ne.height),j.pixelStorei(3316,_.min.x),j.pixelStorei(3315,_.min.y),j.pixelStorei(32877,_.min.z),pe.isDataTexture||pe.isData3DTexture?j.texSubImage3D(mt,Ze,le.x,le.y,le.z,ot,ct,pt,Ct,vt,Ne.data):pe.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),j.compressedTexSubImage3D(mt,Ze,le.x,le.y,le.z,ot,ct,pt,Ct,Ne.data)):j.texSubImage3D(mt,Ze,le.x,le.y,le.z,ot,ct,pt,Ct,vt,Ne),j.pixelStorei(3314,Gt),j.pixelStorei(32878,Nt),j.pixelStorei(3316,ai),j.pixelStorei(3315,jn),j.pixelStorei(32877,Kn),Ze===0&&ae.generateMipmaps&&j.generateMipmap(mt),ve.unbindTexture()},this.initTexture=function(_){_.isCubeTexture?ue.setTextureCube(_,0):_.isData3DTexture?ue.setTexture3D(_,0):_.isDataArrayTexture?ue.setTexture2DArray(_,0):ue.setTexture2D(_,0),ve.unbindTexture()},this.resetState=function(){G=0,f=0,y=null,ve.reset(),he.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class WS extends Fb{}WS.prototype.isWebGL1Renderer=!0;class oh{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Ee(e),this.density=t}clone(){return new oh(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class rh{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Ee(e),this.near=t,this.far=n}clone(){return new rh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Kb extends St{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class GC{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=tC,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ts()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ts()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ts()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const vi=new N;class Gg{constructor(e,t,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)vi.fromBufferAttribute(this,t),vi.applyMatrix4(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)vi.fromBufferAttribute(this,t),vi.applyNormalMatrix(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)vi.fromBufferAttribute(this,t),vi.transformDirection(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}setX(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Pt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Oo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Oo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Oo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Oo(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),s=Pt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=Pt(t,this.array),n=Pt(n,this.array),s=Pt(s,this.array),o=Pt(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return new Ft(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Gg(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Nb extends Tn{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Ee(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let rl;const $I=new N,gl=new N,al=new N,ll=new Se,ec=new Se,SS=new dt,nd=new N,tc=new N,id=new N,hv=new Se,Im=new Se,pv=new Se;class RS extends St{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",rl===void 0){rl=new bt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new GC(t,5);rl.setIndex([0,1,2,0,2,3]),rl.setAttribute("position",new Gg(n,3,0,!1)),rl.setAttribute("uv",new Gg(n,2,3,!1))}this.geometry=rl,this.material=e!==void 0?e:new Nb,this.center=new Se(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),gl.setFromMatrixScale(this.matrixWorld),SS.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),al.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&gl.multiplyScalar(-al.z);const n=this.material.rotation;let s,o;n!==0&&(o=Math.cos(n),s=Math.sin(n));const r=this.center;sd(nd.set(-.5,-.5,0),al,r,gl,s,o),sd(tc.set(.5,-.5,0),al,r,gl,s,o),sd(id.set(.5,.5,0),al,r,gl,s,o),hv.set(0,0),Im.set(1,0),pv.set(1,1);let g=e.ray.intersectTriangle(nd,tc,id,!1,$I);if(g===null&&(sd(tc.set(-.5,.5,0),al,r,gl,s,o),Im.set(0,1),g=e.ray.intersectTriangle(nd,id,tc,!1,$I),g===null))return;const a=e.ray.origin.distanceTo($I);a<e.near||a>e.far||t.push({distance:a,point:$I.clone(),uv:hs.getUV($I,nd,tc,id,hv,Im,pv,new Se),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function sd(i,e,t,n,s,o){ll.subVectors(i,t).addScalar(.5).multiply(n),s!==void 0?(ec.x=o*ll.x-s*ll.y,ec.y=s*ll.x+o*ll.y):ec.copy(ll),i.copy(e),i.x+=ec.x,i.y+=ec.y,i.applyMatrix4(SS)}const od=new N,mv=new N;class VS extends St{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,s=t.length;n<s;n++){const o=t[n];this.addLevel(o.object.clone(),o.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let s;for(s=0;s<n.length&&!(t<n[s].distance);s++);return n.splice(s,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){od.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(od);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){od.setFromMatrixPosition(e.matrixWorld),mv.setFromMatrixPosition(this.matrixWorld);const n=od.distanceTo(mv)/e.zoom;t[0].object.visible=!0;let s,o;for(s=1,o=t.length;s<o&&n>=t[s].distance;s++)t[s-1].object.visible=!1,t[s].object.visible=!0;for(this._currentLevel=s-1;s<o;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let s=0,o=n.length;s<o;s++){const r=n[s];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const fv=new N,bv=new Ht,Gv=new Ht,$K=new N,yv=new dt;class Mb extends fn{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new dt,this.bindMatrixInverse=new dt}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ht,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,s=this.geometry;bv.fromBufferAttribute(s.attributes.skinIndex,e),Gv.fromBufferAttribute(s.attributes.skinWeight,e),fv.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const r=Gv.getComponent(o);if(r!==0){const g=bv.getComponent(o);yv.multiplyMatrices(n.bones[g].matrixWorld,n.boneInverses[g]),t.addScaledVector($K.copy(fv).applyMatrix4(yv),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class gh extends St{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Hl extends Cn{constructor(e=null,t=1,n=1,s,o,r,g,a,l=Sn,I=Sn,C,u){super(null,r,g,a,l,I,s,o,C,u),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Bv=new dt,e3=new dt;class yC{constructor(e=[],t=[]){this.uuid=ts(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,s=this.bones.length;n<s;n++)this.boneInverses.push(new dt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new dt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,s=this.boneTexture;for(let o=0,r=e.length;o<r;o++){const g=e[o]?e[o].matrixWorld:e3;Bv.multiplyMatrices(g,t[o]),Bv.toArray(n,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new yC(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=dS(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Hl(t,e,e,fs,Qo);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,s=e.bones.length;n<s;n++){const o=e.bones[n];let r=t[o];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),r=new gh),this.bones.push(r),this.boneInverses.push(new dt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let s=0,o=t.length;s<o;s++){const r=t[s];e.bones.push(r.uuid);const g=n[s];e.boneInverses.push(g.toArray())}return e}}class Za extends Ft{constructor(e,t,n,s=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const vv=new dt,Zv=new dt,rd=[],nc=new fn;class Fl extends fn{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Za(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){const n=this.matrixWorld,s=this.count;if(nc.geometry=this.geometry,nc.material=this.material,nc.material!==void 0)for(let o=0;o<s;o++){this.getMatrixAt(o,vv),Zv.multiplyMatrices(n,vv),nc.matrixWorld=Zv,nc.raycast(e,rd);for(let r=0,g=rd.length;r<g;r++){const a=rd[r];a.instanceId=o,a.object=this,t.push(a)}rd.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Za(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class bi extends Tn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ee(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const wv=new N,Wv=new N,Sv=new dt,cm=new fC,gd=new Ar;class ar extends St{constructor(e=new bt,t=new bi){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let s=1,o=t.count;s<o;s++)wv.fromBufferAttribute(t,s-1),Wv.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=wv.distanceTo(Wv);e.setAttribute("lineDistance",new tt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,r=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),gd.copy(n.boundingSphere),gd.applyMatrix4(s),gd.radius+=o,e.ray.intersectsSphere(gd)===!1)return;Sv.copy(s).invert(),cm.copy(e.ray).applyMatrix4(Sv);const g=o/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g,l=new N,I=new N,C=new N,u=new N,A=this.isLineSegments?2:1,h=n.index,b=n.attributes.position;if(h!==null){const G=Math.max(0,r.start),f=Math.min(h.count,r.start+r.count);for(let y=G,B=f-1;y<B;y+=A){const v=h.getX(y),W=h.getX(y+1);if(l.fromBufferAttribute(b,v),I.fromBufferAttribute(b,W),cm.distanceSqToSegment(l,I,u,C)>a)continue;u.applyMatrix4(this.matrixWorld);const Z=e.ray.origin.distanceTo(u);Z<e.near||Z>e.far||t.push({distance:Z,point:C.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{const G=Math.max(0,r.start),f=Math.min(b.count,r.start+r.count);for(let y=G,B=f-1;y<B;y+=A){if(l.fromBufferAttribute(b,y),I.fromBufferAttribute(b,y+1),cm.distanceSqToSegment(l,I,u,C)>a)continue;u.applyMatrix4(this.matrixWorld);const W=e.ray.origin.distanceTo(u);W<e.near||W>e.far||t.push({distance:W,point:C.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const g=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=o}}}}}const Rv=new N,Vv=new N;class Ps extends ar{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let s=0,o=t.count;s<o;s+=2)Rv.fromBufferAttribute(t,s),Vv.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+Rv.distanceTo(Vv);e.setAttribute("lineDistance",new tt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Lb extends ar{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ah extends Tn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Ee(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const xv=new dt,o0=new fC,ad=new Ar,ld=new N;class zb extends St{constructor(e=new bt,t=new ah){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,s=this.matrixWorld,o=e.params.Points.threshold,r=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ad.copy(n.boundingSphere),ad.applyMatrix4(s),ad.radius+=o,e.ray.intersectsSphere(ad)===!1)return;xv.copy(s).invert(),o0.copy(e.ray).applyMatrix4(xv);const g=o/((this.scale.x+this.scale.y+this.scale.z)/3),a=g*g,l=n.index,C=n.attributes.position;if(l!==null){const u=Math.max(0,r.start),A=Math.min(l.count,r.start+r.count);for(let h=u,m=A;h<m;h++){const b=l.getX(h);ld.fromBufferAttribute(C,b),Xv(ld,b,a,s,e,t,this)}}else{const u=Math.max(0,r.start),A=Math.min(C.count,r.start+r.count);for(let h=u,m=A;h<m;h++)ld.fromBufferAttribute(C,h),Xv(ld,h,a,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const g=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[g]=o}}}}}function Xv(i,e,t,n,s,o,r){const g=o0.distanceSqToPoint(i);if(g<t){const a=new N;o0.closestPointToPoint(i,a),a.applyMatrix4(n);const l=s.ray.origin.distanceTo(a);if(l<s.near||l>s.far)return;o.push({distance:l,distanceToRay:Math.sqrt(g),point:a,index:e,face:null,object:r})}}class t3 extends Cn{constructor(e,t,n,s,o,r,g,a,l){super(e,t,n,s,o,r,g,a,l),this.isVideoTexture=!0,this.minFilter=r!==void 0?r:en,this.magFilter=o!==void 0?o:en,this.generateMipmaps=!1;const I=this;function C(){I.needsUpdate=!0,e.requestVideoFrameCallback(C)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(C)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class n3 extends Cn{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=Sn,this.minFilter=Sn,this.generateMipmaps=!1,this.needsUpdate=!0}}class xS extends Cn{constructor(e,t,n,s,o,r,g,a,l,I,C,u){super(null,r,g,a,l,I,s,o,C,u),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class i3 extends Cn{constructor(e,t,n,s,o,r,g,a,l){super(e,t,n,s,o,r,g,a,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Qs{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,s=this.getPoint(0),o=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),o+=n.distanceTo(s),t.push(o),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let s=0;const o=n.length;let r;t?r=t:r=e*n[o-1];let g=0,a=o-1,l;for(;g<=a;)if(s=Math.floor(g+(a-g)/2),l=n[s]-r,l<0)g=s+1;else if(l>0)a=s-1;else{a=s;break}if(s=a,n[s]===r)return s/(o-1);const I=n[s],u=n[s+1]-I,A=(r-I)/u;return(s+A)/(o-1)}getTangent(e,t){let s=e-1e-4,o=e+1e-4;s<0&&(s=0),o>1&&(o=1);const r=this.getPoint(s),g=this.getPoint(o),a=t||(r.isVector2?new Se:new N);return a.copy(g).sub(r).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new N,s=[],o=[],r=[],g=new N,a=new dt;for(let A=0;A<=e;A++){const h=A/e;s[A]=this.getTangentAt(h,new N)}o[0]=new N,r[0]=new N;let l=Number.MAX_VALUE;const I=Math.abs(s[0].x),C=Math.abs(s[0].y),u=Math.abs(s[0].z);I<=l&&(l=I,n.set(1,0,0)),C<=l&&(l=C,n.set(0,1,0)),u<=l&&n.set(0,0,1),g.crossVectors(s[0],n).normalize(),o[0].crossVectors(s[0],g),r[0].crossVectors(s[0],o[0]);for(let A=1;A<=e;A++){if(o[A]=o[A-1].clone(),r[A]=r[A-1].clone(),g.crossVectors(s[A-1],s[A]),g.length()>Number.EPSILON){g.normalize();const h=Math.acos(Rn(s[A-1].dot(s[A]),-1,1));o[A].applyMatrix4(a.makeRotationAxis(g,h))}r[A].crossVectors(s[A],o[A])}if(t===!0){let A=Math.acos(Rn(o[0].dot(o[e]),-1,1));A/=e,s[0].dot(g.crossVectors(o[0],o[e]))>0&&(A=-A);for(let h=1;h<=e;h++)o[h].applyMatrix4(a.makeRotationAxis(s[h],A*h)),r[h].crossVectors(s[h],o[h])}return{tangents:s,normals:o,binormals:r}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class lh extends Qs{constructor(e=0,t=0,n=1,s=1,o=0,r=Math.PI*2,g=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=r,this.aClockwise=g,this.aRotation=a}getPoint(e,t){const n=t||new Se,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const r=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(r?o=0:o=s),this.aClockwise===!0&&!r&&(o===s?o=-s:o=o-s);const g=this.aStartAngle+e*o;let a=this.aX+this.xRadius*Math.cos(g),l=this.aY+this.yRadius*Math.sin(g);if(this.aRotation!==0){const I=Math.cos(this.aRotation),C=Math.sin(this.aRotation),u=a-this.aX,A=l-this.aY;a=u*I-A*C+this.aX,l=u*C+A*I+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class XS extends lh{constructor(e,t,n,s,o,r){super(e,t,n,n,s,o,r),this.isArcCurve=!0,this.type="ArcCurve"}}function kb(){let i=0,e=0,t=0,n=0;function s(o,r,g,a){i=o,e=g,t=-3*o+3*r-2*g-a,n=2*o-2*r+g+a}return{initCatmullRom:function(o,r,g,a,l){s(r,g,l*(g-o),l*(a-r))},initNonuniformCatmullRom:function(o,r,g,a,l,I,C){let u=(r-o)/l-(g-o)/(l+I)+(g-r)/I,A=(g-r)/I-(a-r)/(I+C)+(a-g)/C;u*=I,A*=I,s(r,g,u,A)},calc:function(o){const r=o*o,g=r*o;return i+e*o+t*r+n*g}}}const Id=new N,Cm=new kb,um=new kb,dm=new kb;class YS extends Qs{constructor(e=[],t=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new N){const n=t,s=this.points,o=s.length,r=(o-(this.closed?0:1))*e;let g=Math.floor(r),a=r-g;this.closed?g+=g>0?0:(Math.floor(Math.abs(g)/o)+1)*o:a===0&&g===o-1&&(g=o-2,a=1);let l,I;this.closed||g>0?l=s[(g-1)%o]:(Id.subVectors(s[0],s[1]).add(s[0]),l=Id);const C=s[g%o],u=s[(g+1)%o];if(this.closed||g+2<o?I=s[(g+2)%o]:(Id.subVectors(s[o-1],s[o-2]).add(s[o-1]),I=Id),this.curveType==="centripetal"||this.curveType==="chordal"){const A=this.curveType==="chordal"?.5:.25;let h=Math.pow(l.distanceToSquared(C),A),m=Math.pow(C.distanceToSquared(u),A),b=Math.pow(u.distanceToSquared(I),A);m<1e-4&&(m=1),h<1e-4&&(h=m),b<1e-4&&(b=m),Cm.initNonuniformCatmullRom(l.x,C.x,u.x,I.x,h,m,b),um.initNonuniformCatmullRom(l.y,C.y,u.y,I.y,h,m,b),dm.initNonuniformCatmullRom(l.z,C.z,u.z,I.z,h,m,b)}else this.curveType==="catmullrom"&&(Cm.initCatmullRom(l.x,C.x,u.x,I.x,this.tension),um.initCatmullRom(l.y,C.y,u.y,I.y,this.tension),dm.initCatmullRom(l.z,C.z,u.z,I.z,this.tension));return n.set(Cm.calc(a),um.calc(a),dm.calc(a)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new N().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function Yv(i,e,t,n,s){const o=(n-e)*.5,r=(s-t)*.5,g=i*i,a=i*g;return(2*t-2*n+o+r)*a+(-3*t+3*n-2*o-r)*g+o*i+t}function s3(i,e){const t=1-i;return t*t*e}function o3(i,e){return 2*(1-i)*i*e}function r3(i,e){return i*i*e}function Sc(i,e,t,n){return s3(i,e)+o3(i,t)+r3(i,n)}function g3(i,e){const t=1-i;return t*t*t*e}function a3(i,e){const t=1-i;return 3*t*t*i*e}function l3(i,e){return 3*(1-i)*i*i*e}function I3(i,e){return i*i*i*e}function Rc(i,e,t,n,s){return g3(i,e)+a3(i,t)+l3(i,n)+I3(i,s)}class Tb extends Qs{constructor(e=new Se,t=new Se,n=new Se,s=new Se){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new Se){const n=t,s=this.v0,o=this.v1,r=this.v2,g=this.v3;return n.set(Rc(e,s.x,o.x,r.x,g.x),Rc(e,s.y,o.y,r.y,g.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class HS extends Qs{constructor(e=new N,t=new N,n=new N,s=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new N){const n=t,s=this.v0,o=this.v1,r=this.v2,g=this.v3;return n.set(Rc(e,s.x,o.x,r.x,g.x),Rc(e,s.y,o.y,r.y,g.y),Rc(e,s.z,o.z,r.z,g.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ih extends Qs{constructor(e=new Se,t=new Se){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Se){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Se;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class FS extends Qs{constructor(e=new N,t=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new N){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Eb extends Qs{constructor(e=new Se,t=new Se,n=new Se){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Se){const n=t,s=this.v0,o=this.v1,r=this.v2;return n.set(Sc(e,s.x,o.x,r.x),Sc(e,s.y,o.y,r.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class _b extends Qs{constructor(e=new N,t=new N,n=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new N){const n=t,s=this.v0,o=this.v1,r=this.v2;return n.set(Sc(e,s.x,o.x,r.x),Sc(e,s.y,o.y,r.y),Sc(e,s.z,o.z,r.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Jb extends Qs{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Se){const n=t,s=this.points,o=(s.length-1)*e,r=Math.floor(o),g=o-r,a=s[r===0?r:r-1],l=s[r],I=s[r>s.length-2?s.length-1:r+1],C=s[r>s.length-3?s.length-1:r+2];return n.set(Yv(g,a.x,l.x,I.x,C.x),Yv(g,a.y,l.y,I.y,C.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const s=e.points[t];this.points.push(new Se().fromArray(s))}return this}}var Ub=Object.freeze({__proto__:null,ArcCurve:XS,CatmullRomCurve3:YS,CubicBezierCurve:Tb,CubicBezierCurve3:HS,EllipseCurve:lh,LineCurve:Ih,LineCurve3:FS,QuadraticBezierCurve:Eb,QuadraticBezierCurve3:_b,SplineCurve:Jb});class KS extends Qs{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ih(t,e))}getPoint(e,t){const n=e*this.getLength(),s=this.getCurveLengths();let o=0;for(;o<s.length;){if(s[o]>=n){const r=s[o]-n,g=this.curves[o],a=g.getLength(),l=a===0?0:1-r/a;return g.getPointAt(l,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let s=0,o=this.curves;s<o.length;s++){const r=o[s],g=r.isEllipseCurve?e*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?e*r.points.length:e,a=r.getPoints(g);for(let l=0;l<a.length;l++){const I=a[l];n&&n.equals(I)||(t.push(I),n=I)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const s=e.curves[t];this.curves.push(new Ub[s.type]().fromJSON(s))}return this}}class sC extends KS{constructor(e){super(),this.type="Path",this.currentPoint=new Se,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Ih(this.currentPoint.clone(),new Se(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){const o=new Eb(this.currentPoint.clone(),new Se(e,t),new Se(n,s));return this.curves.push(o),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,o,r){const g=new Tb(this.currentPoint.clone(),new Se(e,t),new Se(n,s),new Se(o,r));return this.curves.push(g),this.currentPoint.set(o,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Jb(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,o,r){const g=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+g,t+a,n,s,o,r),this}absarc(e,t,n,s,o,r){return this.absellipse(e,t,n,n,s,o,r),this}ellipse(e,t,n,s,o,r,g,a){const l=this.currentPoint.x,I=this.currentPoint.y;return this.absellipse(e+l,t+I,n,s,o,r,g,a),this}absellipse(e,t,n,s,o,r,g,a){const l=new lh(e,t,n,s,o,r,g,a);if(this.curves.length>0){const C=l.getPoint(0);C.equals(this.currentPoint)||this.lineTo(C.x,C.y)}this.curves.push(l);const I=l.getPoint(1);return this.currentPoint.copy(I),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class oI extends bt{constructor(e=[new Se(0,-.5),new Se(.5,0),new Se(0,.5)],t=12,n=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:s},t=Math.floor(t),s=Rn(s,0,Math.PI*2);const o=[],r=[],g=[],a=[],l=[],I=1/t,C=new N,u=new Se,A=new N,h=new N,m=new N;let b=0,G=0;for(let f=0;f<=e.length-1;f++)switch(f){case 0:b=e[f+1].x-e[f].x,G=e[f+1].y-e[f].y,A.x=G*1,A.y=-b,A.z=G*0,m.copy(A),A.normalize(),a.push(A.x,A.y,A.z);break;case e.length-1:a.push(m.x,m.y,m.z);break;default:b=e[f+1].x-e[f].x,G=e[f+1].y-e[f].y,A.x=G*1,A.y=-b,A.z=G*0,h.copy(A),A.x+=m.x,A.y+=m.y,A.z+=m.z,A.normalize(),a.push(A.x,A.y,A.z),m.copy(h)}for(let f=0;f<=t;f++){const y=n+f*I*s,B=Math.sin(y),v=Math.cos(y);for(let W=0;W<=e.length-1;W++){C.x=e[W].x*B,C.y=e[W].y,C.z=e[W].x*v,r.push(C.x,C.y,C.z),u.x=f/t,u.y=W/(e.length-1),g.push(u.x,u.y);const R=a[3*W+0]*B,Z=a[3*W+1],V=a[3*W+0]*v;l.push(R,Z,V)}}for(let f=0;f<t;f++)for(let y=0;y<e.length-1;y++){const B=y+f*e.length,v=B,W=B+e.length,R=B+e.length+1,Z=B+1;o.push(v,W,Z),o.push(R,Z,W)}this.setIndex(o),this.setAttribute("position",new tt(r,3)),this.setAttribute("uv",new tt(g,2)),this.setAttribute("normal",new tt(l,3))}static fromJSON(e){return new oI(e.points,e.segments,e.phiStart,e.phiLength)}}class BC extends oI{constructor(e=1,t=1,n=4,s=8){const o=new sC;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(n),s),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:s}}static fromJSON(e){return new BC(e.radius,e.length,e.capSegments,e.radialSegments)}}class vC extends bt{constructor(e=1,t=8,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);const o=[],r=[],g=[],a=[],l=new N,I=new Se;r.push(0,0,0),g.push(0,0,1),a.push(.5,.5);for(let C=0,u=3;C<=t;C++,u+=3){const A=n+C/t*s;l.x=e*Math.cos(A),l.y=e*Math.sin(A),r.push(l.x,l.y,l.z),g.push(0,0,1),I.x=(r[u]/e+1)/2,I.y=(r[u+1]/e+1)/2,a.push(I.x,I.y)}for(let C=1;C<=t;C++)o.push(C,C+1,0);this.setIndex(o),this.setAttribute("position",new tt(r,3)),this.setAttribute("normal",new tt(g,3)),this.setAttribute("uv",new tt(a,2))}static fromJSON(e){return new vC(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Ra extends bt{constructor(e=1,t=1,n=1,s=8,o=1,r=!1,g=0,a=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:o,openEnded:r,thetaStart:g,thetaLength:a};const l=this;s=Math.floor(s),o=Math.floor(o);const I=[],C=[],u=[],A=[];let h=0;const m=[],b=n/2;let G=0;f(),r===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(I),this.setAttribute("position",new tt(C,3)),this.setAttribute("normal",new tt(u,3)),this.setAttribute("uv",new tt(A,2));function f(){const B=new N,v=new N;let W=0;const R=(t-e)/n;for(let Z=0;Z<=o;Z++){const V=[],H=Z/o,P=H*(t-e)+e;for(let E=0;E<=s;E++){const L=E/s,K=L*a+g,O=Math.sin(K),q=Math.cos(K);v.x=P*O,v.y=-H*n+b,v.z=P*q,C.push(v.x,v.y,v.z),B.set(O,R,q).normalize(),u.push(B.x,B.y,B.z),A.push(L,1-H),V.push(h++)}m.push(V)}for(let Z=0;Z<s;Z++)for(let V=0;V<o;V++){const H=m[V][Z],P=m[V+1][Z],E=m[V+1][Z+1],L=m[V][Z+1];I.push(H,P,L),I.push(P,E,L),W+=6}l.addGroup(G,W,0),G+=W}function y(B){const v=h,W=new Se,R=new N;let Z=0;const V=B===!0?e:t,H=B===!0?1:-1;for(let E=1;E<=s;E++)C.push(0,b*H,0),u.push(0,H,0),A.push(.5,.5),h++;const P=h;for(let E=0;E<=s;E++){const K=E/s*a+g,O=Math.cos(K),q=Math.sin(K);R.x=V*q,R.y=b*H,R.z=V*O,C.push(R.x,R.y,R.z),u.push(0,H,0),W.x=O*.5+.5,W.y=q*.5*H+.5,A.push(W.x,W.y),h++}for(let E=0;E<s;E++){const L=v+E,K=P+E;B===!0?I.push(K,K+1,L):I.push(K+1,K,L),Z+=3}l.addGroup(G,Z,B===!0?1:2),G+=Z}}static fromJSON(e){return new Ra(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ZC extends Ra{constructor(e=1,t=1,n=8,s=1,o=!1,r=0,g=Math.PI*2){super(0,e,t,n,s,o,r,g),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:o,thetaStart:r,thetaLength:g}}static fromJSON(e){return new ZC(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class pr extends bt{constructor(e=[],t=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};const o=[],r=[];g(s),l(n),I(),this.setAttribute("position",new tt(o,3)),this.setAttribute("normal",new tt(o.slice(),3)),this.setAttribute("uv",new tt(r,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function g(f){const y=new N,B=new N,v=new N;for(let W=0;W<t.length;W+=3)A(t[W+0],y),A(t[W+1],B),A(t[W+2],v),a(y,B,v,f)}function a(f,y,B,v){const W=v+1,R=[];for(let Z=0;Z<=W;Z++){R[Z]=[];const V=f.clone().lerp(B,Z/W),H=y.clone().lerp(B,Z/W),P=W-Z;for(let E=0;E<=P;E++)E===0&&Z===W?R[Z][E]=V:R[Z][E]=V.clone().lerp(H,E/P)}for(let Z=0;Z<W;Z++)for(let V=0;V<2*(W-Z)-1;V++){const H=Math.floor(V/2);V%2===0?(u(R[Z][H+1]),u(R[Z+1][H]),u(R[Z][H])):(u(R[Z][H+1]),u(R[Z+1][H+1]),u(R[Z+1][H]))}}function l(f){const y=new N;for(let B=0;B<o.length;B+=3)y.x=o[B+0],y.y=o[B+1],y.z=o[B+2],y.normalize().multiplyScalar(f),o[B+0]=y.x,o[B+1]=y.y,o[B+2]=y.z}function I(){const f=new N;for(let y=0;y<o.length;y+=3){f.x=o[y+0],f.y=o[y+1],f.z=o[y+2];const B=b(f)/2/Math.PI+.5,v=G(f)/Math.PI+.5;r.push(B,1-v)}h(),C()}function C(){for(let f=0;f<r.length;f+=6){const y=r[f+0],B=r[f+2],v=r[f+4],W=Math.max(y,B,v),R=Math.min(y,B,v);W>.9&&R<.1&&(y<.2&&(r[f+0]+=1),B<.2&&(r[f+2]+=1),v<.2&&(r[f+4]+=1))}}function u(f){o.push(f.x,f.y,f.z)}function A(f,y){const B=f*3;y.x=e[B+0],y.y=e[B+1],y.z=e[B+2]}function h(){const f=new N,y=new N,B=new N,v=new N,W=new Se,R=new Se,Z=new Se;for(let V=0,H=0;V<o.length;V+=9,H+=6){f.set(o[V+0],o[V+1],o[V+2]),y.set(o[V+3],o[V+4],o[V+5]),B.set(o[V+6],o[V+7],o[V+8]),W.set(r[H+0],r[H+1]),R.set(r[H+2],r[H+3]),Z.set(r[H+4],r[H+5]),v.copy(f).add(y).add(B).divideScalar(3);const P=b(v);m(W,H+0,f,P),m(R,H+2,y,P),m(Z,H+4,B,P)}}function m(f,y,B,v){v<0&&f.x===1&&(r[y]=f.x-1),B.x===0&&B.z===0&&(r[y]=v/2/Math.PI+.5)}function b(f){return Math.atan2(f.z,-f.x)}function G(f){return Math.atan2(-f.y,Math.sqrt(f.x*f.x+f.z*f.z))}}static fromJSON(e){return new pr(e.vertices,e.indices,e.radius,e.details)}}class wC extends pr{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-n,0,-s,n,0,s,-n,0,s,n,-s,-n,0,-s,n,0,s,-n,0,s,n,0,-n,0,-s,n,0,-s,-n,0,s,n,0,s],r=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,r,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wC(e.radius,e.detail)}}const cd=new N,Cd=new N,Am=new N,ud=new hs;class NS extends bt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),o=Math.cos(da*t),r=e.getIndex(),g=e.getAttribute("position"),a=r?r.count:g.count,l=[0,0,0],I=["a","b","c"],C=new Array(3),u={},A=[];for(let h=0;h<a;h+=3){r?(l[0]=r.getX(h),l[1]=r.getX(h+1),l[2]=r.getX(h+2)):(l[0]=h,l[1]=h+1,l[2]=h+2);const{a:m,b,c:G}=ud;if(m.fromBufferAttribute(g,l[0]),b.fromBufferAttribute(g,l[1]),G.fromBufferAttribute(g,l[2]),ud.getNormal(Am),C[0]=`${Math.round(m.x*s)},${Math.round(m.y*s)},${Math.round(m.z*s)}`,C[1]=`${Math.round(b.x*s)},${Math.round(b.y*s)},${Math.round(b.z*s)}`,C[2]=`${Math.round(G.x*s)},${Math.round(G.y*s)},${Math.round(G.z*s)}`,!(C[0]===C[1]||C[1]===C[2]||C[2]===C[0]))for(let f=0;f<3;f++){const y=(f+1)%3,B=C[f],v=C[y],W=ud[I[f]],R=ud[I[y]],Z=`${B}_${v}`,V=`${v}_${B}`;V in u&&u[V]?(Am.dot(u[V].normal)<=o&&(A.push(W.x,W.y,W.z),A.push(R.x,R.y,R.z)),u[V]=null):Z in u||(u[Z]={index0:l[f],index1:l[y],normal:Am.clone()})}}for(const h in u)if(u[h]){const{index0:m,index1:b}=u[h];cd.fromBufferAttribute(g,m),Cd.fromBufferAttribute(g,b),A.push(cd.x,cd.y,cd.z),A.push(Cd.x,Cd.y,Cd.z)}this.setAttribute("position",new tt(A,3))}}}class pa extends sC{constructor(e){super(e),this.uuid=ts(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const s=e.holes[t];this.holes.push(new sC().fromJSON(s))}return this}}const c3={triangulate:function(i,e,t=2){const n=e&&e.length,s=n?e[0]*t:i.length;let o=MS(i,0,s,t,!0);const r=[];if(!o||o.next===o.prev)return r;let g,a,l,I,C,u,A;if(n&&(o=h3(i,e,o,t)),i.length>80*t){g=l=i[0],a=I=i[1];for(let h=t;h<s;h+=t)C=i[h],u=i[h+1],C<g&&(g=C),u<a&&(a=u),C>l&&(l=C),u>I&&(I=u);A=Math.max(l-g,I-a),A=A!==0?1/A:0}return oC(o,r,t,g,a,A),r}};function MS(i,e,t,n,s){let o,r;if(s===W3(i,e,t,n)>0)for(o=e;o<t;o+=n)r=Hv(o,i[o],i[o+1],r);else for(o=t-n;o>=e;o-=n)r=Hv(o,i[o],i[o+1],r);return r&&ch(r,r.next)&&(gC(r),r=r.next),r}function yg(i,e){if(!i)return i;e||(e=i);let t=i,n;do if(n=!1,!t.steiner&&(ch(t,t.next)||ln(t.prev,t,t.next)===0)){if(gC(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function oC(i,e,t,n,s,o,r){if(!i)return;!r&&o&&G3(i,n,s,o);let g=i,a,l;for(;i.prev!==i.next;){if(a=i.prev,l=i.next,o?u3(i,n,s,o):C3(i)){e.push(a.i/t),e.push(i.i/t),e.push(l.i/t),gC(i),i=l.next,g=l.next;continue}if(i=l,i===g){r?r===1?(i=d3(yg(i),e,t),oC(i,e,t,n,s,o,2)):r===2&&A3(i,e,t,n,s,o):oC(yg(i),e,t,n,s,o,1);break}}}function C3(i){const e=i.prev,t=i,n=i.next;if(ln(e,t,n)>=0)return!1;let s=i.next.next;for(;s!==i.prev;){if(wl(e.x,e.y,t.x,t.y,n.x,n.y,s.x,s.y)&&ln(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function u3(i,e,t,n){const s=i.prev,o=i,r=i.next;if(ln(s,o,r)>=0)return!1;const g=s.x<o.x?s.x<r.x?s.x:r.x:o.x<r.x?o.x:r.x,a=s.y<o.y?s.y<r.y?s.y:r.y:o.y<r.y?o.y:r.y,l=s.x>o.x?s.x>r.x?s.x:r.x:o.x>r.x?o.x:r.x,I=s.y>o.y?s.y>r.y?s.y:r.y:o.y>r.y?o.y:r.y,C=r0(g,a,e,t,n),u=r0(l,I,e,t,n);let A=i.prevZ,h=i.nextZ;for(;A&&A.z>=C&&h&&h.z<=u;){if(A!==i.prev&&A!==i.next&&wl(s.x,s.y,o.x,o.y,r.x,r.y,A.x,A.y)&&ln(A.prev,A,A.next)>=0||(A=A.prevZ,h!==i.prev&&h!==i.next&&wl(s.x,s.y,o.x,o.y,r.x,r.y,h.x,h.y)&&ln(h.prev,h,h.next)>=0))return!1;h=h.nextZ}for(;A&&A.z>=C;){if(A!==i.prev&&A!==i.next&&wl(s.x,s.y,o.x,o.y,r.x,r.y,A.x,A.y)&&ln(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;h&&h.z<=u;){if(h!==i.prev&&h!==i.next&&wl(s.x,s.y,o.x,o.y,r.x,r.y,h.x,h.y)&&ln(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function d3(i,e,t){let n=i;do{const s=n.prev,o=n.next.next;!ch(s,o)&&LS(s,n,n.next,o)&&rC(s,o)&&rC(o,s)&&(e.push(s.i/t),e.push(n.i/t),e.push(o.i/t),gC(n),gC(n.next),n=i=o),n=n.next}while(n!==i);return yg(n)}function A3(i,e,t,n,s,o){let r=i;do{let g=r.next.next;for(;g!==r.prev;){if(r.i!==g.i&&v3(r,g)){let a=zS(r,g);r=yg(r,r.next),a=yg(a,a.next),oC(r,e,t,n,s,o),oC(a,e,t,n,s,o);return}g=g.next}r=r.next}while(r!==i)}function h3(i,e,t,n){const s=[];let o,r,g,a,l;for(o=0,r=e.length;o<r;o++)g=e[o]*n,a=o<r-1?e[o+1]*n:i.length,l=MS(i,g,a,n,!1),l===l.next&&(l.steiner=!0),s.push(B3(l));for(s.sort(p3),o=0;o<s.length;o++)m3(s[o],t),t=yg(t,t.next);return t}function p3(i,e){return i.x-e.x}function m3(i,e){if(e=f3(i,e),e){const t=zS(e,i);yg(e,e.next),yg(t,t.next)}}function f3(i,e){let t=e;const n=i.x,s=i.y;let o=-1/0,r;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){const u=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(u<=n&&u>o){if(o=u,u===n){if(s===t.y)return t;if(s===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!r)return null;if(n===o)return r;const g=r,a=r.x,l=r.y;let I=1/0,C;t=r;do n>=t.x&&t.x>=a&&n!==t.x&&wl(s<l?n:o,s,a,l,s<l?o:n,s,t.x,t.y)&&(C=Math.abs(s-t.y)/(n-t.x),rC(t,i)&&(C<I||C===I&&(t.x>r.x||t.x===r.x&&b3(r,t)))&&(r=t,I=C)),t=t.next;while(t!==g);return r}function b3(i,e){return ln(i.prev,i,e.prev)<0&&ln(e.next,i,i.next)<0}function G3(i,e,t,n){let s=i;do s.z===null&&(s.z=r0(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==i);s.prevZ.nextZ=null,s.prevZ=null,y3(s)}function y3(i){let e,t,n,s,o,r,g,a,l=1;do{for(t=i,i=null,o=null,r=0;t;){for(r++,n=t,g=0,e=0;e<l&&(g++,n=n.nextZ,!!n);e++);for(a=l;g>0||a>0&&n;)g!==0&&(a===0||!n||t.z<=n.z)?(s=t,t=t.nextZ,g--):(s=n,n=n.nextZ,a--),o?o.nextZ=s:i=s,s.prevZ=o,o=s;t=n}o.nextZ=null,l*=2}while(r>1);return i}function r0(i,e,t,n,s){return i=32767*(i-t)*s,e=32767*(e-n)*s,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,i|e<<1}function B3(i){let e=i,t=i;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==i);return t}function wl(i,e,t,n,s,o,r,g){return(s-r)*(e-g)-(i-r)*(o-g)>=0&&(i-r)*(n-g)-(t-r)*(e-g)>=0&&(t-r)*(o-g)-(s-r)*(n-g)>=0}function v3(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!Z3(i,e)&&(rC(i,e)&&rC(e,i)&&w3(i,e)&&(ln(i.prev,i,e.prev)||ln(i,e.prev,e))||ch(i,e)&&ln(i.prev,i,i.next)>0&&ln(e.prev,e,e.next)>0)}function ln(i,e,t){return(e.y-i.y)*(t.x-e.x)-(e.x-i.x)*(t.y-e.y)}function ch(i,e){return i.x===e.x&&i.y===e.y}function LS(i,e,t,n){const s=Ad(ln(i,e,t)),o=Ad(ln(i,e,n)),r=Ad(ln(t,n,i)),g=Ad(ln(t,n,e));return!!(s!==o&&r!==g||s===0&&dd(i,t,e)||o===0&&dd(i,n,e)||r===0&&dd(t,i,n)||g===0&&dd(t,e,n))}function dd(i,e,t){return e.x<=Math.max(i.x,t.x)&&e.x>=Math.min(i.x,t.x)&&e.y<=Math.max(i.y,t.y)&&e.y>=Math.min(i.y,t.y)}function Ad(i){return i>0?1:i<0?-1:0}function Z3(i,e){let t=i;do{if(t.i!==i.i&&t.next.i!==i.i&&t.i!==e.i&&t.next.i!==e.i&&LS(t,t.next,i,e))return!0;t=t.next}while(t!==i);return!1}function rC(i,e){return ln(i.prev,i,i.next)<0?ln(i,e,i.next)>=0&&ln(i,i.prev,e)>=0:ln(i,e,i.prev)<0||ln(i,i.next,e)<0}function w3(i,e){let t=i,n=!1;const s=(i.x+e.x)/2,o=(i.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&s<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==i);return n}function zS(i,e){const t=new g0(i.i,i.x,i.y),n=new g0(e.i,e.x,e.y),s=i.next,o=e.prev;return i.next=e,e.prev=i,t.next=s,s.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function Hv(i,e,t,n){const s=new g0(i,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function gC(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function g0(i,e,t){this.i=i,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function W3(i,e,t,n){let s=0;for(let o=e,r=t-n;o<t;o+=n)s+=(i[r]-i[o])*(i[o+1]+i[r+1]),r=o;return s}class mo{static area(e){const t=e.length;let n=0;for(let s=t-1,o=0;o<t;s=o++)n+=e[s].x*e[o].y-e[o].x*e[s].y;return n*.5}static isClockWise(e){return mo.area(e)<0}static triangulateShape(e,t){const n=[],s=[],o=[];Fv(e),Kv(n,e);let r=e.length;t.forEach(Fv);for(let a=0;a<t.length;a++)s.push(r),r+=t[a].length,Kv(n,t[a]);const g=c3.triangulate(n,s);for(let a=0;a<g.length;a+=3)o.push(g.slice(a,a+3));return o}}function Fv(i){const e=i.length;e>2&&i[e-1].equals(i[0])&&i.pop()}function Kv(i,e){for(let t=0;t<e.length;t++)i.push(e[t].x),i.push(e[t].y)}class WC extends bt{constructor(e=new pa([new Se(.5,.5),new Se(-.5,.5),new Se(-.5,-.5),new Se(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,s=[],o=[];for(let g=0,a=e.length;g<a;g++){const l=e[g];r(l)}this.setAttribute("position",new tt(s,3)),this.setAttribute("uv",new tt(o,2)),this.computeVertexNormals();function r(g){const a=[],l=t.curveSegments!==void 0?t.curveSegments:12,I=t.steps!==void 0?t.steps:1,C=t.depth!==void 0?t.depth:1;let u=t.bevelEnabled!==void 0?t.bevelEnabled:!0,A=t.bevelThickness!==void 0?t.bevelThickness:.2,h=t.bevelSize!==void 0?t.bevelSize:A-.1,m=t.bevelOffset!==void 0?t.bevelOffset:0,b=t.bevelSegments!==void 0?t.bevelSegments:3;const G=t.extrudePath,f=t.UVGenerator!==void 0?t.UVGenerator:S3;let y,B=!1,v,W,R,Z;G&&(y=G.getSpacedPoints(I),B=!0,u=!1,v=G.computeFrenetFrames(I,!1),W=new N,R=new N,Z=new N),u||(b=0,A=0,h=0,m=0);const V=g.extractPoints(l);let H=V.shape;const P=V.holes;if(!mo.isClockWise(H)){H=H.reverse();for(let se=0,ue=P.length;se<ue;se++){const Ge=P[se];mo.isClockWise(Ge)&&(P[se]=Ge.reverse())}}const L=mo.triangulateShape(H,P),K=H;for(let se=0,ue=P.length;se<ue;se++){const Ge=P[se];H=H.concat(Ge)}function O(se,ue,Ge){return ue||console.error("THREE.ExtrudeGeometry: vec does not exist"),ue.clone().multiplyScalar(Ge).add(se)}const q=H.length,ne=L.length;function k(se,ue,Ge){let xe,fe,Qe;const de=se.x-ue.x,Xe=se.y-ue.y,Le=Ge.x-se.x,me=Ge.y-se.y,M=de*de+Xe*Xe,Y=de*me-Xe*Le;if(Math.abs(Y)>Number.EPSILON){const te=Math.sqrt(M),ce=Math.sqrt(Le*Le+me*me),we=ue.x-Xe/te,Re=ue.y+de/te,Ve=Ge.x-me/ce,We=Ge.y+Le/ce,he=((Ve-we)*me-(We-Re)*Le)/(de*me-Xe*Le);xe=we+de*he-se.x,fe=Re+Xe*he-se.y;const ze=xe*xe+fe*fe;if(ze<=2)return new Se(xe,fe);Qe=Math.sqrt(ze/2)}else{let te=!1;de>Number.EPSILON?Le>Number.EPSILON&&(te=!0):de<-Number.EPSILON?Le<-Number.EPSILON&&(te=!0):Math.sign(Xe)===Math.sign(me)&&(te=!0),te?(xe=-Xe,fe=de,Qe=Math.sqrt(M)):(xe=de,fe=Xe,Qe=Math.sqrt(M/2))}return new Se(xe/Qe,fe/Qe)}const F=[];for(let se=0,ue=K.length,Ge=ue-1,xe=se+1;se<ue;se++,Ge++,xe++)Ge===ue&&(Ge=0),xe===ue&&(xe=0),F[se]=k(K[se],K[Ge],K[xe]);const z=[];let X,T=F.concat();for(let se=0,ue=P.length;se<ue;se++){const Ge=P[se];X=[];for(let xe=0,fe=Ge.length,Qe=fe-1,de=xe+1;xe<fe;xe++,Qe++,de++)Qe===fe&&(Qe=0),de===fe&&(de=0),X[xe]=k(Ge[xe],Ge[Qe],Ge[de]);z.push(X),T=T.concat(X)}for(let se=0;se<b;se++){const ue=se/b,Ge=A*Math.cos(ue*Math.PI/2),xe=h*Math.sin(ue*Math.PI/2)+m;for(let fe=0,Qe=K.length;fe<Qe;fe++){const de=O(K[fe],F[fe],xe);ge(de.x,de.y,-Ge)}for(let fe=0,Qe=P.length;fe<Qe;fe++){const de=P[fe];X=z[fe];for(let Xe=0,Le=de.length;Xe<Le;Xe++){const me=O(de[Xe],X[Xe],xe);ge(me.x,me.y,-Ge)}}}const Q=h+m;for(let se=0;se<q;se++){const ue=u?O(H[se],T[se],Q):H[se];B?(R.copy(v.normals[0]).multiplyScalar(ue.x),W.copy(v.binormals[0]).multiplyScalar(ue.y),Z.copy(y[0]).add(R).add(W),ge(Z.x,Z.y,Z.z)):ge(ue.x,ue.y,0)}for(let se=1;se<=I;se++)for(let ue=0;ue<q;ue++){const Ge=u?O(H[ue],T[ue],Q):H[ue];B?(R.copy(v.normals[se]).multiplyScalar(Ge.x),W.copy(v.binormals[se]).multiplyScalar(Ge.y),Z.copy(y[se]).add(R).add(W),ge(Z.x,Z.y,Z.z)):ge(Ge.x,Ge.y,C/I*se)}for(let se=b-1;se>=0;se--){const ue=se/b,Ge=A*Math.cos(ue*Math.PI/2),xe=h*Math.sin(ue*Math.PI/2)+m;for(let fe=0,Qe=K.length;fe<Qe;fe++){const de=O(K[fe],F[fe],xe);ge(de.x,de.y,C+Ge)}for(let fe=0,Qe=P.length;fe<Qe;fe++){const de=P[fe];X=z[fe];for(let Xe=0,Le=de.length;Xe<Le;Xe++){const me=O(de[Xe],X[Xe],xe);B?ge(me.x,me.y+y[I-1].y,y[I-1].x+Ge):ge(me.x,me.y,C+Ge)}}}ee(),oe();function ee(){const se=s.length/3;if(u){let ue=0,Ge=q*ue;for(let xe=0;xe<ne;xe++){const fe=L[xe];Ie(fe[2]+Ge,fe[1]+Ge,fe[0]+Ge)}ue=I+b*2,Ge=q*ue;for(let xe=0;xe<ne;xe++){const fe=L[xe];Ie(fe[0]+Ge,fe[1]+Ge,fe[2]+Ge)}}else{for(let ue=0;ue<ne;ue++){const Ge=L[ue];Ie(Ge[2],Ge[1],Ge[0])}for(let ue=0;ue<ne;ue++){const Ge=L[ue];Ie(Ge[0]+q*I,Ge[1]+q*I,Ge[2]+q*I)}}n.addGroup(se,s.length/3-se,0)}function oe(){const se=s.length/3;let ue=0;j(K,ue),ue+=K.length;for(let Ge=0,xe=P.length;Ge<xe;Ge++){const fe=P[Ge];j(fe,ue),ue+=fe.length}n.addGroup(se,s.length/3-se,1)}function j(se,ue){let Ge=se.length;for(;--Ge>=0;){const xe=Ge;let fe=Ge-1;fe<0&&(fe=se.length-1);for(let Qe=0,de=I+b*2;Qe<de;Qe++){const Xe=q*Qe,Le=q*(Qe+1),me=ue+xe+Xe,M=ue+fe+Xe,Y=ue+fe+Le,te=ue+xe+Le;Be(me,M,Y,te)}}}function ge(se,ue,Ge){a.push(se),a.push(ue),a.push(Ge)}function Ie(se,ue,Ge){ve(se),ve(ue),ve(Ge);const xe=s.length/3,fe=f.generateTopUV(n,s,xe-3,xe-2,xe-1);Ye(fe[0]),Ye(fe[1]),Ye(fe[2])}function Be(se,ue,Ge,xe){ve(se),ve(ue),ve(xe),ve(ue),ve(Ge),ve(xe);const fe=s.length/3,Qe=f.generateSideWallUV(n,s,fe-6,fe-3,fe-2,fe-1);Ye(Qe[0]),Ye(Qe[1]),Ye(Qe[3]),Ye(Qe[1]),Ye(Qe[2]),Ye(Qe[3])}function ve(se){s.push(a[se*3+0]),s.push(a[se*3+1]),s.push(a[se*3+2])}function Ye(se){o.push(se.x),o.push(se.y)}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return R3(t,n,e)}static fromJSON(e,t){const n=[];for(let o=0,r=e.shapes.length;o<r;o++){const g=t[e.shapes[o]];n.push(g)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new Ub[s.type]().fromJSON(s)),new WC(n,e.options)}}const S3={generateTopUV:function(i,e,t,n,s){const o=e[t*3],r=e[t*3+1],g=e[n*3],a=e[n*3+1],l=e[s*3],I=e[s*3+1];return[new Se(o,r),new Se(g,a),new Se(l,I)]},generateSideWallUV:function(i,e,t,n,s,o){const r=e[t*3],g=e[t*3+1],a=e[t*3+2],l=e[n*3],I=e[n*3+1],C=e[n*3+2],u=e[s*3],A=e[s*3+1],h=e[s*3+2],m=e[o*3],b=e[o*3+1],G=e[o*3+2];return Math.abs(g-I)<Math.abs(r-l)?[new Se(r,1-a),new Se(l,1-C),new Se(u,1-h),new Se(m,1-G)]:[new Se(g,1-a),new Se(I,1-C),new Se(A,1-h),new Se(b,1-G)]}};function R3(i,e,t){if(t.shapes=[],Array.isArray(i))for(let n=0,s=i.length;n<s;n++){const o=i[n];t.shapes.push(o.uuid)}else t.shapes.push(i.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class SC extends pr{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new SC(e.radius,e.detail)}}class rI extends pr{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new rI(e.radius,e.detail)}}class RC extends bt{constructor(e=.5,t=1,n=8,s=1,o=0,r=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:s,thetaStart:o,thetaLength:r},n=Math.max(3,n),s=Math.max(1,s);const g=[],a=[],l=[],I=[];let C=e;const u=(t-e)/s,A=new N,h=new Se;for(let m=0;m<=s;m++){for(let b=0;b<=n;b++){const G=o+b/n*r;A.x=C*Math.cos(G),A.y=C*Math.sin(G),a.push(A.x,A.y,A.z),l.push(0,0,1),h.x=(A.x/t+1)/2,h.y=(A.y/t+1)/2,I.push(h.x,h.y)}C+=u}for(let m=0;m<s;m++){const b=m*(n+1);for(let G=0;G<n;G++){const f=G+b,y=f,B=f+n+1,v=f+n+2,W=f+1;g.push(y,B,W),g.push(B,v,W)}}this.setIndex(g),this.setAttribute("position",new tt(a,3)),this.setAttribute("normal",new tt(l,3)),this.setAttribute("uv",new tt(I,2))}static fromJSON(e){return new RC(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class VC extends bt{constructor(e=new pa([new Se(0,.5),new Se(-.5,-.5),new Se(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],s=[],o=[],r=[];let g=0,a=0;if(Array.isArray(e)===!1)l(e);else for(let I=0;I<e.length;I++)l(e[I]),this.addGroup(g,a,I),g+=a,a=0;this.setIndex(n),this.setAttribute("position",new tt(s,3)),this.setAttribute("normal",new tt(o,3)),this.setAttribute("uv",new tt(r,2));function l(I){const C=s.length/3,u=I.extractPoints(t);let A=u.shape;const h=u.holes;mo.isClockWise(A)===!1&&(A=A.reverse());for(let b=0,G=h.length;b<G;b++){const f=h[b];mo.isClockWise(f)===!0&&(h[b]=f.reverse())}const m=mo.triangulateShape(A,h);for(let b=0,G=h.length;b<G;b++){const f=h[b];A=A.concat(f)}for(let b=0,G=A.length;b<G;b++){const f=A[b];s.push(f.x,f.y,0),o.push(0,0,1),r.push(f.x,f.y)}for(let b=0,G=m.length;b<G;b++){const f=m[b],y=f[0]+C,B=f[1]+C,v=f[2]+C;n.push(y,B,v),a+=3}}}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return V3(t,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const r=t[e.shapes[s]];n.push(r)}return new VC(n,e.curveSegments)}}function V3(i,e){if(e.shapes=[],Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const s=i[t];e.shapes.push(s.uuid)}else e.shapes.push(i.uuid);return e}class gI extends bt{constructor(e=1,t=32,n=16,s=0,o=Math.PI*2,r=0,g=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:s,phiLength:o,thetaStart:r,thetaLength:g},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(r+g,Math.PI);let l=0;const I=[],C=new N,u=new N,A=[],h=[],m=[],b=[];for(let G=0;G<=n;G++){const f=[],y=G/n;let B=0;G==0&&r==0?B=.5/t:G==n&&a==Math.PI&&(B=-.5/t);for(let v=0;v<=t;v++){const W=v/t;C.x=-e*Math.cos(s+W*o)*Math.sin(r+y*g),C.y=e*Math.cos(r+y*g),C.z=e*Math.sin(s+W*o)*Math.sin(r+y*g),h.push(C.x,C.y,C.z),u.copy(C).normalize(),m.push(u.x,u.y,u.z),b.push(W+B,1-y),f.push(l++)}I.push(f)}for(let G=0;G<n;G++)for(let f=0;f<t;f++){const y=I[G][f+1],B=I[G][f],v=I[G+1][f],W=I[G+1][f+1];(G!==0||r>0)&&A.push(y,B,W),(G!==n-1||a<Math.PI)&&A.push(B,v,W)}this.setIndex(A),this.setAttribute("position",new tt(h,3)),this.setAttribute("normal",new tt(m,3)),this.setAttribute("uv",new tt(b,2))}static fromJSON(e){return new gI(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class xC extends pr{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new xC(e.radius,e.detail)}}class XC extends bt{constructor(e=1,t=.4,n=8,s=6,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:s,arc:o},n=Math.floor(n),s=Math.floor(s);const r=[],g=[],a=[],l=[],I=new N,C=new N,u=new N;for(let A=0;A<=n;A++)for(let h=0;h<=s;h++){const m=h/s*o,b=A/n*Math.PI*2;C.x=(e+t*Math.cos(b))*Math.cos(m),C.y=(e+t*Math.cos(b))*Math.sin(m),C.z=t*Math.sin(b),g.push(C.x,C.y,C.z),I.x=e*Math.cos(m),I.y=e*Math.sin(m),u.subVectors(C,I).normalize(),a.push(u.x,u.y,u.z),l.push(h/s),l.push(A/n)}for(let A=1;A<=n;A++)for(let h=1;h<=s;h++){const m=(s+1)*A+h-1,b=(s+1)*(A-1)+h-1,G=(s+1)*(A-1)+h,f=(s+1)*A+h;r.push(m,b,f),r.push(b,G,f)}this.setIndex(r),this.setAttribute("position",new tt(g,3)),this.setAttribute("normal",new tt(a,3)),this.setAttribute("uv",new tt(l,2))}static fromJSON(e){return new XC(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class YC extends bt{constructor(e=1,t=.4,n=64,s=8,o=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:s,p:o,q:r},n=Math.floor(n),s=Math.floor(s);const g=[],a=[],l=[],I=[],C=new N,u=new N,A=new N,h=new N,m=new N,b=new N,G=new N;for(let y=0;y<=n;++y){const B=y/n*o*Math.PI*2;f(B,o,r,e,A),f(B+.01,o,r,e,h),b.subVectors(h,A),G.addVectors(h,A),m.crossVectors(b,G),G.crossVectors(m,b),m.normalize(),G.normalize();for(let v=0;v<=s;++v){const W=v/s*Math.PI*2,R=-t*Math.cos(W),Z=t*Math.sin(W);C.x=A.x+(R*G.x+Z*m.x),C.y=A.y+(R*G.y+Z*m.y),C.z=A.z+(R*G.z+Z*m.z),a.push(C.x,C.y,C.z),u.subVectors(C,A).normalize(),l.push(u.x,u.y,u.z),I.push(y/n),I.push(v/s)}}for(let y=1;y<=n;y++)for(let B=1;B<=s;B++){const v=(s+1)*(y-1)+(B-1),W=(s+1)*y+(B-1),R=(s+1)*y+B,Z=(s+1)*(y-1)+B;g.push(v,W,Z),g.push(W,R,Z)}this.setIndex(g),this.setAttribute("position",new tt(a,3)),this.setAttribute("normal",new tt(l,3)),this.setAttribute("uv",new tt(I,2));function f(y,B,v,W,R){const Z=Math.cos(y),V=Math.sin(y),H=v/B*y,P=Math.cos(H);R.x=W*(2+P)*.5*Z,R.y=W*(2+P)*V*.5,R.z=W*Math.sin(H)*.5}}static fromJSON(e){return new YC(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class HC extends bt{constructor(e=new _b(new N(-1,-1,0),new N(-1,1,0),new N(1,1,0)),t=64,n=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:s,closed:o};const r=e.computeFrenetFrames(t,o);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const g=new N,a=new N,l=new Se;let I=new N;const C=[],u=[],A=[],h=[];m(),this.setIndex(h),this.setAttribute("position",new tt(C,3)),this.setAttribute("normal",new tt(u,3)),this.setAttribute("uv",new tt(A,2));function m(){for(let y=0;y<t;y++)b(y);b(o===!1?t:0),f(),G()}function b(y){I=e.getPointAt(y/t,I);const B=r.normals[y],v=r.binormals[y];for(let W=0;W<=s;W++){const R=W/s*Math.PI*2,Z=Math.sin(R),V=-Math.cos(R);a.x=V*B.x+Z*v.x,a.y=V*B.y+Z*v.y,a.z=V*B.z+Z*v.z,a.normalize(),u.push(a.x,a.y,a.z),g.x=I.x+n*a.x,g.y=I.y+n*a.y,g.z=I.z+n*a.z,C.push(g.x,g.y,g.z)}}function G(){for(let y=1;y<=t;y++)for(let B=1;B<=s;B++){const v=(s+1)*(y-1)+(B-1),W=(s+1)*y+(B-1),R=(s+1)*y+B,Z=(s+1)*(y-1)+B;h.push(v,W,Z),h.push(W,R,Z)}}function f(){for(let y=0;y<=t;y++)for(let B=0;B<=s;B++)l.x=y/t,l.y=B/s,A.push(l.x,l.y)}}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new HC(new Ub[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class kS extends bt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,s=new N,o=new N;if(e.index!==null){const r=e.attributes.position,g=e.index;let a=e.groups;a.length===0&&(a=[{start:0,count:g.count,materialIndex:0}]);for(let l=0,I=a.length;l<I;++l){const C=a[l],u=C.start,A=C.count;for(let h=u,m=u+A;h<m;h+=3)for(let b=0;b<3;b++){const G=g.getX(h+b),f=g.getX(h+(b+1)%3);s.fromBufferAttribute(r,G),o.fromBufferAttribute(r,f),Nv(s,o,n)===!0&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}}else{const r=e.attributes.position;for(let g=0,a=r.count/3;g<a;g++)for(let l=0;l<3;l++){const I=3*g+l,C=3*g+(l+1)%3;s.fromBufferAttribute(r,I),o.fromBufferAttribute(r,C),Nv(s,o,n)===!0&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new tt(t,3))}}}function Nv(i,e,t){const n=`${i.x},${i.y},${i.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${i.x},${i.y},${i.z}`;return t.has(n)===!0||t.has(s)===!0?!1:(t.add(n),t.add(s),!0)}var Mv=Object.freeze({__proto__:null,BoxGeometry:hr,CapsuleGeometry:BC,CircleGeometry:vC,ConeGeometry:ZC,CylinderGeometry:Ra,DodecahedronGeometry:wC,EdgesGeometry:NS,ExtrudeGeometry:WC,IcosahedronGeometry:SC,LatheGeometry:oI,OctahedronGeometry:rI,PlaneGeometry:nI,PolyhedronGeometry:pr,RingGeometry:RC,ShapeGeometry:VC,SphereGeometry:gI,TetrahedronGeometry:xC,TorusGeometry:XC,TorusKnotGeometry:YC,TubeGeometry:HC,WireframeGeometry:kS});class TS extends Tn{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Ee(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class ES extends Ds{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class aI extends Tn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ee(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class mr extends aI{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Se(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Rn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Ee(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Ee(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ee(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class _S extends Tn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Ee(16777215),this.specular=new Ee(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class JS extends Tn{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ee(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class US extends Tn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class DS extends Tn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Ee(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ee(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=pC,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class PS extends Tn{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ee(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ur,this.normalScale=new Se(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class QS extends bi{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function us(i,e,t){return Db(i)?new i.constructor(i.subarray(e,t!==void 0?t:i.length)):i.slice(e,t)}function aa(i,e,t){return!i||!t&&i.constructor===e?i:typeof e.BYTES_PER_ELEMENT=="number"?new e(i):Array.prototype.slice.call(i)}function Db(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function OS(i){function e(s,o){return i[s]-i[o]}const t=i.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n}function a0(i,e,t){const n=i.length,s=new i.constructor(n);for(let o=0,r=0;r!==n;++o){const g=t[o]*e;for(let a=0;a!==e;++a)s[r++]=i[g+a]}return s}function Pb(i,e,t,n){let s=1,o=i[0];for(;o!==void 0&&o[n]===void 0;)o=i[s++];if(o===void 0)return;let r=o[n];if(r!==void 0)if(Array.isArray(r))do r=o[n],r!==void 0&&(e.push(o.time),t.push.apply(t,r)),o=i[s++];while(o!==void 0);else if(r.toArray!==void 0)do r=o[n],r!==void 0&&(e.push(o.time),r.toArray(t,t.length)),o=i[s++];while(o!==void 0);else do r=o[n],r!==void 0&&(e.push(o.time),t.push(r)),o=i[s++];while(o!==void 0)}function x3(i,e,t,n,s=30){const o=i.clone();o.name=e;const r=[];for(let a=0;a<o.tracks.length;++a){const l=o.tracks[a],I=l.getValueSize(),C=[],u=[];for(let A=0;A<l.times.length;++A){const h=l.times[A]*s;if(!(h<t||h>=n)){C.push(l.times[A]);for(let m=0;m<I;++m)u.push(l.values[A*I+m])}}C.length!==0&&(l.times=aa(C,l.times.constructor),l.values=aa(u,l.values.constructor),r.push(l))}o.tracks=r;let g=1/0;for(let a=0;a<o.tracks.length;++a)g>o.tracks[a].times[0]&&(g=o.tracks[a].times[0]);for(let a=0;a<o.tracks.length;++a)o.tracks[a].shift(-1*g);return o.resetDuration(),o}function X3(i,e=0,t=i,n=30){n<=0&&(n=30);const s=t.tracks.length,o=e/n;for(let r=0;r<s;++r){const g=t.tracks[r],a=g.ValueTypeName;if(a==="bool"||a==="string")continue;const l=i.tracks.find(function(G){return G.name===g.name&&G.ValueTypeName===a});if(l===void 0)continue;let I=0;const C=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(I=C/3);let u=0;const A=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=A/3);const h=g.times.length-1;let m;if(o<=g.times[0]){const G=I,f=C-I;m=us(g.values,G,f)}else if(o>=g.times[h]){const G=h*C+I,f=G+C-I;m=us(g.values,G,f)}else{const G=g.createInterpolant(),f=I,y=C-I;G.evaluate(o),m=us(G.resultBuffer,f,y)}a==="quaternion"&&new Qn().fromArray(m).normalize().conjugate().toArray(m);const b=l.times.length;for(let G=0;G<b;++G){const f=G*A+u;if(a==="quaternion")Qn.multiplyQuaternionsFlat(l.values,f,m,0,l.values,f);else{const y=A-u*2;for(let B=0;B<y;++B)l.values[f+B]-=m[B]}}}return i.blendMode=wb,i}var Y3=Object.freeze({__proto__:null,arraySlice:us,convertArray:aa,isTypedArray:Db,getKeyframeOrder:OS,sortedArray:a0,flattenJSON:Pb,subclip:x3,makeClipAdditive:X3});class lI{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,s=t[n],o=t[n-1];e:{t:{let r;n:{i:if(!(e<s)){for(let g=n+2;;){if(s===void 0){if(e<o)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===g)break;if(o=s,s=t[++n],e<s)break t}r=t.length;break n}if(!(e>=o)){const g=t[1];e<g&&(n=2,o=g);for(let a=n-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===a)break;if(s=o,o=t[--n-1],e>=o)break t}r=n,n=0;break n}break e}for(;n<r;){const g=n+r>>>1;e<t[g]?r=g:n=g+1}if(s=t[n],o=t[n-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,o,s)}return this.interpolate_(n,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s;for(let r=0;r!==s;++r)t[r]=n[o+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class jS extends lI{constructor(e,t,n,s){super(e,t,n,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:oa,endingEnd:oa}}intervalChanged_(e,t,n){const s=this.parameterPositions;let o=e-2,r=e+1,g=s[o],a=s[r];if(g===void 0)switch(this.getSettings_().endingStart){case ra:o=e,g=2*t-n;break;case eC:o=s.length-2,g=t+s[o]-s[o+1];break;default:o=e,g=n}if(a===void 0)switch(this.getSettings_().endingEnd){case ra:r=e,a=2*n-t;break;case eC:r=1,a=n+s[1]-s[0];break;default:r=e-1,a=t}const l=(n-t)*.5,I=this.valueSize;this._weightPrev=l/(t-g),this._weightNext=l/(a-n),this._offsetPrev=o*I,this._offsetNext=r*I}interpolate_(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,I=this._offsetPrev,C=this._offsetNext,u=this._weightPrev,A=this._weightNext,h=(n-t)/(s-t),m=h*h,b=m*h,G=-u*b+2*u*m-u*h,f=(1+u)*b+(-1.5-2*u)*m+(-.5+u)*h+1,y=(-1-A)*b+(1.5+A)*m+.5*h,B=A*b-A*m;for(let v=0;v!==g;++v)o[v]=G*r[I+v]+f*r[l+v]+y*r[a+v]+B*r[C+v];return o}}class Qb extends lI{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=e*g,l=a-g,I=(n-t)/(s-t),C=1-I;for(let u=0;u!==g;++u)o[u]=r[l+u]*C+r[a+u]*I;return o}}class qS extends lI{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Os{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=aa(t,this.TimeBufferType),this.values=aa(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:aa(e.times,Array),values:aa(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new qS(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Qb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new jS(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ul:t=this.InterpolantFactoryMethodDiscrete;break;case va:t=this.InterpolantFactoryMethodLinear;break;case Od:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ul;case this.InterpolantFactoryMethodLinear:return va;case this.InterpolantFactoryMethodSmooth:return Od}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){const n=this.times,s=n.length;let o=0,r=s-1;for(;o!==s&&n[o]<e;)++o;for(;r!==-1&&n[r]>t;)--r;if(++r,o!==0||r!==s){o>=r&&(r=Math.max(r,1),o=r-1);const g=this.getValueSize();this.times=us(n,o,r),this.values=us(this.values,o*g,r*g)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,s=this.values,o=n.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let g=0;g!==o;g++){const a=n[g];if(typeof a=="number"&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,g,a),e=!1;break}if(r!==null&&r>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,g,a,r),e=!1;break}r=a}if(s!==void 0&&Db(s))for(let g=0,a=s.length;g!==a;++g){const l=s[g];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,g,l),e=!1;break}}return e}optimize(){const e=us(this.times),t=us(this.values),n=this.getValueSize(),s=this.getInterpolation()===Od,o=e.length-1;let r=1;for(let g=1;g<o;++g){let a=!1;const l=e[g],I=e[g+1];if(l!==I&&(g!==1||l!==e[0]))if(s)a=!0;else{const C=g*n,u=C-n,A=C+n;for(let h=0;h!==n;++h){const m=t[C+h];if(m!==t[u+h]||m!==t[A+h]){a=!0;break}}}if(a){if(g!==r){e[r]=e[g];const C=g*n,u=r*n;for(let A=0;A!==n;++A)t[u+A]=t[C+A]}++r}}if(o>0){e[r]=e[o];for(let g=o*n,a=r*n,l=0;l!==n;++l)t[a+l]=t[g+l];++r}return r!==e.length?(this.times=us(e,0,r),this.values=us(t,0,r*n)):(this.times=e,this.values=t),this}clone(){const e=us(this.times,0),t=us(this.values,0),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Os.prototype.TimeBufferType=Float32Array;Os.prototype.ValueBufferType=Float32Array;Os.prototype.DefaultInterpolation=va;class Va extends Os{}Va.prototype.ValueTypeName="bool";Va.prototype.ValueBufferType=Array;Va.prototype.DefaultInterpolation=Ul;Va.prototype.InterpolantFactoryMethodLinear=void 0;Va.prototype.InterpolantFactoryMethodSmooth=void 0;class Ob extends Os{}Ob.prototype.ValueTypeName="color";class Ql extends Os{}Ql.prototype.ValueTypeName="number";class $S extends lI{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=(n-t)/(s-t);let l=e*g;for(let I=l+g;l!==I;l+=4)Qn.slerpFlat(o,0,r,l-g,r,l,a);return o}}class Bg extends Os{InterpolantFactoryMethodLinear(e){return new $S(this.times,this.values,this.getValueSize(),e)}}Bg.prototype.ValueTypeName="quaternion";Bg.prototype.DefaultInterpolation=va;Bg.prototype.InterpolantFactoryMethodSmooth=void 0;class xa extends Os{}xa.prototype.ValueTypeName="string";xa.prototype.ValueBufferType=Array;xa.prototype.DefaultInterpolation=Ul;xa.prototype.InterpolantFactoryMethodLinear=void 0;xa.prototype.InterpolantFactoryMethodSmooth=void 0;class Ol extends Os{}Ol.prototype.ValueTypeName="vector";class jl{constructor(e,t=-1,n,s=qA){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=ts(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,s=1/(e.fps||1);for(let r=0,g=n.length;r!==g;++r)t.push(F3(n[r]).scale(s));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,r=n.length;o!==r;++o)t.push(Os.toJSON(n[o]));return s}static CreateFromMorphTargetSequence(e,t,n,s){const o=t.length,r=[];for(let g=0;g<o;g++){let a=[],l=[];a.push((g+o-1)%o,g,(g+1)%o),l.push(0,1,0);const I=OS(a);a=a0(a,1,I),l=a0(l,1,I),!s&&a[0]===0&&(a.push(o),l.push(l[0])),r.push(new Ql(".morphTargetInfluences["+t[g].name+"]",a,l).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const s={},o=/^([\w-]*?)([\d]+)$/;for(let g=0,a=e.length;g<a;g++){const l=e[g],I=l.name.match(o);if(I&&I.length>1){const C=I[1];let u=s[C];u||(s[C]=u=[]),u.push(l)}}const r=[];for(const g in s)r.push(this.CreateFromMorphTargetSequence(g,s[g],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(C,u,A,h,m){if(A.length!==0){const b=[],G=[];Pb(A,b,G,h),b.length!==0&&m.push(new C(u,b,G))}},s=[],o=e.name||"default",r=e.fps||30,g=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let C=0;C<l.length;C++){const u=l[C].keys;if(!(!u||u.length===0))if(u[0].morphTargets){const A={};let h;for(h=0;h<u.length;h++)if(u[h].morphTargets)for(let m=0;m<u[h].morphTargets.length;m++)A[u[h].morphTargets[m]]=-1;for(const m in A){const b=[],G=[];for(let f=0;f!==u[h].morphTargets.length;++f){const y=u[h];b.push(y.time),G.push(y.morphTarget===m?1:0)}s.push(new Ql(".morphTargetInfluence["+m+"]",b,G))}a=A.length*r}else{const A=".bones["+t[C].name+"]";n(Ol,A+".position",u,"pos",s),n(Bg,A+".quaternion",u,"rot",s),n(Ol,A+".scale",u,"scl",s)}}return s.length===0?null:new this(o,a,s,g)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,s=e.length;n!==s;++n){const o=this.tracks[n];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function H3(i){switch(i.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ql;case"vector":case"vector2":case"vector3":case"vector4":return Ol;case"color":return Ob;case"quaternion":return Bg;case"bool":case"boolean":return Va;case"string":return xa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+i)}function F3(i){if(i.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=H3(i.type);if(i.times===void 0){const t=[],n=[];Pb(i.keys,t,n,"value"),i.times=t,i.values=n}return e.parse!==void 0?e.parse(i):new e(i.name,i.times,i.values,i.interpolation)}const wa={enabled:!1,files:{},add:function(i,e){this.enabled!==!1&&(this.files[i]=e)},get:function(i){if(this.enabled!==!1)return this.files[i]},remove:function(i){delete this.files[i]},clear:function(){this.files={}}};class jb{constructor(e,t,n){const s=this;let o=!1,r=0,g=0,a;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(I){g++,o===!1&&s.onStart!==void 0&&s.onStart(I,r,g),o=!0},this.itemEnd=function(I){r++,s.onProgress!==void 0&&s.onProgress(I,r,g),r===g&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(I){s.onError!==void 0&&s.onError(I)},this.resolveURL=function(I){return a?a(I):I},this.setURLModifier=function(I){return a=I,this},this.addHandler=function(I,C){return l.push(I,C),this},this.removeHandler=function(I){const C=l.indexOf(I);return C!==-1&&l.splice(C,2),this},this.getHandler=function(I){for(let C=0,u=l.length;C<u;C+=2){const A=l[C],h=l[C+1];if(A.global&&(A.lastIndex=0),A.test(I))return h}return null}}}const eR=new jb;class Yi{constructor(e){this.manager=e!==void 0?e:eR,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(s,o){n.load(e,s,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const To={};class K3 extends Error{constructor(e,t){super(e),this.response=t}}class is extends Yi{constructor(e){super(e)}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=wa.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(To[e]!==void 0){To[e].push({onLoad:t,onProgress:n,onError:s});return}To[e]=[],To[e].push({onLoad:t,onProgress:n,onError:s});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),g=this.mimeType,a=this.responseType;fetch(r).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const I=To[e],C=l.body.getReader(),u=l.headers.get("Content-Length"),A=u?parseInt(u):0,h=A!==0;let m=0;const b=new ReadableStream({start(G){f();function f(){C.read().then(({done:y,value:B})=>{if(y)G.close();else{m+=B.byteLength;const v=new ProgressEvent("progress",{lengthComputable:h,loaded:m,total:A});for(let W=0,R=I.length;W<R;W++){const Z=I[W];Z.onProgress&&Z.onProgress(v)}G.enqueue(B),f()}})}}});return new Response(b)}else throw new K3(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(a){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(I=>new DOMParser().parseFromString(I,g));case"json":return l.json();default:if(g===void 0)return l.text();{const C=/charset="?([^;"\s]*)"?/i.exec(g),u=C&&C[1]?C[1].toLowerCase():void 0,A=new TextDecoder(u);return l.arrayBuffer().then(h=>A.decode(h))}}}).then(l=>{wa.add(e,l);const I=To[e];delete To[e];for(let C=0,u=I.length;C<u;C++){const A=I[C];A.onLoad&&A.onLoad(l)}}).catch(l=>{const I=To[e];if(I===void 0)throw this.manager.itemError(e),l;delete To[e];for(let C=0,u=I.length;C<u;C++){const A=I[C];A.onError&&A.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class N3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=new is(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(g){try{t(o.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),o.manager.itemError(e)}},n,s)}parse(e){const t=[];for(let n=0;n<e.length;n++){const s=jl.parse(e[n]);t.push(s)}return t}}class M3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=[],g=new xS,a=new is(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(o.withCredentials);let l=0;function I(C){a.load(e[C],function(u){const A=o.parse(u,!0);r[C]={width:A.width,height:A.height,format:A.format,mipmaps:A.mipmaps},l+=1,l===6&&(A.mipmapCount===1&&(g.minFilter=en),g.image=r,g.format=A.format,g.needsUpdate=!0,t&&t(g))},n,s)}if(Array.isArray(e))for(let C=0,u=e.length;C<u;++C)I(C);else a.load(e,function(C){const u=o.parse(C,!0);if(u.isCubemap){const A=u.mipmaps.length/u.mipmapCount;for(let h=0;h<A;h++){r[h]={mipmaps:[]};for(let m=0;m<u.mipmapCount;m++)r[h].mipmaps.push(u.mipmaps[h*u.mipmapCount+m]),r[h].format=u.format,r[h].width=u.width,r[h].height=u.height}g.image=r}else g.image.width=u.width,g.image.height=u.height,g.mipmaps=u.mipmaps;u.mipmapCount===1&&(g.minFilter=en),g.format=u.format,g.needsUpdate=!0,t&&t(g)},n,s);return g}}class aC extends Yi{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=wa.get(e);if(r!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(r),o.manager.itemEnd(e)},0),r;const g=iC("img");function a(){I(),wa.add(e,this),t&&t(this),o.manager.itemEnd(e)}function l(C){I(),s&&s(C),o.manager.itemError(e),o.manager.itemEnd(e)}function I(){g.removeEventListener("load",a,!1),g.removeEventListener("error",l,!1)}return g.addEventListener("load",a,!1),g.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(g.crossOrigin=this.crossOrigin),o.manager.itemStart(e),g.src=e,g}}class L3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=new bC,r=new aC(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let g=0;function a(l){r.load(e[l],function(I){o.images[l]=I,g++,g===6&&(o.needsUpdate=!0,t&&t(o))},void 0,s)}for(let l=0;l<e.length;++l)a(l);return o}}class z3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=new Hl,g=new is(this.manager);return g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(o.withCredentials),g.load(e,function(a){const l=o.parse(a);!l||(l.image!==void 0?r.image=l.image:l.data!==void 0&&(r.image.width=l.width,r.image.height=l.height,r.image.data=l.data),r.wrapS=l.wrapS!==void 0?l.wrapS:mi,r.wrapT=l.wrapT!==void 0?l.wrapT:mi,r.magFilter=l.magFilter!==void 0?l.magFilter:en,r.minFilter=l.minFilter!==void 0?l.minFilter:en,r.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.encoding!==void 0&&(r.encoding=l.encoding),l.flipY!==void 0&&(r.flipY=l.flipY),l.format!==void 0&&(r.format=l.format),l.type!==void 0&&(r.type=l.type),l.mipmaps!==void 0&&(r.mipmaps=l.mipmaps,r.minFilter=Cr),l.mipmapCount===1&&(r.minFilter=en),l.generateMipmaps!==void 0&&(r.generateMipmaps=l.generateMipmaps),r.needsUpdate=!0,t&&t(r,l))},n,s),r}}class qb extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=new Cn,r=new aC(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,function(g){o.image=g,o.needsUpdate=!0,t!==void 0&&t(o)},n,s),o}}class Sg extends St{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Ee(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}class tR extends Sg{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.groundColor=new Ee(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const hm=new dt,Lv=new N,zv=new N;class $b{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Se(512,512),this.map=null,this.mapPass=null,this.matrix=new dt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new th,this._frameExtents=new Se(1,1),this._viewportCount=1,this._viewports=[new Ht(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Lv.setFromMatrixPosition(e.matrixWorld),t.position.copy(Lv),zv.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(zv),t.updateMatrixWorld(),hm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hm),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(hm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class k3 extends $b{constructor(){super(new zn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=nC*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(n!==t.fov||s!==t.aspect||o!==t.far)&&(t.fov=n,t.aspect=s,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class eG extends Sg{constructor(e,t,n=0,s=Math.PI/3,o=0,r=1){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.target=new St,this.distance=n,this.angle=s,this.penumbra=o,this.decay=r,this.map=null,this.shadow=new k3}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const kv=new dt,ic=new N,pm=new N;class T3 extends $b{constructor(){super(new zn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Se(4,2),this._viewportCount=6,this._viewports=[new Ht(2,1,1,1),new Ht(0,1,1,1),new Ht(3,1,1,1),new Ht(1,1,1,1),new Ht(3,0,1,1),new Ht(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,s=this.matrix,o=e.distance||n.far;o!==n.far&&(n.far=o,n.updateProjectionMatrix()),ic.setFromMatrixPosition(e.matrixWorld),n.position.copy(ic),pm.copy(n.position),pm.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(pm),n.updateMatrixWorld(),s.makeTranslation(-ic.x,-ic.y,-ic.z),kv.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(kv)}}class tG extends Sg{constructor(e,t,n=0,s=1){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new T3}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class E3 extends $b{constructor(){super(new iI(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nG extends Sg{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.target=new St,this.shadow=new E3}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class nR extends Sg{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class iR extends Sg{constructor(e,t,n=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class sR{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new N)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,s=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*s),t.addScaledVector(r[2],.488603*o),t.addScaledVector(r[3],.488603*n),t.addScaledVector(r[4],1.092548*(n*s)),t.addScaledVector(r[5],1.092548*(s*o)),t.addScaledVector(r[6],.315392*(3*o*o-1)),t.addScaledVector(r[7],1.092548*(n*o)),t.addScaledVector(r[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){const n=e.x,s=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],2*.511664*s),t.addScaledVector(r[2],2*.511664*o),t.addScaledVector(r[3],2*.511664*n),t.addScaledVector(r[4],2*.429043*n*s),t.addScaledVector(r[5],2*.429043*s*o),t.addScaledVector(r[6],.743125*o*o-.247708),t.addScaledVector(r[7],2*.429043*n*o),t.addScaledVector(r[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const n=e.x,s=e.y,o=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*o,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*n*o,t[8]=.546274*(n*n-s*s)}}class Ch extends Sg{constructor(e=new sR,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class uh extends Yi{constructor(e){super(e),this.textures={}}load(e,t,n,s){const o=this,r=new is(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,function(g){try{t(o.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),o.manager.itemError(e)}},n,s)}parse(e){const t=this.textures;function n(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const s=uh.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new Ee().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==1&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const r=e.uniforms[o];switch(s.uniforms[o]={},r.type){case"t":s.uniforms[o].value=n(r.value);break;case"c":s.uniforms[o].value=new Ee().setHex(r.value);break;case"v2":s.uniforms[o].value=new Se().fromArray(r.value);break;case"v3":s.uniforms[o].value=new N().fromArray(r.value);break;case"v4":s.uniforms[o].value=new Ht().fromArray(r.value);break;case"m3":s.uniforms[o].value=new Si().fromArray(r.value);break;case"m4":s.uniforms[o].value=new dt().fromArray(r.value);break;default:s.uniforms[o].value=r.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)s.extensions[o]=e.extensions[o];if(e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=n(e.map)),e.matcap!==void 0&&(s.matcap=n(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),s.normalScale=new Se().fromArray(o)}return e.displacementMap!==void 0&&(s.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=n(e.envMap)),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new Se().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=n(e.thicknessMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=n(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}static createMaterialFromType(e){const t={ShadowMaterial:TS,SpriteMaterial:Nb,RawShaderMaterial:ES,ShaderMaterial:Ds,PointsMaterial:ah,MeshPhysicalMaterial:mr,MeshStandardMaterial:aI,MeshPhongMaterial:_S,MeshToonMaterial:JS,MeshNormalMaterial:US,MeshLambertMaterial:DS,MeshDepthMaterial:ih,MeshDistanceMaterial:sh,MeshBasicMaterial:Ji,MeshMatcapMaterial:PS,LineDashedMaterial:QS,LineBasicMaterial:bi,Material:Tn};return new t[e]}}class fo{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class iG extends bt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class oR extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=new is(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,function(g){try{t(o.parse(JSON.parse(g)))}catch(a){s?s(a):console.error(a),o.manager.itemError(e)}},n,s)}parse(e){const t={},n={};function s(A,h){if(t[h]!==void 0)return t[h];const b=A.interleavedBuffers[h],G=o(A,b.buffer),f=vl(b.type,G),y=new GC(f,b.stride);return y.uuid=b.uuid,t[h]=y,y}function o(A,h){if(n[h]!==void 0)return n[h];const b=A.arrayBuffers[h],G=new Uint32Array(b).buffer;return n[h]=G,G}const r=e.isInstancedBufferGeometry?new iG:new bt,g=e.data.index;if(g!==void 0){const A=vl(g.type,g.array);r.setIndex(new Ft(A,1))}const a=e.data.attributes;for(const A in a){const h=a[A];let m;if(h.isInterleavedBufferAttribute){const b=s(e.data,h.data);m=new Gg(b,h.itemSize,h.offset,h.normalized)}else{const b=vl(h.type,h.array),G=h.isInstancedBufferAttribute?Za:Ft;m=new G(b,h.itemSize,h.normalized)}h.name!==void 0&&(m.name=h.name),h.usage!==void 0&&m.setUsage(h.usage),h.updateRange!==void 0&&(m.updateRange.offset=h.updateRange.offset,m.updateRange.count=h.updateRange.count),r.setAttribute(A,m)}const l=e.data.morphAttributes;if(l)for(const A in l){const h=l[A],m=[];for(let b=0,G=h.length;b<G;b++){const f=h[b];let y;if(f.isInterleavedBufferAttribute){const B=s(e.data,f.data);y=new Gg(B,f.itemSize,f.offset,f.normalized)}else{const B=vl(f.type,f.array);y=new Ft(B,f.itemSize,f.normalized)}f.name!==void 0&&(y.name=f.name),m.push(y)}r.morphAttributes[A]=m}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const C=e.data.groups||e.data.drawcalls||e.data.offsets;if(C!==void 0)for(let A=0,h=C.length;A!==h;++A){const m=C[A];r.addGroup(m.start,m.count,m.materialIndex)}const u=e.data.boundingSphere;if(u!==void 0){const A=new N;u.center!==void 0&&A.fromArray(u.center),r.boundingSphere=new Ar(A,u.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class _3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=this.path===""?fo.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const g=new is(this.manager);g.setPath(this.path),g.setRequestHeader(this.requestHeader),g.setWithCredentials(this.withCredentials),g.load(e,function(a){let l=null;try{l=JSON.parse(a)}catch(C){s!==void 0&&s(C),console.error("THREE:ObjectLoader: Can't parse "+e+".",C.message);return}const I=l.metadata;if(I===void 0||I.type===void 0||I.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(l,t)},n,s)}async loadAsync(e,t){const n=this,s=this.path===""?fo.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new is(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const r=await o.loadAsync(e,t),g=JSON.parse(r),a=g.metadata;if(a===void 0||a.type===void 0||a.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(g)}parse(e,t){const n=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,s),r=this.parseImages(e.images,function(){t!==void 0&&t(l)}),g=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,g),l=this.parseObject(e.object,o,a,g,n),I=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,I),t!==void 0){let C=!1;for(const u in r)if(r[u].data instanceof HTMLImageElement){C=!0;break}C===!1&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),o=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,o),g=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,s,g,r,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(e!==void 0)for(let n=0,s=e.length;n<s;n++){const o=new pa().fromJSON(e[n]);t[o.uuid]=o}return t}parseSkeletons(e,t){const n={},s={};if(t.traverse(function(o){o.isBone&&(s[o.uuid]=o)}),e!==void 0)for(let o=0,r=e.length;o<r;o++){const g=new yC().fromJSON(e[o],s);n[g.uuid]=g}return n}parseGeometries(e,t){const n={};if(e!==void 0){const s=new oR;for(let o=0,r=e.length;o<r;o++){let g;const a=e[o];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":g=s.parse(a);break;default:a.type in Mv?g=Mv[a.type].fromJSON(a,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}g.uuid=a.uuid,a.name!==void 0&&(g.name=a.name),g.isBufferGeometry===!0&&a.userData!==void 0&&(g.userData=a.userData),n[a.uuid]=g}}return n}parseMaterials(e,t){const n={},s={};if(e!==void 0){const o=new uh;o.setTextures(t);for(let r=0,g=e.length;r<g;r++){const a=e[r];n[a.uuid]===void 0&&(n[a.uuid]=o.parse(a)),s[a.uuid]=n[a.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const s=e[n],o=jl.parse(s);t[o.uuid]=o}return t}parseImages(e,t){const n=this,s={};let o;function r(a){return n.manager.itemStart(a),o.load(a,function(){n.manager.itemEnd(a)},void 0,function(){n.manager.itemError(a),n.manager.itemEnd(a)})}function g(a){if(typeof a=="string"){const l=a,I=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:n.resourcePath+l;return r(I)}else return a.data?{data:vl(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){const a=new jb(t);o=new aC(a),o.setCrossOrigin(this.crossOrigin);for(let l=0,I=e.length;l<I;l++){const C=e[l],u=C.url;if(Array.isArray(u)){const A=[];for(let h=0,m=u.length;h<m;h++){const b=u[h],G=g(b);G!==null&&(G instanceof HTMLImageElement?A.push(G):A.push(new Hl(G.data,G.width,G.height)))}s[C.uuid]=new ga(A)}else{const A=g(C.url);s[C.uuid]=new ga(A)}}}return s}async parseImagesAsync(e){const t=this,n={};let s;async function o(r){if(typeof r=="string"){const g=r,a=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:t.resourcePath+g;return await s.loadAsync(a)}else return r.data?{data:vl(r.type,r.data),width:r.width,height:r.height}:null}if(e!==void 0&&e.length>0){s=new aC(this.manager),s.setCrossOrigin(this.crossOrigin);for(let r=0,g=e.length;r<g;r++){const a=e[r],l=a.url;if(Array.isArray(l)){const I=[];for(let C=0,u=l.length;C<u;C++){const A=l[C],h=await o(A);h!==null&&(h instanceof HTMLImageElement?I.push(h):I.push(new Hl(h.data,h.width,h.height)))}n[a.uuid]=new ga(I)}else{const I=await o(a.url);n[a.uuid]=new ga(I)}}}return n}parseTextures(e,t){function n(o,r){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),r[o])}const s={};if(e!==void 0)for(let o=0,r=e.length;o<r;o++){const g=e[o];g.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid),t[g.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",g.image);const a=t[g.image],l=a.data;let I;Array.isArray(l)?(I=new bC,l.length===6&&(I.needsUpdate=!0)):(l&&l.data?I=new Hl:I=new Cn,l&&(I.needsUpdate=!0)),I.source=a,I.uuid=g.uuid,g.name!==void 0&&(I.name=g.name),g.mapping!==void 0&&(I.mapping=n(g.mapping,J3)),g.offset!==void 0&&I.offset.fromArray(g.offset),g.repeat!==void 0&&I.repeat.fromArray(g.repeat),g.center!==void 0&&I.center.fromArray(g.center),g.rotation!==void 0&&(I.rotation=g.rotation),g.wrap!==void 0&&(I.wrapS=n(g.wrap[0],Tv),I.wrapT=n(g.wrap[1],Tv)),g.format!==void 0&&(I.format=g.format),g.type!==void 0&&(I.type=g.type),g.encoding!==void 0&&(I.encoding=g.encoding),g.minFilter!==void 0&&(I.minFilter=n(g.minFilter,Ev)),g.magFilter!==void 0&&(I.magFilter=n(g.magFilter,Ev)),g.anisotropy!==void 0&&(I.anisotropy=g.anisotropy),g.flipY!==void 0&&(I.flipY=g.flipY),g.premultiplyAlpha!==void 0&&(I.premultiplyAlpha=g.premultiplyAlpha),g.unpackAlignment!==void 0&&(I.unpackAlignment=g.unpackAlignment),g.userData!==void 0&&(I.userData=g.userData),s[g.uuid]=I}return s}parseObject(e,t,n,s,o){let r;function g(u){return t[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",u),t[u]}function a(u){if(u!==void 0){if(Array.isArray(u)){const A=[];for(let h=0,m=u.length;h<m;h++){const b=u[h];n[b]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",b),A.push(n[b])}return A}return n[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",u),n[u]}}function l(u){return s[u]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",u),s[u]}let I,C;switch(e.type){case"Scene":r=new Kb,e.background!==void 0&&(Number.isInteger(e.background)?r.background=new Ee(e.background):r.background=l(e.background)),e.environment!==void 0&&(r.environment=l(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?r.fog=new rh(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(r.fog=new oh(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new zn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(r.focus=e.focus),e.zoom!==void 0&&(r.zoom=e.zoom),e.filmGauge!==void 0&&(r.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(r.filmOffset=e.filmOffset),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new iI(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(r.zoom=e.zoom),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new nR(e.color,e.intensity);break;case"DirectionalLight":r=new nG(e.color,e.intensity);break;case"PointLight":r=new tG(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new iR(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new eG(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new tR(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=new Ch().fromJSON(e);break;case"SkinnedMesh":I=g(e.geometry),C=a(e.material),r=new Mb(I,C),e.bindMode!==void 0&&(r.bindMode=e.bindMode),e.bindMatrix!==void 0&&r.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(r.skeleton=e.skeleton);break;case"Mesh":I=g(e.geometry),C=a(e.material),r=new fn(I,C);break;case"InstancedMesh":I=g(e.geometry),C=a(e.material);const u=e.count,A=e.instanceMatrix,h=e.instanceColor;r=new Fl(I,C,u),r.instanceMatrix=new Za(new Float32Array(A.array),16),h!==void 0&&(r.instanceColor=new Za(new Float32Array(h.array),h.itemSize));break;case"LOD":r=new VS;break;case"Line":r=new ar(g(e.geometry),a(e.material));break;case"LineLoop":r=new Lb(g(e.geometry),a(e.material));break;case"LineSegments":r=new Ps(g(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new zb(g(e.geometry),a(e.material));break;case"Sprite":r=new RS(a(e.material));break;case"Group":r=new jo;break;case"Bone":r=new gh;break;default:r=new St}if(r.uuid=e.uuid,e.name!==void 0&&(r.name=e.name),e.matrix!==void 0?(r.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(e.position!==void 0&&r.position.fromArray(e.position),e.rotation!==void 0&&r.rotation.fromArray(e.rotation),e.quaternion!==void 0&&r.quaternion.fromArray(e.quaternion),e.scale!==void 0&&r.scale.fromArray(e.scale)),e.castShadow!==void 0&&(r.castShadow=e.castShadow),e.receiveShadow!==void 0&&(r.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(r.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(r.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(r.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(r.visible=e.visible),e.frustumCulled!==void 0&&(r.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(r.renderOrder=e.renderOrder),e.userData!==void 0&&(r.userData=e.userData),e.layers!==void 0&&(r.layers.mask=e.layers),e.children!==void 0){const u=e.children;for(let A=0;A<u.length;A++)r.add(this.parseObject(u[A],t,n,s,o))}if(e.animations!==void 0){const u=e.animations;for(let A=0;A<u.length;A++){const h=u[A];r.animations.push(o[h])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(r.autoUpdate=e.autoUpdate);const u=e.levels;for(let A=0;A<u.length;A++){const h=u[A],m=r.getObjectByProperty("uuid",h.object);m!==void 0&&r.addLevel(m,h.distance)}}return r}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const s=t[n.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(s,n.bindMatrix)}})}}const J3={UVMapping:OA,CubeReflectionMapping:pg,CubeRefractionMapping:mg,EquirectangularReflectionMapping:Oc,EquirectangularRefractionMapping:jc,CubeUVReflectionMapping:tI},Tv={RepeatWrapping:gr,ClampToEdgeWrapping:mi,MirroredRepeatWrapping:_l},Ev={NearestFilter:Sn,NearestMipmapNearestFilter:qc,NearestMipmapLinearFilter:$c,LinearFilter:en,LinearMipmapNearestFilter:jA,LinearMipmapLinearFilter:Cr};class rR extends Yi{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=wa.get(e);if(r!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(r),o.manager.itemEnd(e)},0),r;const g={};g.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",g.headers=this.requestHeader,fetch(e,g).then(function(a){return a.blob()}).then(function(a){return createImageBitmap(a,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(a){wa.add(e,a),t&&t(a),o.manager.itemEnd(e)}).catch(function(a){s&&s(a),o.manager.itemError(e),o.manager.itemEnd(e)}),o.manager.itemStart(e)}}let hd;const sG={getContext:function(){return hd===void 0&&(hd=new(window.AudioContext||window.webkitAudioContext)),hd},setContext:function(i){hd=i}};class U3 extends Yi{constructor(e){super(e)}load(e,t,n,s){const o=this,r=new is(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(g){try{const a=g.slice(0);sG.getContext().decodeAudioData(a,function(I){t(I)})}catch(a){s?s(a):console.error(a),o.manager.itemError(e)}},n,s)}}class D3 extends Ch{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const s=new Ee().set(e),o=new Ee().set(t),r=new N(s.r,s.g,s.b),g=new N(o.r,o.g,o.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(g).multiplyScalar(a),this.sh.coefficients[1].copy(r).sub(g).multiplyScalar(l)}}class P3 extends Ch{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0;const n=new Ee().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const _v=new dt,Jv=new dt,Tg=new dt;class Q3{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new zn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new zn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Tg.copy(e.projectionMatrix);const s=t.eyeSep/2,o=s*t.near/t.focus,r=t.near*Math.tan(da*t.fov*.5)/t.zoom;let g,a;Jv.elements[12]=-s,_v.elements[12]=s,g=-r*t.aspect+o,a=r*t.aspect+o,Tg.elements[0]=2*t.near/(a-g),Tg.elements[8]=(a+g)/(a-g),this.cameraL.projectionMatrix.copy(Tg),g=-r*t.aspect-o,a=r*t.aspect-o,Tg.elements[0]=2*t.near/(a-g),Tg.elements[8]=(a+g)/(a-g),this.cameraR.projectionMatrix.copy(Tg)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Jv),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_v)}}class oG{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Uv(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Uv();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Uv(){return(typeof performance>"u"?Date:performance).now()}const Eg=new N,Dv=new Qn,O3=new N,_g=new N;class j3 extends St{constructor(){super(),this.type="AudioListener",this.context=sG.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new oG}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Eg,Dv,O3),_g.set(0,0,-1).applyQuaternion(Dv),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Eg.x,s),t.positionY.linearRampToValueAtTime(Eg.y,s),t.positionZ.linearRampToValueAtTime(Eg.z,s),t.forwardX.linearRampToValueAtTime(_g.x,s),t.forwardY.linearRampToValueAtTime(_g.y,s),t.forwardZ.linearRampToValueAtTime(_g.z,s),t.upX.linearRampToValueAtTime(n.x,s),t.upY.linearRampToValueAtTime(n.y,s),t.upZ.linearRampToValueAtTime(n.z,s)}else t.setPosition(Eg.x,Eg.y,Eg.z),t.setOrientation(_g.x,_g.y,_g.z,n.x,n.y,n.z)}}class gR extends St{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Jg=new N,Pv=new Qn,q3=new N,Ug=new N;class $3 extends gR{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Jg,Pv,q3),Ug.set(0,0,1).applyQuaternion(Pv);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Jg.x,n),t.positionY.linearRampToValueAtTime(Jg.y,n),t.positionZ.linearRampToValueAtTime(Jg.z,n),t.orientationX.linearRampToValueAtTime(Ug.x,n),t.orientationY.linearRampToValueAtTime(Ug.y,n),t.orientationZ.linearRampToValueAtTime(Ug.z,n)}else t.setPosition(Jg.x,Jg.y,Jg.z),t.setOrientation(Ug.x,Ug.y,Ug.z)}}class eN{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class aR{constructor(e,t,n){this.binding=e,this.valueSize=n;let s,o,r;switch(t){case"quaternion":s=this._slerp,o=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,o=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,o=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=o,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,s=this.valueSize,o=e*s+s;let r=this.cumulativeWeight;if(r===0){for(let g=0;g!==s;++g)n[o+g]=n[g];r=t}else{r+=t;const g=t/r;this._mixBufferRegion(n,o,0,g,s)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,s=e*t+t,o=this.cumulativeWeight,r=this.cumulativeWeightAdditive,g=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const a=t*this._origIndex;this._mixBufferRegion(n,s,a,1-o,t)}r>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){g.setValue(n,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,s=n*this._origIndex;e.getValue(t,s);for(let o=n,r=s;o!==r;++o)t[o]=t[s+o%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,o){if(s>=.5)for(let r=0;r!==o;++r)e[t+r]=e[n+r]}_slerp(e,t,n,s){Qn.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,o){const r=this._workIndex*o;Qn.multiplyQuaternionsFlat(e,r,e,t,e,n),Qn.slerpFlat(e,t,e,t,e,r,s)}_lerp(e,t,n,s,o){const r=1-s;for(let g=0;g!==o;++g){const a=t+g;e[a]=e[a]*r+e[n+g]*s}}_lerpAdditive(e,t,n,s,o){for(let r=0;r!==o;++r){const g=t+r;e[g]=e[g]+e[n+r]*s}}}const rG="\\[\\]\\.:\\/",tN=new RegExp("["+rG+"]","g"),gG="[^"+rG+"]",nN="[^"+rG.replace("\\.","")+"]",iN=/((?:WC+[\/:])*)/.source.replace("WC",gG),sN=/(WCOD+)?/.source.replace("WCOD",nN),oN=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",gG),rN=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",gG),gN=new RegExp("^"+iN+sN+oN+rN+"$"),aN=["material","materials","bones","map"];class lN{constructor(e,t,n){const s=n||Vt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=n.length;s!==o;++s)n[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Vt{constructor(e,t,n){this.path=t,this.parsedPath=n||Vt.parseTrackName(t),this.node=Vt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Vt.Composite(e,t,n):new Vt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(tN,"")}static parseTrackName(e){const t=gN.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=n.nodeName.substring(s+1);aN.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=o)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(o){for(let r=0;r<o.length;r++){const g=o[r];if(g.name===t||g.uuid===t)return g;const a=n(g.children);if(a)return a}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let s=0,o=n.length;s!==o;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,s=t.propertyName;let o=t.propertyIndex;if(e||(e=Vt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let l=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let I=0;I<e.length;I++)if(e[I].name===l){l=I;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}const r=e[s];if(r===void 0){const l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn't found.",e);return}let g=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?g=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(g=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=o}else r.fromArray!==void 0&&r.toArray!==void 0?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=s;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][g]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Vt.Composite=lN;Vt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Vt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Vt.prototype.GetterByBindingType=[Vt.prototype._getValue_direct,Vt.prototype._getValue_array,Vt.prototype._getValue_arrayElement,Vt.prototype._getValue_toArray];Vt.prototype.SetterByBindingTypeAndVersioning=[[Vt.prototype._setValue_direct,Vt.prototype._setValue_direct_setNeedsUpdate,Vt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_array,Vt.prototype._setValue_array_setNeedsUpdate,Vt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_arrayElement,Vt.prototype._setValue_arrayElement_setNeedsUpdate,Vt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Vt.prototype._setValue_fromArray,Vt.prototype._setValue_fromArray_setNeedsUpdate,Vt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class IN{constructor(){this.isAnimationObjectGroup=!0,this.uuid=ts(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,s=arguments.length;n!==s;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,s=this._parsedPaths,o=this._bindings,r=o.length;let g,a=e.length,l=this.nCachedObjects_;for(let I=0,C=arguments.length;I!==C;++I){const u=arguments[I],A=u.uuid;let h=t[A];if(h===void 0){h=a++,t[A]=h,e.push(u);for(let m=0,b=r;m!==b;++m)o[m].push(new Vt(u,n[m],s[m]))}else if(h<l){g=e[h];const m=--l,b=e[m];t[b.uuid]=h,e[h]=b,t[A]=m,e[m]=u;for(let G=0,f=r;G!==f;++G){const y=o[G],B=y[m];let v=y[h];y[h]=B,v===void 0&&(v=new Vt(u,n[G],s[G])),y[m]=v}}else e[h]!==g&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let o=this.nCachedObjects_;for(let r=0,g=arguments.length;r!==g;++r){const a=arguments[r],l=a.uuid,I=t[l];if(I!==void 0&&I>=o){const C=o++,u=e[C];t[u.uuid]=I,e[I]=u,t[l]=C,e[C]=a;for(let A=0,h=s;A!==h;++A){const m=n[A],b=m[C],G=m[I];m[I]=b,m[C]=G}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length;let o=this.nCachedObjects_,r=e.length;for(let g=0,a=arguments.length;g!==a;++g){const l=arguments[g],I=l.uuid,C=t[I];if(C!==void 0)if(delete t[I],C<o){const u=--o,A=e[u],h=--r,m=e[h];t[A.uuid]=C,e[C]=A,t[m.uuid]=u,e[u]=m,e.pop();for(let b=0,G=s;b!==G;++b){const f=n[b],y=f[u],B=f[h];f[C]=y,f[u]=B,f.pop()}}else{const u=--r,A=e[u];u>0&&(t[A.uuid]=C),e[C]=A,e.pop();for(let h=0,m=s;h!==m;++h){const b=n[h];b[C]=b[u],b.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const n=this._bindingsIndicesByPath;let s=n[e];const o=this._bindings;if(s!==void 0)return o[s];const r=this._paths,g=this._parsedPaths,a=this._objects,l=a.length,I=this.nCachedObjects_,C=new Array(l);s=o.length,n[e]=s,r.push(e),g.push(t),o.push(C);for(let u=I,A=a.length;u!==A;++u){const h=a[u];C[u]=new Vt(h,e,t)}return C}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const s=this._paths,o=this._parsedPaths,r=this._bindings,g=r.length-1,a=r[g],l=e[g];t[l]=n,r[n]=a,r.pop(),o[n]=o[g],o.pop(),s[n]=s[g],s.pop()}}}class cN{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;const o=t.tracks,r=o.length,g=new Array(r),a={endingStart:oa,endingEnd:oa};for(let l=0;l!==r;++l){const I=o[l].createInterpolant(null);g[l]=I,I.settings=a}this._interpolantSettings=a,this._interpolants=g,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=gS,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const s=this._clip.duration,o=e._clip.duration,r=o/s,g=s/o;e.warp(1,r,t),this.warp(g,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const s=this._mixer,o=s.time,r=this.timeScale;let g=this._timeScaleInterpolant;g===null&&(g=s._lendControlInterpolant(),this._timeScaleInterpolant=g);const a=g.parameterPositions,l=g.sampleValues;return a[0]=o,a[1]=o+n,l[0]=e/r,l[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const a=(e-o)*n;a<0||n===0?t=0:(this._startTime=null,t=n*a)}t*=this._updateTimeScale(e);const r=this._updateTime(t),g=this._updateWeight(e);if(g>0){const a=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case wb:for(let I=0,C=a.length;I!==C;++I)a[I].evaluate(r),l[I].accumulateAdditive(g);break;case qA:default:for(let I=0,C=a.length;I!==C;++I)a[I].evaluate(r),l[I].accumulate(s,g)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let s=this.time+e,o=this._loopCount;const r=n===aS;if(e===0)return o===-1?s:r&&(o&1)===1?t-s:s;if(n===rS){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,r)):this._setEndings(this.repetitions===0,!0,r)),s>=t||s<0){const g=Math.floor(s/t);s-=t*g,o+=Math.abs(g);const a=this.repetitions-o;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(a===1){const l=e<0;this._setEndings(l,!l,r)}else this._setEndings(!1,!1,r);this._loopCount=o,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:g})}}else this.time=s;if(r&&(o&1)===1)return t-s}return s}_setEndings(e,t,n){const s=this._interpolantSettings;n?(s.endingStart=ra,s.endingEnd=ra):(e?s.endingStart=this.zeroSlopeAtStart?ra:oa:s.endingStart=eC,t?s.endingEnd=this.zeroSlopeAtEnd?ra:oa:s.endingEnd=eC)}_scheduleFading(e,t,n){const s=this._mixer,o=s.time;let r=this._weightInterpolant;r===null&&(r=s._lendControlInterpolant(),this._weightInterpolant=r);const g=r.parameterPositions,a=r.sampleValues;return g[0]=o,a[0]=t,g[1]=o+e,a[1]=n,this}}const CN=new Float32Array(1);class uN extends yo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,s=e._clip.tracks,o=s.length,r=e._propertyBindings,g=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName;let I=l[a];I===void 0&&(I={},l[a]=I);for(let C=0;C!==o;++C){const u=s[C],A=u.name;let h=I[A];if(h!==void 0)++h.referenceCount,r[C]=h;else{if(h=r[C],h!==void 0){h._cacheIndex===null&&(++h.referenceCount,this._addInactiveBinding(h,a,A));continue}const m=t&&t._propertyBindings[C].binding.parsedPath;h=new aR(Vt.create(n,A,m),u.ValueTypeName,u.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,a,A),r[C]=h}g[C].resultBuffer=h.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,s=e._clip.uuid,o=this._actionsByClip[s];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,s,n)}const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const o=t[n];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const o=t[n];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const s=this._actions,o=this._actionsByClip;let r=o[t];if(r===void 0)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=r;else{const g=r.knownActions;e._byClipCacheIndex=g.length,g.push(e)}e._cacheIndex=s.length,s.push(e),r.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,r=this._actionsByClip,g=r[o],a=g.knownActions,l=a[a.length-1],I=e._byClipCacheIndex;l._byClipCacheIndex=I,a[I]=l,a.pop(),e._byClipCacheIndex=null;const C=g.actionByRoot,u=(e._localRoot||this._root).uuid;delete C[u],a.length===0&&delete r[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){const o=t[n];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=n,t[n]=o}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=n,t[n]=o}_addInactiveBinding(e,t,n){const s=this._bindingsByRootAndName,o=this._bindings;let r=s[t];r===void 0&&(r={},s[t]=r),r[n]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,s=n.rootNode.uuid,o=n.path,r=this._bindingsByRootAndName,g=r[s],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete g[o],Object.keys(g).length===0&&delete r[s]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=n,t[n]=o}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=n,t[n]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new Qb(new Float32Array(2),new Float32Array(2),1,CN),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,o=t[s];e.__cacheIndex=s,t[s]=e,o.__cacheIndex=n,t[n]=o}clipAction(e,t,n){const s=t||this._root,o=s.uuid;let r=typeof e=="string"?jl.findByName(s,e):e;const g=r!==null?r.uuid:e,a=this._actionsByClip[g];let l=null;if(n===void 0&&(r!==null?n=r.blendMode:n=qA),a!==void 0){const C=a.actionByRoot[o];if(C!==void 0&&C.blendMode===n)return C;l=a.knownActions[0],r===null&&(r=l._clip)}if(r===null)return null;const I=new cN(this,r,t,n);return this._bindAction(I,l),this._addInactiveAction(I,g,o),I}existingAction(e,t){const n=t||this._root,s=n.uuid,o=typeof e=="string"?jl.findByName(n,e):e,r=o?o.uuid:e,g=this._actionsByClip[r];return g!==void 0&&g.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,s=this.time+=e,o=Math.sign(e),r=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(s,e,o,r);const g=this._bindings,a=this._nActiveBindings;for(let l=0;l!==a;++l)g[l].apply(r);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,s=this._actionsByClip,o=s[n];if(o!==void 0){const r=o.knownActions;for(let g=0,a=r.length;g!==a;++g){const l=r[g];this._deactivateAction(l);const I=l._cacheIndex,C=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,C._cacheIndex=I,t[I]=C,t.pop(),this._removeInactiveBindingsForAction(l)}delete s[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const r in n){const g=n[r].actionByRoot,a=g[t];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const s=this._bindingsByRootAndName,o=s[t];if(o!==void 0)for(const r in o){const g=o[r];g.restoreOriginalState(),this._removeInactiveBinding(g)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class aG{constructor(e){this.value=e}clone(){return new aG(this.value.clone===void 0?this.value:this.value.clone())}}let dN=0;class AN extends yo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:dN++}),this.name="",this.usage=tC,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,s=t.length;n<s;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class hN extends GC{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class pN{constructor(e,t,n,s,o){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class lR{constructor(e,t,n=0,s=1/0){this.ray=new fC(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new ha,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return l0(e,this,n,t),n.sort(Qv),n}intersectObjects(e,t=!0,n=[]){for(let s=0,o=e.length;s<o;s++)l0(e[s],this,n,t);return n.sort(Qv),n}}function Qv(i,e){return i.distance-e.distance}function l0(i,e,t,n){if(i.layers.test(e.layers)&&i.raycast(e,t),n===!0){const s=i.children;for(let o=0,r=s.length;o<r;o++)l0(s[o],e,t,!0)}}class mN{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Rn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class fN{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const Ov=new Se;class bN{constructor(e=new Se(1/0,1/0),t=new Se(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Ov.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ov.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const jv=new N,pd=new N;class GN{constructor(e=new N,t=new N){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){jv.subVectors(e,this.start),pd.subVectors(this.end,this.start);const n=pd.dot(pd);let o=pd.dot(jv)/n;return t&&(o=Rn(o,0,1)),o}closestPointToPoint(e,t,n){const s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const qv=new N;class yN extends St{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new bt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,g=1,a=32;r<a;r++,g++){const l=r/a*Math.PI*2,I=g/a*Math.PI*2;s.push(Math.cos(l),Math.sin(l),1,Math.cos(I),Math.sin(I),1)}n.setAttribute("position",new tt(s,3));const o=new bi({fog:!1,toneMapped:!1});this.cone=new Ps(n,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),qv.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(qv),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Er=new N,md=new dt,mm=new dt;class BN extends Ps{constructor(e){const t=IR(e),n=new bt,s=[],o=[],r=new Ee(0,0,1),g=new Ee(0,1,0);for(let l=0;l<t.length;l++){const I=t[l];I.parent&&I.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),o.push(r.r,r.g,r.b),o.push(g.r,g.g,g.b))}n.setAttribute("position",new tt(s,3)),n.setAttribute("color",new tt(o,3));const a=new bi({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,s=n.getAttribute("position");mm.copy(this.root.matrixWorld).invert();for(let o=0,r=0;o<t.length;o++){const g=t[o];g.parent&&g.parent.isBone&&(md.multiplyMatrices(mm,g.matrixWorld),Er.setFromMatrixPosition(md),s.setXYZ(r,Er.x,Er.y,Er.z),md.multiplyMatrices(mm,g.parent.matrixWorld),Er.setFromMatrixPosition(md),s.setXYZ(r+1,Er.x,Er.y,Er.z),r+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function IR(i){const e=[];i.isBone===!0&&e.push(i);for(let t=0;t<i.children.length;t++)e.push.apply(e,IR(i.children[t]));return e}class vN extends fn{constructor(e,t,n){const s=new gI(t,4,2),o=new Ji({wireframe:!0,fog:!1,toneMapped:!1});super(s,o),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ZN=new N,$v=new Ee,eZ=new Ee;class wN extends St{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const s=new rI(t);s.rotateY(Math.PI*.5),this.material=new Ji({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=s.getAttribute("position"),r=new Float32Array(o.count*3);s.setAttribute("color",new Ft(r,3)),this.add(new fn(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");$v.copy(this.light.color),eZ.copy(this.light.groundColor);for(let n=0,s=t.count;n<s;n++){const o=n<s/2?$v:eZ;t.setXYZ(n,o.r,o.g,o.b)}t.needsUpdate=!0}e.lookAt(ZN.setFromMatrixPosition(this.light.matrixWorld).negate())}}class WN extends Ps{constructor(e=10,t=10,n=4473924,s=8947848){n=new Ee(n),s=new Ee(s);const o=t/2,r=e/t,g=e/2,a=[],l=[];for(let u=0,A=0,h=-g;u<=t;u++,h+=r){a.push(-g,0,h,g,0,h),a.push(h,0,-g,h,0,g);const m=u===o?n:s;m.toArray(l,A),A+=3,m.toArray(l,A),A+=3,m.toArray(l,A),A+=3,m.toArray(l,A),A+=3}const I=new bt;I.setAttribute("position",new tt(a,3)),I.setAttribute("color",new tt(l,3));const C=new bi({vertexColors:!0,toneMapped:!1});super(I,C),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class SN extends Ps{constructor(e=10,t=16,n=8,s=64,o=4473924,r=8947848){o=new Ee(o),r=new Ee(r);const g=[],a=[];if(t>1)for(let C=0;C<t;C++){const u=C/t*(Math.PI*2),A=Math.sin(u)*e,h=Math.cos(u)*e;g.push(0,0,0),g.push(A,0,h);const m=C&1?o:r;a.push(m.r,m.g,m.b),a.push(m.r,m.g,m.b)}for(let C=0;C<n;C++){const u=C&1?o:r,A=e-e/n*C;for(let h=0;h<s;h++){let m=h/s*(Math.PI*2),b=Math.sin(m)*A,G=Math.cos(m)*A;g.push(b,0,G),a.push(u.r,u.g,u.b),m=(h+1)/s*(Math.PI*2),b=Math.sin(m)*A,G=Math.cos(m)*A,g.push(b,0,G),a.push(u.r,u.g,u.b)}}const l=new bt;l.setAttribute("position",new tt(g,3)),l.setAttribute("color",new tt(a,3));const I=new bi({vertexColors:!0,toneMapped:!1});super(l,I),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const tZ=new N,fd=new N,nZ=new N;class RN extends St{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,t===void 0&&(t=1);let s=new bt;s.setAttribute("position",new tt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new bi({fog:!1,toneMapped:!1});this.lightPlane=new ar(s,o),this.add(this.lightPlane),s=new bt,s.setAttribute("position",new tt([0,0,0,0,0,1],3)),this.targetLine=new ar(s,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){tZ.setFromMatrixPosition(this.light.matrixWorld),fd.setFromMatrixPosition(this.light.target.matrixWorld),nZ.subVectors(fd,tZ),this.lightPlane.lookAt(fd),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(fd),this.targetLine.scale.z=nZ.length()}}const bd=new N,pn=new Pl;class VN extends Ps{constructor(e){const t=new bt,n=new bi({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],o=[],r={};g("n1","n2"),g("n2","n4"),g("n4","n3"),g("n3","n1"),g("f1","f2"),g("f2","f4"),g("f4","f3"),g("f3","f1"),g("n1","f1"),g("n2","f2"),g("n3","f3"),g("n4","f4"),g("p","n1"),g("p","n2"),g("p","n3"),g("p","n4"),g("u1","u2"),g("u2","u3"),g("u3","u1"),g("c","t"),g("p","c"),g("cn1","cn2"),g("cn3","cn4"),g("cf1","cf2"),g("cf3","cf4");function g(h,m){a(h),a(m)}function a(h){s.push(0,0,0),o.push(0,0,0),r[h]===void 0&&(r[h]=[]),r[h].push(s.length/3-1)}t.setAttribute("position",new tt(s,3)),t.setAttribute("color",new tt(o,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update();const l=new Ee(16755200),I=new Ee(16711680),C=new Ee(43775),u=new Ee(16777215),A=new Ee(3355443);this.setColors(l,I,C,u,A)}setColors(e,t,n,s,o){const g=this.geometry.getAttribute("color");g.setXYZ(0,e.r,e.g,e.b),g.setXYZ(1,e.r,e.g,e.b),g.setXYZ(2,e.r,e.g,e.b),g.setXYZ(3,e.r,e.g,e.b),g.setXYZ(4,e.r,e.g,e.b),g.setXYZ(5,e.r,e.g,e.b),g.setXYZ(6,e.r,e.g,e.b),g.setXYZ(7,e.r,e.g,e.b),g.setXYZ(8,e.r,e.g,e.b),g.setXYZ(9,e.r,e.g,e.b),g.setXYZ(10,e.r,e.g,e.b),g.setXYZ(11,e.r,e.g,e.b),g.setXYZ(12,e.r,e.g,e.b),g.setXYZ(13,e.r,e.g,e.b),g.setXYZ(14,e.r,e.g,e.b),g.setXYZ(15,e.r,e.g,e.b),g.setXYZ(16,e.r,e.g,e.b),g.setXYZ(17,e.r,e.g,e.b),g.setXYZ(18,e.r,e.g,e.b),g.setXYZ(19,e.r,e.g,e.b),g.setXYZ(20,e.r,e.g,e.b),g.setXYZ(21,e.r,e.g,e.b),g.setXYZ(22,e.r,e.g,e.b),g.setXYZ(23,e.r,e.g,e.b),g.setXYZ(24,t.r,t.g,t.b),g.setXYZ(25,t.r,t.g,t.b),g.setXYZ(26,t.r,t.g,t.b),g.setXYZ(27,t.r,t.g,t.b),g.setXYZ(28,t.r,t.g,t.b),g.setXYZ(29,t.r,t.g,t.b),g.setXYZ(30,t.r,t.g,t.b),g.setXYZ(31,t.r,t.g,t.b),g.setXYZ(32,n.r,n.g,n.b),g.setXYZ(33,n.r,n.g,n.b),g.setXYZ(34,n.r,n.g,n.b),g.setXYZ(35,n.r,n.g,n.b),g.setXYZ(36,n.r,n.g,n.b),g.setXYZ(37,n.r,n.g,n.b),g.setXYZ(38,s.r,s.g,s.b),g.setXYZ(39,s.r,s.g,s.b),g.setXYZ(40,o.r,o.g,o.b),g.setXYZ(41,o.r,o.g,o.b),g.setXYZ(42,o.r,o.g,o.b),g.setXYZ(43,o.r,o.g,o.b),g.setXYZ(44,o.r,o.g,o.b),g.setXYZ(45,o.r,o.g,o.b),g.setXYZ(46,o.r,o.g,o.b),g.setXYZ(47,o.r,o.g,o.b),g.setXYZ(48,o.r,o.g,o.b),g.setXYZ(49,o.r,o.g,o.b),g.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,s=1;pn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),wn("c",t,e,pn,0,0,-1),wn("t",t,e,pn,0,0,1),wn("n1",t,e,pn,-n,-s,-1),wn("n2",t,e,pn,n,-s,-1),wn("n3",t,e,pn,-n,s,-1),wn("n4",t,e,pn,n,s,-1),wn("f1",t,e,pn,-n,-s,1),wn("f2",t,e,pn,n,-s,1),wn("f3",t,e,pn,-n,s,1),wn("f4",t,e,pn,n,s,1),wn("u1",t,e,pn,n*.7,s*1.1,-1),wn("u2",t,e,pn,-n*.7,s*1.1,-1),wn("u3",t,e,pn,0,s*2,-1),wn("cf1",t,e,pn,-n,0,1),wn("cf2",t,e,pn,n,0,1),wn("cf3",t,e,pn,0,-s,1),wn("cf4",t,e,pn,0,s,1),wn("cn1",t,e,pn,-n,0,-1),wn("cn2",t,e,pn,n,0,-1),wn("cn3",t,e,pn,0,-s,-1),wn("cn4",t,e,pn,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function wn(i,e,t,n,s,o,r){bd.set(s,o,r).unproject(n);const g=e[i];if(g!==void 0){const a=t.getAttribute("position");for(let l=0,I=g.length;l<I;l++)a.setXYZ(g[l],bd.x,bd.y,bd.z)}}const Gd=new dr;class xN extends Ps{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),o=new bt;o.setIndex(new Ft(n,1)),o.setAttribute("position",new Ft(s,3)),super(o,new bi({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Gd.setFromObject(this.object),Gd.isEmpty())return;const t=Gd.min,n=Gd.max,s=this.geometry.attributes.position,o=s.array;o[0]=n.x,o[1]=n.y,o[2]=n.z,o[3]=t.x,o[4]=n.y,o[5]=n.z,o[6]=t.x,o[7]=t.y,o[8]=n.z,o[9]=n.x,o[10]=t.y,o[11]=n.z,o[12]=n.x,o[13]=n.y,o[14]=t.z,o[15]=t.x,o[16]=n.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=n.x,o[22]=t.y,o[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class XN extends Ps{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new bt;o.setIndex(new Ft(n,1)),o.setAttribute("position",new tt(s,3)),super(o,new bi({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class YN extends ar{constructor(e,t=1,n=16776960){const s=n,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new bt;r.setAttribute("position",new tt(o,3)),r.computeBoundingSphere(),super(r,new bi({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const g=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],a=new bt;a.setAttribute("position",new tt(g,3)),a.computeBoundingSphere(),this.add(new fn(a,new Ji({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const iZ=new N;let yd,fm;class HN extends St{constructor(e=new N(0,0,1),t=new N(0,0,0),n=1,s=16776960,o=n*.2,r=o*.2){super(),this.type="ArrowHelper",yd===void 0&&(yd=new bt,yd.setAttribute("position",new tt([0,0,0,0,1,0],3)),fm=new Ra(0,.5,1,5,1),fm.translate(0,-.5,0)),this.position.copy(t),this.line=new ar(yd,new bi({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new fn(fm,new Ji({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,o,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{iZ.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(iZ,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class FN extends Ps{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new bt;s.setAttribute("position",new tt(t,3)),s.setAttribute("color",new tt(n,3));const o=new bi({vertexColors:!0,toneMapped:!1});super(s,o),this.type="AxesHelper"}setColors(e,t,n){const s=new Ee,o=this.geometry.attributes.color.array;return s.set(e),s.toArray(o,0),s.toArray(o,3),s.set(t),s.toArray(o,6),s.toArray(o,9),s.set(n),s.toArray(o,12),s.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class KN{constructor(){this.type="ShapePath",this.color=new Ee,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new sC,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,s){return this.currentPath.quadraticCurveTo(e,t,n,s),this}bezierCurveTo(e,t,n,s,o,r){return this.currentPath.bezierCurveTo(e,t,n,s,o,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(G){const f=[];for(let y=0,B=G.length;y<B;y++){const v=G[y],W=new pa;W.curves=v.curves,f.push(W)}return f}function n(G,f){const y=f.length;let B=!1;for(let v=y-1,W=0;W<y;v=W++){let R=f[v],Z=f[W],V=Z.x-R.x,H=Z.y-R.y;if(Math.abs(H)>Number.EPSILON){if(H<0&&(R=f[W],V=-V,Z=f[v],H=-H),G.y<R.y||G.y>Z.y)continue;if(G.y===R.y){if(G.x===R.x)return!0}else{const P=H*(G.x-R.x)-V*(G.y-R.y);if(P===0)return!0;if(P<0)continue;B=!B}}else{if(G.y!==R.y)continue;if(Z.x<=G.x&&G.x<=R.x||R.x<=G.x&&G.x<=Z.x)return!0}}return B}const s=mo.isClockWise,o=this.subPaths;if(o.length===0)return[];let r,g,a;const l=[];if(o.length===1)return g=o[0],a=new pa,a.curves=g.curves,l.push(a),l;let I=!s(o[0].getPoints());I=e?!I:I;const C=[],u=[];let A=[],h=0,m;u[h]=void 0,A[h]=[];for(let G=0,f=o.length;G<f;G++)g=o[G],m=g.getPoints(),r=s(m),r=e?!r:r,r?(!I&&u[h]&&h++,u[h]={s:new pa,p:m},u[h].s.curves=g.curves,I&&h++,A[h]=[]):A[h].push({h:g,p:m[0]});if(!u[0])return t(o);if(u.length>1){let G=!1,f=0;for(let y=0,B=u.length;y<B;y++)C[y]=[];for(let y=0,B=u.length;y<B;y++){const v=A[y];for(let W=0;W<v.length;W++){const R=v[W];let Z=!0;for(let V=0;V<u.length;V++)n(R.p,u[V].p)&&(y!==V&&f++,Z?(Z=!1,C[V].push(R)):G=!0);Z&&C[y].push(R)}}f>0&&G===!1&&(A=C)}let b;for(let G=0,f=u.length;G<f;G++){a=u[G].s,l.push(a),b=A[G];for(let y=0,B=b.length;y<B;y++)a.holes.push(b[y].h)}return l}}const Uo=NN();function NN(){const i=new ArrayBuffer(4),e=new Float32Array(i),t=new Uint32Array(i),n=new Uint32Array(512),s=new Uint32Array(512);for(let a=0;a<256;++a){const l=a-127;l<-27?(n[a]=0,n[a|256]=32768,s[a]=24,s[a|256]=24):l<-14?(n[a]=1024>>-l-14,n[a|256]=1024>>-l-14|32768,s[a]=-l-1,s[a|256]=-l-1):l<=15?(n[a]=l+15<<10,n[a|256]=l+15<<10|32768,s[a]=13,s[a|256]=13):l<128?(n[a]=31744,n[a|256]=64512,s[a]=24,s[a|256]=24):(n[a]=31744,n[a|256]=64512,s[a]=13,s[a|256]=13)}const o=new Uint32Array(2048),r=new Uint32Array(64),g=new Uint32Array(64);for(let a=1;a<1024;++a){let l=a<<13,I=0;for(;(l&8388608)===0;)l<<=1,I-=8388608;l&=-8388609,I+=947912704,o[a]=l|I}for(let a=1024;a<2048;++a)o[a]=939524096+(a-1024<<13);for(let a=1;a<31;++a)r[a]=a<<23;r[31]=1199570944,r[32]=2147483648;for(let a=33;a<63;++a)r[a]=2147483648+(a-32<<23);r[63]=3347054592;for(let a=1;a<64;++a)a!==32&&(g[a]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:s,mantissaTable:o,exponentTable:r,offsetTable:g}}function MN(i){Math.abs(i)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),i=Rn(i,-65504,65504),Uo.floatView[0]=i;const e=Uo.uint32View[0],t=e>>23&511;return Uo.baseTable[t]+((e&8388607)>>Uo.shiftTable[t])}function LN(i){const e=i>>10;return Uo.uint32View[0]=Uo.mantissaTable[Uo.offsetTable[e]+(i&1023)]+Uo.exponentTable[e],Uo.floatView[0]}var zN=Object.freeze({__proto__:null,toHalfFloat:MN,fromHalfFloat:LN});function kN(){console.error("THREE.ImmediateRenderObject has been removed.")}class TN extends Bs{constructor(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(e,t,n),this.samples=4}}class EN extends mC{constructor(e,t,n,s){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(e,t,n,s)}}class _N extends $A{constructor(e,t,n,s){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(e,t,n,s)}}class JN extends hr{constructor(e,t,n,s,o,r){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(e,t,n,s,o,r)}}class UN extends BC{constructor(e,t,n,s){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(e,t,n,s)}}class DN extends vC{constructor(e,t,n,s){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(e,t,n,s)}}class PN extends ZC{constructor(e,t,n,s,o,r,g){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(e,t,n,s,o,r,g)}}class QN extends Ra{constructor(e,t,n,s,o,r,g,a){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(e,t,n,s,o,r,g,a)}}class ON extends wC{constructor(e,t){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(e,t)}}class jN extends WC{constructor(e,t){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(e,t)}}class qN extends SC{constructor(e,t){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(e,t)}}class $N extends oI{constructor(e,t,n,s){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(e,t,n,s)}}class eM extends rI{constructor(e,t){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(e,t)}}class XA extends nI{constructor(e,t,n,s){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(e,t,n,s)}}class tM extends pr{constructor(e,t,n,s){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(e,t,n,s)}}class nM extends RC{constructor(e,t,n,s,o,r){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(e,t,n,s,o,r)}}class iM extends VC{constructor(e,t){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(e,t)}}class sM extends gI{constructor(e,t,n,s,o,r,g){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(e,t,n,s,o,r,g)}}class oM extends xC{constructor(e,t){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(e,t)}}class rM extends XC{constructor(e,t,n,s,o){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(e,t,n,s,o)}}class gM extends YC{constructor(e,t,n,s,o,r){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(e,t,n,s,o,r)}}class aM extends HC{constructor(e,t,n,s,o){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(e,t,n,s,o)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:QA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=QA);const lM=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:vb,AddEquation:qg,AddOperation:zW,AdditiveAnimationBlendMode:wb,AdditiveBlending:Rf,AlphaFormat:OW,AlwaysDepth:YW,AlwaysStencilFunc:CS,AmbientLight:nR,AmbientLightProbe:P3,AnimationClip:jl,AnimationLoader:N3,AnimationMixer:uN,AnimationObjectGroup:IN,AnimationUtils:Y3,ArcCurve:XS,ArrayCamera:ZS,ArrowHelper:HN,Audio:gR,AudioAnalyser:eN,AudioContext:sG,AudioListener:j3,AudioLoader:U3,AxesHelper:FN,BackSide:Vi,BasicDepthPacking:IS,BasicShadowMap:uX,Bone:gh,BooleanKeyframeTrack:Va,Box2:bN,Box3:dr,Box3Helper:XN,BoxBufferGeometry:JN,BoxGeometry:hr,BoxHelper:xN,BufferAttribute:Ft,BufferGeometry:bt,BufferGeometryLoader:oR,ByteType:JW,Cache:wa,Camera:Pl,CameraHelper:VN,CanvasTexture:i3,CapsuleBufferGeometry:UN,CapsuleGeometry:BC,CatmullRomCurve3:YS,CineonToneMapping:EW,CircleBufferGeometry:DN,CircleGeometry:vC,ClampToEdgeWrapping:mi,Clock:oG,Color:Ee,ColorKeyframeTrack:Ob,ColorManagement:Cs,CompressedTexture:xS,CompressedTextureLoader:M3,ConeBufferGeometry:PN,ConeGeometry:ZC,CubeCamera:pS,CubeReflectionMapping:pg,CubeRefractionMapping:mg,CubeTexture:bC,CubeTextureLoader:L3,CubeUVReflectionMapping:tI,CubicBezierCurve:Tb,CubicBezierCurve3:HS,CubicInterpolant:jS,CullFaceBack:Sf,CullFaceFront:fW,CullFaceFrontBack:CX,CullFaceNone:mW,Curve:Qs,CurvePath:KS,CustomBlending:bW,CustomToneMapping:_W,CylinderBufferGeometry:QN,CylinderGeometry:Ra,Cylindrical:fN,Data3DTexture:$A,DataArrayTexture:mC,DataTexture:Hl,DataTexture2DArray:EN,DataTexture3D:_N,DataTextureLoader:z3,DataUtils:zN,DecrementStencilOp:BX,DecrementWrapStencilOp:ZX,DefaultLoadingManager:eR,DepthFormat:ug,DepthStencilFormat:Ba,DepthTexture:wS,DirectionalLight:nG,DirectionalLightHelper:RN,DiscreteInterpolant:qS,DodecahedronBufferGeometry:ON,DodecahedronGeometry:wC,DoubleSide:ms,DstAlphaFactor:WW,DstColorFactor:RW,DynamicCopyUsage:LX,DynamicDrawUsage:uS,DynamicReadUsage:KX,EdgesGeometry:NS,EllipseCurve:lh,EqualDepth:FW,EqualStencilFunc:RX,EquirectangularReflectionMapping:Oc,EquirectangularRefractionMapping:jc,Euler:Wg,EventDispatcher:yo,ExtrudeBufferGeometry:jN,ExtrudeGeometry:WC,FileLoader:is,Float16BufferAttribute:f9,Float32BufferAttribute:tt,Float64BufferAttribute:b9,FloatType:Qo,Fog:rh,FogExp2:oh,FramebufferTexture:n3,FrontSide:rr,Frustum:th,GLBufferAttribute:pN,GLSL1:kX,GLSL3:t0,GreaterDepth:NW,GreaterEqualDepth:KW,GreaterEqualStencilFunc:YX,GreaterStencilFunc:xX,GridHelper:WN,Group:jo,HalfFloatType:Jl,HemisphereLight:tR,HemisphereLightHelper:wN,HemisphereLightProbe:D3,IcosahedronBufferGeometry:qN,IcosahedronGeometry:SC,ImageBitmapLoader:rR,ImageLoader:aC,ImageUtils:xb,ImmediateRenderObject:kN,IncrementStencilOp:yX,IncrementWrapStencilOp:vX,InstancedBufferAttribute:Za,InstancedBufferGeometry:iG,InstancedInterleavedBuffer:hN,InstancedMesh:Fl,Int16BufferAttribute:p9,Int32BufferAttribute:m9,Int8BufferAttribute:d9,IntType:DW,InterleavedBuffer:GC,InterleavedBufferAttribute:Gg,Interpolant:lI,InterpolateDiscrete:Ul,InterpolateLinear:va,InterpolateSmooth:Od,InvertStencilOp:wX,KeepStencilOp:jd,KeyframeTrack:Os,LOD:VS,LatheBufferGeometry:$N,LatheGeometry:oI,Layers:ha,LessDepth:HW,LessEqualDepth:RA,LessEqualStencilFunc:VX,LessStencilFunc:SX,Light:Sg,LightProbe:Ch,Line:ar,Line3:GN,LineBasicMaterial:bi,LineCurve:Ih,LineCurve3:FS,LineDashedMaterial:QS,LineLoop:Lb,LineSegments:Ps,LinearEncoding:bg,LinearFilter:en,LinearInterpolant:Qb,LinearMipMapLinearFilter:pX,LinearMipMapNearestFilter:hX,LinearMipmapLinearFilter:Cr,LinearMipmapNearestFilter:jA,LinearSRGBColorSpace:tg,LinearToneMapping:kW,Loader:Yi,LoaderUtils:fo,LoadingManager:jb,LoopOnce:rS,LoopPingPong:aS,LoopRepeat:gS,LuminanceAlphaFormat:$W,LuminanceFormat:qW,MOUSE:IX,Material:Tn,MaterialLoader:uh,MathUtils:Vb,Matrix3:Si,Matrix4:dt,MaxEquation:Yf,Mesh:fn,MeshBasicMaterial:Ji,MeshDepthMaterial:ih,MeshDistanceMaterial:sh,MeshLambertMaterial:DS,MeshMatcapMaterial:PS,MeshNormalMaterial:US,MeshPhongMaterial:_S,MeshPhysicalMaterial:mr,MeshStandardMaterial:aI,MeshToonMaterial:JS,MinEquation:Xf,MirroredRepeatWrapping:_l,MixOperation:LW,MultiplyBlending:xf,MultiplyOperation:pC,NearestFilter:Sn,NearestMipMapLinearFilter:AX,NearestMipMapNearestFilter:dX,NearestMipmapLinearFilter:$c,NearestMipmapNearestFilter:qc,NeverDepth:XW,NeverStencilFunc:WX,NoBlending:tr,NoColorSpace:fX,NoToneMapping:po,NormalAnimationBlendMode:qA,NormalBlending:Ca,NotEqualDepth:MW,NotEqualStencilFunc:XX,NumberKeyframeTrack:Ql,Object3D:St,ObjectLoader:_3,ObjectSpaceNormalMap:cS,OctahedronBufferGeometry:eM,OctahedronGeometry:rI,OneFactor:vW,OneMinusDstAlphaFactor:SW,OneMinusDstColorFactor:VW,OneMinusSrcAlphaFactor:Bb,OneMinusSrcColorFactor:wW,OrthographicCamera:iI,PCFShadowMap:bb,PCFSoftShadowMap:Gb,PMREMGenerator:i0,Path:sC,PerspectiveCamera:zn,Plane:Dr,PlaneBufferGeometry:XA,PlaneGeometry:nI,PlaneHelper:YN,PointLight:tG,PointLightHelper:vN,Points:zb,PointsMaterial:ah,PolarGridHelper:SN,PolyhedronBufferGeometry:tM,PolyhedronGeometry:pr,PositionalAudio:$3,PropertyBinding:Vt,PropertyMixer:aR,QuadraticBezierCurve:Eb,QuadraticBezierCurve3:_b,Quaternion:Qn,QuaternionKeyframeTrack:Bg,QuaternionLinearInterpolant:$S,REVISION:QA,RGBADepthPacking:Sb,RGBAFormat:fs,RGBAIntegerFormat:sS,RGBA_ASTC_10x10_Format:jf,RGBA_ASTC_10x5_Format:Pf,RGBA_ASTC_10x6_Format:Qf,RGBA_ASTC_10x8_Format:Of,RGBA_ASTC_12x10_Format:qf,RGBA_ASTC_12x12_Format:$f,RGBA_ASTC_4x4_Format:zf,RGBA_ASTC_5x4_Format:kf,RGBA_ASTC_5x5_Format:Tf,RGBA_ASTC_6x5_Format:Ef,RGBA_ASTC_6x6_Format:_f,RGBA_ASTC_8x5_Format:Jf,RGBA_ASTC_8x6_Format:Uf,RGBA_ASTC_8x8_Format:Df,RGBA_BPTC_Format:e0,RGBA_ETC2_EAC_Format:Lf,RGBA_PVRTC_2BPPV1_Format:Nf,RGBA_PVRTC_4BPPV1_Format:Kf,RGBA_S3TC_DXT1_Format:Dd,RGBA_S3TC_DXT3_Format:Pd,RGBA_S3TC_DXT5_Format:Qd,RGBFormat:jW,RGB_ETC1_Format:oS,RGB_ETC2_Format:Mf,RGB_PVRTC_2BPPV1_Format:Ff,RGB_PVRTC_4BPPV1_Format:Hf,RGB_S3TC_DXT1_Format:Ud,RGFormat:nS,RGIntegerFormat:iS,RawShaderMaterial:ES,Ray:fC,Raycaster:lR,RectAreaLight:iR,RedFormat:eS,RedIntegerFormat:tS,ReinhardToneMapping:TW,RepeatWrapping:gr,ReplaceStencilOp:GX,ReverseSubtractEquation:yW,RingBufferGeometry:nM,RingGeometry:RC,SRGBColorSpace:Co,Scene:Kb,ShaderChunk:yt,ShaderLib:Es,ShaderMaterial:Ds,ShadowMaterial:TS,Shape:pa,ShapeBufferGeometry:iM,ShapeGeometry:VC,ShapePath:KN,ShapeUtils:mo,ShortType:UW,Skeleton:yC,SkeletonHelper:BN,SkinnedMesh:Mb,Source:ga,Sphere:Ar,SphereBufferGeometry:sM,SphereGeometry:gI,Spherical:mN,SphericalHarmonics3:sR,SplineCurve:Jb,SpotLight:eG,SpotLightHelper:yN,Sprite:RS,SpriteMaterial:Nb,SrcAlphaFactor:yb,SrcAlphaSaturateFactor:xW,SrcColorFactor:ZW,StaticCopyUsage:MX,StaticDrawUsage:tC,StaticReadUsage:FX,StereoCamera:Q3,StreamCopyUsage:zX,StreamDrawUsage:HX,StreamReadUsage:NX,StringKeyframeTrack:xa,SubtractEquation:GW,SubtractiveBlending:Vf,TOUCH:cX,TangentSpaceNormalMap:ur,TetrahedronBufferGeometry:oM,TetrahedronGeometry:xC,Texture:Cn,TextureLoader:qb,TorusBufferGeometry:rM,TorusGeometry:XC,TorusKnotBufferGeometry:gM,TorusKnotGeometry:YC,Triangle:hs,TriangleFanDrawMode:Wb,TriangleStripDrawMode:lS,TrianglesDrawMode:mX,TubeBufferGeometry:aM,TubeGeometry:HC,UVMapping:OA,Uint16BufferAttribute:Xb,Uint32BufferAttribute:Yb,Uint8BufferAttribute:A9,Uint8ClampedBufferAttribute:h9,Uniform:aG,UniformsGroup:AN,UniformsLib:_e,UniformsUtils:eh,UnsignedByteType:fg,UnsignedInt248Type:ua,UnsignedIntType:eg,UnsignedShort4444Type:PW,UnsignedShort5551Type:QW,UnsignedShortType:Zb,VSMShadowMap:Bl,Vector2:Se,Vector3:N,Vector4:Ht,VectorKeyframeTrack:Ol,VideoTexture:t3,WebGL1Renderer:WS,WebGL3DRenderTarget:s9,WebGLArrayRenderTarget:i9,WebGLCubeRenderTarget:mS,WebGLMultipleRenderTargets:o9,WebGLMultisampleRenderTarget:TN,WebGLRenderTarget:Bs,WebGLRenderer:Fb,WebGLUtils:vS,WireframeGeometry:kS,WrapAroundEnding:eC,ZeroCurvatureEnding:oa,ZeroFactor:BW,ZeroSlopeEnding:ra,ZeroStencilOp:bX,_SRGBAFormat:VA,sRGBEncoding:Yt},Symbol.toStringTag,{value:"Module"}));function IM(i){let e;const t=new Set,n=(l,I)=>{const C=typeof l=="function"?l(e):l;if(C!==e){const u=e;e=I?C:Object.assign({},e,C),t.forEach(A=>A(e,u))}},s=()=>e,o=(l,I=s,C=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let u=I(e);function A(){const h=I(e);if(!C(u,h)){const m=u;l(u=h,m)}}return t.add(A),()=>t.delete(A)},a={setState:n,getState:s,subscribe:(l,I,C)=>I||C?o(l,I,C):(t.add(l),()=>t.delete(l)),destroy:()=>t.clear()};return e=i(n,s,a),a}const cM=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),sZ=cM?Je.exports.useEffect:Je.exports.useLayoutEffect;function CM(i){const e=typeof i=="function"?IM(i):i,t=(n=e.getState,s=Object.is)=>{const[,o]=Je.exports.useReducer(b=>b+1,0),r=e.getState(),g=Je.exports.useRef(r),a=Je.exports.useRef(n),l=Je.exports.useRef(s),I=Je.exports.useRef(!1),C=Je.exports.useRef();C.current===void 0&&(C.current=n(r));let u,A=!1;(g.current!==r||a.current!==n||l.current!==s||I.current)&&(u=n(r),A=!s(C.current,u)),sZ(()=>{A&&(C.current=u),g.current=r,a.current=n,l.current=s,I.current=!1});const h=Je.exports.useRef(r);sZ(()=>{const b=()=>{try{const f=e.getState(),y=a.current(f);l.current(C.current,y)||(g.current=f,C.current=y,o())}catch{I.current=!0,o()}},G=e.subscribe(b);return e.getState()!==h.current&&b(),G},[]);const m=A?u:C.current;return Je.exports.useDebugValue(m),m};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const n=[t,e];return{next(){const s=n.length<=0;return{value:n.shift(),done:s}}}},t}function uM(i,e){if(Object.is(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;const t=Object.keys(i);if(t.length!==Object.keys(e).length)return!1;for(let n=0;n<t.length;n++)if(!Object.prototype.hasOwnProperty.call(e,t[n])||!Object.is(i[t[n]],e[t[n]]))return!1;return!0}var cR={exports:{}},CR={exports:{}};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var bm,oZ;function dM(){if(oZ)return bm;oZ=1;var i=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function n(o){if(o==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(o)}function s(){try{if(!Object.assign)return!1;var o=new String("abc");if(o[5]="de",Object.getOwnPropertyNames(o)[0]==="5")return!1;for(var r={},g=0;g<10;g++)r["_"+String.fromCharCode(g)]=g;var a=Object.getOwnPropertyNames(r).map(function(I){return r[I]});if(a.join("")!=="0123456789")return!1;var l={};return"abcdefghijklmnopqrst".split("").forEach(function(I){l[I]=I}),Object.keys(Object.assign({},l)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return bm=s()?Object.assign:function(o,r){for(var g,a=n(o),l,I=1;I<arguments.length;I++){g=Object(arguments[I]);for(var C in g)e.call(g,C)&&(a[C]=g[C]);if(i){l=i(g);for(var u=0;u<l.length;u++)t.call(g,l[u])&&(a[l[u]]=g[l[u]])}}return a},bm}var Vc={exports:{}},uR={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){var e,t,n,s;if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var r=Date,g=r.now();i.unstable_now=function(){return r.now()-g}}if(typeof window>"u"||typeof MessageChannel!="function"){var a=null,l=null,I=function(){if(a!==null)try{var X=i.unstable_now();a(!0,X),a=null}catch(T){throw setTimeout(I,0),T}};e=function(X){a!==null?setTimeout(e,0,X):(a=X,setTimeout(I,0))},t=function(X,T){l=setTimeout(X,T)},n=function(){clearTimeout(l)},i.unstable_shouldYield=function(){return!1},s=i.unstable_forceFrameRate=function(){}}else{var C=window.setTimeout,u=window.clearTimeout;if(typeof console<"u"){var A=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof A!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var h=!1,m=null,b=-1,G=5,f=0;i.unstable_shouldYield=function(){return i.unstable_now()>=f},s=function(){},i.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<X?Math.floor(1e3/X):5};var y=new MessageChannel,B=y.port2;y.port1.onmessage=function(){if(m!==null){var X=i.unstable_now();f=X+G;try{m(!0,X)?B.postMessage(null):(h=!1,m=null)}catch(T){throw B.postMessage(null),T}}else h=!1},e=function(X){m=X,h||(h=!0,B.postMessage(null))},t=function(X,T){b=C(function(){X(i.unstable_now())},T)},n=function(){u(b),b=-1}}function v(X,T){var Q=X.length;X.push(T);e:for(;;){var ee=Q-1>>>1,oe=X[ee];if(oe!==void 0&&0<Z(oe,T))X[ee]=T,X[Q]=oe,Q=ee;else break e}}function W(X){return X=X[0],X===void 0?null:X}function R(X){var T=X[0];if(T!==void 0){var Q=X.pop();if(Q!==T){X[0]=Q;e:for(var ee=0,oe=X.length;ee<oe;){var j=2*(ee+1)-1,ge=X[j],Ie=j+1,Be=X[Ie];if(ge!==void 0&&0>Z(ge,Q))Be!==void 0&&0>Z(Be,ge)?(X[ee]=Be,X[Ie]=Q,ee=Ie):(X[ee]=ge,X[j]=Q,ee=j);else if(Be!==void 0&&0>Z(Be,Q))X[ee]=Be,X[Ie]=Q,ee=Ie;else break e}}return T}return null}function Z(X,T){var Q=X.sortIndex-T.sortIndex;return Q!==0?Q:X.id-T.id}var V=[],H=[],P=1,E=null,L=3,K=!1,O=!1,q=!1;function ne(X){for(var T=W(H);T!==null;){if(T.callback===null)R(H);else if(T.startTime<=X)R(H),T.sortIndex=T.expirationTime,v(V,T);else break;T=W(H)}}function k(X){if(q=!1,ne(X),!O)if(W(V)!==null)O=!0,e(F);else{var T=W(H);T!==null&&t(k,T.startTime-X)}}function F(X,T){O=!1,q&&(q=!1,n()),K=!0;var Q=L;try{for(ne(T),E=W(V);E!==null&&(!(E.expirationTime>T)||X&&!i.unstable_shouldYield());){var ee=E.callback;if(typeof ee=="function"){E.callback=null,L=E.priorityLevel;var oe=ee(E.expirationTime<=T);T=i.unstable_now(),typeof oe=="function"?E.callback=oe:E===W(V)&&R(V),ne(T)}else R(V);E=W(V)}if(E!==null)var j=!0;else{var ge=W(H);ge!==null&&t(k,ge.startTime-T),j=!1}return j}finally{E=null,L=Q,K=!1}}var z=s;i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(X){X.callback=null},i.unstable_continueExecution=function(){O||K||(O=!0,e(F))},i.unstable_getCurrentPriorityLevel=function(){return L},i.unstable_getFirstCallbackNode=function(){return W(V)},i.unstable_next=function(X){switch(L){case 1:case 2:case 3:var T=3;break;default:T=L}var Q=L;L=T;try{return X()}finally{L=Q}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=z,i.unstable_runWithPriority=function(X,T){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Q=L;L=X;try{return T()}finally{L=Q}},i.unstable_scheduleCallback=function(X,T,Q){var ee=i.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ee+Q:ee):Q=ee,X){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Q+oe,X={id:P++,callback:T,priorityLevel:X,startTime:Q,expirationTime:oe,sortIndex:-1},Q>ee?(X.sortIndex=Q,v(H,X),W(V)===null&&X===W(H)&&(q?n():q=!0,t(k,Q-ee))):(X.sortIndex=oe,v(V,X),O||K||(O=!0,e(F))),X},i.unstable_wrapCallback=function(X){var T=L;return function(){var Q=L;L=T;try{return X.apply(this,arguments)}finally{L=Q}}}})(uR);(function(i){i.exports=uR})(Vc);/** @license React v0.26.2
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){i.exports=function(t){var n={},s=dM(),o=Je.exports,r=Vc.exports;function g(c){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+c,p=1;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p]);return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=60103,I=60106,C=60107,u=60108,A=60114,h=60109,m=60110,b=60112,G=60113,f=60120,y=60115,B=60116,v=60121,W=60129,R=60130,Z=60131;if(typeof Symbol=="function"&&Symbol.for){var V=Symbol.for;l=V("react.element"),I=V("react.portal"),C=V("react.fragment"),u=V("react.strict_mode"),A=V("react.profiler"),h=V("react.provider"),m=V("react.context"),b=V("react.forward_ref"),G=V("react.suspense"),f=V("react.suspense_list"),y=V("react.memo"),B=V("react.lazy"),v=V("react.block"),V("react.scope"),W=V("react.debug_trace_mode"),R=V("react.offscreen"),Z=V("react.legacy_hidden")}var H=typeof Symbol=="function"&&Symbol.iterator;function P(c){return c===null||typeof c!="object"?null:(c=H&&c[H]||c["@@iterator"],typeof c=="function"?c:null)}function E(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case C:return"Fragment";case I:return"Portal";case A:return"Profiler";case u:return"StrictMode";case G:return"Suspense";case f:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case m:return(c.displayName||"Context")+".Consumer";case h:return(c._context.displayName||"Context")+".Provider";case b:var d=c.render;return d=d.displayName||d.name||"",c.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case y:return E(c.type);case v:return E(c._render);case B:d=c._payload,c=c._init;try{return E(c(d))}catch{}}return null}function L(c){var d=c,p=c;if(c.alternate)for(;d.return;)d=d.return;else{c=d;do d=c,(d.flags&1026)!==0&&(p=d.return),c=d.return;while(c)}return d.tag===3?p:null}function K(c){if(L(c)!==c)throw Error(g(188))}function O(c){var d=c.alternate;if(!d){if(d=L(c),d===null)throw Error(g(188));return d!==c?null:c}for(var p=c,w=d;;){var S=p.return;if(S===null)break;var x=S.alternate;if(x===null){if(w=S.return,w!==null){p=w;continue}break}if(S.child===x.child){for(x=S.child;x;){if(x===p)return K(S),c;if(x===w)return K(S),d;x=x.sibling}throw Error(g(188))}if(p.return!==w.return)p=S,w=x;else{for(var D=!1,ie=S.child;ie;){if(ie===p){D=!0,p=S,w=x;break}if(ie===w){D=!0,w=S,p=x;break}ie=ie.sibling}if(!D){for(ie=x.child;ie;){if(ie===p){D=!0,p=x,w=S;break}if(ie===w){D=!0,w=x,p=S;break}ie=ie.sibling}if(!D)throw Error(g(189))}}if(p.alternate!==w)throw Error(g(190))}if(p.tag!==3)throw Error(g(188));return p.stateNode.current===p?c:d}function q(c){if(c=O(c),!c)return null;for(var d=c;;){if(d.tag===5||d.tag===6)return d;if(d.child)d.child.return=d,d=d.child;else{if(d===c)break;for(;!d.sibling;){if(!d.return||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}}return null}function ne(c){if(c=O(c),!c)return null;for(var d=c;;){if(d.tag===5||d.tag===6)return d;if(d.child&&d.tag!==4)d.child.return=d,d=d.child;else{if(d===c)break;for(;!d.sibling;){if(!d.return||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}}return null}function k(c,d){for(var p=c.alternate;d!==null;){if(d===c||d===p)return!0;d=d.return}return!1}var F=t.getPublicInstance,z=t.getRootHostContext,X=t.getChildHostContext,T=t.prepareForCommit,Q=t.resetAfterCommit,ee=t.createInstance,oe=t.appendInitialChild,j=t.finalizeInitialChildren,ge=t.prepareUpdate,Ie=t.shouldSetTextContent,Be=t.createTextInstance,ve=t.scheduleTimeout,Ye=t.cancelTimeout,se=t.noTimeout,ue=t.isPrimaryRenderer,Ge=t.supportsMutation,xe=t.supportsPersistence,fe=t.supportsHydration,Qe=t.getInstanceFromNode,de=t.makeOpaqueHydratingObject,Xe=t.makeClientId,Le=t.beforeActiveInstanceBlur,me=t.afterActiveInstanceBlur,M=t.preparePortalMount,Y=t.supportsTestSelectors,te=t.findFiberRoot,ce=t.getBoundingRect,we=t.getTextContent,Re=t.isHiddenSubtree,Ve=t.matchAccessibilityRole,We=t.setFocusIfFocusable,he=t.setupIntersectionObserver,ze=t.appendChild,Pe=t.appendChildToContainer,Te=t.commitTextUpdate,Fe=t.commitMount,Ke=t.commitUpdate,$e=t.insertBefore,$=t.insertInContainerBefore,De=t.removeChild,He=t.removeChildFromContainer,Ae=t.resetTextContent,ke=t.hideInstance,gt=t.hideTextInstance,At=t.unhideInstance,Tt=t.unhideTextInstance,Bt=t.clearContainer,rt=t.cloneInstance,Kt=t.createContainerChildSet,Et=t.appendChildToContainerChildSet,_t=t.finalizeContainerChildren,on=t.replaceContainerChildren,gi=t.cloneHiddenInstance,un=t.cloneHiddenTextInstance,dn=t.canHydrateInstance,On=t.canHydrateTextInstance,_=t.isSuspenseInstancePending,le=t.isSuspenseInstanceFallback,pe=t.getNextHydratableSibling,ae=t.getFirstHydratableChild,Ze=t.hydrateInstance,ot=t.hydrateTextInstance,ct=t.getNextHydratableInstanceAfterSuspenseInstance,pt=t.commitHydratedContainer,Ct=t.commitHydratedSuspenseInstance,vt;function mt(c){if(vt===void 0)try{throw Error()}catch(p){var d=p.stack.trim().match(/\n( *(at )?)/);vt=d&&d[1]||""}return`
`+vt+c}var Gt=!1;function Nt(c,d){if(!c||Gt)return"";Gt=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(be){var w=be}Reflect.construct(c,[],d)}else{try{d.call()}catch(be){w=be}c.call(d.prototype)}else{try{throw Error()}catch(be){w=be}c()}}catch(be){if(be&&w&&typeof be.stack=="string"){for(var S=be.stack.split(`
`),x=w.stack.split(`
`),D=S.length-1,ie=x.length-1;1<=D&&0<=ie&&S[D]!==x[ie];)ie--;for(;1<=D&&0<=ie;D--,ie--)if(S[D]!==x[ie]){if(D!==1||ie!==1)do if(D--,ie--,0>ie||S[D]!==x[ie])return`
`+S[D].replace(" at new "," at ");while(1<=D&&0<=ie);break}}}finally{Gt=!1,Error.prepareStackTrace=p}return(c=c?c.displayName||c.name:"")?mt(c):""}var ai=[],jn=-1;function Kn(c){return{current:c}}function Ne(c){0>jn||(c.current=ai[jn],ai[jn]=null,jn--)}function nt(c,d){jn++,ai[jn]=c.current,c.current=d}var qn={},ft=Kn(qn),Mt=Kn(!1),Vn=qn;function $n(c,d){var p=c.type.contextTypes;if(!p)return qn;var w=c.stateNode;if(w&&w.__reactInternalMemoizedUnmaskedChildContext===d)return w.__reactInternalMemoizedMaskedChildContext;var S={},x;for(x in p)S[x]=d[x];return w&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=d,c.__reactInternalMemoizedMaskedChildContext=S),S}function rn(c){return c=c.childContextTypes,c!=null}function gn(){Ne(Mt),Ne(ft)}function Gi(c,d,p){if(ft.current!==qn)throw Error(g(168));nt(ft,d),nt(Mt,p)}function Bo(c,d,p){var w=c.stateNode;if(c=d.childContextTypes,typeof w.getChildContext!="function")return p;w=w.getChildContext();for(var S in w)if(!(S in c))throw Error(g(108,E(d)||"Unknown",S));return s({},p,w)}function An(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||qn,Vn=ft.current,nt(ft,c),nt(Mt,Mt.current),!0}function vo(c,d,p){var w=c.stateNode;if(!w)throw Error(g(169));p?(c=Bo(c,d,Vn),w.__reactInternalMemoizedMergedChildContext=c,Ne(Mt),Ne(ft),nt(ft,c)):Ne(Mt),nt(Mt,p)}var ws=null,Hi=null,fr=r.unstable_now;fr();var br=0,Lt=8;function Ws(c){if((1&c)!==0)return Lt=15,1;if((2&c)!==0)return Lt=14,2;if((4&c)!==0)return Lt=13,4;var d=24&c;return d!==0?(Lt=12,d):(c&32)!==0?(Lt=11,32):(d=192&c,d!==0?(Lt=10,d):(c&256)!==0?(Lt=9,256):(d=3584&c,d!==0?(Lt=8,d):(c&4096)!==0?(Lt=7,4096):(d=4186112&c,d!==0?(Lt=6,d):(d=62914560&c,d!==0?(Lt=5,d):c&67108864?(Lt=4,67108864):(c&134217728)!==0?(Lt=3,134217728):(d=805306368&c,d!==0?(Lt=2,d):(1073741824&c)!==0?(Lt=1,1073741824):(Lt=8,c))))))}function Rg(c){switch(c){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function Gh(c){switch(c){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(g(358,c))}}function js(c,d){var p=c.pendingLanes;if(p===0)return Lt=0;var w=0,S=0,x=c.expiredLanes,D=c.suspendedLanes,ie=c.pingedLanes;if(x!==0)w=x,S=Lt=15;else if(x=p&134217727,x!==0){var be=x&~D;be!==0?(w=Ws(be),S=Lt):(ie&=x,ie!==0&&(w=Ws(ie),S=Lt))}else x=p&~D,x!==0?(w=Ws(x),S=Lt):ie!==0&&(w=Ws(ie),S=Lt);if(w===0)return 0;if(w=31-rs(w),w=p&((0>w?0:1<<w)<<1)-1,d!==0&&d!==w&&(d&D)===0){if(Ws(d),S<=Lt)return d;Lt=S}if(d=c.entangledLanes,d!==0)for(c=c.entanglements,d&=w;0<d;)p=31-rs(d),S=1<<p,w|=c[p],d&=~S;return w}function Vg(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function qs(c,d){switch(c){case 15:return 1;case 14:return 2;case 12:return c=Zo(24&~d),c===0?qs(10,d):c;case 10:return c=Zo(192&~d),c===0?qs(8,d):c;case 8:return c=Zo(3584&~d),c===0&&(c=Zo(4186112&~d),c===0&&(c=512)),c;case 2:return d=Zo(805306368&~d),d===0&&(d=268435456),d}throw Error(g(358,c))}function Zo(c){return c&-c}function Gr(c){for(var d=[],p=0;31>p;p++)d.push(c);return d}function wo(c,d,p){c.pendingLanes|=d;var w=d-1;c.suspendedLanes&=w,c.pingedLanes&=w,c=c.eventTimes,d=31-rs(d),c[d]=p}var rs=Math.clz32?Math.clz32:uI,FC=Math.log,KC=Math.LN2;function uI(c){return c===0?32:31-(FC(c)/KC|0)|0}var xg=r.unstable_runWithPriority,Xa=r.unstable_scheduleCallback,yr=r.unstable_cancelCallback,Br=r.unstable_shouldYield,Wo=r.unstable_requestPaint,So=r.unstable_now,NC=r.unstable_getCurrentPriorityLevel,$s=r.unstable_ImmediatePriority,Ya=r.unstable_UserBlockingPriority,Ha=r.unstable_NormalPriority,dI=r.unstable_LowPriority,vr=r.unstable_IdlePriority,Zr={},MC=Wo!==void 0?Wo:function(){},bn=null,wr=null,Xg=!1,AI=So(),Gn=1e4>AI?So:function(){return So()-AI};function Ss(){switch(NC()){case $s:return 99;case Ya:return 98;case Ha:return 97;case dI:return 96;case vr:return 95;default:throw Error(g(332))}}function hI(c){switch(c){case 99:return $s;case 98:return Ya;case 97:return Ha;case 96:return dI;case 95:return vr;default:throw Error(g(332))}}function yi(c,d){return c=hI(c),xg(c,d)}function Rs(c,d,p){return c=hI(c),Xa(c,d,p)}function yn(){if(wr!==null){var c=wr;wr=null,yr(c)}pI()}function pI(){if(!Xg&&bn!==null){Xg=!0;var c=0;try{var d=bn;yi(99,function(){for(;c<d.length;c++){var p=d[c];do p=p(!0);while(p!==null)}}),bn=null}catch(p){throw bn!==null&&(bn=bn.slice(c+1)),Xa($s,yn),p}finally{Xg=!1}}}var mI=a.ReactCurrentBatchConfig;function fI(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var Jn=typeof Object.is=="function"?Object.is:fI,LC=Object.prototype.hasOwnProperty;function eo(c,d){if(Jn(c,d))return!0;if(typeof c!="object"||c===null||typeof d!="object"||d===null)return!1;var p=Object.keys(c),w=Object.keys(d);if(p.length!==w.length)return!1;for(w=0;w<p.length;w++)if(!LC.call(d,p[w])||!Jn(c[p[w]],d[p[w]]))return!1;return!0}function Fa(c){switch(c.tag){case 5:return mt(c.type);case 16:return mt("Lazy");case 13:return mt("Suspense");case 19:return mt("SuspenseList");case 0:case 2:case 15:return c=Nt(c.type,!1),c;case 11:return c=Nt(c.type.render,!1),c;case 22:return c=Nt(c.type._render,!1),c;case 1:return c=Nt(c.type,!0),c;default:return""}}function qt(c,d){if(c&&c.defaultProps){d=s({},d),c=c.defaultProps;for(var p in c)d[p]===void 0&&(d[p]=c[p]);return d}return d}var Ka=Kn(null),Ro=null,Vs=null,Yg=null;function bI(){Yg=Vs=Ro=null}function Vo(c,d){c=c.type._context,ue?(nt(Ka,c._currentValue),c._currentValue=d):(nt(Ka,c._currentValue2),c._currentValue2=d)}function xn(c){var d=Ka.current;Ne(Ka),c=c.type._context,ue?c._currentValue=d:c._currentValue2=d}function Fi(c,d){for(;c!==null;){var p=c.alternate;if((c.childLanes&d)===d){if(p===null||(p.childLanes&d)===d)break;p.childLanes|=d}else c.childLanes|=d,p!==null&&(p.childLanes|=d);c=c.return}}function Bn(c,d){Ro=c,Yg=Vs=null,c=c.dependencies,c!==null&&c.firstContext!==null&&((c.lanes&d)!==0&&(Xs=!0),c.firstContext=null)}function vn(c,d){if(Yg!==c&&d!==!1&&d!==0)if((typeof d!="number"||d===1073741823)&&(Yg=c,d=1073741823),d={context:c,observedBits:d,next:null},Vs===null){if(Ro===null)throw Error(g(308));Vs=d,Ro.dependencies={lanes:0,firstContext:d,responders:null}}else Vs=Vs.next=d;return ue?c._currentValue:c._currentValue2}var xs=!1;function yh(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function fG(c,d){c=c.updateQueue,d.updateQueue===c&&(d.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function Wr(c,d){return{eventTime:c,lane:d,tag:0,payload:null,callback:null,next:null}}function Sr(c,d){if(c=c.updateQueue,c!==null){c=c.shared;var p=c.pending;p===null?d.next=d:(d.next=p.next,p.next=d),c.pending=d}}function bG(c,d){var p=c.updateQueue,w=c.alternate;if(w!==null&&(w=w.updateQueue,p===w)){var S=null,x=null;if(p=p.firstBaseUpdate,p!==null){do{var D={eventTime:p.eventTime,lane:p.lane,tag:p.tag,payload:p.payload,callback:p.callback,next:null};x===null?S=x=D:x=x.next=D,p=p.next}while(p!==null);x===null?S=x=d:x=x.next=d}else S=x=d;p={baseState:w.baseState,firstBaseUpdate:S,lastBaseUpdate:x,shared:w.shared,effects:w.effects},c.updateQueue=p;return}c=p.lastBaseUpdate,c===null?p.firstBaseUpdate=d:c.next=d,p.lastBaseUpdate=d}function GI(c,d,p,w){var S=c.updateQueue;xs=!1;var x=S.firstBaseUpdate,D=S.lastBaseUpdate,ie=S.shared.pending;if(ie!==null){S.shared.pending=null;var be=ie,Ue=be.next;be.next=null,D===null?x=Ue:D.next=Ue,D=be;var at=c.alternate;if(at!==null){at=at.updateQueue;var ut=at.lastBaseUpdate;ut!==D&&(ut===null?at.firstBaseUpdate=Ue:ut.next=Ue,at.lastBaseUpdate=be)}}if(x!==null){ut=S.baseState,D=0,at=Ue=be=null;do{ie=x.lane;var je=x.eventTime;if((w&ie)===ie){at!==null&&(at=at.next={eventTime:je,lane:0,tag:x.tag,payload:x.payload,callback:x.callback,next:null});e:{var Dt=c,nn=x;switch(ie=d,je=p,nn.tag){case 1:if(Dt=nn.payload,typeof Dt=="function"){ut=Dt.call(je,ut,ie);break e}ut=Dt;break e;case 3:Dt.flags=Dt.flags&-4097|64;case 0:if(Dt=nn.payload,ie=typeof Dt=="function"?Dt.call(je,ut,ie):Dt,ie==null)break e;ut=s({},ut,ie);break e;case 2:xs=!0}}x.callback!==null&&(c.flags|=32,ie=S.effects,ie===null?S.effects=[x]:ie.push(x))}else je={eventTime:je,lane:ie,tag:x.tag,payload:x.payload,callback:x.callback,next:null},at===null?(Ue=at=je,be=ut):at=at.next=je,D|=ie;if(x=x.next,x===null){if(ie=S.shared.pending,ie===null)break;x=ie.next,ie.next=null,S.lastBaseUpdate=ie,S.shared.pending=null}}while(1);at===null&&(be=ut),S.baseState=be,S.firstBaseUpdate=Ue,S.lastBaseUpdate=at,FI|=D,c.lanes=D,c.memoizedState=ut}}function GG(c,d,p){if(c=d.effects,d.effects=null,c!==null)for(d=0;d<c.length;d++){var w=c[d],S=w.callback;if(S!==null){if(w.callback=null,w=p,typeof S!="function")throw Error(g(191,S));S.call(w)}}}var yG=new o.Component().refs;function zC(c,d,p,w){d=c.memoizedState,p=p(w,d),p=p==null?d:s({},d,p),c.memoizedState=p,c.lanes===0&&(c.updateQueue.baseState=p)}var kC={isMounted:function(c){return(c=c._reactInternals)?L(c)===c:!1},enqueueSetState:function(c,d,p){c=c._reactInternals;var w=Mi(),S=xr(c),x=Wr(w,S);x.payload=d,p!=null&&(x.callback=p),Sr(c,x),Fo(c,S,w)},enqueueReplaceState:function(c,d,p){c=c._reactInternals;var w=Mi(),S=xr(c),x=Wr(w,S);x.tag=1,x.payload=d,p!=null&&(x.callback=p),Sr(c,x),Fo(c,S,w)},enqueueForceUpdate:function(c,d){c=c._reactInternals;var p=Mi(),w=xr(c),S=Wr(p,w);S.tag=2,d!=null&&(S.callback=d),Sr(c,S),Fo(c,w,p)}};function BG(c,d,p,w,S,x,D){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(w,x,D):d.prototype&&d.prototype.isPureReactComponent?!eo(p,w)||!eo(S,x):!0}function vG(c,d,p){var w=!1,S=qn,x=d.contextType;return typeof x=="object"&&x!==null?x=vn(x):(S=rn(d)?Vn:ft.current,w=d.contextTypes,x=(w=w!=null)?$n(c,S):qn),d=new d(p,x),c.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=kC,c.stateNode=d,d._reactInternals=c,w&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=S,c.__reactInternalMemoizedMaskedChildContext=x),d}function ZG(c,d,p,w){c=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(p,w),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(p,w),d.state!==c&&kC.enqueueReplaceState(d,d.state,null)}function Bh(c,d,p,w){var S=c.stateNode;S.props=p,S.state=c.memoizedState,S.refs=yG,yh(c);var x=d.contextType;typeof x=="object"&&x!==null?S.context=vn(x):(x=rn(d)?Vn:ft.current,S.context=$n(c,x)),GI(c,p,S,w),S.state=c.memoizedState,x=d.getDerivedStateFromProps,typeof x=="function"&&(zC(c,d,x,p),S.state=c.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(d=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),d!==S.state&&kC.enqueueReplaceState(S,S.state,null),GI(c,p,S,w),S.state=c.memoizedState),typeof S.componentDidMount=="function"&&(c.flags|=4)}var TC=Array.isArray;function yI(c,d,p){if(c=p.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(p._owner){if(p=p._owner,p){if(p.tag!==1)throw Error(g(309));var w=p.stateNode}if(!w)throw Error(g(147,c));var S=""+c;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===S?d.ref:(d=function(x){var D=w.refs;D===yG&&(D=w.refs={}),x===null?delete D[S]:D[S]=x},d._stringRef=S,d)}if(typeof c!="string")throw Error(g(284));if(!p._owner)throw Error(g(290,c))}return c}function EC(c,d){if(c.type!=="textarea")throw Error(g(31,Object.prototype.toString.call(d)==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":d))}function wG(c){function d(Ce,re){if(c){var ye=Ce.lastEffect;ye!==null?(ye.nextEffect=re,Ce.lastEffect=re):Ce.firstEffect=Ce.lastEffect=re,re.nextEffect=null,re.flags=8}}function p(Ce,re){if(!c)return null;for(;re!==null;)d(Ce,re),re=re.sibling;return null}function w(Ce,re){for(Ce=new Map;re!==null;)re.key!==null?Ce.set(re.key,re):Ce.set(re.index,re),re=re.sibling;return Ce}function S(Ce,re){return Ce=Yr(Ce,re),Ce.index=0,Ce.sibling=null,Ce}function x(Ce,re,ye){return Ce.index=ye,c?(ye=Ce.alternate,ye!==null?(ye=ye.index,ye<re?(Ce.flags=2,re):ye):(Ce.flags=2,re)):re}function D(Ce){return c&&Ce.alternate===null&&(Ce.flags=2),Ce}function ie(Ce,re,ye,Oe){return re===null||re.tag!==6?(re=cp(ye,Ce.mode,Oe),re.return=Ce,re):(re=S(re,ye),re.return=Ce,re)}function be(Ce,re,ye,Oe){return re!==null&&re.elementType===ye.type?(Oe=S(re,ye.props),Oe.ref=yI(Ce,re,ye),Oe.return=Ce,Oe):(Oe=pu(ye.type,ye.key,ye.props,null,Ce.mode,Oe),Oe.ref=yI(Ce,re,ye),Oe.return=Ce,Oe)}function Ue(Ce,re,ye,Oe){return re===null||re.tag!==4||re.stateNode.containerInfo!==ye.containerInfo||re.stateNode.implementation!==ye.implementation?(re=Cp(ye,Ce.mode,Oe),re.return=Ce,re):(re=S(re,ye.children||[]),re.return=Ce,re)}function at(Ce,re,ye,Oe,lt){return re===null||re.tag!==7?(re=_a(ye,Ce.mode,Oe,lt),re.return=Ce,re):(re=S(re,ye),re.return=Ce,re)}function ut(Ce,re,ye){if(typeof re=="string"||typeof re=="number")return re=cp(""+re,Ce.mode,ye),re.return=Ce,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case l:return ye=pu(re.type,re.key,re.props,null,Ce.mode,ye),ye.ref=yI(Ce,null,re),ye.return=Ce,ye;case I:return re=Cp(re,Ce.mode,ye),re.return=Ce,re}if(TC(re)||P(re))return re=_a(re,Ce.mode,ye,null),re.return=Ce,re;EC(Ce,re)}return null}function je(Ce,re,ye,Oe){var lt=re!==null?re.key:null;if(typeof ye=="string"||typeof ye=="number")return lt!==null?null:ie(Ce,re,""+ye,Oe);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case l:return ye.key===lt?ye.type===C?at(Ce,re,ye.props.children,Oe,lt):be(Ce,re,ye,Oe):null;case I:return ye.key===lt?Ue(Ce,re,ye,Oe):null}if(TC(ye)||P(ye))return lt!==null?null:at(Ce,re,ye,Oe,null);EC(Ce,ye)}return null}function Dt(Ce,re,ye,Oe,lt){if(typeof Oe=="string"||typeof Oe=="number")return Ce=Ce.get(ye)||null,ie(re,Ce,""+Oe,lt);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case l:return Ce=Ce.get(Oe.key===null?ye:Oe.key)||null,Oe.type===C?at(re,Ce,Oe.props.children,lt,Oe.key):be(re,Ce,Oe,lt);case I:return Ce=Ce.get(Oe.key===null?ye:Oe.key)||null,Ue(re,Ce,Oe,lt)}if(TC(Oe)||P(Oe))return Ce=Ce.get(ye)||null,at(re,Ce,Oe,lt,null);EC(re,Oe)}return null}function nn(Ce,re,ye,Oe){for(var lt=null,Qt=null,ht=re,zt=re=0,Xn=null;ht!==null&&zt<ye.length;zt++){ht.index>zt?(Xn=ht,ht=null):Xn=ht.sibling;var Rt=je(Ce,ht,ye[zt],Oe);if(Rt===null){ht===null&&(ht=Xn);break}c&&ht&&Rt.alternate===null&&d(Ce,ht),re=x(Rt,re,zt),Qt===null?lt=Rt:Qt.sibling=Rt,Qt=Rt,ht=Xn}if(zt===ye.length)return p(Ce,ht),lt;if(ht===null){for(;zt<ye.length;zt++)ht=ut(Ce,ye[zt],Oe),ht!==null&&(re=x(ht,re,zt),Qt===null?lt=ht:Qt.sibling=ht,Qt=ht);return lt}for(ht=w(Ce,ht);zt<ye.length;zt++)Xn=Dt(ht,Ce,zt,ye[zt],Oe),Xn!==null&&(c&&Xn.alternate!==null&&ht.delete(Xn.key===null?zt:Xn.key),re=x(Xn,re,zt),Qt===null?lt=Xn:Qt.sibling=Xn,Qt=Xn);return c&&ht.forEach(function(Hr){return d(Ce,Hr)}),lt}function Is(Ce,re,ye,Oe){var lt=P(ye);if(typeof lt!="function")throw Error(g(150));if(ye=lt.call(ye),ye==null)throw Error(g(151));for(var Qt=lt=null,ht=re,zt=re=0,Xn=null,Rt=ye.next();ht!==null&&!Rt.done;zt++,Rt=ye.next()){ht.index>zt?(Xn=ht,ht=null):Xn=ht.sibling;var Hr=je(Ce,ht,Rt.value,Oe);if(Hr===null){ht===null&&(ht=Xn);break}c&&ht&&Hr.alternate===null&&d(Ce,ht),re=x(Hr,re,zt),Qt===null?lt=Hr:Qt.sibling=Hr,Qt=Hr,ht=Xn}if(Rt.done)return p(Ce,ht),lt;if(ht===null){for(;!Rt.done;zt++,Rt=ye.next())Rt=ut(Ce,Rt.value,Oe),Rt!==null&&(re=x(Rt,re,zt),Qt===null?lt=Rt:Qt.sibling=Rt,Qt=Rt);return lt}for(ht=w(Ce,ht);!Rt.done;zt++,Rt=ye.next())Rt=Dt(ht,Ce,zt,Rt.value,Oe),Rt!==null&&(c&&Rt.alternate!==null&&ht.delete(Rt.key===null?zt:Rt.key),re=x(Rt,re,zt),Qt===null?lt=Rt:Qt.sibling=Rt,Qt=Rt);return c&&ht.forEach(function(JV){return d(Ce,JV)}),lt}return function(Ce,re,ye,Oe){var lt=typeof ye=="object"&&ye!==null&&ye.type===C&&ye.key===null;lt&&(ye=ye.props.children);var Qt=typeof ye=="object"&&ye!==null;if(Qt)switch(ye.$$typeof){case l:e:{for(Qt=ye.key,lt=re;lt!==null;){if(lt.key===Qt){switch(lt.tag){case 7:if(ye.type===C){p(Ce,lt.sibling),re=S(lt,ye.props.children),re.return=Ce,Ce=re;break e}break;default:if(lt.elementType===ye.type){p(Ce,lt.sibling),re=S(lt,ye.props),re.ref=yI(Ce,lt,ye),re.return=Ce,Ce=re;break e}}p(Ce,lt);break}else d(Ce,lt);lt=lt.sibling}ye.type===C?(re=_a(ye.props.children,Ce.mode,Oe,ye.key),re.return=Ce,Ce=re):(Oe=pu(ye.type,ye.key,ye.props,null,Ce.mode,Oe),Oe.ref=yI(Ce,re,ye),Oe.return=Ce,Ce=Oe)}return D(Ce);case I:e:{for(lt=ye.key;re!==null;){if(re.key===lt)if(re.tag===4&&re.stateNode.containerInfo===ye.containerInfo&&re.stateNode.implementation===ye.implementation){p(Ce,re.sibling),re=S(re,ye.children||[]),re.return=Ce,Ce=re;break e}else{p(Ce,re);break}else d(Ce,re);re=re.sibling}re=Cp(ye,Ce.mode,Oe),re.return=Ce,Ce=re}return D(Ce)}if(typeof ye=="string"||typeof ye=="number")return ye=""+ye,re!==null&&re.tag===6?(p(Ce,re.sibling),re=S(re,ye),re.return=Ce,Ce=re):(p(Ce,re),re=cp(ye,Ce.mode,Oe),re.return=Ce,Ce=re),D(Ce);if(TC(ye))return nn(Ce,re,ye,Oe);if(P(ye))return Is(Ce,re,ye,Oe);if(Qt&&EC(Ce,ye),typeof ye>"u"&&!lt)switch(Ce.tag){case 1:case 22:case 0:case 11:case 15:throw Error(g(152,E(Ce.type)||"Component"))}return p(Ce,re)}}var _C=wG(!0),WG=wG(!1),BI={},gs=Kn(BI),vI=Kn(BI),Na=Kn(BI);function to(c){if(c===BI)throw Error(g(174));return c}function vh(c,d){nt(Na,d),nt(vI,c),nt(gs,BI),c=z(d),Ne(gs),nt(gs,c)}function Ma(){Ne(gs),Ne(vI),Ne(Na)}function SG(c){var d=to(Na.current),p=to(gs.current);d=X(p,c.type,d),p!==d&&(nt(vI,c),nt(gs,d))}function Zh(c){vI.current===c&&(Ne(gs),Ne(vI))}var hn=Kn(0);function JC(c){for(var d=c;d!==null;){if(d.tag===13){var p=d.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||_(p)||le(p)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&64)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===c)break;for(;d.sibling===null;){if(d.return===null||d.return===c)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var xo=null,Hg=null,no=!1;function RG(c,d){var p=ls(5,null,null,0);p.elementType="DELETED",p.type="DELETED",p.stateNode=d,p.return=c,p.flags=8,c.lastEffect!==null?(c.lastEffect.nextEffect=p,c.lastEffect=p):c.firstEffect=c.lastEffect=p}function VG(c,d){switch(c.tag){case 5:return d=dn(d,c.type,c.pendingProps),d!==null?(c.stateNode=d,!0):!1;case 6:return d=On(d,c.pendingProps),d!==null?(c.stateNode=d,!0):!1;case 13:return!1;default:return!1}}function wh(c){if(no){var d=Hg;if(d){var p=d;if(!VG(c,d)){if(d=pe(p),!d||!VG(c,d)){c.flags=c.flags&-1025|2,no=!1,xo=c;return}RG(xo,p)}xo=c,Hg=ae(d)}else c.flags=c.flags&-1025|2,no=!1,xo=c}}function xG(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;xo=c}function UC(c){if(!fe||c!==xo)return!1;if(!no)return xG(c),no=!0,!1;var d=c.type;if(c.tag!==5||d!=="head"&&d!=="body"&&!Ie(d,c.memoizedProps))for(d=Hg;d;)RG(c,d),d=pe(d);if(xG(c),c.tag===13){if(!fe)throw Error(g(316));if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(g(317));Hg=ct(c)}else Hg=xo?pe(c.stateNode):null;return!0}function Wh(){fe&&(Hg=xo=null,no=!1)}var La=[];function Sh(){for(var c=0;c<La.length;c++){var d=La[c];ue?d._workInProgressVersionPrimary=null:d._workInProgressVersionSecondary=null}La.length=0}var ZI=a.ReactCurrentDispatcher,as=a.ReactCurrentBatchConfig,wI=0,Zn=null,li=null,ei=null,DC=!1,WI=!1;function Ki(){throw Error(g(321))}function Rh(c,d){if(d===null)return!1;for(var p=0;p<d.length&&p<c.length;p++)if(!Jn(c[p],d[p]))return!1;return!0}function Vh(c,d,p,w,S,x){if(wI=x,Zn=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,ZI.current=c===null||c.memoizedState===null?mV:fV,c=p(w,S),WI){x=0;do{if(WI=!1,!(25>x))throw Error(g(301));x+=1,ei=li=null,d.updateQueue=null,ZI.current=bV,c=p(w,S)}while(WI)}if(ZI.current=jC,d=li!==null&&li.next!==null,wI=0,ei=li=Zn=null,DC=!1,d)throw Error(g(300));return c}function Fg(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ei===null?Zn.memoizedState=ei=c:ei=ei.next=c,ei}function Kg(){if(li===null){var c=Zn.alternate;c=c!==null?c.memoizedState:null}else c=li.next;var d=ei===null?Zn.memoizedState:ei.next;if(d!==null)ei=d,li=c;else{if(c===null)throw Error(g(310));li=c,c={memoizedState:li.memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},ei===null?Zn.memoizedState=ei=c:ei=ei.next=c}return ei}function io(c,d){return typeof d=="function"?d(c):d}function SI(c){var d=Kg(),p=d.queue;if(p===null)throw Error(g(311));p.lastRenderedReducer=c;var w=li,S=w.baseQueue,x=p.pending;if(x!==null){if(S!==null){var D=S.next;S.next=x.next,x.next=D}w.baseQueue=S=x,p.pending=null}if(S!==null){S=S.next,w=w.baseState;var ie=D=x=null,be=S;do{var Ue=be.lane;if((wI&Ue)===Ue)ie!==null&&(ie=ie.next={lane:0,action:be.action,eagerReducer:be.eagerReducer,eagerState:be.eagerState,next:null}),w=be.eagerReducer===c?be.eagerState:c(w,be.action);else{var at={lane:Ue,action:be.action,eagerReducer:be.eagerReducer,eagerState:be.eagerState,next:null};ie===null?(D=ie=at,x=w):ie=ie.next=at,Zn.lanes|=Ue,FI|=Ue}be=be.next}while(be!==null&&be!==S);ie===null?x=w:ie.next=D,Jn(w,d.memoizedState)||(Xs=!0),d.memoizedState=w,d.baseState=x,d.baseQueue=ie,p.lastRenderedState=w}return[d.memoizedState,p.dispatch]}function RI(c){var d=Kg(),p=d.queue;if(p===null)throw Error(g(311));p.lastRenderedReducer=c;var w=p.dispatch,S=p.pending,x=d.memoizedState;if(S!==null){p.pending=null;var D=S=S.next;do x=c(x,D.action),D=D.next;while(D!==S);Jn(x,d.memoizedState)||(Xs=!0),d.memoizedState=x,d.baseQueue===null&&(d.baseState=x),p.lastRenderedState=x}return[x,w]}function XG(c,d,p){var w=d._getVersion;w=w(d._source);var S=ue?d._workInProgressVersionPrimary:d._workInProgressVersionSecondary;if(S!==null?c=S===w:(c=c.mutableReadLanes,(c=(wI&c)===c)&&(ue?d._workInProgressVersionPrimary=w:d._workInProgressVersionSecondary=w,La.push(d))),c)return p(d._source);throw La.push(d),Error(g(350))}function YG(c,d,p,w){var S=Bi;if(S===null)throw Error(g(349));var x=d._getVersion,D=x(d._source),ie=ZI.current,be=ie.useState(function(){return XG(S,d,p)}),Ue=be[1],at=be[0];be=ei;var ut=c.memoizedState,je=ut.refs,Dt=je.getSnapshot,nn=ut.source;ut=ut.subscribe;var Is=Zn;return c.memoizedState={refs:je,source:d,subscribe:w},ie.useEffect(function(){je.getSnapshot=p,je.setSnapshot=Ue;var Ce=x(d._source);if(!Jn(D,Ce)){Ce=p(d._source),Jn(at,Ce)||(Ue(Ce),Ce=xr(Is),S.mutableReadLanes|=Ce&S.pendingLanes),Ce=S.mutableReadLanes,S.entangledLanes|=Ce;for(var re=S.entanglements,ye=Ce;0<ye;){var Oe=31-rs(ye),lt=1<<Oe;re[Oe]|=Ce,ye&=~lt}}},[p,d,w]),ie.useEffect(function(){return w(d._source,function(){var Ce=je.getSnapshot,re=je.setSnapshot;try{re(Ce(d._source));var ye=xr(Is);S.mutableReadLanes|=ye&S.pendingLanes}catch(Oe){re(function(){throw Oe})}})},[d,w]),Jn(Dt,p)&&Jn(nn,d)&&Jn(ut,w)||(c={pending:null,dispatch:null,lastRenderedReducer:io,lastRenderedState:at},c.dispatch=Ue=Hh.bind(null,Zn,c),be.queue=c,be.baseQueue=null,at=XG(S,d,p),be.memoizedState=be.baseState=at),at}function HG(c,d,p){var w=Kg();return YG(w,c,d,p)}function VI(c){var d=Fg();return typeof c=="function"&&(c=c()),d.memoizedState=d.baseState=c,c=d.queue={pending:null,dispatch:null,lastRenderedReducer:io,lastRenderedState:c},c=c.dispatch=Hh.bind(null,Zn,c),[d.memoizedState,c]}function PC(c,d,p,w){return c={tag:c,create:d,destroy:p,deps:w,next:null},d=Zn.updateQueue,d===null?(d={lastEffect:null},Zn.updateQueue=d,d.lastEffect=c.next=c):(p=d.lastEffect,p===null?d.lastEffect=c.next=c:(w=p.next,p.next=c,c.next=w,d.lastEffect=c)),c}function FG(c){var d=Fg();return c={current:c},d.memoizedState=c}function QC(){return Kg().memoizedState}function xh(c,d,p,w){var S=Fg();Zn.flags|=c,S.memoizedState=PC(1|d,p,void 0,w===void 0?null:w)}function Xh(c,d,p,w){var S=Kg();w=w===void 0?null:w;var x=void 0;if(li!==null){var D=li.memoizedState;if(x=D.destroy,w!==null&&Rh(w,D.deps)){PC(d,p,x,w);return}}Zn.flags|=c,S.memoizedState=PC(1|d,p,x,w)}function KG(c,d){return xh(516,4,c,d)}function OC(c,d){return Xh(516,4,c,d)}function NG(c,d){return Xh(4,2,c,d)}function MG(c,d){if(typeof d=="function")return c=c(),d(c),function(){d(null)};if(d!=null)return c=c(),d.current=c,function(){d.current=null}}function LG(c,d,p){return p=p!=null?p.concat([c]):null,Xh(4,2,MG.bind(null,d,c),p)}function Yh(){}function zG(c,d){var p=Kg();d=d===void 0?null:d;var w=p.memoizedState;return w!==null&&d!==null&&Rh(d,w[1])?w[0]:(p.memoizedState=[c,d],c)}function kG(c,d){var p=Kg();d=d===void 0?null:d;var w=p.memoizedState;return w!==null&&d!==null&&Rh(d,w[1])?w[0]:(c=c(),p.memoizedState=[c,d],c)}function pV(c,d){var p=Ss();yi(98>p?98:p,function(){c(!0)}),yi(97<p?97:p,function(){var w=as.transition;as.transition=1;try{c(!1),d()}finally{as.transition=w}})}function Hh(c,d,p){var w=Mi(),S=xr(c),x={lane:S,action:p,eagerReducer:null,eagerState:null,next:null},D=d.pending;if(D===null?x.next=x:(x.next=D.next,D.next=x),d.pending=x,D=c.alternate,c===Zn||D!==null&&D===Zn)WI=DC=!0;else{if(c.lanes===0&&(D===null||D.lanes===0)&&(D=d.lastRenderedReducer,D!==null))try{var ie=d.lastRenderedState,be=D(ie,p);if(x.eagerReducer=D,x.eagerState=be,Jn(be,ie))return}catch{}finally{}Fo(c,S,w)}}var jC={readContext:vn,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useLayoutEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useMutableSource:Ki,useOpaqueIdentifier:Ki,unstable_isNewReconciler:!1},mV={readContext:vn,useCallback:function(c,d){return Fg().memoizedState=[c,d===void 0?null:d],c},useContext:vn,useEffect:KG,useImperativeHandle:function(c,d,p){return p=p!=null?p.concat([c]):null,xh(4,2,MG.bind(null,d,c),p)},useLayoutEffect:function(c,d){return xh(4,2,c,d)},useMemo:function(c,d){var p=Fg();return d=d===void 0?null:d,c=c(),p.memoizedState=[c,d],c},useReducer:function(c,d,p){var w=Fg();return d=p!==void 0?p(d):d,w.memoizedState=w.baseState=d,c=w.queue={pending:null,dispatch:null,lastRenderedReducer:c,lastRenderedState:d},c=c.dispatch=Hh.bind(null,Zn,c),[w.memoizedState,c]},useRef:FG,useState:VI,useDebugValue:Yh,useDeferredValue:function(c){var d=VI(c),p=d[0],w=d[1];return KG(function(){var S=as.transition;as.transition=1;try{w(c)}finally{as.transition=S}},[c]),p},useTransition:function(){var c=VI(!1),d=c[0];return c=pV.bind(null,c[1]),FG(c),[c,d]},useMutableSource:function(c,d,p){var w=Fg();return w.memoizedState={refs:{getSnapshot:d,setSnapshot:null},source:c,subscribe:p},YG(w,c,d,p)},useOpaqueIdentifier:function(){if(no){var c=!1,d=de(function(){throw c||(c=!0,p(Xe())),Error(g(355))}),p=VI(d)[1];return(Zn.mode&2)===0&&(Zn.flags|=516,PC(5,function(){p(Xe())},void 0,null)),d}return d=Xe(),VI(d),d},unstable_isNewReconciler:!1},fV={readContext:vn,useCallback:zG,useContext:vn,useEffect:OC,useImperativeHandle:LG,useLayoutEffect:NG,useMemo:kG,useReducer:SI,useRef:QC,useState:function(){return SI(io)},useDebugValue:Yh,useDeferredValue:function(c){var d=SI(io),p=d[0],w=d[1];return OC(function(){var S=as.transition;as.transition=1;try{w(c)}finally{as.transition=S}},[c]),p},useTransition:function(){var c=SI(io)[0];return[QC().current,c]},useMutableSource:HG,useOpaqueIdentifier:function(){return SI(io)[0]},unstable_isNewReconciler:!1},bV={readContext:vn,useCallback:zG,useContext:vn,useEffect:OC,useImperativeHandle:LG,useLayoutEffect:NG,useMemo:kG,useReducer:RI,useRef:QC,useState:function(){return RI(io)},useDebugValue:Yh,useDeferredValue:function(c){var d=RI(io),p=d[0],w=d[1];return OC(function(){var S=as.transition;as.transition=1;try{w(c)}finally{as.transition=S}},[c]),p},useTransition:function(){var c=RI(io)[0];return[QC().current,c]},useMutableSource:HG,useOpaqueIdentifier:function(){return RI(io)[0]},unstable_isNewReconciler:!1},GV=a.ReactCurrentOwner,Xs=!1;function Ni(c,d,p,w){d.child=c===null?WG(d,null,p,w):_C(d,c.child,p,w)}function TG(c,d,p,w,S){p=p.render;var x=d.ref;return Bn(d,S),w=Vh(c,d,p,w,x,S),c!==null&&!Xs?(d.updateQueue=c.updateQueue,d.flags&=-517,c.lanes&=~S,Xo(c,d,S)):(d.flags|=1,Ni(c,d,w,S),d.child)}function EG(c,d,p,w,S,x){if(c===null){var D=p.type;return typeof D=="function"&&!lp(D)&&D.defaultProps===void 0&&p.compare===null&&p.defaultProps===void 0?(d.tag=15,d.type=D,_G(c,d,D,w,S,x)):(c=pu(p.type,null,w,d,d.mode,x),c.ref=d.ref,c.return=d,d.child=c)}return D=c.child,(S&x)===0&&(S=D.memoizedProps,p=p.compare,p=p!==null?p:eo,p(S,w)&&c.ref===d.ref)?Xo(c,d,x):(d.flags|=1,c=Yr(D,w),c.ref=d.ref,c.return=d,d.child=c)}function _G(c,d,p,w,S,x){if(c!==null&&eo(c.memoizedProps,w)&&c.ref===d.ref)if(Xs=!1,(x&S)!==0)(c.flags&16384)!==0&&(Xs=!0);else return d.lanes=c.lanes,Xo(c,d,x);return Kh(c,d,p,w,x)}function Fh(c,d,p){var w=d.pendingProps,S=w.children,x=c!==null?c.memoizedState:null;if(w.mode==="hidden"||w.mode==="unstable-defer-without-hiding")if((d.mode&4)===0)d.memoizedState={baseLanes:0},du(d,p);else if((p&1073741824)!==0)d.memoizedState={baseLanes:0},du(d,x!==null?x.baseLanes:p);else return c=x!==null?x.baseLanes|p:p,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:c},du(d,c),null;else x!==null?(w=x.baseLanes|p,d.memoizedState=null):w=p,du(d,w);return Ni(c,d,S,p),d.child}function JG(c,d){var p=d.ref;(c===null&&p!==null||c!==null&&c.ref!==p)&&(d.flags|=128)}function Kh(c,d,p,w,S){var x=rn(p)?Vn:ft.current;return x=$n(d,x),Bn(d,S),p=Vh(c,d,p,w,x,S),c!==null&&!Xs?(d.updateQueue=c.updateQueue,d.flags&=-517,c.lanes&=~S,Xo(c,d,S)):(d.flags|=1,Ni(c,d,p,S),d.child)}function UG(c,d,p,w,S){if(rn(p)){var x=!0;An(d)}else x=!1;if(Bn(d,S),d.stateNode===null)c!==null&&(c.alternate=null,d.alternate=null,d.flags|=2),vG(d,p,w),Bh(d,p,w,S),w=!0;else if(c===null){var D=d.stateNode,ie=d.memoizedProps;D.props=ie;var be=D.context,Ue=p.contextType;typeof Ue=="object"&&Ue!==null?Ue=vn(Ue):(Ue=rn(p)?Vn:ft.current,Ue=$n(d,Ue));var at=p.getDerivedStateFromProps,ut=typeof at=="function"||typeof D.getSnapshotBeforeUpdate=="function";ut||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(ie!==w||be!==Ue)&&ZG(d,D,w,Ue),xs=!1;var je=d.memoizedState;D.state=je,GI(d,w,D,S),be=d.memoizedState,ie!==w||je!==be||Mt.current||xs?(typeof at=="function"&&(zC(d,p,at,w),be=d.memoizedState),(ie=xs||BG(d,p,ie,w,je,be,Ue))?(ut||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(d.flags|=4)):(typeof D.componentDidMount=="function"&&(d.flags|=4),d.memoizedProps=w,d.memoizedState=be),D.props=w,D.state=be,D.context=Ue,w=ie):(typeof D.componentDidMount=="function"&&(d.flags|=4),w=!1)}else{D=d.stateNode,fG(c,d),ie=d.memoizedProps,Ue=d.type===d.elementType?ie:qt(d.type,ie),D.props=Ue,ut=d.pendingProps,je=D.context,be=p.contextType,typeof be=="object"&&be!==null?be=vn(be):(be=rn(p)?Vn:ft.current,be=$n(d,be));var Dt=p.getDerivedStateFromProps;(at=typeof Dt=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(ie!==ut||je!==be)&&ZG(d,D,w,be),xs=!1,je=d.memoizedState,D.state=je,GI(d,w,D,S);var nn=d.memoizedState;ie!==ut||je!==nn||Mt.current||xs?(typeof Dt=="function"&&(zC(d,p,Dt,w),nn=d.memoizedState),(Ue=xs||BG(d,p,Ue,w,je,nn,be))?(at||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(w,nn,be),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(w,nn,be)),typeof D.componentDidUpdate=="function"&&(d.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(d.flags|=256)):(typeof D.componentDidUpdate!="function"||ie===c.memoizedProps&&je===c.memoizedState||(d.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||ie===c.memoizedProps&&je===c.memoizedState||(d.flags|=256),d.memoizedProps=w,d.memoizedState=nn),D.props=w,D.state=nn,D.context=be,w=Ue):(typeof D.componentDidUpdate!="function"||ie===c.memoizedProps&&je===c.memoizedState||(d.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||ie===c.memoizedProps&&je===c.memoizedState||(d.flags|=256),w=!1)}return Nh(c,d,p,w,x,S)}function Nh(c,d,p,w,S,x){JG(c,d);var D=(d.flags&64)!==0;if(!w&&!D)return S&&vo(d,p,!1),Xo(c,d,x);w=d.stateNode,GV.current=d;var ie=D&&typeof p.getDerivedStateFromError!="function"?null:w.render();return d.flags|=1,c!==null&&D?(d.child=_C(d,c.child,null,x),d.child=_C(d,null,ie,x)):Ni(c,d,ie,x),d.memoizedState=w.state,S&&vo(d,p,!0),d.child}function DG(c){var d=c.stateNode;d.pendingContext?Gi(c,d.pendingContext,d.pendingContext!==d.context):d.context&&Gi(c,d.context,!1),vh(c,d.containerInfo)}var qC={dehydrated:null,retryLane:0};function PG(c,d,p){var w=d.pendingProps,S=hn.current,x=!1,D;return(D=(d.flags&64)!==0)||(D=c!==null&&c.memoizedState===null?!1:(S&2)!==0),D?(x=!0,d.flags&=-65):c!==null&&c.memoizedState===null||w.fallback===void 0||w.unstable_avoidThisFallback===!0||(S|=1),nt(hn,S&1),c===null?(w.fallback!==void 0&&wh(d),c=w.children,S=w.fallback,x?(c=QG(d,c,S,p),d.child.memoizedState={baseLanes:p},d.memoizedState=qC,c):typeof w.unstable_expectedLoadTime=="number"?(c=QG(d,c,S,p),d.child.memoizedState={baseLanes:p},d.memoizedState=qC,d.lanes=33554432,c):(p=Ip({mode:"visible",children:c},d.mode,p,null),p.return=d,d.child=p)):c.memoizedState!==null?x?(w=jG(c,d,w.children,w.fallback,p),x=d.child,S=c.child.memoizedState,x.memoizedState=S===null?{baseLanes:p}:{baseLanes:S.baseLanes|p},x.childLanes=c.childLanes&~p,d.memoizedState=qC,w):(p=OG(c,d,w.children,p),d.memoizedState=null,p):x?(w=jG(c,d,w.children,w.fallback,p),x=d.child,S=c.child.memoizedState,x.memoizedState=S===null?{baseLanes:p}:{baseLanes:S.baseLanes|p},x.childLanes=c.childLanes&~p,d.memoizedState=qC,w):(p=OG(c,d,w.children,p),d.memoizedState=null,p)}function QG(c,d,p,w){var S=c.mode,x=c.child;return d={mode:"hidden",children:d},(S&2)===0&&x!==null?(x.childLanes=0,x.pendingProps=d):x=Ip(d,S,0,null),p=_a(p,S,w,null),x.return=c,p.return=c,x.sibling=p,c.child=x,p}function OG(c,d,p,w){var S=c.child;return c=S.sibling,p=Yr(S,{mode:"visible",children:p}),(d.mode&2)===0&&(p.lanes=w),p.return=d,p.sibling=null,c!==null&&(c.nextEffect=null,c.flags=8,d.firstEffect=d.lastEffect=c),d.child=p}function jG(c,d,p,w,S){var x=d.mode,D=c.child;c=D.sibling;var ie={mode:"hidden",children:p};return(x&2)===0&&d.child!==D?(p=d.child,p.childLanes=0,p.pendingProps=ie,D=p.lastEffect,D!==null?(d.firstEffect=p.firstEffect,d.lastEffect=D,D.nextEffect=null):d.firstEffect=d.lastEffect=null):p=Yr(D,ie),c!==null?w=Yr(c,w):(w=_a(w,x,S,null),w.flags|=2),w.return=d,p.return=d,p.sibling=w,d.child=p,w}function qG(c,d){c.lanes|=d;var p=c.alternate;p!==null&&(p.lanes|=d),Fi(c.return,d)}function Mh(c,d,p,w,S,x){var D=c.memoizedState;D===null?c.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:w,tail:p,tailMode:S,lastEffect:x}:(D.isBackwards=d,D.rendering=null,D.renderingStartTime=0,D.last=w,D.tail=p,D.tailMode=S,D.lastEffect=x)}function $G(c,d,p){var w=d.pendingProps,S=w.revealOrder,x=w.tail;if(Ni(c,d,w.children,p),w=hn.current,(w&2)!==0)w=w&1|2,d.flags|=64;else{if(c!==null&&(c.flags&64)!==0)e:for(c=d.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&qG(c,p);else if(c.tag===19)qG(c,p);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===d)break e;for(;c.sibling===null;){if(c.return===null||c.return===d)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}w&=1}if(nt(hn,w),(d.mode&2)===0)d.memoizedState=null;else switch(S){case"forwards":for(p=d.child,S=null;p!==null;)c=p.alternate,c!==null&&JC(c)===null&&(S=p),p=p.sibling;p=S,p===null?(S=d.child,d.child=null):(S=p.sibling,p.sibling=null),Mh(d,!1,S,p,x,d.lastEffect);break;case"backwards":for(p=null,S=d.child,d.child=null;S!==null;){if(c=S.alternate,c!==null&&JC(c)===null){d.child=S;break}c=S.sibling,S.sibling=p,p=S,S=c}Mh(d,!0,p,null,x,d.lastEffect);break;case"together":Mh(d,!1,null,null,void 0,d.lastEffect);break;default:d.memoizedState=null}return d.child}function Xo(c,d,p){if(c!==null&&(d.dependencies=c.dependencies),FI|=d.lanes,(p&d.childLanes)!==0){if(c!==null&&d.child!==c.child)throw Error(g(153));if(d.child!==null){for(c=d.child,p=Yr(c,c.pendingProps),d.child=p,p.return=d;c.sibling!==null;)c=c.sibling,p=p.sibling=Yr(c,c.pendingProps),p.return=d;p.sibling=null}return d.child}return null}function so(c){c.flags|=4}var xI,XI,$C,eu;if(Ge)xI=function(c,d){for(var p=d.child;p!==null;){if(p.tag===5||p.tag===6)oe(c,p.stateNode);else if(p.tag!==4&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return;p=p.return}p.sibling.return=p.return,p=p.sibling}},XI=function(){},$C=function(c,d,p,w,S){if(c=c.memoizedProps,c!==w){var x=d.stateNode,D=to(gs.current);p=ge(x,p,c,w,S,D),(d.updateQueue=p)&&so(d)}},eu=function(c,d,p,w){p!==w&&so(d)};else if(xe){xI=function(c,d,p,w){for(var S=d.child;S!==null;){if(S.tag===5){var x=S.stateNode;p&&w&&(x=gi(x,S.type,S.memoizedProps,S)),oe(c,x)}else if(S.tag===6)x=S.stateNode,p&&w&&(x=un(x,S.memoizedProps,S)),oe(c,x);else if(S.tag!==4){if(S.tag===13&&(S.flags&4)!==0&&(x=S.memoizedState!==null)){var D=S.child;if(D!==null&&(D.child!==null&&(D.child.return=D,xI(c,D,!0,x)),x=D.sibling,x!==null)){x.return=S,S=x;continue}}if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===d)break;for(;S.sibling===null;){if(S.return===null||S.return===d)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};var ey=function(c,d,p,w){for(var S=d.child;S!==null;){if(S.tag===5){var x=S.stateNode;p&&w&&(x=gi(x,S.type,S.memoizedProps,S)),Et(c,x)}else if(S.tag===6)x=S.stateNode,p&&w&&(x=un(x,S.memoizedProps,S)),Et(c,x);else if(S.tag!==4){if(S.tag===13&&(S.flags&4)!==0&&(x=S.memoizedState!==null)){var D=S.child;if(D!==null&&(D.child!==null&&(D.child.return=D,ey(c,D,!0,x)),x=D.sibling,x!==null)){x.return=S,S=x;continue}}if(S.child!==null){S.child.return=S,S=S.child;continue}}if(S===d)break;for(;S.sibling===null;){if(S.return===null||S.return===d)return;S=S.return}S.sibling.return=S.return,S=S.sibling}};XI=function(c){var d=c.stateNode;if(c.firstEffect!==null){var p=d.containerInfo,w=Kt(p);ey(w,c,!1,!1),d.pendingChildren=w,so(c),_t(p,w)}},$C=function(c,d,p,w,S){var x=c.stateNode,D=c.memoizedProps;if((c=d.firstEffect===null)&&D===w)d.stateNode=x;else{var ie=d.stateNode,be=to(gs.current),Ue=null;D!==w&&(Ue=ge(ie,p,D,w,S,be)),c&&Ue===null?d.stateNode=x:(x=rt(x,Ue,p,D,w,d,c,ie),j(x,p,w,S,be)&&so(d),d.stateNode=x,c?so(d):xI(x,d,!1,!1))}},eu=function(c,d,p,w){p!==w?(c=to(Na.current),p=to(gs.current),d.stateNode=Be(w,c,p,d),so(d)):d.stateNode=c.stateNode}}else XI=function(){},$C=function(){},eu=function(){};function YI(c,d){if(!no)switch(c.tailMode){case"hidden":d=c.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?c.tail=null:p.sibling=null;break;case"collapsed":p=c.tail;for(var w=null;p!==null;)p.alternate!==null&&(w=p),p=p.sibling;w===null?d||c.tail===null?c.tail=null:c.tail.sibling=null:w.sibling=null}}function yV(c,d,p){var w=d.pendingProps;switch(d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return rn(d.type)&&gn(),null;case 3:return Ma(),Ne(Mt),Ne(ft),Sh(),w=d.stateNode,w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(c===null||c.child===null)&&(UC(d)?so(d):w.hydrate||(d.flags|=256)),XI(d),null;case 5:Zh(d);var S=to(Na.current);if(p=d.type,c!==null&&d.stateNode!=null)$C(c,d,p,w,S),c.ref!==d.ref&&(d.flags|=128);else{if(!w){if(d.stateNode===null)throw Error(g(166));return null}if(c=to(gs.current),UC(d)){if(!fe)throw Error(g(175));c=Ze(d.stateNode,d.type,d.memoizedProps,S,c,d),d.updateQueue=c,c!==null&&so(d)}else{var x=ee(p,w,S,c,d);xI(x,d,!1,!1),d.stateNode=x,j(x,p,w,S,c)&&so(d)}d.ref!==null&&(d.flags|=128)}return null;case 6:if(c&&d.stateNode!=null)eu(c,d,c.memoizedProps,w);else{if(typeof w!="string"&&d.stateNode===null)throw Error(g(166));if(c=to(Na.current),S=to(gs.current),UC(d)){if(!fe)throw Error(g(176));ot(d.stateNode,d.memoizedProps,d)&&so(d)}else d.stateNode=Be(w,c,S,d)}return null;case 13:return Ne(hn),w=d.memoizedState,(d.flags&64)!==0?(d.lanes=p,d):(w=w!==null,S=!1,c===null?d.memoizedProps.fallback!==void 0&&UC(d):S=c.memoizedState!==null,w&&!S&&(d.mode&2)!==0&&(c===null&&d.memoizedProps.unstable_avoidThisFallback!==!0||(hn.current&1)!==0?ti===0&&(ti=3):((ti===0||ti===3)&&(ti=4),Bi===null||(FI&134217727)===0&&(ka&134217727)===0||Ta(Bi,Ii))),xe&&w&&(d.flags|=4),Ge&&(w||S)&&(d.flags|=4),null);case 4:return Ma(),XI(d),c===null&&M(d.stateNode.containerInfo),null;case 10:return xn(d),null;case 17:return rn(d.type)&&gn(),null;case 19:if(Ne(hn),w=d.memoizedState,w===null)return null;if(S=(d.flags&64)!==0,x=w.rendering,x===null)if(S)YI(w,!1);else{if(ti!==0||c!==null&&(c.flags&64)!==0)for(c=d.child;c!==null;){if(x=JC(c),x!==null){for(d.flags|=64,YI(w,!1),c=x.updateQueue,c!==null&&(d.updateQueue=c,d.flags|=4),w.lastEffect===null&&(d.firstEffect=null),d.lastEffect=w.lastEffect,c=p,w=d.child;w!==null;)S=w,p=c,S.flags&=2,S.nextEffect=null,S.firstEffect=null,S.lastEffect=null,x=S.alternate,x===null?(S.childLanes=0,S.lanes=p,S.child=null,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=x.childLanes,S.lanes=x.lanes,S.child=x.child,S.memoizedProps=x.memoizedProps,S.memoizedState=x.memoizedState,S.updateQueue=x.updateQueue,S.type=x.type,p=x.dependencies,S.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return nt(hn,hn.current&1|2),d.child}c=c.sibling}w.tail!==null&&Gn()>ep&&(d.flags|=64,S=!0,YI(w,!1),d.lanes=33554432)}else{if(!S)if(c=JC(x),c!==null){if(d.flags|=64,S=!0,c=c.updateQueue,c!==null&&(d.updateQueue=c,d.flags|=4),YI(w,!0),w.tail===null&&w.tailMode==="hidden"&&!x.alternate&&!no)return d=d.lastEffect=w.lastEffect,d!==null&&(d.nextEffect=null),null}else 2*Gn()-w.renderingStartTime>ep&&p!==1073741824&&(d.flags|=64,S=!0,YI(w,!1),d.lanes=33554432);w.isBackwards?(x.sibling=d.child,d.child=x):(c=w.last,c!==null?c.sibling=x:d.child=x,w.last=x)}return w.tail!==null?(c=w.tail,w.rendering=c,w.tail=c.sibling,w.lastEffect=d.lastEffect,w.renderingStartTime=Gn(),c.sibling=null,d=hn.current,nt(hn,S?d&1|2:d&1),c):null;case 23:case 24:return rp(),c!==null&&c.memoizedState!==null!=(d.memoizedState!==null)&&w.mode!=="unstable-defer-without-hiding"&&(d.flags|=4),null}throw Error(g(156,d.tag))}function BV(c){switch(c.tag){case 1:rn(c.type)&&gn();var d=c.flags;return d&4096?(c.flags=d&-4097|64,c):null;case 3:if(Ma(),Ne(Mt),Ne(ft),Sh(),d=c.flags,(d&64)!==0)throw Error(g(285));return c.flags=d&-4097|64,c;case 5:return Zh(c),null;case 13:return Ne(hn),d=c.flags,d&4096?(c.flags=d&-4097|64,c):null;case 19:return Ne(hn),null;case 4:return Ma(),null;case 10:return xn(c),null;case 23:case 24:return rp(),null;default:return null}}function Lh(c,d){try{var p="",w=d;do p+=Fa(w),w=w.return;while(w);var S=p}catch(x){S=`
Error generating stack: `+x.message+`
`+x.stack}return{value:c,source:d,stack:S}}function zh(c,d){try{console.error(d.value)}catch(p){setTimeout(function(){throw p})}}var vV=typeof WeakMap=="function"?WeakMap:Map;function ty(c,d,p){p=Wr(-1,p),p.tag=3,p.payload={element:null};var w=d.value;return p.callback=function(){Iu||(Iu=!0,tp=w),zh(c,d)},p}function ny(c,d,p){p=Wr(-1,p),p.tag=3;var w=c.type.getDerivedStateFromError;if(typeof w=="function"){var S=d.value;p.payload=function(){return zh(c,d),w(S)}}var x=c.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(p.callback=function(){typeof w!="function"&&(oo===null?oo=new Set([this]):oo.add(this),zh(c,d));var D=d.stack;this.componentDidCatch(d.value,{componentStack:D!==null?D:""})}),p}var ZV=typeof WeakSet=="function"?WeakSet:Set;function iy(c){var d=c.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(p){Xr(c,p)}else d.current=null}function wV(c,d){switch(d.tag){case 0:case 11:case 15:case 22:return;case 1:if(d.flags&256&&c!==null){var p=c.memoizedProps,w=c.memoizedState;c=d.stateNode,d=c.getSnapshotBeforeUpdate(d.elementType===d.type?p:qt(d.type,p),w),c.__reactInternalSnapshotBeforeUpdate=d}return;case 3:Ge&&d.flags&256&&Bt(d.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(g(163))}function sy(c,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var p=d=d.next;do{if((p.tag&c)===c){var w=p.destroy;p.destroy=void 0,w!==void 0&&w()}p=p.next}while(p!==d)}}function WV(c,d,p){switch(p.tag){case 0:case 11:case 15:case 22:if(d=p.updateQueue,d=d!==null?d.lastEffect:null,d!==null){c=d=d.next;do{if((c.tag&3)===3){var w=c.create;c.destroy=w()}c=c.next}while(c!==d)}if(d=p.updateQueue,d=d!==null?d.lastEffect:null,d!==null){c=d=d.next;do{var S=c;w=S.next,S=S.tag,(S&4)!==0&&(S&1)!==0&&(Gy(p,c),KV(p,c)),c=w}while(c!==d)}return;case 1:c=p.stateNode,p.flags&4&&(d===null?c.componentDidMount():(w=p.elementType===p.type?d.memoizedProps:qt(p.type,d.memoizedProps),c.componentDidUpdate(w,d.memoizedState,c.__reactInternalSnapshotBeforeUpdate))),d=p.updateQueue,d!==null&&GG(p,d,c);return;case 3:if(d=p.updateQueue,d!==null){if(c=null,p.child!==null)switch(p.child.tag){case 5:c=F(p.child.stateNode);break;case 1:c=p.child.stateNode}GG(p,d,c)}return;case 5:c=p.stateNode,d===null&&p.flags&4&&Fe(c,p.type,p.memoizedProps,p);return;case 6:return;case 4:return;case 12:return;case 13:fe&&p.memoizedState===null&&(p=p.alternate,p!==null&&(p=p.memoizedState,p!==null&&(p=p.dehydrated,p!==null&&Ct(p))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(g(163))}function oy(c,d){if(Ge)for(var p=c;;){if(p.tag===5){var w=p.stateNode;d?ke(w):At(p.stateNode,p.memoizedProps)}else if(p.tag===6)w=p.stateNode,d?gt(w):Tt(w,p.memoizedProps);else if((p.tag!==23&&p.tag!==24||p.memoizedState===null||p===c)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return;p=p.return}p.sibling.return=p.return,p=p.sibling}}function ry(c,d){if(Hi&&typeof Hi.onCommitFiberUnmount=="function")try{Hi.onCommitFiberUnmount(ws,d)}catch{}switch(d.tag){case 0:case 11:case 14:case 15:case 22:if(c=d.updateQueue,c!==null&&(c=c.lastEffect,c!==null)){var p=c=c.next;do{var w=p,S=w.destroy;if(w=w.tag,S!==void 0)if((w&4)!==0)Gy(d,p);else{w=d;try{S()}catch(x){Xr(w,x)}}p=p.next}while(p!==c)}break;case 1:if(iy(d),c=d.stateNode,typeof c.componentWillUnmount=="function")try{c.props=d.memoizedProps,c.state=d.memoizedState,c.componentWillUnmount()}catch(x){Xr(d,x)}break;case 5:iy(d);break;case 4:Ge?cy(c,d):xe&&xe&&(d=d.stateNode.containerInfo,c=Kt(d),on(d,c))}}function gy(c,d){for(var p=d;;)if(ry(c,p),p.child===null||Ge&&p.tag===4){if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return;p=p.return}p.sibling.return=p.return,p=p.sibling}else p.child.return=p,p=p.child}function ay(c){c.alternate=null,c.child=null,c.dependencies=null,c.firstEffect=null,c.lastEffect=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.return=null,c.updateQueue=null}function ly(c){return c.tag===5||c.tag===3||c.tag===4}function Iy(c){if(Ge){e:{for(var d=c.return;d!==null;){if(ly(d))break e;d=d.return}throw Error(g(160))}var p=d;switch(d=p.stateNode,p.tag){case 5:var w=!1;break;case 3:d=d.containerInfo,w=!0;break;case 4:d=d.containerInfo,w=!0;break;default:throw Error(g(161))}p.flags&16&&(Ae(d),p.flags&=-17);e:t:for(p=c;;){for(;p.sibling===null;){if(p.return===null||ly(p.return)){p=null;break e}p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue t;p.child.return=p,p=p.child}if(!(p.flags&2)){p=p.stateNode;break e}}w?kh(c,p,d):Th(c,p,d)}}function kh(c,d,p){var w=c.tag,S=w===5||w===6;if(S)c=S?c.stateNode:c.stateNode.instance,d?$(p,c,d):Pe(p,c);else if(w!==4&&(c=c.child,c!==null))for(kh(c,d,p),c=c.sibling;c!==null;)kh(c,d,p),c=c.sibling}function Th(c,d,p){var w=c.tag,S=w===5||w===6;if(S)c=S?c.stateNode:c.stateNode.instance,d?$e(p,c,d):ze(p,c);else if(w!==4&&(c=c.child,c!==null))for(Th(c,d,p),c=c.sibling;c!==null;)Th(c,d,p),c=c.sibling}function cy(c,d){for(var p=d,w=!1,S,x;;){if(!w){w=p.return;e:for(;;){if(w===null)throw Error(g(160));switch(S=w.stateNode,w.tag){case 5:x=!1;break e;case 3:S=S.containerInfo,x=!0;break e;case 4:S=S.containerInfo,x=!0;break e}w=w.return}w=!0}if(p.tag===5||p.tag===6)gy(c,p),x?He(S,p.stateNode):De(S,p.stateNode);else if(p.tag===4){if(p.child!==null){S=p.stateNode.containerInfo,x=!0,p.child.return=p,p=p.child;continue}}else if(ry(c,p),p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return;p=p.return,p.tag===4&&(w=!1)}p.sibling.return=p.return,p=p.sibling}}function Eh(c,d){if(Ge){switch(d.tag){case 0:case 11:case 14:case 15:case 22:sy(3,d);return;case 1:return;case 5:var p=d.stateNode;if(p!=null){var w=d.memoizedProps;c=c!==null?c.memoizedProps:w;var S=d.type,x=d.updateQueue;d.updateQueue=null,x!==null&&Ke(p,x,S,c,w,d)}return;case 6:if(d.stateNode===null)throw Error(g(162));p=d.memoizedProps,Te(d.stateNode,c!==null?c.memoizedProps:p,p);return;case 3:fe&&(d=d.stateNode,d.hydrate&&(d.hydrate=!1,pt(d.containerInfo)));return;case 12:return;case 13:Cy(d),tu(d);return;case 19:tu(d);return;case 17:return;case 23:case 24:oy(d,d.memoizedState!==null);return}throw Error(g(163))}switch(d.tag){case 0:case 11:case 14:case 15:case 22:sy(3,d);return;case 12:return;case 13:Cy(d),tu(d);return;case 19:tu(d);return;case 3:fe&&(p=d.stateNode,p.hydrate&&(p.hydrate=!1,pt(p.containerInfo)));break;case 23:case 24:return}e:if(xe){switch(d.tag){case 1:case 5:case 6:case 20:break e;case 3:case 4:d=d.stateNode,on(d.containerInfo,d.pendingChildren);break e}throw Error(g(163))}}function Cy(c){c.memoizedState!==null&&($h=Gn(),Ge&&oy(c.child,!0))}function tu(c){var d=c.updateQueue;if(d!==null){c.updateQueue=null;var p=c.stateNode;p===null&&(p=c.stateNode=new ZV),d.forEach(function(w){var S=LV.bind(null,c,w);p.has(w)||(p.add(w),w.then(S,S))})}}function SV(c,d){return c!==null&&(c=c.memoizedState,c===null||c.dehydrated!==null)?(d=d.memoizedState,d!==null&&d.dehydrated===null):!1}var nu=0,iu=1,su=2,ou=3,ru=4;if(typeof Symbol=="function"&&Symbol.for){var HI=Symbol.for;nu=HI("selector.component"),iu=HI("selector.has_pseudo_class"),su=HI("selector.role"),ou=HI("selector.test_id"),ru=HI("selector.text")}function _h(c){var d=Qe(c);if(d!=null){if(typeof d.memoizedProps["data-testname"]!="string")throw Error(g(364));return d}if(c=te(c),c===null)throw Error(g(362));return c.stateNode.current}function Jh(c,d){switch(d.$$typeof){case nu:if(c.type===d.value)return!0;break;case iu:e:{d=d.value,c=[c,0];for(var p=0;p<c.length;){var w=c[p++],S=c[p++],x=d[S];if(w.tag!==5||!Re(w)){for(;x!=null&&Jh(w,x);)S++,x=d[S];if(S===d.length){d=!0;break e}else for(w=w.child;w!==null;)c.push(w,S),w=w.sibling}}d=!1}return d;case su:if(c.tag===5&&Ve(c.stateNode,d.value))return!0;break;case ru:if((c.tag===5||c.tag===6)&&(c=we(c),c!==null&&0<=c.indexOf(d.value)))return!0;break;case ou:if(c.tag===5&&(c=c.memoizedProps["data-testname"],typeof c=="string"&&c.toLowerCase()===d.value.toLowerCase()))return!0;break;default:throw Error(g(365,d))}return!1}function Uh(c){switch(c.$$typeof){case nu:return"<"+(E(c.value)||"Unknown")+">";case iu:return":has("+(Uh(c)||"")+")";case su:return'[role="'+c.value+'"]';case ru:return'"'+c.value+'"';case ou:return'[data-testname="'+c.value+'"]';default:throw Error(g(365,c))}}function uy(c,d){var p=[];c=[c,0];for(var w=0;w<c.length;){var S=c[w++],x=c[w++],D=d[x];if(S.tag!==5||!Re(S)){for(;D!=null&&Jh(S,D);)x++,D=d[x];if(x===d.length)p.push(S);else for(S=S.child;S!==null;)c.push(S,x),S=S.sibling}}return p}function Dh(c,d){if(!Y)throw Error(g(363));c=_h(c),c=uy(c,d),d=[],c=Array.from(c);for(var p=0;p<c.length;){var w=c[p++];if(w.tag===5)Re(w)||d.push(w.stateNode);else for(w=w.child;w!==null;)c.push(w),w=w.sibling}return d}var gu=null;function RV(c){if(gu===null)try{var d=("require"+Math.random()).slice(0,7);gu=(i&&i[d]).call(i,"timers").setImmediate}catch{gu=function(w){var S=new MessageChannel;S.port1.onmessage=w,S.port2.postMessage(void 0)}}return gu(c)}var VV=Math.ceil,au=a.ReactCurrentDispatcher,Ph=a.ReactCurrentOwner,Qh=a.IsSomeRendererActing,It=0,Bi=null,Nn=null,Ii=0,Ng=0,Oh=Kn(0),ti=0,lu=null,za=0,FI=0,ka=0,jh=0,qh=null,$h=0,ep=1/0;function Rr(){ep=Gn()+500}var et=null,Iu=!1,tp=null,oo=null,Vr=!1,KI=null,NI=90,np=[],ip=[],Yo=null,MI=0,sp=null,cu=-1,Ho=0,Cu=0,LI=null,zI=!1;function Mi(){return(It&48)!==0?Gn():cu!==-1?cu:cu=Gn()}function xr(c){if(c=c.mode,(c&2)===0)return 1;if((c&4)===0)return Ss()===99?1:2;if(Ho===0&&(Ho=za),mI.transition!==0){Cu!==0&&(Cu=qh!==null?qh.pendingLanes:0),c=Ho;var d=4186112&~Cu;return d&=-d,d===0&&(c=4186112&~c,d=c&-c,d===0&&(d=8192)),d}return c=Ss(),(It&4)!==0&&c===98?c=qs(12,Ho):(c=Rg(c),c=qs(c,Ho)),c}function Fo(c,d,p){if(50<MI)throw MI=0,sp=null,Error(g(185));if(c=uu(c,d),c===null)return null;wo(c,d,p),c===Bi&&(ka|=d,ti===4&&Ta(c,Ii));var w=Ss();d===1?(It&8)!==0&&(It&48)===0?op(c):(Qi(c,p),It===0&&(Rr(),yn())):((It&4)===0||w!==98&&w!==99||(Yo===null?Yo=new Set([c]):Yo.add(c)),Qi(c,p)),qh=c}function uu(c,d){c.lanes|=d;var p=c.alternate;for(p!==null&&(p.lanes|=d),p=c,c=c.return;c!==null;)c.childLanes|=d,p=c.alternate,p!==null&&(p.childLanes|=d),p=c,c=c.return;return p.tag===3?p.stateNode:null}function Qi(c,d){for(var p=c.callbackNode,w=c.suspendedLanes,S=c.pingedLanes,x=c.expirationTimes,D=c.pendingLanes;0<D;){var ie=31-rs(D),be=1<<ie,Ue=x[ie];if(Ue===-1){if((be&w)===0||(be&S)!==0){Ue=d,Ws(be);var at=Lt;x[ie]=10<=at?Ue+250:6<=at?Ue+5e3:-1}}else Ue<=d&&(c.expiredLanes|=be);D&=~be}if(w=js(c,c===Bi?Ii:0),d=Lt,w===0)p!==null&&(p!==Zr&&yr(p),c.callbackNode=null,c.callbackPriority=0);else{if(p!==null){if(c.callbackPriority===d)return;p!==Zr&&yr(p)}d===15?(p=op.bind(null,c),bn===null?(bn=[p],wr=Xa($s,pI)):bn.push(p),p=Zr):d===14?p=Rs(99,op.bind(null,c)):(p=Gh(d),p=Rs(p,dy.bind(null,c))),c.callbackPriority=d,c.callbackNode=p}}function dy(c){if(cu=-1,Cu=Ho=0,(It&48)!==0)throw Error(g(327));var d=c.callbackNode;if(Ko()&&c.callbackNode!==d)return null;var p=js(c,c===Bi?Ii:0);if(p===0)return null;var w=p,S=It;It|=16;var x=my();(Bi!==c||Ii!==w)&&(Rr(),Ea(c,w));do try{YV();break}catch(ie){py(c,ie)}while(1);if(bI(),au.current=x,It=S,Nn!==null?w=0:(Bi=null,Ii=0,w=ti),(za&ka)!==0)Ea(c,0);else if(w!==0){if(w===2&&(It|=64,c.hydrate&&(c.hydrate=!1,Bt(c.containerInfo)),p=Vg(c),p!==0&&(w=kI(c,p))),w===1)throw d=lu,Ea(c,0),Ta(c,p),Qi(c,Gn()),d;switch(c.finishedWork=c.current.alternate,c.finishedLanes=p,w){case 0:case 1:throw Error(g(345));case 2:Mg(c);break;case 3:if(Ta(c,p),(p&62914560)===p&&(w=$h+500-Gn(),10<w)){if(js(c,0)!==0)break;if(S=c.suspendedLanes,(S&p)!==p){Mi(),c.pingedLanes|=c.suspendedLanes&S;break}c.timeoutHandle=ve(Mg.bind(null,c),w);break}Mg(c);break;case 4:if(Ta(c,p),(p&4186112)===p)break;for(w=c.eventTimes,S=-1;0<p;){var D=31-rs(p);x=1<<D,D=w[D],D>S&&(S=D),p&=~x}if(p=S,p=Gn()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*VV(p/1960))-p,10<p){c.timeoutHandle=ve(Mg.bind(null,c),p);break}Mg(c);break;case 5:Mg(c);break;default:throw Error(g(329))}}return Qi(c,Gn()),c.callbackNode===d?dy.bind(null,c):null}function Ta(c,d){for(d&=~jh,d&=~ka,c.suspendedLanes|=d,c.pingedLanes&=~d,c=c.expirationTimes;0<d;){var p=31-rs(d),w=1<<p;c[p]=-1,d&=~w}}function op(c){if((It&48)!==0)throw Error(g(327));if(Ko(),c===Bi&&(c.expiredLanes&Ii)!==0){var d=Ii,p=kI(c,d);(za&ka)!==0&&(d=js(c,d),p=kI(c,d))}else d=js(c,0),p=kI(c,d);if(c.tag!==0&&p===2&&(It|=64,c.hydrate&&(c.hydrate=!1,Bt(c.containerInfo)),d=Vg(c),d!==0&&(p=kI(c,d))),p===1)throw p=lu,Ea(c,0),Ta(c,d),Qi(c,Gn()),p;return c.finishedWork=c.current.alternate,c.finishedLanes=d,Mg(c),Qi(c,Gn()),null}function xV(){if(Yo!==null){var c=Yo;Yo=null,c.forEach(function(d){d.expiredLanes|=24&d.pendingLanes,Qi(d,Gn())})}yn()}function Ay(c,d){var p=It;It|=1;try{return c(d)}finally{It=p,It===0&&(Rr(),yn())}}function hy(c,d){var p=It;if((p&48)!==0)return c(d);It|=1;try{if(c)return yi(99,c.bind(null,d))}finally{It=p,yn()}}function du(c,d){nt(Oh,Ng),Ng|=d,za|=d}function rp(){Ng=Oh.current,Ne(Oh)}function Ea(c,d){c.finishedWork=null,c.finishedLanes=0;var p=c.timeoutHandle;if(p!==se&&(c.timeoutHandle=se,Ye(p)),Nn!==null)for(p=Nn.return;p!==null;){var w=p;switch(w.tag){case 1:w=w.type.childContextTypes,w!=null&&gn();break;case 3:Ma(),Ne(Mt),Ne(ft),Sh();break;case 5:Zh(w);break;case 4:Ma();break;case 13:Ne(hn);break;case 19:Ne(hn);break;case 10:xn(w);break;case 23:case 24:rp()}p=p.return}Bi=c,Nn=Yr(c.current,null),Ii=Ng=za=d,ti=0,lu=null,jh=ka=FI=0}function py(c,d){do{var p=Nn;try{if(bI(),ZI.current=jC,DC){for(var w=Zn.memoizedState;w!==null;){var S=w.queue;S!==null&&(S.pending=null),w=w.next}DC=!1}if(wI=0,ei=li=Zn=null,WI=!1,Ph.current=null,p===null||p.return===null){ti=1,lu=d,Nn=null;break}e:{var x=c,D=p.return,ie=p,be=d;if(d=Ii,ie.flags|=2048,ie.firstEffect=ie.lastEffect=null,be!==null&&typeof be=="object"&&typeof be.then=="function"){var Ue=be;if((ie.mode&2)===0){var at=ie.alternate;at?(ie.updateQueue=at.updateQueue,ie.memoizedState=at.memoizedState,ie.lanes=at.lanes):(ie.updateQueue=null,ie.memoizedState=null)}var ut=(hn.current&1)!==0,je=D;do{var Dt;if(Dt=je.tag===13){var nn=je.memoizedState;if(nn!==null)Dt=nn.dehydrated!==null;else{var Is=je.memoizedProps;Dt=Is.fallback===void 0?!1:Is.unstable_avoidThisFallback!==!0?!0:!ut}}if(Dt){var Ce=je.updateQueue;if(Ce===null){var re=new Set;re.add(Ue),je.updateQueue=re}else Ce.add(Ue);if((je.mode&2)===0){if(je.flags|=64,ie.flags|=16384,ie.flags&=-2981,ie.tag===1)if(ie.alternate===null)ie.tag=17;else{var ye=Wr(-1,1);ye.tag=2,Sr(ie,ye)}ie.lanes|=1;break e}be=void 0,ie=d;var Oe=x.pingCache;if(Oe===null?(Oe=x.pingCache=new vV,be=new Set,Oe.set(Ue,be)):(be=Oe.get(Ue),be===void 0&&(be=new Set,Oe.set(Ue,be))),!be.has(ie)){be.add(ie);var lt=MV.bind(null,x,Ue,ie);Ue.then(lt,lt)}je.flags|=4096,je.lanes=d;break e}je=je.return}while(je!==null);be=Error((E(ie.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}ti!==5&&(ti=2),be=Lh(be,ie),je=D;do{switch(je.tag){case 3:x=be,je.flags|=4096,d&=-d,je.lanes|=d;var Qt=ty(je,x,d);bG(je,Qt);break e;case 1:x=be;var ht=je.type,zt=je.stateNode;if((je.flags&64)===0&&(typeof ht.getDerivedStateFromError=="function"||zt!==null&&typeof zt.componentDidCatch=="function"&&(oo===null||!oo.has(zt)))){je.flags|=4096,d&=-d,je.lanes|=d;var Xn=ny(je,x,d);bG(je,Xn);break e}}je=je.return}while(je!==null)}by(p)}catch(Rt){d=Rt,Nn===p&&p!==null&&(Nn=p=p.return);continue}break}while(1)}function my(){var c=au.current;return au.current=jC,c===null?jC:c}function kI(c,d){var p=It;It|=16;var w=my();Bi===c&&Ii===d||Ea(c,d);do try{XV();break}catch(S){py(c,S)}while(1);if(bI(),It=p,au.current=w,Nn!==null)throw Error(g(261));return Bi=null,Ii=0,ti}function XV(){for(;Nn!==null;)fy(Nn)}function YV(){for(;Nn!==null&&!Br();)fy(Nn)}function fy(c){var d=By(c.alternate,c,Ng);c.memoizedProps=c.pendingProps,d===null?by(c):Nn=d,Ph.current=null}function by(c){var d=c;do{var p=d.alternate;if(c=d.return,(d.flags&2048)===0){if(p=yV(p,d,Ng),p!==null){Nn=p;return}if(p=d,p.tag!==24&&p.tag!==23||p.memoizedState===null||(Ng&1073741824)!==0||(p.mode&4)===0){for(var w=0,S=p.child;S!==null;)w|=S.lanes|S.childLanes,S=S.sibling;p.childLanes=w}c!==null&&(c.flags&2048)===0&&(c.firstEffect===null&&(c.firstEffect=d.firstEffect),d.lastEffect!==null&&(c.lastEffect!==null&&(c.lastEffect.nextEffect=d.firstEffect),c.lastEffect=d.lastEffect),1<d.flags&&(c.lastEffect!==null?c.lastEffect.nextEffect=d:c.firstEffect=d,c.lastEffect=d))}else{if(p=BV(d),p!==null){p.flags&=2047,Nn=p;return}c!==null&&(c.firstEffect=c.lastEffect=null,c.flags|=2048)}if(d=d.sibling,d!==null){Nn=d;return}Nn=d=c}while(d!==null);ti===0&&(ti=5)}function Mg(c){var d=Ss();return yi(99,HV.bind(null,c,d)),null}function HV(c,d){do Ko();while(KI!==null);if((It&48)!==0)throw Error(g(327));var p=c.finishedWork;if(p===null)return null;if(c.finishedWork=null,c.finishedLanes=0,p===c.current)throw Error(g(177));c.callbackNode=null;var w=p.lanes|p.childLanes,S=w,x=c.pendingLanes&~S;c.pendingLanes=S,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=S,c.mutableReadLanes&=S,c.entangledLanes&=S,S=c.entanglements;for(var D=c.eventTimes,ie=c.expirationTimes;0<x;){var be=31-rs(x),Ue=1<<be;S[be]=0,D[be]=-1,ie[be]=-1,x&=~Ue}if(Yo!==null&&(w&24)===0&&Yo.has(c)&&Yo.delete(c),c===Bi&&(Nn=Bi=null,Ii=0),1<p.flags?p.lastEffect!==null?(p.lastEffect.nextEffect=p,w=p.firstEffect):w=p:w=p.firstEffect,w!==null){S=It,It|=32,Ph.current=null,LI=T(c.containerInfo),zI=!1,et=w;do try{FV()}catch(re){if(et===null)throw Error(g(330));Xr(et,re),et=et.nextEffect}while(et!==null);LI=null,et=w;do try{for(D=c;et!==null;){var at=et.flags;if(at&16&&Ge&&Ae(et.stateNode),at&128){var ut=et.alternate;if(ut!==null){var je=ut.ref;je!==null&&(typeof je=="function"?je(null):je.current=null)}}switch(at&1038){case 2:Iy(et),et.flags&=-3;break;case 6:Iy(et),et.flags&=-3,Eh(et.alternate,et);break;case 1024:et.flags&=-1025;break;case 1028:et.flags&=-1025,Eh(et.alternate,et);break;case 4:Eh(et.alternate,et);break;case 8:ie=D,x=et,Ge?cy(ie,x):gy(ie,x);var Dt=x.alternate;ay(x),Dt!==null&&ay(Dt)}et=et.nextEffect}}catch(re){if(et===null)throw Error(g(330));Xr(et,re),et=et.nextEffect}while(et!==null);zI&&me(),Q(c.containerInfo),c.current=p,et=w;do try{for(at=c;et!==null;){var nn=et.flags;if(nn&36&&WV(at,et.alternate,et),nn&128){ut=void 0;var Is=et.ref;if(Is!==null){var Ce=et.stateNode;switch(et.tag){case 5:ut=F(Ce);break;default:ut=Ce}typeof Is=="function"?Is(ut):Is.current=ut}}et=et.nextEffect}}catch(re){if(et===null)throw Error(g(330));Xr(et,re),et=et.nextEffect}while(et!==null);et=null,MC(),It=S}else c.current=p;if(Vr)Vr=!1,KI=c,NI=d;else for(et=w;et!==null;)d=et.nextEffect,et.nextEffect=null,et.flags&8&&(nn=et,nn.sibling=null,nn.stateNode=null),et=d;if(w=c.pendingLanes,w===0&&(oo=null),w===1?c===sp?MI++:(MI=0,sp=c):MI=0,p=p.stateNode,Hi&&typeof Hi.onCommitFiberRoot=="function")try{Hi.onCommitFiberRoot(ws,p,void 0,(p.current.flags&64)===64)}catch{}if(Qi(c,Gn()),Iu)throw Iu=!1,c=tp,tp=null,c;return(It&8)!==0||yn(),null}function FV(){for(;et!==null;){var c=et.alternate;zI||LI===null||((et.flags&8)!==0?k(et,LI)&&(zI=!0,Le()):et.tag===13&&SV(c,et)&&k(et,LI)&&(zI=!0,Le()));var d=et.flags;(d&256)!==0&&wV(c,et),(d&512)===0||Vr||(Vr=!0,Rs(97,function(){return Ko(),null})),et=et.nextEffect}}function Ko(){if(NI!==90){var c=97<NI?97:NI;return NI=90,yi(c,NV)}return!1}function KV(c,d){np.push(d,c),Vr||(Vr=!0,Rs(97,function(){return Ko(),null}))}function Gy(c,d){ip.push(d,c),Vr||(Vr=!0,Rs(97,function(){return Ko(),null}))}function NV(){if(KI===null)return!1;var c=KI;if(KI=null,(It&48)!==0)throw Error(g(331));var d=It;It|=32;var p=ip;ip=[];for(var w=0;w<p.length;w+=2){var S=p[w],x=p[w+1],D=S.destroy;if(S.destroy=void 0,typeof D=="function")try{D()}catch(be){if(x===null)throw Error(g(330));Xr(x,be)}}for(p=np,np=[],w=0;w<p.length;w+=2){S=p[w],x=p[w+1];try{var ie=S.create;S.destroy=ie()}catch(be){if(x===null)throw Error(g(330));Xr(x,be)}}for(ie=c.current.firstEffect;ie!==null;)c=ie.nextEffect,ie.nextEffect=null,ie.flags&8&&(ie.sibling=null,ie.stateNode=null),ie=c;return It=d,yn(),!0}function yy(c,d,p){d=Lh(p,d),d=ty(c,d,1),Sr(c,d),d=Mi(),c=uu(c,1),c!==null&&(wo(c,1,d),Qi(c,d))}function Xr(c,d){if(c.tag===3)yy(c,c,d);else for(var p=c.return;p!==null;){if(p.tag===3){yy(p,c,d);break}else if(p.tag===1){var w=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof w.componentDidCatch=="function"&&(oo===null||!oo.has(w))){c=Lh(d,c);var S=ny(p,c,1);if(Sr(p,S),S=Mi(),p=uu(p,1),p!==null)wo(p,1,S),Qi(p,S);else if(typeof w.componentDidCatch=="function"&&(oo===null||!oo.has(w)))try{w.componentDidCatch(d,c)}catch{}break}}p=p.return}}function MV(c,d,p){var w=c.pingCache;w!==null&&w.delete(d),d=Mi(),c.pingedLanes|=c.suspendedLanes&p,Bi===c&&(Ii&p)===p&&(ti===4||ti===3&&(Ii&62914560)===Ii&&500>Gn()-$h?Ea(c,0):jh|=p),Qi(c,d)}function LV(c,d){var p=c.stateNode;p!==null&&p.delete(d),d=0,d===0&&(d=c.mode,(d&2)===0?d=1:(d&4)===0?d=Ss()===99?1:2:(Ho===0&&(Ho=za),d=Zo(62914560&~Ho),d===0&&(d=4194304))),p=Mi(),c=uu(c,d),c!==null&&(wo(c,d,p),Qi(c,p))}var By;By=function(c,d,p){var w=d.lanes;if(c!==null)if(c.memoizedProps!==d.pendingProps||Mt.current)Xs=!0;else if((p&w)!==0)Xs=(c.flags&16384)!==0;else{switch(Xs=!1,d.tag){case 3:DG(d),Wh();break;case 5:SG(d);break;case 1:rn(d.type)&&An(d);break;case 4:vh(d,d.stateNode.containerInfo);break;case 10:Vo(d,d.memoizedProps.value);break;case 13:if(d.memoizedState!==null)return(p&d.child.childLanes)!==0?PG(c,d,p):(nt(hn,hn.current&1),d=Xo(c,d,p),d!==null?d.sibling:null);nt(hn,hn.current&1);break;case 19:if(w=(p&d.childLanes)!==0,(c.flags&64)!==0){if(w)return $G(c,d,p);d.flags|=64}var S=d.memoizedState;if(S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),nt(hn,hn.current),w)break;return null;case 23:case 24:return d.lanes=0,Fh(c,d,p)}return Xo(c,d,p)}else Xs=!1;switch(d.lanes=0,d.tag){case 2:if(w=d.type,c!==null&&(c.alternate=null,d.alternate=null,d.flags|=2),c=d.pendingProps,S=$n(d,ft.current),Bn(d,p),S=Vh(null,d,w,c,S,p),d.flags|=1,typeof S=="object"&&S!==null&&typeof S.render=="function"&&S.$$typeof===void 0){if(d.tag=1,d.memoizedState=null,d.updateQueue=null,rn(w)){var x=!0;An(d)}else x=!1;d.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,yh(d);var D=w.getDerivedStateFromProps;typeof D=="function"&&zC(d,w,D,c),S.updater=kC,d.stateNode=S,S._reactInternals=d,Bh(d,w,c,p),d=Nh(null,d,w,!0,x,p)}else d.tag=0,Ni(null,d,S,p),d=d.child;return d;case 16:S=d.elementType;e:{switch(c!==null&&(c.alternate=null,d.alternate=null,d.flags|=2),c=d.pendingProps,x=S._init,S=x(S._payload),d.type=S,x=d.tag=kV(S),c=qt(S,c),x){case 0:d=Kh(null,d,S,c,p);break e;case 1:d=UG(null,d,S,c,p);break e;case 11:d=TG(null,d,S,c,p);break e;case 14:d=EG(null,d,S,qt(S.type,c),w,p);break e}throw Error(g(306,S,""))}return d;case 0:return w=d.type,S=d.pendingProps,S=d.elementType===w?S:qt(w,S),Kh(c,d,w,S,p);case 1:return w=d.type,S=d.pendingProps,S=d.elementType===w?S:qt(w,S),UG(c,d,w,S,p);case 3:if(DG(d),w=d.updateQueue,c===null||w===null)throw Error(g(282));if(w=d.pendingProps,S=d.memoizedState,S=S!==null?S.element:null,fG(c,d),GI(d,w,null,p),w=d.memoizedState.element,w===S)Wh(),d=Xo(c,d,p);else{if(S=d.stateNode,(x=S.hydrate)&&(fe?(Hg=ae(d.stateNode.containerInfo),xo=d,x=no=!0):x=!1),x){if(fe&&(c=S.mutableSourceEagerHydrationData,c!=null))for(S=0;S<c.length;S+=2)x=c[S],D=c[S+1],ue?x._workInProgressVersionPrimary=D:x._workInProgressVersionSecondary=D,La.push(x);for(p=WG(d,null,w,p),d.child=p;p;)p.flags=p.flags&-3|1024,p=p.sibling}else Ni(c,d,w,p),Wh();d=d.child}return d;case 5:return SG(d),c===null&&wh(d),w=d.type,S=d.pendingProps,x=c!==null?c.memoizedProps:null,D=S.children,Ie(w,S)?D=null:x!==null&&Ie(w,x)&&(d.flags|=16),JG(c,d),Ni(c,d,D,p),d.child;case 6:return c===null&&wh(d),null;case 13:return PG(c,d,p);case 4:return vh(d,d.stateNode.containerInfo),w=d.pendingProps,c===null?d.child=_C(d,null,w,p):Ni(c,d,w,p),d.child;case 11:return w=d.type,S=d.pendingProps,S=d.elementType===w?S:qt(w,S),TG(c,d,w,S,p);case 7:return Ni(c,d,d.pendingProps,p),d.child;case 8:return Ni(c,d,d.pendingProps.children,p),d.child;case 12:return Ni(c,d,d.pendingProps.children,p),d.child;case 10:e:{if(w=d.type._context,S=d.pendingProps,D=d.memoizedProps,x=S.value,Vo(d,x),D!==null){var ie=D.value;if(x=Jn(ie,x)?0:(typeof w._calculateChangedBits=="function"?w._calculateChangedBits(ie,x):1073741823)|0,x===0){if(D.children===S.children&&!Mt.current){d=Xo(c,d,p);break e}}else for(ie=d.child,ie!==null&&(ie.return=d);ie!==null;){var be=ie.dependencies;if(be!==null){D=ie.child;for(var Ue=be.firstContext;Ue!==null;){if(Ue.context===w&&(Ue.observedBits&x)!==0){ie.tag===1&&(Ue=Wr(-1,p&-p),Ue.tag=2,Sr(ie,Ue)),ie.lanes|=p,Ue=ie.alternate,Ue!==null&&(Ue.lanes|=p),Fi(ie.return,p),be.lanes|=p;break}Ue=Ue.next}}else D=ie.tag===10&&ie.type===d.type?null:ie.child;if(D!==null)D.return=ie;else for(D=ie;D!==null;){if(D===d){D=null;break}if(ie=D.sibling,ie!==null){ie.return=D.return,D=ie;break}D=D.return}ie=D}}Ni(c,d,S.children,p),d=d.child}return d;case 9:return S=d.type,x=d.pendingProps,w=x.children,Bn(d,p),S=vn(S,x.unstable_observedBits),w=w(S),d.flags|=1,Ni(c,d,w,p),d.child;case 14:return S=d.type,x=qt(S,d.pendingProps),x=qt(S.type,x),EG(c,d,S,x,w,p);case 15:return _G(c,d,d.type,d.pendingProps,w,p);case 17:return w=d.type,S=d.pendingProps,S=d.elementType===w?S:qt(w,S),c!==null&&(c.alternate=null,d.alternate=null,d.flags|=2),d.tag=1,rn(w)?(c=!0,An(d)):c=!1,Bn(d,p),vG(d,w,S),Bh(d,w,S,p),Nh(null,d,w,!0,c,p);case 19:return $G(c,d,p);case 23:return Fh(c,d,p);case 24:return Fh(c,d,p)}throw Error(g(156,d.tag))};var Au={current:!1},gp=r.unstable_flushAllWithoutAsserting,vy=typeof gp=="function";function ap(){if(gp!==void 0)return gp();for(var c=!1;Ko();)c=!0;return c}function Zy(c){try{ap(),RV(function(){ap()?Zy(c):c()})}catch(d){c(d)}}var hu=0,wy=!1;function zV(c,d,p,w){this.tag=c,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=w,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function ls(c,d,p,w){return new zV(c,d,p,w)}function lp(c){return c=c.prototype,!(!c||!c.isReactComponent)}function kV(c){if(typeof c=="function")return lp(c)?1:0;if(c!=null){if(c=c.$$typeof,c===b)return 11;if(c===y)return 14}return 2}function Yr(c,d){var p=c.alternate;return p===null?(p=ls(c.tag,d,c.key,c.mode),p.elementType=c.elementType,p.type=c.type,p.stateNode=c.stateNode,p.alternate=c,c.alternate=p):(p.pendingProps=d,p.type=c.type,p.flags=0,p.nextEffect=null,p.firstEffect=null,p.lastEffect=null),p.childLanes=c.childLanes,p.lanes=c.lanes,p.child=c.child,p.memoizedProps=c.memoizedProps,p.memoizedState=c.memoizedState,p.updateQueue=c.updateQueue,d=c.dependencies,p.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},p.sibling=c.sibling,p.index=c.index,p.ref=c.ref,p}function pu(c,d,p,w,S,x){var D=2;if(w=c,typeof c=="function")lp(c)&&(D=1);else if(typeof c=="string")D=5;else e:switch(c){case C:return _a(p.children,S,x,d);case W:D=8,S|=16;break;case u:D=8,S|=1;break;case A:return c=ls(12,p,d,S|8),c.elementType=A,c.type=A,c.lanes=x,c;case G:return c=ls(13,p,d,S),c.type=G,c.elementType=G,c.lanes=x,c;case f:return c=ls(19,p,d,S),c.elementType=f,c.lanes=x,c;case R:return Ip(p,S,x,d);case Z:return c=ls(24,p,d,S),c.elementType=Z,c.lanes=x,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case h:D=10;break e;case m:D=9;break e;case b:D=11;break e;case y:D=14;break e;case B:D=16,w=null;break e;case v:D=22;break e}throw Error(g(130,c==null?c:typeof c,""))}return d=ls(D,p,d,S),d.elementType=c,d.type=w,d.lanes=x,d}function _a(c,d,p,w){return c=ls(7,c,w,d),c.lanes=p,c}function Ip(c,d,p,w){return c=ls(23,c,w,d),c.elementType=R,c.lanes=p,c}function cp(c,d,p){return c=ls(6,c,null,d),c.lanes=p,c}function Cp(c,d,p){return d=ls(4,c.children!==null?c.children:[],c.key,d),d.lanes=p,d.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},d}function TV(c,d,p){this.tag=d,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=se,this.pendingContext=this.context=null,this.hydrate=p,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Gr(0),this.expirationTimes=Gr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gr(0),fe&&(this.mutableSourceEagerHydrationData=null)}function Wy(c){var d=c._reactInternals;if(d===void 0)throw typeof c.render=="function"?Error(g(188)):Error(g(268,Object.keys(c)));return c=q(d),c===null?null:c.stateNode}function Sy(c,d){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var p=c.retryLane;c.retryLane=p!==0&&p<d?p:d}}function mu(c,d){Sy(c,d),(c=c.alternate)&&Sy(c,d)}function EV(c){return c=q(c),c===null?null:c.stateNode}function _V(){return null}return n.IsThisRendererActing=Au,n.act=function(c){function d(){hu--,Qh.current=p,Au.current=w}wy===!1&&(wy=!0,console.error("act(...) is not supported in production builds of React, and might not behave as expected.")),hu++;var p=Qh.current,w=Au.current;Qh.current=!0,Au.current=!0;try{var S=Ay(c)}catch(x){throw d(),x}if(S!==null&&typeof S=="object"&&typeof S.then=="function")return{then:function(x,D){S.then(function(){1<hu||vy===!0&&p===!0?(d(),x()):Zy(function(ie){d(),ie?D(ie):x()})},function(ie){d(),D(ie)})}};try{hu!==1||vy!==!1&&p!==!1||ap(),d()}catch(x){throw d(),x}return{then:function(x){x()}}},n.attemptContinuousHydration=function(c){if(c.tag===13){var d=Mi();Fo(c,67108864,d),mu(c,67108864)}},n.attemptHydrationAtCurrentPriority=function(c){if(c.tag===13){var d=Mi(),p=xr(c);Fo(c,p,d),mu(c,p)}},n.attemptSynchronousHydration=function(c){switch(c.tag){case 3:var d=c.stateNode;if(d.hydrate){var p=Ws(d.pendingLanes);d.expiredLanes|=p&d.pendingLanes,Qi(d,Gn()),(It&48)===0&&(Rr(),yn())}break;case 13:var w=Mi();hy(function(){return Fo(c,1,w)}),mu(c,4)}},n.attemptUserBlockingHydration=function(c){if(c.tag===13){var d=Mi();Fo(c,4,d),mu(c,4)}},n.batchedEventUpdates=function(c,d){var p=It;It|=2;try{return c(d)}finally{It=p,It===0&&(Rr(),yn())}},n.batchedUpdates=Ay,n.createComponentSelector=function(c){return{$$typeof:nu,value:c}},n.createContainer=function(c,d,p){return c=new TV(c,d,p),d=ls(3,null,null,d===2?7:d===1?3:0),c.current=d,d.stateNode=c,yh(d),c},n.createHasPsuedoClassSelector=function(c){return{$$typeof:iu,value:c}},n.createPortal=function(c,d,p){var w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:I,key:w==null?null:""+w,children:c,containerInfo:d,implementation:p}},n.createRoleSelector=function(c){return{$$typeof:su,value:c}},n.createTestNameSelector=function(c){return{$$typeof:ou,value:c}},n.createTextSelector=function(c){return{$$typeof:ru,value:c}},n.deferredUpdates=function(c){return yi(97,c)},n.discreteUpdates=function(c,d,p,w,S){var x=It;It|=4;try{return yi(98,c.bind(null,d,p,w,S))}finally{It=x,It===0&&(Rr(),yn())}},n.findAllNodes=Dh,n.findBoundingRects=function(c,d){if(!Y)throw Error(g(363));d=Dh(c,d),c=[];for(var p=0;p<d.length;p++)c.push(ce(d[p]));for(d=c.length-1;0<d;d--){p=c[d];for(var w=p.x,S=w+p.width,x=p.y,D=x+p.height,ie=d-1;0<=ie;ie--)if(d!==ie){var be=c[ie],Ue=be.x,at=Ue+be.width,ut=be.y,je=ut+be.height;if(w>=Ue&&x>=ut&&S<=at&&D<=je){c.splice(d,1);break}else if(w!==Ue||p.width!==be.width||je<x||ut>D){if(!(x!==ut||p.height!==be.height||at<w||Ue>S)){Ue>w&&(be.width+=Ue-w,be.x=w),at<S&&(be.width=S-Ue),c.splice(d,1);break}}else{ut>x&&(be.height+=ut-x,be.y=x),je<D&&(be.height=D-ut),c.splice(d,1);break}}}return c},n.findHostInstance=Wy,n.findHostInstanceWithNoPortals=function(c){return c=ne(c),c===null?null:c.tag===20?c.stateNode.instance:c.stateNode},n.findHostInstanceWithWarning=function(c){return Wy(c)},n.flushControlled=function(c){var d=It;It|=1;try{yi(99,c)}finally{It=d,It===0&&(Rr(),yn())}},n.flushDiscreteUpdates=function(){(It&49)===0&&(xV(),Ko())},n.flushPassiveEffects=Ko,n.flushSync=hy,n.focusWithin=function(c,d){if(!Y)throw Error(g(363));for(c=_h(c),d=uy(c,d),d=Array.from(d),c=0;c<d.length;){var p=d[c++];if(!Re(p)){if(p.tag===5&&We(p.stateNode))return!0;for(p=p.child;p!==null;)d.push(p),p=p.sibling}}return!1},n.getCurrentUpdateLanePriority=function(){return br},n.getFindAllNodesFailureDescription=function(c,d){if(!Y)throw Error(g(363));var p=0,w=[];c=[_h(c),0];for(var S=0;S<c.length;){var x=c[S++],D=c[S++],ie=d[D];if((x.tag!==5||!Re(x))&&(Jh(x,ie)&&(w.push(Uh(ie)),D++,D>p&&(p=D)),D<d.length))for(x=x.child;x!==null;)c.push(x,D),x=x.sibling}if(p<d.length){for(c=[];p<d.length;p++)c.push(Uh(d[p]));return`findAllNodes was able to match part of the selector:
  `+(w.join(" > ")+`

No matching component was found for:
  `)+c.join(" > ")}return null},n.getPublicRootInstance=function(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return F(c.child.stateNode);default:return c.child.stateNode}},n.injectIntoDevTools=function(c){if(c={bundleType:c.bundleType,version:c.version,rendererPackageName:c.rendererPackageName,rendererConfig:c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:EV,findFiberByHostInstance:c.findFiberByHostInstance||_V,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")c=!1;else{var d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!d.isDisabled&&d.supportsFiber)try{ws=d.inject(c),Hi=d}catch{}c=!0}return c},n.observeVisibleRects=function(c,d,p,w){if(!Y)throw Error(g(363));c=Dh(c,d);var S=he(c,p,w).disconnect;return{disconnect:function(){S()}}},n.registerMutableSourceForHydration=function(c,d){var p=d._getVersion;p=p(d._source),c.mutableSourceEagerHydrationData==null?c.mutableSourceEagerHydrationData=[d,p]:c.mutableSourceEagerHydrationData.push(d,p)},n.runWithPriority=function(c,d){var p=br;try{return br=c,d()}finally{br=p}},n.shouldSuspend=function(){return!1},n.unbatchedUpdates=function(c,d){var p=It;It&=-2,It|=8;try{return c(d)}finally{It=p,It===0&&(Rr(),yn())}},n.updateContainer=function(c,d,p,w){var S=d.current,x=Mi(),D=xr(S);e:if(p){p=p._reactInternals;t:{if(L(p)!==p||p.tag!==1)throw Error(g(170));var ie=p;do{switch(ie.tag){case 3:ie=ie.stateNode.context;break t;case 1:if(rn(ie.type)){ie=ie.stateNode.__reactInternalMemoizedMergedChildContext;break t}}ie=ie.return}while(ie!==null);throw Error(g(171))}if(p.tag===1){var be=p.type;if(rn(be)){p=Bo(p,be,ie);break e}}p=ie}else p=qn;return d.context===null?d.context=p:d.pendingContext=p,d=Wr(x,D),d.payload={element:c},w=w===void 0?null:w,w!==null&&(d.callback=w),Sr(S,d),Fo(S,D,x),D},n}})(CR);(function(i){i.exports=CR.exports})(cR);const AM=a2(cR.exports);var lG=function i(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,o;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!i(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[s]))return!1;for(s=n;s--!==0;){var r=o[s];if(!i(e[r],t[r]))return!1}return!0}return e!==e&&t!==t};const dh=[];function dR(i,e,t,n=0,s=!1){for(const r of e)if(lG(t,r.args)){if(s)return;if(r.error)throw r.error;if(r.response)return r.response;throw r.promise}const o={args:t,promise:i(...t).then(r=>o.response=r!=null?r:!0).catch(r=>o.error=r!=null?r:"unknown error").then(()=>{n>0&&setTimeout(()=>{const r=e.indexOf(o);r!==-1&&e.splice(r,1)},n)})};if(e.push(o),!s)throw o.promise}function hM(i,...e){if(e===void 0||e.length===0)i.splice(0,i.length);else{const t=i.find(n=>lG(e,n.args));if(t){const n=i.indexOf(t);n!==-1&&i.splice(n,1)}}}function lr(i,...e){return dR(i,dh,e,lr.lifespan)}lr.lifespan=0;lr.clear=(...i)=>hM(dh,...i);lr.preload=(i,...e)=>void dR(i,dh,e,lr.lifespan,!0);lr.peek=(...i)=>{var e;return(e=dh.find(t=>lG(i,t.args)))==null?void 0:e.response};function pM(i){return function(e){i.forEach(function(t){typeof t=="function"?t(e):t!=null&&(t.current=e)})}}function I0(i,e,t){var n,s,o,r,g;e==null&&(e=100);function a(){var I=Date.now()-r;I<e&&I>=0?n=setTimeout(a,e-I):(n=null,t||(g=i.apply(o,s),o=s=null))}var l=function(){o=this,s=arguments,r=Date.now();var I=t&&!n;return n||(n=setTimeout(a,e)),I&&(g=i.apply(o,s),o=s=null),g};return l.clear=function(){n&&(clearTimeout(n),n=null)},l.flush=function(){n&&(g=i.apply(o,s),o=s=null,clearTimeout(n),n=null)},l}I0.debounce=I0;var rZ=I0;function mM(i){let{debounce:e,scroll:t,polyfill:n,offsetSize:s}=i===void 0?{debounce:0,scroll:!1,offsetSize:!1}:i;const o=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!o)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[r,g]=Je.exports.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=Je.exports.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:r}),l=e?typeof e=="number"?e:e.scroll:null,I=e?typeof e=="number"?e:e.resize:null,C=Je.exports.useRef(!1);Je.exports.useEffect(()=>(C.current=!0,()=>void(C.current=!1)));const[u,A,h]=Je.exports.useMemo(()=>{const f=()=>{if(!a.current.element)return;const{left:y,top:B,width:v,height:W,bottom:R,right:Z,x:V,y:H}=a.current.element.getBoundingClientRect(),P={left:y,top:B,width:v,height:W,bottom:R,right:Z,x:V,y:H};a.current.element instanceof HTMLElement&&s&&(P.height=a.current.element.offsetHeight,P.width=a.current.element.offsetWidth),Object.freeze(P),C.current&&!yM(a.current.lastBounds,P)&&g(a.current.lastBounds=P)};return[f,I?rZ(f,I):f,l?rZ(f,l):f]},[g,s,l,I]);function m(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(f=>f.removeEventListener("scroll",h,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null)}function b(){!a.current.element||(a.current.resizeObserver=new o(h),a.current.resizeObserver.observe(a.current.element),t&&a.current.scrollContainers&&a.current.scrollContainers.forEach(f=>f.addEventListener("scroll",h,{capture:!0,passive:!0})))}const G=f=>{!f||f===a.current.element||(m(),a.current.element=f,a.current.scrollContainers=AR(f),b())};return bM(h,Boolean(t)),fM(A),Je.exports.useEffect(()=>{m(),b()},[t,h,A]),Je.exports.useEffect(()=>m,[]),[G,r,u]}function fM(i){Je.exports.useEffect(()=>{const e=i;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[i])}function bM(i,e){Je.exports.useEffect(()=>{if(e){const t=i;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[i,e])}function AR(i){const e=[];if(!i||i===document.body)return e;const{overflow:t,overflowX:n,overflowY:s}=window.getComputedStyle(i);return[t,n,s].some(o=>o==="auto"||o==="scroll")&&e.push(i),[...e,...AR(i.parentElement)]}const GM=["x","y","top","bottom","left","right","width","height"],yM=(i,e)=>GM.every(t=>i[t]===e[t]);var Ah={exports:{}},hh={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BM=Je.exports,vM=Symbol.for("react.element"),ZM=Symbol.for("react.fragment"),wM=Object.prototype.hasOwnProperty,WM=BM.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,SM={key:!0,ref:!0,__self:!0,__source:!0};function hR(i,e,t){var n,s={},o=null,r=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(r=e.ref);for(n in e)wM.call(e,n)&&!SM.hasOwnProperty(n)&&(s[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:vM,type:i,key:o,ref:r,props:s,_owner:WM.current}}hh.Fragment=ZM;hh.jsx=hR;hh.jsxs=hR;(function(i){i.exports=hh})(Ah);const IG=Ah.exports.Fragment,Wt=Ah.exports.jsx,dg=Ah.exports.jsxs,kt={obj:i=>i===Object(i)&&!kt.arr(i)&&typeof i!="function",fun:i=>typeof i=="function",str:i=>typeof i=="string",num:i=>typeof i=="number",und:i=>i===void 0,arr:i=>Array.isArray(i),equ(i,e){if(typeof i!=typeof e||!!i!=!!e)return!1;if(kt.str(i)||kt.num(i)||kt.obj(i))return i===e;if(kt.arr(i)&&i==e)return!0;let t;for(t in i)if(!(t in e))return!1;for(t in e)if(i[t]!==e[t])return!1;return kt.und(t)?i===e:!0}};function Gm(i){return(i.eventObject||i.object).uuid+"/"+i.index}function RM(i,e){const{internal:t}=i.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,s)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(s)})}function VM(i){const e=new N;function t(C){var u;const A=i.getState(),{raycaster:h,mouse:m,camera:b,size:G}=A,{offsetX:f,offsetY:y}=(u=h.computeOffsets==null?void 0:h.computeOffsets(C,A))!=null?u:C,{width:B,height:v}=G;m.set(f/B*2-1,-(y/v)*2+1),h.setFromCamera(m,b)}function n(C){const{internal:u}=i.getState(),A=C.offsetX-u.initialClick[0],h=C.offsetY-u.initialClick[1];return Math.round(Math.sqrt(A*A+h*h))}function s(C){return C.filter(u=>["Move","Over","Enter","Out","Leave"].some(A=>{var h;return(h=u.__r3f.handlers)==null?void 0:h["onPointer"+A]}))}function o(C){const u=i.getState(),{raycaster:A,internal:h}=u;if(!A.enabled)return[];const m=new Set,b=[],G=C?C(h.interaction):h.interaction;let f=A.intersectObjects(G,!0).filter(B=>{const v=Gm(B);return m.has(v)?!1:(m.add(v),!0)});A.filter&&(f=A.filter(f,u));for(const B of f){let v=B.object;for(;v;){var y;((y=v.__r3f)==null?void 0:y.handlers)&&b.push({...B,eventObject:v}),v=v.parent}}return b}function r(C,u){const{internal:A}=i.getState();return"pointerId"in u&&A.capturedMap.has(u.pointerId)&&C.push(...A.capturedMap.get(u.pointerId).values()),C}function g(C,u,A){const{raycaster:h,mouse:m,camera:b,internal:G}=i.getState();if(C.length){const f=e.set(m.x,m.y,0).unproject(b),y=u.type==="click"?n(u):0,B=W=>u.target.releasePointerCapture(W),v={stopped:!1};for(const W of C){const R=P=>{var E,L;return(E=(L=G.capturedMap.get(P))==null?void 0:L.has(W.eventObject))!=null?E:!1},Z=P=>{G.capturedMap.has(P)?G.capturedMap.get(P).set(W.eventObject,W):G.capturedMap.set(P,new Map([[W.eventObject,W]])),u.target.setPointerCapture(P)};let V={};for(let P in Object.getPrototypeOf(u)){let E=u[P];typeof E!="function"&&(V[P]=E)}let H={...W,...V,spaceX:m.x,spaceY:m.y,intersections:C,stopped:v.stopped,delta:y,unprojectedPoint:f,ray:h.ray,camera:b,stopPropagation:()=>{const P="pointerId"in u&&G.capturedMap.get(u.pointerId);if((!P||P.has(W.eventObject))&&(H.stopped=v.stopped=!0,G.hovered.size&&Array.from(G.hovered.values()).find(E=>E.eventObject===W.eventObject))){const E=C.slice(0,C.indexOf(W));a([...E,W])}},target:{hasPointerCapture:R,setPointerCapture:Z,releasePointerCapture:B},currentTarget:{hasPointerCapture:R,setPointerCapture:Z,releasePointerCapture:B},sourceEvent:u,nativeEvent:u};if(A(H),v.stopped===!0)break}}return C}function a(C){const{internal:u}=i.getState();Array.from(u.hovered.values()).forEach(A=>{if(!C.length||!C.find(h=>h.object===A.object&&h.index===A.index)){const m=A.eventObject.__r3f.handlers;if(u.hovered.delete(Gm(A)),m){const b={...A,intersections:C||[]};m.onPointerOut==null||m.onPointerOut(b),m.onPointerLeave==null||m.onPointerLeave(b)}}})}const l=C=>{switch(C){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return u=>{"pointerId"in u&&i.getState().internal.capturedMap.delete(u.pointerId),a([])}}return u=>{const{onPointerMissed:A,internal:h}=i.getState();t(u);const m=C==="onPointerMove",G=r(o(m?s:void 0),u);m&&a(G),g(G,u,f=>{const y=f.eventObject,B=y.__r3f.handlers;if(!!B)if(m){if(B.onPointerOver||B.onPointerEnter||B.onPointerOut||B.onPointerLeave){const v=Gm(f),W=h.hovered.get(v);W?W.stopped&&f.stopPropagation():(h.hovered.set(v,f),B.onPointerOver==null||B.onPointerOver(f),B.onPointerEnter==null||B.onPointerEnter(f))}B.onPointerMove==null||B.onPointerMove(f)}else{const v=B==null?void 0:B[C];v&&(C!=="onClick"&&C!=="onContextMenu"&&C!=="onDoubleClick"||h.initialHits.includes(y))&&(v(f),I(u,h.interaction.filter(W=>W!==y)))}}),C==="onPointerDown"&&(h.initialClick=[u.offsetX,u.offsetY],h.initialHits=G.map(f=>f.eventObject)),(C==="onClick"||C==="onContextMenu"||C==="onDoubleClick")&&!G.length&&n(u)<=2&&(I(u,h.interaction),A&&A(u))}};function I(C,u){u.forEach(A=>{var h;return(h=A.__r3f.handlers)==null||h.onPointerMissed==null?void 0:h.onPointerMissed(C)})}return{handlePointer:l}}const YA=i=>i&&!!i.getState,ym=(i,e)=>{var t,n;return{root:YA(i)?i:(t=(n=i.__r3f)==null?void 0:n.root)!=null?t:e.__r3f.root,container:YA(i)?i.getState().scene:i}},gZ="__default",Bm={},aZ=["children","key","ref"];let xM={};function c0(i,e){const t=i;return(e!=null&&e.instance||!t.__r3f)&&(t.__r3f={root:null,memoizedProps:{},objects:[],...e}),i}function XM(i){function e(C,u,A={},h=!1){var m,b,G;const f=(m=C==null?void 0:C.__r3f)!=null?m:{},y=f.root,B=(b=y==null||y.getState==null?void 0:y.getState())!=null?b:{},v=[],W=[],R={};let Z=0;Object.entries(u).forEach(([K,O])=>{aZ.indexOf(K)===-1&&(R[K]=O)}),f.memoizedProps&&f.memoizedProps.args&&(R.args=f.memoizedProps.args),f.memoizedProps&&f.memoizedProps.attach&&(R.attach=f.memoizedProps.attach),C.__r3f&&(C.__r3f.memoizedProps=R);let V=Object.keys(u);for(Z=0;Z<V.length;Z++)kt.equ(u[V[Z]],A[V[Z]])&&v.push(V[Z]),kt.fun(u[V[Z]])&&/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(V[Z])&&W.push(V[Z]);const H=[];if(h)for(V=Object.keys(A),Z=0;Z<V.length;Z++)u.hasOwnProperty(V[Z])||H.push(V[Z]);const P=[...v,...aZ];(G=C.__r3f)!=null&&G.instance&&P.push("object");const E={...u};for(V=Object.keys(E),Z=0;Z<V.length;Z++)P.indexOf(V[Z])>-1&&delete E[V[Z]];const L=Object.entries(E);for(Z=0;Z<H.length;Z++)H[Z]!=="children"&&L.unshift([H[Z],gZ+"remove"]);if(L.length>0){if(L.forEach(([K,O])=>{if(!W.includes(K)){let q=C,ne=q[K];if(K.includes("-")){const k=K.split("-");if(ne=k.reduce((F,z)=>F[z],C),!(ne&&ne.set)){const[F,...z]=k.reverse();q=z.reverse().reduce((X,T)=>X[T],C),K=F}}if(O===gZ+"remove")if(ne&&ne.constructor)O=new ne.constructor(R.args);else if(q.constructor){const k=new q.constructor(q.__r3f.memoizedProps.args);O=k[ne],k.dispose&&k.dispose()}else O=0;if(ne&&ne.set&&(ne.copy||ne instanceof ha)){if(Array.isArray(O))ne.fromArray?ne.fromArray(O):ne.set(...O);else if(ne.copy&&O&&O.constructor&&ne.constructor.name===O.constructor.name)ne.copy(O);else if(O!==void 0){const k=ne instanceof Ee;!k&&ne.setScalar?ne.setScalar(O):ne instanceof ha&&O instanceof ha?ne.mask=O.mask:ne.set(O),!B.linear&&k&&ne.convertSRGBToLinear()}}else q[K]=O,!B.linear&&q[K]instanceof Cn&&(q[K].encoding=Yt);t(C)}}),h&&y&&C.raycast&&f.handlers){f.handlers=void 0;const K=B.internal.interaction.indexOf(C);K>-1&&B.internal.interaction.splice(K,1)}W.length&&(h&&y&&C.raycast&&B.internal.interaction.push(C),f.handlers=W.reduce((K,O)=>({...K,[O]:u[O]}),{})),C.parent&&n(C)}}function t(C){var u,A;const h=(u=C.__r3f)==null||(A=u.root)==null||A.getState==null?void 0:A.getState();h&&h.internal.frames===0&&h.invalidate()}function n(C){C.onUpdate==null||C.onUpdate(C)}function s(C,{args:u=[],...A},h,m,b){let G=`${C[0].toUpperCase()}${C.slice(1)}`,f;if(!YA(h)&&b){const y=B=>B.return?y(B.return):B.stateNode&&B.stateNode.containerInfo;h=y(b)}if(!h||!YA(h))throw`No valid root for ${G}!`;if(C==="primitive"){if(A.object===void 0)throw"Primitives without 'object' are invalid!";const y=A.object;f=c0(y,{root:h,instance:!0})}else{const y=xM[G]||lM[G];if(!y)throw`${G} is not part of the THREE namespace! Did you forget to extend? See: https://github.com/pmndrs/react-three-fiber/blob/master/markdown/api.md#using-3rd-party-objects-declaratively`;const B=kt.arr(u);f=c0(B?new y(...u):new y(u),{root:h,memoizedProps:{args:B&&u.length===0?null:u}})}return"attachFns"in A||(G.endsWith("Geometry")?A={attach:"geometry",...A}:G.endsWith("Material")&&(A={attach:"material",...A})),e(f,A,{}),f}function o(C,u){let A=!1;if(u){if(u.attachArray)kt.arr(C[u.attachArray])||(C[u.attachArray]=[]),C[u.attachArray].push(u);else if(u.attachObject)kt.obj(C[u.attachObject[0]])||(C[u.attachObject[0]]={}),C[u.attachObject[0]][u.attachObject[1]]=u;else if(u.attach&&!kt.fun(u.attach))C[u.attach]=u;else if(kt.arr(u.attachFns)){const[h]=u.attachFns;kt.str(h)&&kt.fun(C[h])?C[h](u):kt.fun(h)&&h(u,C)}else u.isObject3D&&(C.add(u),A=!0);A||(C.__r3f.objects.push(u),u.parent=C),n(u),t(u)}}function r(C,u,A){let h=!1;if(u){if(u.attachArray){const m=C[u.attachArray];kt.arr(m)||(C[u.attachArray]=[]),m.splice(m.indexOf(A),0,u)}else{if(u.attachObject||u.attach&&!kt.fun(u.attach))return o(C,u);if(u.isObject3D){u.parent=C,u.dispatchEvent({type:"added"});const m=C.children.filter(G=>G!==u),b=m.indexOf(A);C.children=[...m.slice(0,b),u,...m.slice(b)],h=!0}}h||(C.__r3f.objects.push(u),u.parent=C),n(u),t(u)}}function g(C,u,A=!1){C&&[...C].forEach(h=>a(u,h,A))}function a(C,u,A){if(u){var h;if(C.__r3f.objects){const y=C.__r3f.objects.length;C.__r3f.objects=C.__r3f.objects.filter(v=>v!==u),C.__r3f.objects.length<y&&(u.parent=null)}if(u.attachArray)C[u.attachArray]=C[u.attachArray].filter(y=>y!==u);else if(u.attachObject)delete C[u.attachObject[0]][u.attachObject[1]];else if(u.attach&&!kt.fun(u.attach))C[u.attach]=null;else if(kt.arr(u.attachFns)){const[,y]=u.attachFns;kt.str(y)&&kt.fun(C[y])?C[y](u):kt.fun(y)&&y(u,C)}else if(u.isObject3D){var m;C.remove(u),(m=u.__r3f)!=null&&m.root&&RM(u.__r3f.root,u)}const G=(h=u.__r3f)==null?void 0:h.instance,f=A===void 0?u.dispose!==null&&!G:A;if(!G){var b;g((b=u.__r3f)==null?void 0:b.objects,u,f),g(u.children,u,f)}u.__r3f&&(delete u.__r3f.root,delete u.__r3f.objects,delete u.__r3f.handlers,delete u.__r3f.memoizedProps,G||delete u.__r3f),f&&u.dispose&&u.type!=="Scene"&&Vc.exports.unstable_runWithPriority(Vc.exports.unstable_IdlePriority,()=>u.dispose()),t(C)}}function l(C,u,A,h){const m=C.parent;if(!m)return;const b=s(u,A,C.__r3f.root);C.children&&(C.children.forEach(G=>o(b,G)),C.children=[]),C.__r3f.objects.forEach(G=>o(b,G)),C.__r3f.objects=[],a(m,C),o(m,b),[h,h.alternate].forEach(G=>{G!==null&&(G.stateNode=b,G.ref&&(typeof G.ref=="function"?G.ref(b):G.ref.current=b))})}return{reconciler:AM({now:Vc.exports.unstable_now,createInstance:s,removeChild:a,appendChild:o,appendInitialChild:o,insertBefore:r,warnsIfNotActing:!0,supportsMutation:!0,isPrimaryRenderer:!1,scheduleTimeout:kt.fun(setTimeout)?setTimeout:void 0,cancelTimeout:kt.fun(clearTimeout)?clearTimeout:void 0,setTimeout:kt.fun(setTimeout)?setTimeout:void 0,clearTimeout:kt.fun(clearTimeout)?clearTimeout:void 0,noTimeout:-1,appendChildToContainer:(C,u)=>{const{container:A,root:h}=ym(C,u);A.__r3f.root=h,o(A,u)},removeChildFromContainer:(C,u)=>{const{container:A}=ym(C,u);a(A,u)},insertInContainerBefore:(C,u,A)=>{const{container:h}=ym(C,u);r(h,u,A)},commitUpdate(C,u,A,h,m,b){if(C.__r3f.instance&&m.object&&m.object!==C)l(C,A,m,b);else{const{args:G=[],...f}=m,{args:y=[],...B}=h;G.some((W,R)=>kt.obj(W)?Object.entries(W).some(([Z,V])=>V!==y[R][Z]):W!==y[R])?l(C,A,m,b):e(C,f,B,!0)}},hideInstance(C){C.isObject3D&&(C.visible=!1,t(C))},unhideInstance(C,u){(C.isObject3D&&u.visible==null||u.visible)&&(C.visible=!0,t(C))},hideTextInstance(){throw new Error("Text is not allowed in the R3F tree.")},getPublicInstance(C){return C},getRootHostContext(C){return Bm},getChildHostContext(C){return Bm},createTextInstance(){},finalizeInitialChildren(C){return!!C.__r3f.handlers},commitMount(C){C.raycast&&C.__r3f.handlers&&C.__r3f.root.getState().internal.interaction.push(C)},prepareUpdate(){return Bm},shouldDeprioritizeSubtree(){return!1},prepareForCommit(){return null},preparePortalMount(...C){},resetAfterCommit(){},shouldSetTextContent(){return!1},clearContainer(){return!1}}),applyProps:e}}const YM=i=>i&&!!i.render,lZ=i=>i&&i.isOrthographicCamera,cG=Je.exports.createContext(null),HM=(i,e,t,n)=>{const{gl:s,size:o,shadows:r=!1,linear:g=!1,flat:a=!1,vr:l=!1,orthographic:I=!1,frameloop:C="always",dpr:u=1,performance:A,clock:h=new oG,raycaster:m,camera:b,onPointerMissed:G}=n;r&&(s.shadowMap.enabled=!0,typeof r=="object"?Object.assign(s.shadowMap,r):s.shadowMap.type=Gb),g||(a||(s.toneMapping=vb),s.outputEncoding=Yt),C==="never"&&(h.stop(),h.elapsedTime=0);const f=CM((B,v)=>{const W=new lR,{params:R,...Z}=m||{};i(W,{enabled:!0,...Z,params:{...W.params,...R}},{});const V=b instanceof Pl,H=V?b:I?new iI(0,0,0,0,.1,1e3):new zn(75,0,.1,1e3);V||(H.position.z=5,b&&i(H,b,{}),H.lookAt(0,0,0));function P(k){return Array.isArray(k)?Math.min(Math.max(k[0],window.devicePixelRatio),k[1]):k}const E=P(u),L=new N,K=new N;function O(k=v().camera,F=K,z=v().size){const{width:X,height:T}=z,Q=X/T,ee=k.getWorldPosition(L).distanceTo(F);if(lZ(k))return{width:X/k.zoom,height:T/k.zoom,factor:1,distance:ee,aspect:Q};{const oe=k.fov*Math.PI/180,j=2*Math.tan(oe/2)*ee,ge=j*(X/T);return{width:ge,height:j,factor:X/ge,distance:ee,aspect:Q}}}let q;const ne=k=>B(F=>({performance:{...F.performance,current:k}}));return{gl:s,set:B,get:v,invalidate:()=>e(v()),advance:(k,F)=>t(k,F,v()),linear:g,flat:a,scene:c0(new Kb),camera:H,controls:null,raycaster:W,clock:h,mouse:new Se,vr:l,frameloop:C,onPointerMissed:G,performance:{current:1,min:.5,max:1,debounce:200,...A,regress:()=>{const k=v();q&&clearTimeout(q),k.performance.current!==k.performance.min&&ne(k.performance.min),q=setTimeout(()=>ne(v().performance.max),k.performance.debounce)}},size:{width:0,height:0},viewport:{initialDpr:E,dpr:E,width:0,height:0,aspect:0,distance:0,factor:0,getCurrentViewport:O},setSize:(k,F)=>{const z={width:k,height:F};B(X=>({size:z,viewport:{...X.viewport,...O(H,K,z)}}))},setDpr:k=>B(F=>({viewport:{...F.viewport,dpr:P(k)}})),events:{connected:!1},internal:{active:!1,priority:0,frames:0,lastProps:n,interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(k,F=0)=>(B(({internal:z})=>({internal:{...z,priority:z.priority+(F>0?1:0),subscribers:[...z.subscribers,{ref:k,priority:F}].sort((X,T)=>X.priority-T.priority)}})),()=>{B(({internal:z})=>({internal:{...z,priority:z.priority-(F>0?1:0),subscribers:z.subscribers.filter(X=>X.ref!==k)}}))})}}});f.subscribe(()=>{const{camera:B,size:v,viewport:W,internal:R}=f.getState();R.lastProps.camera instanceof Pl||(lZ(B)?(B.left=v.width/-2,B.right=v.width/2,B.top=v.height/2,B.bottom=v.height/-2):B.aspect=v.width/v.height,B.updateProjectionMatrix(),B.updateMatrixWorld()),s.setPixelRatio(W.dpr),s.setSize(v.width,v.height)},B=>[B.viewport.dpr,B.size],uM);const y=f.getState();return o&&y.setSize(o.width,o.height),f.subscribe(B=>e(B)),f};let ng,IZ=[],cZ=[],FM=[];function sc(i,e){for(ng=0;ng<i.length;ng++)i[ng](e)}function vm(i,e){let t=e.clock.getDelta();for(e.frameloop==="never"&&typeof i=="number"&&(t=i-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=i),ng=0;ng<e.internal.subscribers.length;ng++)e.internal.subscribers[ng].ref.current(e,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function KM(i){let e=!1,t;function n(r){if(e=!0,t=0,sc(IZ,r),i.forEach(g=>{const a=g.store.getState();a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&(t+=vm(r,a))}),sc(cZ,r),t>0)return requestAnimationFrame(n);sc(FM,r),e=!1}function s(r){if(!r)return i.forEach(g=>s(g.store.getState()));r.vr||!r.internal.active||r.frameloop==="never"||(r.internal.frames=Math.min(60,r.internal.frames+1),e||(e=!0,requestAnimationFrame(n)))}function o(r,g=!0,a){g&&sc(IZ,r),a?vm(r,a):i.forEach(l=>vm(r,l.store.getState())),g&&sc(cZ,r)}return{loop:n,invalidate:s,advance:o}}function NM(i){const{handlePointer:e}=VM(i),t={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};return{connected:!1,handlers:Object.keys(t).reduce((n,s)=>({...n,[s]:e(s)}),{}),connect:n=>{var s;const{set:o,events:r}=i.getState();r.disconnect==null||r.disconnect(),o(g=>({events:{...g.events,connected:n}})),Object.entries((s=r==null?void 0:r.handlers)!=null?s:[]).forEach(([g,a])=>{const[l,I]=t[g];n.addEventListener(l,a,{passive:I})})},disconnect:()=>{const{set:n,events:s}=i.getState();if(s.connected){var o;Object.entries((o=s.handlers)!=null?o:[]).forEach(([r,g])=>{if(s&&s.connected instanceof HTMLElement){const[a]=t[r];s.connected.removeEventListener(a,g)}}),n(r=>({events:{...r.events,connected:!1}}))}}}}const C0=typeof window<"u"?Je.exports.useLayoutEffect:Je.exports.useEffect;function MM({set:i}){return C0(()=>(i(new Promise(()=>null)),()=>i(!1)),[]),null}class pR extends Je.exports.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}pR.getDerivedStateFromError=()=>({error:!0});const LM=Je.exports.forwardRef(function({children:e,fallback:t,tabIndex:n,resize:s,id:o,style:r,className:g,events:a,...l},I){const[C,u]=mM({scroll:!0,debounce:{scroll:50,resize:0},...s}),A=Je.exports.useRef(null),[h,m]=Je.exports.useState(!1),[b,G]=Je.exports.useState(!1);if(h)throw h;if(b)throw b;return C0(()=>{u.width>0&&u.height>0&&_M(Wt(pR,{set:G,children:Wt(Je.exports.Suspense,{fallback:Wt(MM,{set:m}),children:e})}),A.current,{...l,size:u,events:a||NM})},[u,e]),C0(()=>{const f=A.current;return()=>bR(f)},[]),Wt("div",{ref:C,id:o,className:g,tabIndex:n,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",...r},children:Wt("canvas",{ref:pM([A,I]),style:{display:"block"},children:t})})});function Or(i=t=>t,e){const t=Je.exports.useContext(cG);if(!t)throw"R3F hooks can only be used within the Canvas component!";return t(i,e)}function mR(i,e=0){const{subscribe:t}=Je.exports.useContext(cG).getState().internal,n=Je.exports.useRef(i);return Je.exports.useLayoutEffect(()=>void(n.current=i),[i]),Je.exports.useLayoutEffect(()=>{const s=t(n,e);return()=>s()},[e,t]),null}function zM(i){const e={nodes:{},materials:{}};return i&&i.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function fR(i,e){return function(t,...n){const s=new t;return i&&i(s),Promise.all(n.map(o=>new Promise((r,g)=>s.load(o,a=>{a.scene&&Object.assign(a,zM(a.scene)),r(a)},e,a=>g(`Could not load ${o}: ${a.message}`)))))}}function II(i,e,t,n){const s=Array.isArray(e)?e:[e],o=lr(fR(t,n),i,...s);return Array.isArray(e)?o:o[0]}II.preload=function(i,e,t){const n=Array.isArray(e)?e:[e];return lr.preload(fR(t),i,...n)};II.clear=function(i,e){const t=Array.isArray(e)?e:[e];return lr.clear(i,...t)};const lC=new Map,CZ=["legacy","blocking","concurrent"],{invalidate:kM,advance:uZ}=KM(lC),{reconciler:IC,applyProps:TM}=XM(),EM=(i,e)=>YM(i)?i:new Fb({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...i});function _M(i,e,{gl:t,size:n,mode:s=CZ[1],events:o,onCreated:r,...g}={}){var a;if(!n){var l,I,C,u;n={width:(l=(I=e.parentElement)==null?void 0:I.clientWidth)!=null?l:0,height:(C=(u=e.parentElement)==null?void 0:u.clientHeight)!=null?C:0}}let A=lC.get(e),h=A==null?void 0:A.fiber,m=A==null?void 0:A.store,b=(a=m)==null?void 0:a.getState();if(h&&b){const G=b.internal.lastProps;g.dpr!==void 0&&!kt.equ(G.dpr,g.dpr)&&b.setDpr(g.dpr),kt.equ(G.size,n)||b.setSize(n.width,n.height),g.linear!==G.linear&&(bR(e),h=void 0)}if(!h){const G=EM(t,e);g.vr&&(G.xr.enabled=!0,G.setAnimationLoop(y=>uZ(y,!0))),m=HM(TM,kM,uZ,{gl:G,size:n,...g});const f=m.getState();h=IC.createContainer(m,CZ.indexOf(s),!1,null),lC.set(e,{fiber:h,store:m}),o&&f.set({events:o(m)})}if(m&&h)return IC.updateContainer(Wt(JM,{store:m,element:i,onCreated:r,target:e}),h,null,()=>{}),m;throw"Error creating root!"}function JM({store:i,element:e,onCreated:t,target:n}){return Je.exports.useEffect(()=>{const s=i.getState();s.set(o=>({internal:{...o.internal,active:!0}})),s.events.connect==null||s.events.connect(n),t&&t(s)},[]),Je.exports.createElement(cG.Provider,{value:i},e)}function bR(i,e){const t=lC.get(i),n=t==null?void 0:t.fiber;if(n){const s=t==null?void 0:t.store.getState();s&&(s.internal.active=!1),IC.updateContainer(null,n,null,()=>{s&&setTimeout(()=>{var o,r,g;s.events.disconnect==null||s.events.disconnect(),(o=s.gl)==null||(r=o.renderLists)==null||r.dispose==null||r.dispose(),(g=s.gl)==null||g.forceContextLoss==null||g.forceContextLoss(),UM(s),lC.delete(i),e&&e(i)},500)})}}function UM(i){i.dispose&&i.type!=="Scene"&&i.dispose();for(const n in i){var e,t;(e=(t=n).dispose)==null||e.call(t),delete i[n]}}IC.act;IC.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:"17.0.2"});function Ot(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}class ig extends fn{constructor(){super(new hr(1,1,1),ig.material)}}Ot(ig,"SkyShader",{uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new N},up:{value:new N(0,1,0)}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","uniform vec3 up;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","	zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","	return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","	float c = ( 0.2 * T ) * 10E-18;","	return 0.434 * c * MieConst;","}","void main() {","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	vWorldPosition = worldPosition.xyz;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","	gl_Position.z = gl_Position.w;","	vSunDirection = normalize( sunPosition );","	vSunE = sunIntensity( dot( vSunDirection, up ) );","	vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","	float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","	vBetaR = totalRayleigh * rayleighCoefficient;","	vBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join(`
`),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float mieDirectionalG;","uniform vec3 up;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","	return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","	float g2 = pow( g, 2.0 );","	float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","	return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","void main() {","	vec3 direction = normalize( vWorldPosition - cameraPos );","	float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );","	float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","	float sR = rayleighZenithLength * inverse;","	float sM = mieZenithLength * inverse;","	vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","	float cosTheta = dot( direction, vSunDirection );","	float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","	vec3 betaRTheta = vBetaR * rPhase;","	float mPhase = hgPhase( cosTheta, mieDirectionalG );","	vec3 betaMTheta = vBetaM * mPhase;","	vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","	Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","	float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]","	float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]","	vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","	vec3 L0 = vec3( 0.1 ) * Fex;","	float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","	L0 += ( vSunE * 19000.0 * Fex ) * sundisk;","	vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","	vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","	gl_FragColor = vec4( retColor, 1.0 );","#include <tonemapping_fragment>","#include <encodings_fragment>","}"].join(`
`)});Ot(ig,"material",new Ds({name:"SkyShader",fragmentShader:ig.SkyShader.fragmentShader,vertexShader:ig.SkyShader.vertexShader,uniforms:eh.clone(ig.SkyShader.uniforms),side:Vi,depthWrite:!1}));class DM extends yo{constructor(e,t){super(),Ot(this,"camera",void 0),Ot(this,"domElement",void 0),Ot(this,"isLocked",!1),Ot(this,"minPolarAngle",0),Ot(this,"maxPolarAngle",Math.PI),Ot(this,"changeEvent",{type:"change"}),Ot(this,"lockEvent",{type:"lock"}),Ot(this,"unlockEvent",{type:"unlock"}),Ot(this,"euler",new Wg(0,0,0,"YXZ")),Ot(this,"PI_2",Math.PI/2),Ot(this,"vec",new N),Ot(this,"onMouseMove",n=>{if(!this.domElement||this.isLocked===!1)return;const s=n.movementX||n.mozMovementX||n.webkitMovementX||0,o=n.movementY||n.mozMovementY||n.webkitMovementY||0;this.euler.setFromQuaternion(this.camera.quaternion),this.euler.y-=s*.002,this.euler.x-=o*.002,this.euler.x=Math.max(this.PI_2-this.maxPolarAngle,Math.min(this.PI_2-this.minPolarAngle,this.euler.x)),this.camera.quaternion.setFromEuler(this.euler),this.dispatchEvent(this.changeEvent)}),Ot(this,"onPointerlockChange",()=>{!this.domElement||(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(this.lockEvent),this.isLocked=!0):(this.dispatchEvent(this.unlockEvent),this.isLocked=!1))}),Ot(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),Ot(this,"connect",n=>{this.domElement=n||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),Ot(this,"disconnect",()=>{!this.domElement||(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),Ot(this,"dispose",()=>{this.disconnect()}),Ot(this,"getObject",()=>this.camera),Ot(this,"direction",new N(0,0,-1)),Ot(this,"getDirection",n=>n.copy(this.direction).applyQuaternion(this.camera.quaternion)),Ot(this,"moveForward",n=>{this.vec.setFromMatrixColumn(this.camera.matrix,0),this.vec.crossVectors(this.camera.up,this.vec),this.camera.position.addScaledVector(this.vec,n)}),Ot(this,"moveRight",n=>{this.vec.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(this.vec,n)}),Ot(this,"lock",()=>{!this.domElement||this.domElement.requestPointerLock()}),Ot(this,"unlock",()=>{!this.domElement||this.domElement.ownerDocument.exitPointerLock()}),this.domElement=t,this.camera=e,this.domElement&&this.connect(this.domElement)}}class CG extends Yi{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new qM(t)}),this.register(function(t){return new o5(t)}),this.register(function(t){return new r5(t)}),this.register(function(t){return new e5(t)}),this.register(function(t){return new t5(t)}),this.register(function(t){return new n5(t)}),this.register(function(t){return new i5(t)}),this.register(function(t){return new jM(t)}),this.register(function(t){return new s5(t)}),this.register(function(t){return new $M(t)}),this.register(function(t){return new QM(t)}),this.register(function(t){return new g5(t)})}load(e,t,n,s){const o=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=fo.extractUrlBase(e),this.manager.itemStart(e);const g=function(l){s?s(l):console.error(l),o.manager.itemError(e),o.manager.itemEnd(e)},a=new is(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{o.parse(l,r,function(I){t(I),o.manager.itemEnd(e)},g)}catch(I){g(I)}},n,g)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,s){let o;const r={},g={};if(typeof e=="string")o=e;else if(fo.decodeText(new Uint8Array(e,0,4))===GR){try{r[Zt.KHR_BINARY_GLTF]=new a5(e)}catch(C){s&&s(C);return}o=r[Zt.KHR_BINARY_GLTF].content}else o=fo.decodeText(new Uint8Array(e));const a=JSON.parse(o);if(a.asset===void 0||a.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new G5(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let I=0;I<this.pluginCallbacks.length;I++){const C=this.pluginCallbacks[I](l);g[C.name]=C,r[C.name]=!0}if(a.extensionsUsed)for(let I=0;I<a.extensionsUsed.length;++I){const C=a.extensionsUsed[I],u=a.extensionsRequired||[];switch(C){case Zt.KHR_MATERIALS_UNLIT:r[C]=new OM;break;case Zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[C]=new c5;break;case Zt.KHR_DRACO_MESH_COMPRESSION:r[C]=new l5(a,this.dracoLoader);break;case Zt.KHR_TEXTURE_TRANSFORM:r[C]=new I5;break;case Zt.KHR_MESH_QUANTIZATION:r[C]=new C5;break;default:u.indexOf(C)>=0&&g[C]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+C+'".')}}l.setExtensions(r),l.setPlugins(g),l.parse(n,s)}parseAsync(e,t){const n=this;return new Promise(function(s,o){n.parse(e,t,s,o)})}}function PM(){let i={};return{get:function(e){return i[e]},add:function(e,t){i[e]=t},remove:function(e){delete i[e]},removeAll:function(){i={}}}}const Zt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class QM{constructor(e){this.parser=e,this.name=Zt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,s=t.length;n<s;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let s=t.cache.get(n);if(s)return s;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const I=new Ee(16777215);a.color!==void 0&&I.fromArray(a.color);const C=a.range!==void 0?a.range:0;switch(a.type){case"directional":l=new nG(I),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new tG(I),l.distance=C;break;case"spot":l=new eG(I),l.distance=C,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,l.angle=a.spot.outerConeAngle,l.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return l.position.set(0,0,0),l.decay=2,a.intensity!==void 0&&(l.intensity=a.intensity),l.name=t.createUniqueName(a.name||"light_"+e),s=Promise.resolve(l),t.cache.add(n,s),s}createNodeAttachment(e){const t=this,n=this.parser,o=n.json.nodes[e],g=(o.extensions&&o.extensions[this.name]||{}).light;return g===void 0?null:this._loadLight(g).then(function(a){return n._getNodeRef(t.cache,g,a)})}}class OM{constructor(){this.name=Zt.KHR_MATERIALS_UNLIT}getMaterialType(){return Ji}extendParams(e,t,n){const s=[];e.color=new Ee(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}o.baseColorTexture!==void 0&&s.push(n.assignTexture(e,"map",o.baseColorTexture,Yt))}return Promise.all(s)}}class jM{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class qM{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const g=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Se(g,g)}return Promise.all(o)}}class $M{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}}class e5{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new Ee(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Yt)),r.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class t5{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class n5{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const g=r.attenuationColor||[1,1,1];return t.attenuationColor=new Ee(g[0],g[1],g[2]),Promise.all(o)}}class i5{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class s5{constructor(e){this.parser=e,this.name=Zt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:mr}extendMaterialParams(e,t){const n=this.parser,s=n.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const g=r.specularColorFactor||[1,1,1];return t.specularColor=new Ee(g[0],g[1],g[2]),r.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,Yt)),Promise.all(o)}}class o5{constructor(e){this.parser=e,this.name=Zt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,s=n.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,r)}}class r5{constructor(e){this.parser=e,this.name=Zt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,s=n.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],g=s.images[r.source];let a=n.textureLoader;if(g.uri){const l=n.options.manager.getHandler(g.uri);l!==null&&(a=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(e,r.source,a);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class g5{constructor(e){this.name=Zt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const s=n.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(g){const a=s.byteOffset||0,l=s.byteLength||0,I=s.count,C=s.byteStride,u=new Uint8Array(g,a,l);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(I,C,u,s.mode,s.filter).then(function(A){return A.buffer}):r.ready.then(function(){const A=new ArrayBuffer(I*C);return r.decodeGltfBuffer(new Uint8Array(A),I,C,u,s.mode,s.filter),A})})}else return null}}const GR="glTF",oc=12,dZ={JSON:1313821514,BIN:5130562};class a5{constructor(e){this.name=Zt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,oc);if(this.header={magic:fo.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==GR)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-oc,s=new DataView(e,oc);let o=0;for(;o<n;){const r=s.getUint32(o,!0);o+=4;const g=s.getUint32(o,!0);if(o+=4,g===dZ.JSON){const a=new Uint8Array(e,oc+o,r);this.content=fo.decodeText(a)}else if(g===dZ.BIN){const a=oc+o;this.body=e.slice(a,a+r)}o+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class l5{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Zt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,g={},a={},l={};for(const I in r){const C=d0[I]||I.toLowerCase();g[C]=r[I]}for(const I in e.attributes){const C=d0[I]||I.toLowerCase();if(r[I]!==void 0){const u=n.accessors[e.attributes[I]],A=cC[u.componentType];l[C]=A.name,a[C]=u.normalized===!0}}return t.getDependency("bufferView",o).then(function(I){return new Promise(function(C){s.decodeDracoFile(I,function(u){for(const A in u.attributes){const h=u.attributes[A],m=a[A];m!==void 0&&(h.normalized=m)}C(u)},g,l)})})}}class I5{constructor(){this.name=Zt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class u0 extends aI{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),s=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),g={specular:{value:new Ee().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=g,this.onBeforeCompile=function(a){for(const l in g)a.uniforms[l]=g[l];a.fragmentShader=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",s).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return g.specular.value},set:function(a){g.specular.value=a}},specularMap:{get:function(){return g.specularMap.value},set:function(a){g.specularMap.value=a,a?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return g.glossiness.value},set:function(a){g.glossiness.value=a}},glossinessMap:{get:function(){return g.glossinessMap.value},set:function(a){g.glossinessMap.value=a,a?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class c5{constructor(){this.name=Zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return u0}extendParams(e,t,n){const s=t.extensions[this.name];e.color=new Ee(1,1,1),e.opacity=1;const o=[];if(Array.isArray(s.diffuseFactor)){const r=s.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(s.diffuseTexture!==void 0&&o.push(n.assignTexture(e,"map",s.diffuseTexture,Yt)),e.emissive=new Ee(0,0,0),e.glossiness=s.glossinessFactor!==void 0?s.glossinessFactor:1,e.specular=new Ee(1,1,1),Array.isArray(s.specularFactor)&&e.specular.fromArray(s.specularFactor),s.specularGlossinessTexture!==void 0){const r=s.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",r)),o.push(n.assignTexture(e,"specularMap",r,Yt))}return Promise.all(o)}createMaterial(e){const t=new u0(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=ur,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class C5{constructor(){this.name=Zt.KHR_MESH_QUANTIZATION}}class yR extends lI{constructor(e,t,n,s){super(e,t,n,s)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let r=0;r!==s;r++)t[r]=n[o+r];return t}interpolate_(e,t,n,s){const o=this.resultBuffer,r=this.sampleValues,g=this.valueSize,a=g*2,l=g*3,I=s-t,C=(n-t)/I,u=C*C,A=u*C,h=e*l,m=h-l,b=-2*A+3*u,G=A-u,f=1-b,y=G-u+C;for(let B=0;B!==g;B++){const v=r[m+B+g],W=r[m+B+a]*I,R=r[h+B+g],Z=r[h+B]*I;o[B]=f*v+y*W+b*R+G*Z}return o}}const u5=new Qn;class d5 extends yR{interpolate_(e,t,n,s){const o=super.interpolate_(e,t,n,s);return u5.fromArray(o).normalize().toArray(o),o}}const Eo={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},cC={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},AZ={9728:Sn,9729:en,9984:qc,9985:jA,9986:$c,9987:Cr},hZ={33071:mi,33648:_l,10497:gr},pZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d0={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},_r={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A5={CUBICSPLINE:void 0,LINEAR:va,STEP:Ul},Zm={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function h5(i){return i.DefaultMaterial===void 0&&(i.DefaultMaterial=new aI({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:rr})),i.DefaultMaterial}function rc(i,e,t){for(const n in t.extensions)i[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function jg(i,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(i.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function p5(i,e,t){let n=!1,s=!1,o=!1;for(let l=0,I=e.length;l<I;l++){const C=e[l];if(C.POSITION!==void 0&&(n=!0),C.NORMAL!==void 0&&(s=!0),C.COLOR_0!==void 0&&(o=!0),n&&s&&o)break}if(!n&&!s&&!o)return Promise.resolve(i);const r=[],g=[],a=[];for(let l=0,I=e.length;l<I;l++){const C=e[l];if(n){const u=C.POSITION!==void 0?t.getDependency("accessor",C.POSITION):i.attributes.position;r.push(u)}if(s){const u=C.NORMAL!==void 0?t.getDependency("accessor",C.NORMAL):i.attributes.normal;g.push(u)}if(o){const u=C.COLOR_0!==void 0?t.getDependency("accessor",C.COLOR_0):i.attributes.color;a.push(u)}}return Promise.all([Promise.all(r),Promise.all(g),Promise.all(a)]).then(function(l){const I=l[0],C=l[1],u=l[2];return n&&(i.morphAttributes.position=I),s&&(i.morphAttributes.normal=C),o&&(i.morphAttributes.color=u),i.morphTargetsRelative=!0,i})}function m5(i,e){if(i.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)i.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(i.morphTargetInfluences.length===t.length){i.morphTargetDictionary={};for(let n=0,s=t.length;n<s;n++)i.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function f5(i){const e=i.extensions&&i.extensions[Zt.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+mZ(e.attributes):t=i.indices+":"+mZ(i.attributes)+":"+i.mode,t}function mZ(i){let e="";const t=Object.keys(i).sort();for(let n=0,s=t.length;n<s;n++)e+=t[n]+":"+i[t[n]]+";";return e}function A0(i){switch(i){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function b5(i){return i.search(/\.jpe?g($|\?)/i)>0||i.search(/^data\:image\/jpeg/)===0?"image/jpeg":i.search(/\.webp($|\?)/i)>0||i.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class G5{constructor(e={},t={}){var n,s;this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new PM,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const o=typeof navigator<"u"&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=typeof navigator<"u"&&((n=navigator.userAgent)===null||n===void 0?void 0:n.indexOf("Firefox"))>-1,g=typeof navigator<"u"&&r?(s=navigator.userAgent)===null||s===void 0?void 0:s.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||o||r&&g<98?this.textureLoader=new qb(this.options.manager):this.textureLoader=new rR(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new is(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,s=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(r){const g={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:n,userData:{}};rc(o,g,s),jg(g,s),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(g)})).then(function(){e(g)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let s=0,o=t.length;s<o;s++){const r=t[s].joints;for(let g=0,a=r.length;g<a;g++)e[r[g]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(n[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const s=n.clone(),o=(r,g)=>{const a=this.associations.get(r);a!=null&&this.associations.set(g,a);for(const[l,I]of r.children.entries())o(I,g.children[l])};return o(n,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const s=e(t[n]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let s=0;s<t.length;s++){const o=e(t[s]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let s=this.cache.get(n);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this.loadNode(t);break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(o,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Zt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,r){n.load(fo.resolveURL(t.uri,s.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const s=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+s)})}loadAccessor(e){const t=this,n=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0)return Promise.resolve(null);const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(r){const g=r[0],a=pZ[s.type],l=cC[s.componentType],I=l.BYTES_PER_ELEMENT,C=I*a,u=s.byteOffset||0,A=s.bufferView!==void 0?n.bufferViews[s.bufferView].byteStride:void 0,h=s.normalized===!0;let m,b;if(A&&A!==C){const G=Math.floor(u/A),f="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+G+":"+s.count;let y=t.cache.get(f);y||(m=new l(g,G*A,s.count*A/I),y=new GC(m,A/I),t.cache.add(f,y)),b=new Gg(y,a,u%A/I,h)}else g===null?m=new l(s.count*a):m=new l(g,u,s.count*a),b=new Ft(m,a,h);if(s.sparse!==void 0){const G=pZ.SCALAR,f=cC[s.sparse.indices.componentType],y=s.sparse.indices.byteOffset||0,B=s.sparse.values.byteOffset||0,v=new f(r[1],y,s.sparse.count*G),W=new l(r[2],B,s.sparse.count*a);g!==null&&(b=new Ft(b.array.slice(),b.itemSize,b.normalized));for(let R=0,Z=v.length;R<Z;R++){const V=v[R];if(b.setX(V,W[R*a]),a>=2&&b.setY(V,W[R*a+1]),a>=3&&b.setZ(V,W[R*a+2]),a>=4&&b.setW(V,W[R*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return b})}loadTexture(e){const t=this.json,n=this.options,o=t.textures[e].source,r=t.images[o];let g=this.textureLoader;if(r.uri){const a=n.manager.getHandler(r.uri);a!==null&&(g=a)}return this.loadTextureImage(e,o,g)}loadTextureImage(e,t,n){const s=this,o=this.json,r=o.textures[e],g=o.images[t],a=(g.uri||g.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const l=this.loadImageSource(t,n).then(function(I){I.flipY=!1,r.name&&(I.name=r.name);const u=(o.samplers||{})[r.sampler]||{};return I.magFilter=AZ[u.magFilter]||en,I.minFilter=AZ[u.minFilter]||Cr,I.wrapS=hZ[u.wrapS]||gr,I.wrapT=hZ[u.wrapT]||gr,s.associations.set(I,{textures:e}),I}).catch(function(){return null});return this.textureCache[a]=l,l}loadImageSource(e,t){const n=this,s=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(C=>C.clone());const r=s.images[e],g=self.URL||self.webkitURL;let a=r.uri||"",l=!1;if(r.bufferView!==void 0)a=n.getDependency("bufferView",r.bufferView).then(function(C){l=!0;const u=new Blob([C],{type:r.mimeType});return a=g.createObjectURL(u),a});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const I=Promise.resolve(a).then(function(C){return new Promise(function(u,A){let h=u;t.isImageBitmapLoader===!0&&(h=function(m){const b=new Cn(m);b.needsUpdate=!0,u(b)}),t.load(fo.resolveURL(C,o.path),h,void 0,A)})}).then(function(C){return l===!0&&g.revokeObjectURL(a),C.userData.mimeType=r.mimeType||b5(r.uri),C}).catch(function(C){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),C});return this.sourceCache[e]=I,I}assignTexture(e,t,n,s){const o=this;return this.getDependency("texture",n.index).then(function(r){if(n.texCoord!==void 0&&n.texCoord!=0&&!(t==="aoMap"&&n.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[Zt.KHR_TEXTURE_TRANSFORM]){const g=n.extensions!==void 0?n.extensions[Zt.KHR_TEXTURE_TRANSFORM]:void 0;if(g){const a=o.associations.get(r);r=o.extensions[Zt.KHR_TEXTURE_TRANSFORM].extendTexture(r,g),o.associations.set(r,a)}}return s!==void 0&&(r.encoding=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const s=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const g="PointsMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new ah,Tn.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(g,a)),n=a}else if(e.isLine){const g="LineBasicMaterial:"+n.uuid;let a=this.cache.get(g);a||(a=new bi,Tn.prototype.copy.call(a,n),a.color.copy(n.color),this.cache.add(g,a)),n=a}if(s||o||r){let g="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(g+="specular-glossiness:"),s&&(g+="derivative-tangents:"),o&&(g+="vertex-colors:"),r&&(g+="flat-shading:");let a=this.cache.get(g);a||(a=n.clone(),o&&(a.vertexColors=!0),r&&(a.flatShading=!0),s&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(g,a),this.associations.set(a,this.associations.get(n))),n=a}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return aI}loadMaterial(e){const t=this,n=this.json,s=this.extensions,o=n.materials[e];let r;const g={},a=o.extensions||{},l=[];if(a[Zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const C=s[Zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=C.getMaterialType(),l.push(C.extendParams(g,o,t))}else if(a[Zt.KHR_MATERIALS_UNLIT]){const C=s[Zt.KHR_MATERIALS_UNLIT];r=C.getMaterialType(),l.push(C.extendParams(g,o,t))}else{const C=o.pbrMetallicRoughness||{};if(g.color=new Ee(1,1,1),g.opacity=1,Array.isArray(C.baseColorFactor)){const u=C.baseColorFactor;g.color.fromArray(u),g.opacity=u[3]}C.baseColorTexture!==void 0&&l.push(t.assignTexture(g,"map",C.baseColorTexture,Yt)),g.metalness=C.metallicFactor!==void 0?C.metallicFactor:1,g.roughness=C.roughnessFactor!==void 0?C.roughnessFactor:1,C.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(g,"metalnessMap",C.metallicRoughnessTexture)),l.push(t.assignTexture(g,"roughnessMap",C.metallicRoughnessTexture))),r=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,g)})))}o.doubleSided===!0&&(g.side=ms);const I=o.alphaMode||Zm.OPAQUE;if(I===Zm.BLEND?(g.transparent=!0,g.depthWrite=!1):(g.transparent=!1,I===Zm.MASK&&(g.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==Ji&&(l.push(t.assignTexture(g,"normalMap",o.normalTexture)),g.normalScale=new Se(1,1),o.normalTexture.scale!==void 0)){const C=o.normalTexture.scale;g.normalScale.set(C,C)}return o.occlusionTexture!==void 0&&r!==Ji&&(l.push(t.assignTexture(g,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(g.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==Ji&&(g.emissive=new Ee().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&r!==Ji&&l.push(t.assignTexture(g,"emissiveMap",o.emissiveTexture,Yt)),Promise.all(l).then(function(){let C;return r===u0?C=s[Zt.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(g):C=new r(g),o.name&&(C.name=o.name),jg(C,o),t.associations.set(C,{materials:e}),o.extensions&&rc(s,C,o),C})}createUniqueName(e){const t=Vt.sanitizeNodeName(e||"");let n=t;for(let s=1;this.nodeNamesUsed[n];++s)n=t+"_"+s;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,s=this.primitiveCache;function o(g){return n[Zt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(g,t).then(function(a){return fZ(a,g,t)})}const r=[];for(let g=0,a=e.length;g<a;g++){const l=e[g],I=f5(l),C=s[I];if(C)r.push(C.promise);else{let u;l.extensions&&l.extensions[Zt.KHR_DRACO_MESH_COMPRESSION]?u=o(l):u=fZ(new bt,l,t),s[I]={primitive:l,promise:u},r.push(u)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,s=this.extensions,o=n.meshes[e],r=o.primitives,g=[];for(let a=0,l=r.length;a<l;a++){const I=r[a].material===void 0?h5(this.cache):this.getDependency("material",r[a].material);g.push(I)}return g.push(t.loadGeometries(r)),Promise.all(g).then(function(a){const l=a.slice(0,a.length-1),I=a[a.length-1],C=[];for(let A=0,h=I.length;A<h;A++){const m=I[A],b=r[A];let G;const f=l[A];if(b.mode===Eo.TRIANGLES||b.mode===Eo.TRIANGLE_STRIP||b.mode===Eo.TRIANGLE_FAN||b.mode===void 0)G=o.isSkinnedMesh===!0?new Mb(m,f):new fn(m,f),G.isSkinnedMesh===!0&&!G.geometry.attributes.skinWeight.normalized&&G.normalizeSkinWeights(),b.mode===Eo.TRIANGLE_STRIP?G.geometry=bZ(G.geometry,lS):b.mode===Eo.TRIANGLE_FAN&&(G.geometry=bZ(G.geometry,Wb));else if(b.mode===Eo.LINES)G=new Ps(m,f);else if(b.mode===Eo.LINE_STRIP)G=new ar(m,f);else if(b.mode===Eo.LINE_LOOP)G=new Lb(m,f);else if(b.mode===Eo.POINTS)G=new zb(m,f);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+b.mode);Object.keys(G.geometry.morphAttributes).length>0&&m5(G,o),G.name=t.createUniqueName(o.name||"mesh_"+e),jg(G,o),b.extensions&&rc(s,G,b),t.assignFinalMaterial(G),C.push(G)}for(let A=0,h=C.length;A<h;A++)t.associations.set(C[A],{meshes:e,primitives:A});if(C.length===1)return C[0];const u=new jo;t.associations.set(u,{meshes:e});for(let A=0,h=C.length;A<h;A++)u.add(C[A]);return u})}loadCamera(e){let t;const n=this.json.cameras[e],s=n[n.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new zn(Vb.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):n.type==="orthographic"&&(t=new iI(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),jg(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(s){return n.inverseBindMatrices=s,n})}loadAnimation(e){const n=this.json.animations[e],s=[],o=[],r=[],g=[],a=[];for(let l=0,I=n.channels.length;l<I;l++){const C=n.channels[l],u=n.samplers[C.sampler],A=C.target,h=A.node,m=n.parameters!==void 0?n.parameters[u.input]:u.input,b=n.parameters!==void 0?n.parameters[u.output]:u.output;s.push(this.getDependency("node",h)),o.push(this.getDependency("accessor",m)),r.push(this.getDependency("accessor",b)),g.push(u),a.push(A)}return Promise.all([Promise.all(s),Promise.all(o),Promise.all(r),Promise.all(g),Promise.all(a)]).then(function(l){const I=l[0],C=l[1],u=l[2],A=l[3],h=l[4],m=[];for(let G=0,f=I.length;G<f;G++){const y=I[G],B=C[G],v=u[G],W=A[G],R=h[G];if(y===void 0)continue;y.updateMatrix();let Z;switch(_r[R.path]){case _r.weights:Z=Ql;break;case _r.rotation:Z=Bg;break;case _r.position:case _r.scale:default:Z=Ol;break}const V=y.name?y.name:y.uuid,H=W.interpolation!==void 0?A5[W.interpolation]:va,P=[];_r[R.path]===_r.weights?y.traverse(function(L){L.morphTargetInfluences&&P.push(L.name?L.name:L.uuid)}):P.push(V);let E=v.array;if(v.normalized){const L=A0(E.constructor),K=new Float32Array(E.length);for(let O=0,q=E.length;O<q;O++)K[O]=E[O]*L;E=K}for(let L=0,K=P.length;L<K;L++){const O=new Z(P[L]+"."+_r[R.path],B.array,E,H);W.interpolation==="CUBICSPLINE"&&(O.createInterpolant=function(ne){const k=this instanceof Bg?d5:yR;return new k(this.times,this.values,this.getValueSize()/3,ne)},O.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(O)}}const b=n.name?n.name:"animation_"+e;return new jl(b,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,s=t.nodes[e];return s.mesh===void 0?null:n.getDependency("mesh",s.mesh).then(function(o){const r=n._getNodeRef(n.meshCache,s.mesh,o);return s.weights!==void 0&&r.traverse(function(g){if(!!g.isMesh)for(let a=0,l=s.weights.length;a<l;a++)g.morphTargetInfluences[a]=s.weights[a]}),r})}loadNode(e){const t=this.json,n=this.extensions,s=this,o=t.nodes[e],r=o.name?s.createUniqueName(o.name):"";return function(){const g=[],a=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return a&&g.push(a),o.camera!==void 0&&g.push(s.getDependency("camera",o.camera).then(function(l){return s._getNodeRef(s.cameraCache,o.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){g.push(l)}),Promise.all(g)}().then(function(g){let a;if(o.isBone===!0?a=new gh:g.length>1?a=new jo:g.length===1?a=g[0]:a=new St,a!==g[0])for(let l=0,I=g.length;l<I;l++)a.add(g[l]);if(o.name&&(a.userData.name=o.name,a.name=r),jg(a,o),o.extensions&&rc(n,a,o),o.matrix!==void 0){const l=new dt;l.fromArray(o.matrix),a.applyMatrix4(l)}else o.translation!==void 0&&a.position.fromArray(o.translation),o.rotation!==void 0&&a.quaternion.fromArray(o.rotation),o.scale!==void 0&&a.scale.fromArray(o.scale);return s.associations.has(a)||s.associations.set(a,{}),s.associations.get(a).nodes=e,a})}loadScene(e){const t=this.json,n=this.extensions,s=this.json.scenes[e],o=this,r=new jo;s.name&&(r.name=o.createUniqueName(s.name)),jg(r,s),s.extensions&&rc(n,r,s);const g=s.nodes||[],a=[];for(let l=0,I=g.length;l<I;l++)a.push(BR(g[l],r,t,o));return Promise.all(a).then(function(){const l=I=>{const C=new Map;for(const[u,A]of o.associations)(u instanceof Tn||u instanceof Cn)&&C.set(u,A);return I.traverse(u=>{const A=o.associations.get(u);A!=null&&C.set(u,A)}),C};return o.associations=l(r),r})}}function BR(i,e,t,n){const s=t.nodes[i];return n.getDependency("node",i).then(function(o){if(s.skin===void 0)return o;let r;return n.getDependency("skin",s.skin).then(function(g){r=g;const a=[];for(let l=0,I=r.joints.length;l<I;l++)a.push(n.getDependency("node",r.joints[l]));return Promise.all(a)}).then(function(g){return o.traverse(function(a){if(!a.isMesh)return;const l=[],I=[];for(let C=0,u=g.length;C<u;C++){const A=g[C];if(A){l.push(A);const h=new dt;r.inverseBindMatrices!==void 0&&h.fromArray(r.inverseBindMatrices.array,C*16),I.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[C])}a.bind(new yC(l,I),a.matrixWorld)}),o})}).then(function(o){e.add(o);const r=[];if(s.children){const g=s.children;for(let a=0,l=g.length;a<l;a++){const I=g[a];r.push(BR(I,o,t,n))}}return Promise.all(r)})}function y5(i,e,t){const n=e.attributes,s=new dr;if(n.POSITION!==void 0){const g=t.json.accessors[n.POSITION],a=g.min,l=g.max;if(a!==void 0&&l!==void 0){if(s.set(new N(a[0],a[1],a[2]),new N(l[0],l[1],l[2])),g.normalized){const I=A0(cC[g.componentType]);s.min.multiplyScalar(I),s.max.multiplyScalar(I)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const g=new N,a=new N;for(let l=0,I=o.length;l<I;l++){const C=o[l];if(C.POSITION!==void 0){const u=t.json.accessors[C.POSITION],A=u.min,h=u.max;if(A!==void 0&&h!==void 0){if(a.setX(Math.max(Math.abs(A[0]),Math.abs(h[0]))),a.setY(Math.max(Math.abs(A[1]),Math.abs(h[1]))),a.setZ(Math.max(Math.abs(A[2]),Math.abs(h[2]))),u.normalized){const m=A0(cC[u.componentType]);a.multiplyScalar(m)}g.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(g)}i.boundingBox=s;const r=new Ar;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,i.boundingSphere=r}function fZ(i,e,t){const n=e.attributes,s=[];function o(r,g){return t.getDependency("accessor",r).then(function(a){i.setAttribute(g,a)})}for(const r in n){const g=d0[r]||r.toLowerCase();g in i.attributes||s.push(o(n[r],g))}if(e.indices!==void 0&&!i.index){const r=t.getDependency("accessor",e.indices).then(function(g){i.setIndex(g)});s.push(r)}return jg(i,e),y5(i,e,t),Promise.all(s).then(function(){return e.targets!==void 0?p5(i,e.targets,t):i})}function bZ(i,e){let t=i.getIndex();if(t===null){const r=[],g=i.getAttribute("position");if(g!==void 0){for(let a=0;a<g.count;a++)r.push(a);i.setIndex(r),t=i.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),i}const n=t.count-2,s=[];if(e===Wb)for(let r=1;r<=n;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<n;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=i.clone();return o.setIndex(s),o}const wm=new WeakMap;class B5 extends Yi{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,s){const o=new is(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,r=>{const g={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,g).then(t).catch(s)},n,s)}decodeDracoFile(e,t,n,s){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){for(const a in t.attributeTypes){const l=t.attributeTypes[a];l.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[a]=l.name)}const n=JSON.stringify(t);if(wm.has(e)){const a=wm.get(e);if(a.key===n)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,r=e.byteLength,g=this._getWorker(o,r).then(a=>(s=a,new Promise((l,I)=>{s._callbacks[o]={resolve:l,reject:I},s.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return g.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),wm.set(e,{key:n,promise:g}),g}_createGeometry(e){const t=new bt;e.index&&t.setIndex(new Ft(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const s=e.attributes[n],o=s.name,r=s.array,g=s.itemSize;t.setAttribute(o,new Ft(r,g))}return t}_loadLibrary(e,t){const n=new is(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((s,o)=>{n.load(e,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const s=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const o=v5.toString(),r=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const r=o.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function v5(){let i,e;onmessage=function(r){const g=r.data;switch(g.type){case"init":i=g.decoderConfig,e=new Promise(function(I){i.onModuleLoaded=function(C){I({draco:C})},DracoDecoderModule(i)});break;case"decode":const a=g.buffer,l=g.taskConfig;e.then(I=>{const C=I.draco,u=new C.Decoder,A=new C.DecoderBuffer;A.Init(new Int8Array(a),a.byteLength);try{const h=t(C,u,A,l),m=h.attributes.map(b=>b.array.buffer);h.index&&m.push(h.index.array.buffer),self.postMessage({type:"decode",id:g.id,geometry:h},m)}catch(h){console.error(h),self.postMessage({type:"error",id:g.id,error:h.message})}finally{C.destroy(A),C.destroy(u)}});break}};function t(r,g,a,l){const I=l.attributeIDs,C=l.attributeTypes;let u,A;const h=g.GetEncodedGeometryType(a);if(h===r.TRIANGULAR_MESH)u=new r.Mesh,A=g.DecodeBufferToMesh(a,u);else if(h===r.POINT_CLOUD)u=new r.PointCloud,A=g.DecodeBufferToPointCloud(a,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());const m={index:null,attributes:[]};for(const b in I){const G=self[C[b]];let f,y;if(l.useUniqueIDs)y=I[b],f=g.GetAttributeByUniqueId(u,y);else{if(y=g.GetAttributeId(u,r[I[b]]),y===-1)continue;f=g.GetAttribute(u,y)}m.attributes.push(s(r,g,u,b,G,f))}return h===r.TRIANGULAR_MESH&&(m.index=n(r,g,u)),r.destroy(u),m}function n(r,g,a){const I=a.num_faces()*3,C=I*4,u=r._malloc(C);g.GetTrianglesUInt32Array(a,C,u);const A=new Uint32Array(r.HEAPF32.buffer,u,I).slice();return r._free(u),{array:A,itemSize:1}}function s(r,g,a,l,I,C){const u=C.num_components(),h=a.num_points()*u,m=h*I.BYTES_PER_ELEMENT,b=o(r,I),G=r._malloc(m);g.GetAttributeDataArrayForAllPoints(a,C,b,m,G);const f=new I(r.HEAPF32.buffer,G,h).slice();return r._free(G),{name:l,array:f,itemSize:u}}function o(r,g){switch(g){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}let Bd;const Wm=()=>{if(Bd)return Bd;const i="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=i;WebAssembly.validate(t)&&(s=e);let o;const r=WebAssembly.instantiate(g(s),{}).then(C=>{o=C.instance,o.exports.__wasm_call_ctors()});function g(C){const u=new Uint8Array(C.length);for(let h=0;h<C.length;++h){const m=C.charCodeAt(h);u[h]=m>96?m-71:m>64?m-65:m>47?m+4:m>46?63:62}let A=0;for(let h=0;h<C.length;++h)u[A++]=u[h]<60?n[u[h]]:(u[h]-60)*64+u[++h];return u.buffer.slice(0,A)}function a(C,u,A,h,m,b){const G=o.exports.sbrk,f=A+3&-4,y=G(f*h),B=G(m.length),v=new Uint8Array(o.exports.memory.buffer);v.set(m,B);const W=C(y,A,h,B,m.length);if(W===0&&b&&b(y,f,h),u.set(v.subarray(y,y+A*h)),G(y-G(0)),W!==0)throw new Error(`Malformed buffer data: ${W}`)}const l={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},I={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Bd={ready:r,supported:!0,decodeVertexBuffer(C,u,A,h,m){a(o.exports.meshopt_decodeVertexBuffer,C,u,A,h,o.exports[l[m]])},decodeIndexBuffer(C,u,A,h){a(o.exports.meshopt_decodeIndexBuffer,C,u,A,h)},decodeIndexSequence(C,u,A,h){a(o.exports.meshopt_decodeIndexSequence,C,u,A,h)},decodeGltfBuffer(C,u,A,h,m,b){a(o.exports[I[m]],C,u,A,h,o.exports[l[b]])}},Bd};function uG(){var i=0,e=[],t,n=0,s=0;function o(G,f){var y=uG();function B(){var v=i>0?G:f;if(m(v))try{var W=v(t);W===y&&h();var R=u(W);R?R.call(W,y.resolve,y.reject):y.resolve(W)}catch(Z){y.reject(Z)}else y[i>0?"resolve":"reject"](t)}return e.push(B),i&&l(),y}var r=A(function(G){s||a(1,G)}),g=A(function(G){s||a(-1,G)});function a(G,f){s++;var y=0;try{f===b&&h();var B=G>0&&u(f);B?B.call(f,A(function(v){y++,a(1,v)}),A(function(v){y++,a(-1,v)})):(i=G,t=f,l())}catch(v){!i&&!y&&a(-1,v)}}function l(){n||(setTimeout(I,0),n=1)}function I(){var G=e;n=0,e=[],G.forEach(C)}function C(G){G()}function u(G){var f=G&&(m(G)||typeof G=="object")&&G.then;return m(f)&&f}function A(G){var f=0;return function(){for(var y=[],B=arguments.length;B--;)y[B]=arguments[B];f++||G.apply(this,y)}}function h(){throw new TypeError("Chaining cycle detected")}var m=function(G){return typeof G=="function"},b={then:o,resolve:r,reject:g};return b}function vR(){var i,e,t=new Promise(function(n,s){i=n,e=s});return{then:t.then.bind(t),resolve:i,reject:e}}uG.all=vR.all=function(i){var e=0,t=[],n=Ir();return i.length===0?n.resolve([]):i.forEach(function(s,o){var r=Ir();r.resolve(s),r.then(function(g){e++,t[o]=g,e===i.length&&n.resolve(t)},n.reject)}),n};var Ir=typeof Promise=="function"?vR:uG;function Z5(){var i=Object.create(null);function e(s,o){var r=s.id,g=s.name,a=s.dependencies;a===void 0&&(a=[]);var l=s.init;l===void 0&&(l=function(){});var I=s.getTransferables;if(I===void 0&&(I=null),!i[r])try{a=a.map(function(u){return u&&u.isWorkerModule&&(e(u,function(A){if(A instanceof Error)throw A}),u=i[u.id].value),u}),l=n("<"+g+">.init",l),I&&(I=n("<"+g+">.getTransferables",I));var C=null;typeof l=="function"?C=l.apply(void 0,a):console.error("worker module init function failed to rehydrate"),i[r]={id:r,value:C,getTransferables:I},o(C)}catch(u){u&&u.noLog||console.error(u),o(u)}}function t(s,o){var r,g=s.id,a=s.args;(!i[g]||typeof i[g].value!="function")&&o(new Error("Worker module "+g+": not found or its 'init' did not return a function"));try{var l=(r=i[g]).value.apply(r,a);l&&typeof l.then=="function"?l.then(I,function(C){return o(C instanceof Error?C:new Error(""+C))}):I(l)}catch(C){o(C)}function I(C){try{var u=i[g].getTransferables&&i[g].getTransferables(C);(!u||!Array.isArray(u)||!u.length)&&(u=void 0),o(C,u)}catch(A){console.error(A),o(A)}}}function n(s,o){var r=void 0;self.troikaDefine=function(a){return r=a};var g=URL.createObjectURL(new Blob(["/** "+s.replace(/\*/g,"")+` **/

troikaDefine(
`+o+`
)`],{type:"application/javascript"}));try{importScripts(g)}catch(a){console.error(a)}return URL.revokeObjectURL(g),delete self.troikaDefine,r}self.addEventListener("message",function(s){var o=s.data,r=o.messageId,g=o.action,a=o.data;try{g==="registerModule"&&e(a,function(l){l instanceof Error?postMessage({messageId:r,success:!1,error:l.message}):postMessage({messageId:r,success:!0,result:{isCallable:typeof l=="function"}})}),g==="callModule"&&t(a,function(l,I){l instanceof Error?postMessage({messageId:r,success:!1,error:l.message}):postMessage({messageId:r,success:!0,result:l},I||void 0)})}catch(l){postMessage({messageId:r,success:!1,error:l.stack})}})}function w5(i){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(s){if(typeof s=="function")return s.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=i.dependencies,n=i.init;t=Array.isArray(t)?t.map(function(o){return o&&o._getInitResult?o._getInitResult():o}):[];var s=Ir.all(t).then(function(o){return n.apply(null,o)});return e._getInitResult=function(){return s},s},e}var ZR=function(){var i=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),i=!0}catch(t){typeof process<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return ZR=function(){return i},i},W5=0,S5=0,Sm=!1,xc=Object.create(null),Xc=Object.create(null),h0=Object.create(null);function cI(i){if((!i||typeof i.init!="function")&&!Sm)throw new Error("requires `options.init` function");var e=i.dependencies,t=i.init,n=i.getTransferables,s=i.workerId;if(!ZR())return w5(i);s==null&&(s="#default");var o="workerModule"+ ++W5,r=i.name||o,g=null;e=e&&e.map(function(l){return typeof l=="function"&&!l.workerModuleData&&(Sm=!0,l=cI({workerId:s,name:"<"+r+"> function dependency: "+l.name,init:`function(){return (
`+eA(l)+`
)}`}),Sm=!1),l&&l.workerModuleData&&(l=l.workerModuleData),l});function a(){for(var l=[],I=arguments.length;I--;)l[I]=arguments[I];if(!g){g=GZ(s,"registerModule",a.workerModuleData);var C=function(){g=null,Xc[s].delete(C)};(Xc[s]||(Xc[s]=new Set)).add(C)}return g.then(function(u){var A=u.isCallable;if(A)return GZ(s,"callModule",{id:o,args:l});throw new Error("Worker module function was called but `init` did not return a callable function")})}return a.workerModuleData={isWorkerModule:!0,id:o,name:r,dependencies:e,init:eA(t),getTransferables:n&&eA(n)},a}function R5(i){Xc[i]&&Xc[i].forEach(function(e){e()}),xc[i]&&(xc[i].terminate(),delete xc[i])}function eA(i){var e=i.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function V5(i){var e=xc[i];if(!e){var t=eA(Z5);e=xc[i]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+i.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var s=n.data,o=s.messageId,r=h0[o];if(!r)throw new Error("WorkerModule response with empty or unknown messageId");delete h0[o],r(s)}}return e}function GZ(i,e,t){var n=Ir(),s=++S5;return h0[s]=function(o){o.success?n.resolve(o.result):n.reject(new Error("Error in worker "+e+" call: "+o.error))},V5(i).postMessage({messageId:s,action:e,data:t}),n}var x5=cI({name:"Thenable",dependencies:[Ir],init:function(i){return i}});function wR(){var i=function(e){function t(F,z,X,T,Q,ee,oe,j){var ge=1-oe;j.x=ge*ge*F+2*ge*oe*X+oe*oe*Q,j.y=ge*ge*z+2*ge*oe*T+oe*oe*ee}function n(F,z,X,T,Q,ee,oe,j,ge,Ie){var Be=1-ge;Ie.x=Be*Be*Be*F+3*Be*Be*ge*X+3*Be*ge*ge*Q+ge*ge*ge*oe,Ie.y=Be*Be*Be*z+3*Be*Be*ge*T+3*Be*ge*ge*ee+ge*ge*ge*j}function s(F,z){for(var X=/([MLQCZ])([^MLQCZ]*)/g,T,Q,ee,oe,j;T=X.exec(F);){var ge=T[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(Ie){return parseFloat(Ie)});switch(T[1]){case"M":oe=Q=ge[0],j=ee=ge[1];break;case"L":(ge[0]!==oe||ge[1]!==j)&&z("L",oe,j,oe=ge[0],j=ge[1]);break;case"Q":{z("Q",oe,j,oe=ge[2],j=ge[3],ge[0],ge[1]);break}case"C":{z("C",oe,j,oe=ge[4],j=ge[5],ge[0],ge[1],ge[2],ge[3]);break}case"Z":(oe!==Q||j!==ee)&&z("L",oe,j,Q,ee);break}}}function o(F,z,X){X===void 0&&(X=16);var T={x:0,y:0};s(F,function(Q,ee,oe,j,ge,Ie,Be,ve,Ye){switch(Q){case"L":z(ee,oe,j,ge);break;case"Q":{for(var se=ee,ue=oe,Ge=1;Ge<X;Ge++)t(ee,oe,Ie,Be,j,ge,Ge/(X-1),T),z(se,ue,T.x,T.y),se=T.x,ue=T.y;break}case"C":{for(var xe=ee,fe=oe,Qe=1;Qe<X;Qe++)n(ee,oe,Ie,Be,ve,Ye,j,ge,Qe/(X-1),T),z(xe,fe,T.x,T.y),xe=T.x,fe=T.y;break}}})}var r="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",g="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",a=new WeakMap,l={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function I(F,z){var X=F.getContext?F.getContext("webgl",l):F,T=a.get(X);if(!T){let xe=function(me){var M=ee[me];if(!M&&(M=ee[me]=X.getExtension(me),!M))throw new Error(me+" not supported");return M},fe=function(me,M){var Y=X.createShader(M);return X.shaderSource(Y,me),X.compileShader(Y),Y},Qe=function(me,M,Y,te){if(!oe[me]){var ce={},we={},Re=X.createProgram();X.attachShader(Re,fe(M,X.VERTEX_SHADER)),X.attachShader(Re,fe(Y,X.FRAGMENT_SHADER)),X.linkProgram(Re),oe[me]={program:Re,transaction:function(We){X.useProgram(Re),We({setUniform:function(ze,Pe){for(var Te=[],Fe=arguments.length-2;Fe-- >0;)Te[Fe]=arguments[Fe+2];var Ke=we[Pe]||(we[Pe]=X.getUniformLocation(Re,Pe));X["uniform"+ze].apply(X,[Ke].concat(Te))},setAttribute:function(ze,Pe,Te,Fe,Ke){var $e=ce[ze];$e||($e=ce[ze]={buf:X.createBuffer(),loc:X.getAttribLocation(Re,ze),data:null}),X.bindBuffer(X.ARRAY_BUFFER,$e.buf),X.vertexAttribPointer($e.loc,Pe,X.FLOAT,!1,0,0),X.enableVertexAttribArray($e.loc),Q?X.vertexAttribDivisor($e.loc,Fe):xe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE($e.loc,Fe),Ke!==$e.data&&(X.bufferData(X.ARRAY_BUFFER,Ke,Te),$e.data=Ke)}})}}}oe[me].transaction(te)},de=function(me,M){ge++;try{X.activeTexture(X.TEXTURE0+ge);var Y=j[me];Y||(Y=j[me]=X.createTexture(),X.bindTexture(X.TEXTURE_2D,Y),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MIN_FILTER,X.NEAREST),X.texParameteri(X.TEXTURE_2D,X.TEXTURE_MAG_FILTER,X.NEAREST)),X.bindTexture(X.TEXTURE_2D,Y),M(Y,ge)}finally{ge--}},Xe=function(me,M,Y){var te=X.createFramebuffer();Ie.push(te),X.bindFramebuffer(X.FRAMEBUFFER,te),X.activeTexture(X.TEXTURE0+M),X.bindTexture(X.TEXTURE_2D,me),X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_2D,me,0);try{Y(te)}finally{X.deleteFramebuffer(te),X.bindFramebuffer(X.FRAMEBUFFER,Ie[--Ie.length-1]||null)}},Le=function(){ee={},oe={},j={},ge=-1,Ie.length=0};var Be=xe,ve=fe,Ye=Qe,se=de,ue=Xe,Ge=Le,Q=typeof WebGL2RenderingContext<"u"&&X instanceof WebGL2RenderingContext,ee={},oe={},j={},ge=-1,Ie=[];X.canvas.addEventListener("webglcontextlost",function(me){Le(),me.preventDefault()},!1),a.set(X,T={gl:X,isWebGL2:Q,getExtension:xe,withProgram:Qe,withTexture:de,withTextureFramebuffer:Xe,handleContextLoss:Le})}z(T)}function C(F,z,X,T,Q,ee,oe,j){oe===void 0&&(oe=15),j===void 0&&(j=null),I(F,function(ge){var Ie=ge.gl,Be=ge.withProgram,ve=ge.withTexture;ve("copy",function(Ye,se){Ie.texImage2D(Ie.TEXTURE_2D,0,Ie.RGBA,Q,ee,0,Ie.RGBA,Ie.UNSIGNED_BYTE,z),Be("copy",r,g,function(ue){var Ge=ue.setUniform,xe=ue.setAttribute;xe("aUV",2,Ie.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Ge("1i","image",se),Ie.bindFramebuffer(Ie.FRAMEBUFFER,j||null),Ie.disable(Ie.BLEND),Ie.colorMask(oe&8,oe&4,oe&2,oe&1),Ie.viewport(X,T,Q,ee),Ie.scissor(X,T,Q,ee),Ie.drawArrays(Ie.TRIANGLES,0,3)})})})}function u(F,z,X){var T=F.width,Q=F.height;I(F,function(ee){var oe=ee.gl,j=new Uint8Array(T*Q*4);oe.readPixels(0,0,T,Q,oe.RGBA,oe.UNSIGNED_BYTE,j),F.width=z,F.height=X,C(oe,j,0,0,T,Q)})}var A=Object.freeze({__proto__:null,withWebGLContext:I,renderImageData:C,resizeWebGLCanvasWithoutClearing:u});function h(F,z,X,T,Q,ee){ee===void 0&&(ee=1);var oe=new Uint8Array(F*z),j=T[2]-T[0],ge=T[3]-T[1],Ie=[];o(X,function(xe,fe,Qe,de){Ie.push({x1:xe,y1:fe,x2:Qe,y2:de,minX:Math.min(xe,Qe),minY:Math.min(fe,de),maxX:Math.max(xe,Qe),maxY:Math.max(fe,de)})}),Ie.sort(function(xe,fe){return xe.maxX-fe.maxX});for(var Be=0;Be<F;Be++)for(var ve=0;ve<z;ve++){var Ye=ue(T[0]+j*(Be+.5)/F,T[1]+ge*(ve+.5)/z),se=Math.pow(1-Math.abs(Ye)/Q,ee)/2;Ye<0&&(se=1-se),se=Math.max(0,Math.min(255,Math.round(se*255))),oe[ve*F+Be]=se}return oe;function ue(xe,fe){for(var Qe=1/0,de=1/0,Xe=Ie.length;Xe--;){var Le=Ie[Xe];if(Le.maxX+de<=xe)break;if(xe+de>Le.minX&&fe-de<Le.maxY&&fe+de>Le.minY){var me=G(xe,fe,Le.x1,Le.y1,Le.x2,Le.y2);me<Qe&&(Qe=me,de=Math.sqrt(Qe))}}return Ge(xe,fe)&&(de=-de),de}function Ge(xe,fe){for(var Qe=0,de=Ie.length;de--;){var Xe=Ie[de];if(Xe.maxX<=xe)break;var Le=Xe.y1>fe!=Xe.y2>fe&&xe<(Xe.x2-Xe.x1)*(fe-Xe.y1)/(Xe.y2-Xe.y1)+Xe.x1;Le&&(Qe+=Xe.y1<Xe.y2?1:-1)}return Qe!==0}}function m(F,z,X,T,Q,ee,oe,j,ge,Ie){ee===void 0&&(ee=1),j===void 0&&(j=0),ge===void 0&&(ge=0),Ie===void 0&&(Ie=0),b(F,z,X,T,Q,ee,oe,null,j,ge,Ie)}function b(F,z,X,T,Q,ee,oe,j,ge,Ie,Be){ee===void 0&&(ee=1),ge===void 0&&(ge=0),Ie===void 0&&(Ie=0),Be===void 0&&(Be=0);for(var ve=h(F,z,X,T,Q,ee),Ye=new Uint8Array(ve.length*4),se=0;se<ve.length;se++)Ye[se*4+Be]=ve[se];C(oe,Ye,ge,Ie,F,z,1<<3-Be,j)}function G(F,z,X,T,Q,ee){var oe=Q-X,j=ee-T,ge=oe*oe+j*j,Ie=ge?Math.max(0,Math.min(1,((F-X)*oe+(z-T)*j)/ge)):0,Be=F-(X+Ie*oe),ve=z-(T+Ie*j);return Be*Be+ve*ve}var f=Object.freeze({__proto__:null,generate:h,generateIntoCanvas:m,generateIntoFramebuffer:b}),y="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",B="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",v="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",W=new Float32Array([0,0,2,0,0,2]),R=null,Z=!1,V={},H=new WeakMap;function P(F){if(!Z&&!O(F))throw new Error("WebGL generation not supported")}function E(F,z,X,T,Q,ee,oe){if(ee===void 0&&(ee=1),oe===void 0&&(oe=null),!oe&&(oe=R,!oe)){var j=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!j)throw new Error("OffscreenCanvas or DOM canvas not supported");oe=R=j.getContext("webgl",{depth:!1})}P(oe);var ge=new Uint8Array(F*z*4);I(oe,function(Ye){var se=Ye.gl,ue=Ye.withTexture,Ge=Ye.withTextureFramebuffer;ue("readable",function(xe,fe){se.texImage2D(se.TEXTURE_2D,0,se.RGBA,F,z,0,se.RGBA,se.UNSIGNED_BYTE,null),Ge(xe,fe,function(Qe){K(F,z,X,T,Q,ee,se,Qe,0,0,0),se.readPixels(0,0,F,z,se.RGBA,se.UNSIGNED_BYTE,ge)})})});for(var Ie=new Uint8Array(F*z),Be=0,ve=0;Be<ge.length;Be+=4)Ie[ve++]=ge[Be];return Ie}function L(F,z,X,T,Q,ee,oe,j,ge,Ie){ee===void 0&&(ee=1),j===void 0&&(j=0),ge===void 0&&(ge=0),Ie===void 0&&(Ie=0),K(F,z,X,T,Q,ee,oe,null,j,ge,Ie)}function K(F,z,X,T,Q,ee,oe,j,ge,Ie,Be){ee===void 0&&(ee=1),ge===void 0&&(ge=0),Ie===void 0&&(Ie=0),Be===void 0&&(Be=0),P(oe);var ve=[];o(X,function(Ye,se,ue,Ge){ve.push(Ye,se,ue,Ge)}),ve=new Float32Array(ve),I(oe,function(Ye){var se=Ye.gl,ue=Ye.isWebGL2,Ge=Ye.getExtension,xe=Ye.withProgram,fe=Ye.withTexture,Qe=Ye.withTextureFramebuffer,de=Ye.handleContextLoss;if(fe("rawDistances",function(Xe,Le){(F!==Xe._lastWidth||z!==Xe._lastHeight)&&se.texImage2D(se.TEXTURE_2D,0,se.RGBA,Xe._lastWidth=F,Xe._lastHeight=z,0,se.RGBA,se.UNSIGNED_BYTE,null),xe("main",y,B,function(me){var M=me.setAttribute,Y=me.setUniform,te=!ue&&Ge("ANGLE_instanced_arrays"),ce=!ue&&Ge("EXT_blend_minmax");M("aUV",2,se.STATIC_DRAW,0,W),M("aLineSegment",4,se.DYNAMIC_DRAW,1,ve),Y.apply(void 0,["4f","uGlyphBounds"].concat(T)),Y("1f","uMaxDistance",Q),Y("1f","uExponent",ee),Qe(Xe,Le,function(we){se.enable(se.BLEND),se.colorMask(!0,!0,!0,!0),se.viewport(0,0,F,z),se.scissor(0,0,F,z),se.blendFunc(se.ONE,se.ONE),se.blendEquationSeparate(se.FUNC_ADD,ue?se.MAX:ce.MAX_EXT),se.clear(se.COLOR_BUFFER_BIT),ue?se.drawArraysInstanced(se.TRIANGLES,0,3,ve.length/4):te.drawArraysInstancedANGLE(se.TRIANGLES,0,3,ve.length/4)})}),xe("post",r,v,function(me){me.setAttribute("aUV",2,se.STATIC_DRAW,0,W),me.setUniform("1i","tex",Le),se.bindFramebuffer(se.FRAMEBUFFER,j),se.disable(se.BLEND),se.colorMask(Be===0,Be===1,Be===2,Be===3),se.viewport(ge,Ie,F,z),se.scissor(ge,Ie,F,z),se.drawArrays(se.TRIANGLES,0,3)})}),se.isContextLost())throw de(),new Error("webgl context lost")})}function O(F){var z=!F||F===R?V:F.canvas||F,X=H.get(z);if(X===void 0){Z=!0;var T=null;try{var Q=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],ee=E(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,F);X=ee&&Q.length===ee.length&&ee.every(function(oe,j){return oe===Q[j]}),X||(T="bad trial run results",console.info(Q,ee))}catch(oe){X=!1,T=oe.message}T&&console.warn("WebGL SDF generation not supported:",T),Z=!1,H.set(z,X)}return X}var q=Object.freeze({__proto__:null,generate:E,generateIntoCanvas:L,generateIntoFramebuffer:K,isSupported:O});function ne(F,z,X,T,Q,ee){Q===void 0&&(Q=Math.max(T[2]-T[0],T[3]-T[1])/2),ee===void 0&&(ee=1);try{return E.apply(q,arguments)}catch(oe){return console.info("WebGL SDF generation failed, falling back to JS",oe),h.apply(f,arguments)}}function k(F,z,X,T,Q,ee,oe,j,ge,Ie){Q===void 0&&(Q=Math.max(T[2]-T[0],T[3]-T[1])/2),ee===void 0&&(ee=1),j===void 0&&(j=0),ge===void 0&&(ge=0),Ie===void 0&&(Ie=0);try{return L.apply(q,arguments)}catch(Be){return console.info("WebGL SDF generation failed, falling back to JS",Be),m.apply(f,arguments)}}return e.forEachPathCommand=s,e.generate=ne,e.generateIntoCanvas=k,e.javascript=f,e.pathToLineSegments=o,e.webgl=q,e.webglUtils=A,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}function X5(){var i=function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},s={};n.L=1,s[1]="L",Object.keys(t).forEach(function(de,Xe){n[de]=1<<Xe+1,s[n[de]]=de}),Object.freeze(n);var o=n.LRI|n.RLI|n.FSI,r=n.L|n.R|n.AL,g=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,a=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,l=n.S|n.WS|n.B|o|n.PDI|a,I=null;function C(){if(!I){I=new Map;var de=function(Le){if(t.hasOwnProperty(Le)){var me=0;t[Le].split(",").forEach(function(M){var Y=M.split("+"),te=Y[0],ce=Y[1];te=parseInt(te,36),ce=ce?parseInt(ce,36):0,I.set(me+=te,n[Le]);for(var we=0;we<ce;we++)I.set(++me,n[Le])})}};for(var Xe in t)de(Xe)}}function u(de){return C(),I.get(de.codePointAt(0))||n.L}function A(de){return s[u(de)]}var h={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(de,Xe){var Le=36,me=0,M=new Map,Y=Xe&&new Map,te;return de.split(",").forEach(function ce(we){if(we.indexOf("+")!==-1)for(var Re=+we;Re--;)ce(te);else{te=we;var Ve=we.split(">"),We=Ve[0],he=Ve[1];We=String.fromCodePoint(me+=parseInt(We,Le)),he=String.fromCodePoint(me+=parseInt(he,Le)),M.set(We,he),Xe&&Y.set(he,We)}}),{map:M,reverseMap:Y}}var b,G,f;function y(){if(!b){var de=m(h.pairs,!0),Xe=de.map,Le=de.reverseMap;b=Xe,G=Le,f=m(h.canonical,!1).map}}function B(de){return y(),b.get(de)||null}function v(de){return y(),G.get(de)||null}function W(de){return y(),f.get(de)||null}var R=n.L,Z=n.R,V=n.EN,H=n.ES,P=n.ET,E=n.AN,L=n.CS,K=n.B,O=n.S,q=n.ON,ne=n.BN,k=n.NSM,F=n.AL,z=n.LRO,X=n.RLO,T=n.LRE,Q=n.RLE,ee=n.PDF,oe=n.LRI,j=n.RLI,ge=n.FSI,Ie=n.PDI;function Be(de,Xe){for(var Le=125,me=new Uint32Array(de.length),M=0;M<de.length;M++)me[M]=u(de[M]);var Y=new Map;function te(xn,Fi){var Bn=me[xn];me[xn]=Fi,Y.set(Bn,Y.get(Bn)-1),Bn&g&&Y.set(g,Y.get(g)-1),Y.set(Fi,(Y.get(Fi)||0)+1),Fi&g&&Y.set(g,(Y.get(g)||0)+1)}for(var ce=new Uint8Array(de.length),we=new Map,Re=[],Ve=null,We=0;We<de.length;We++)Ve||Re.push(Ve={start:We,end:de.length-1,level:Xe==="rtl"?1:Xe==="ltr"?0:Yg(We,!1)}),me[We]&K&&(Ve.end=We,Ve=null);for(var he=Q|T|X|z|o|Ie|ee|K,ze=function(xn){return xn+(xn&1?1:2)},Pe=function(xn){return xn+(xn&1?2:1)},Te=0;Te<Re.length;Te++){Ve=Re[Te];var Fe=[{_level:Ve.level,_override:0,_isolate:0}],Ke=void 0,$e=0,$=0,De=0;Y.clear();for(var He=Ve.start;He<=Ve.end;He++){var Ae=me[He];if(Ke=Fe[Fe.length-1],Y.set(Ae,(Y.get(Ae)||0)+1),Ae&g&&Y.set(g,(Y.get(g)||0)+1),Ae&he)if(Ae&(Q|T)){ce[He]=Ke._level;var ke=(Ae===Q?Pe:ze)(Ke._level);ke<=Le&&!$e&&!$?Fe.push({_level:ke,_override:0,_isolate:0}):$e||$++}else if(Ae&(X|z)){ce[He]=Ke._level;var gt=(Ae===X?Pe:ze)(Ke._level);gt<=Le&&!$e&&!$?Fe.push({_level:gt,_override:Ae&X?Z:R,_isolate:0}):$e||$++}else if(Ae&o){Ae&ge&&(Ae=Yg(He+1,!0)===1?j:oe),ce[He]=Ke._level,Ke._override&&te(He,Ke._override);var At=(Ae===j?Pe:ze)(Ke._level);At<=Le&&$e===0&&$===0?(De++,Fe.push({_level:At,_override:0,_isolate:1,_isolInitIndex:He})):$e++}else if(Ae&Ie){if($e>0)$e--;else if(De>0){for($=0;!Fe[Fe.length-1]._isolate;)Fe.pop();var Tt=Fe[Fe.length-1]._isolInitIndex;Tt!=null&&(we.set(Tt,He),we.set(He,Tt)),Fe.pop(),De--}Ke=Fe[Fe.length-1],ce[He]=Ke._level,Ke._override&&te(He,Ke._override)}else Ae&ee?($e===0&&($>0?$--:!Ke._isolate&&Fe.length>1&&(Fe.pop(),Ke=Fe[Fe.length-1])),ce[He]=Ke._level):Ae&K&&(ce[He]=Ve.level);else ce[He]=Ke._level,Ke._override&&Ae!==ne&&te(He,Ke._override)}for(var Bt=[],rt=null,Kt=Ve.start;Kt<=Ve.end;Kt++){var Et=me[Kt];if(!(Et&a)){var _t=ce[Kt],on=Et&o,gi=Et===Ie;rt&&_t===rt._level?(rt._end=Kt,rt._endsWithIsolInit=on):Bt.push(rt={_start:Kt,_end:Kt,_level:_t,_startsWithPDI:gi,_endsWithIsolInit:on})}}for(var un=[],dn=0;dn<Bt.length;dn++){var On=Bt[dn];if(!On._startsWithPDI||On._startsWithPDI&&!we.has(On._start)){for(var _=[rt=On],le=void 0;rt&&rt._endsWithIsolInit&&(le=we.get(rt._end))!=null;)for(var pe=dn+1;pe<Bt.length;pe++)if(Bt[pe]._start===le){_.push(rt=Bt[pe]);break}for(var ae=[],Ze=0;Ze<_.length;Ze++)for(var ot=_[Ze],ct=ot._start;ct<=ot._end;ct++)ae.push(ct);for(var pt=ce[ae[0]],Ct=Ve.level,vt=ae[0]-1;vt>=0;vt--)if(!(me[vt]&a)){Ct=ce[vt];break}var mt=ae[ae.length-1],Gt=ce[mt],Nt=Ve.level;if(!(me[mt]&o)){for(var ai=mt+1;ai<=Ve.end;ai++)if(!(me[ai]&a)){Nt=ce[ai];break}}un.push({_seqIndices:ae,_sosType:Math.max(Ct,pt)%2?Z:R,_eosType:Math.max(Nt,Gt)%2?Z:R})}}for(var jn=0;jn<un.length;jn++){var Kn=un[jn],Ne=Kn._seqIndices,nt=Kn._sosType,qn=Kn._eosType;if(Y.get(k))for(var ft=0;ft<Ne.length;ft++){var Mt=Ne[ft];if(me[Mt]&k){for(var Vn=nt,$n=ft-1;$n>=0;$n--)if(!(me[Ne[$n]]&a)){Vn=me[Ne[$n]];break}te(Mt,Vn&(o|Ie)?q:Vn)}}if(Y.get(V))for(var rn=0;rn<Ne.length;rn++){var gn=Ne[rn];if(me[gn]&V)for(var Gi=rn-1;Gi>=-1;Gi--){var Bo=Gi===-1?nt:me[Ne[Gi]];if(Bo&r){Bo===F&&te(gn,E);break}}}if(Y.get(F))for(var An=0;An<Ne.length;An++){var vo=Ne[An];me[vo]&F&&te(vo,Z)}if(Y.get(H)||Y.get(L))for(var ws=1;ws<Ne.length-1;ws++){var Hi=Ne[ws];if(me[Hi]&(H|L)){for(var fr=0,br=0,Lt=ws-1;Lt>=0&&(fr=me[Ne[Lt]],!!(fr&a));Lt--);for(var Ws=ws+1;Ws<Ne.length&&(br=me[Ne[Ws]],!!(br&a));Ws++);fr===br&&(me[Hi]===H?fr===V:fr&(V|E))&&te(Hi,fr)}}if(Y.get(V))for(var Rg=0;Rg<Ne.length;Rg++){var Gh=Ne[Rg];if(me[Gh]&V){for(var js=Rg-1;js>=0&&me[Ne[js]]&(P|a);js--)te(Ne[js],V);for(var Vg=Rg+1;Vg<Ne.length&&me[Ne[Vg]]&(P|a);Vg++)te(Ne[Vg],V)}}if(Y.get(P)||Y.get(H)||Y.get(L))for(var qs=0;qs<Ne.length;qs++){var Zo=Ne[qs];if(me[Zo]&(P|H|L)){te(Zo,q);for(var Gr=qs-1;Gr>=0&&me[Ne[Gr]]&a;Gr--)te(Ne[Gr],q);for(var wo=qs+1;wo<Ne.length&&me[Ne[wo]]&a;wo++)te(Ne[wo],q)}}if(Y.get(V))for(var rs=0,FC=nt;rs<Ne.length;rs++){var KC=Ne[rs],uI=me[KC];uI&V?FC===R&&te(KC,R):uI&r&&(FC=uI)}if(Y.get(g)){var xg=Z|V|E,Xa=xg|R,yr=[];{for(var Br=[],Wo=0;Wo<Ne.length;Wo++)if(me[Ne[Wo]]&g){var So=de[Ne[Wo]],NC=void 0;if(B(So)!==null)if(Br.length<63)Br.push({char:So,seqIndex:Wo});else break;else if((NC=v(So))!==null)for(var $s=Br.length-1;$s>=0;$s--){var Ya=Br[$s].char;if(Ya===NC||Ya===v(W(So))||B(W(Ya))===So){yr.push([Br[$s].seqIndex,Wo]),Br.length=$s;break}}}yr.sort(function(xn,Fi){return xn[0]-Fi[0]})}for(var Ha=0;Ha<yr.length;Ha++){for(var dI=yr[Ha],vr=dI[0],Zr=dI[1],MC=!1,bn=0,wr=vr+1;wr<Zr;wr++){var Xg=Ne[wr];if(me[Xg]&Xa){MC=!0;var AI=me[Xg]&xg?Z:R;if(AI===Vo(Xg)){bn=AI;break}}}if(MC&&!bn){bn=nt;for(var Gn=vr-1;Gn>=0;Gn--){var Ss=Ne[Gn];if(me[Ss]&Xa){var hI=me[Ss]&xg?Z:R;hI!==Vo(Ss)?bn=hI:bn=Vo(Ss);break}}}if(bn){if(me[Ne[vr]]=me[Ne[Zr]]=bn,bn!==Vo(Ne[vr])){for(var yi=vr+1;yi<Ne.length;yi++)if(!(me[Ne[yi]]&a)){u(de[Ne[yi]])&k&&(me[Ne[yi]]=bn);break}}if(bn!==Vo(Ne[Zr])){for(var Rs=Zr+1;Rs<Ne.length;Rs++)if(!(me[Ne[Rs]]&a)){u(de[Ne[Rs]])&k&&(me[Ne[Rs]]=bn);break}}}}for(var yn=0;yn<Ne.length;yn++)if(me[Ne[yn]]&g){for(var pI=yn,mI=yn,fI=nt,Jn=yn-1;Jn>=0;Jn--)if(me[Ne[Jn]]&a)pI=Jn;else{fI=me[Ne[Jn]]&xg?Z:R;break}for(var LC=qn,eo=yn+1;eo<Ne.length;eo++)if(me[Ne[eo]]&(g|a))mI=eo;else{LC=me[Ne[eo]]&xg?Z:R;break}for(var Fa=pI;Fa<=mI;Fa++)me[Ne[Fa]]=fI===LC?fI:Vo(Ne[Fa]);yn=mI}}}for(var qt=Ve.start;qt<=Ve.end;qt++){var Ka=ce[qt],Ro=me[qt];if(Ka&1?Ro&(R|V|E)&&ce[qt]++:Ro&Z?ce[qt]++:Ro&(E|V)&&(ce[qt]+=2),Ro&a&&(ce[qt]=qt===0?Ve.level:ce[qt-1]),qt===Ve.end||u(de[qt])&(O|K))for(var Vs=qt;Vs>=0&&u(de[Vs])&l;Vs--)ce[Vs]=Ve.level}}return{levels:ce,paragraphs:Re};function Yg(xn,Fi){for(var Bn=xn;Bn<de.length;Bn++){var vn=me[Bn];if(vn&(Z|F))return 1;if(vn&(K|R)||Fi&&vn===Ie)return 0;if(vn&o){var xs=bI(Bn);Bn=xs===-1?de.length:xs}}return 0}function bI(xn){for(var Fi=1,Bn=xn+1;Bn<de.length;Bn++){var vn=me[Bn];if(vn&K)break;if(vn&Ie){if(--Fi===0)return Bn}else vn&o&&Fi++}return-1}function Vo(xn){return ce[xn]&1?Z:R}}var ve="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Ye;function se(){if(!Ye){var de=m(ve,!0),Xe=de.map,Le=de.reverseMap;Le.forEach(function(me,M){Xe.set(M,me)}),Ye=Xe}}function ue(de){return se(),Ye.get(de)||null}function Ge(de,Xe,Le,me){var M=de.length;Le=Math.max(0,Le==null?0:+Le),me=Math.min(M-1,me==null?M-1:+me);for(var Y=new Map,te=Le;te<=me;te++)if(Xe[te]&1){var ce=ue(de[te]);ce!==null&&Y.set(te,ce)}return Y}function xe(de,Xe,Le,me){var M=de.length;Le=Math.max(0,Le==null?0:+Le),me=Math.min(M-1,me==null?M-1:+me);var Y=[];return Xe.paragraphs.forEach(function(te){var ce=Math.max(Le,te.start),we=Math.min(me,te.end);if(ce<we){for(var Re=Xe.levels.slice(ce,we+1),Ve=we;Ve>=ce&&u(de[Ve])&l;Ve--)Re[Ve]=te.level;for(var We=te.level,he=1/0,ze=0;ze<Re.length;ze++){var Pe=Re[ze];Pe>We&&(We=Pe),Pe<he&&(he=Pe|1)}for(var Te=We;Te>=he;Te--)for(var Fe=0;Fe<Re.length;Fe++)if(Re[Fe]>=Te){for(var Ke=Fe;Fe+1<Re.length&&Re[Fe+1]>=Te;)Fe++;Fe>Ke&&Y.push([Ke+Le,Fe+Le])}}}),Y}function fe(de,Xe,Le,me){var M=Qe(de,Xe,Le,me),Y=[].concat(de);return M.forEach(function(te,ce){Y[ce]=(Xe.levels[te]&1?ue(de[te]):null)||de[te]}),Y.join("")}function Qe(de,Xe,Le,me){for(var M=xe(de,Xe,Le,me),Y=[],te=0;te<de.length;te++)Y[te]=te;return M.forEach(function(ce){for(var we=ce[0],Re=ce[1],Ve=Y.slice(we,Re+1),We=Ve.length;We--;)Y[Re-We]=Ve[We]}),Y}return e.closingToOpeningBracket=v,e.getBidiCharType=u,e.getBidiCharTypeName=A,e.getCanonicalBracket=W,e.getEmbeddingLevels=Be,e.getMirroredCharacter=ue,e.getMirroredCharactersMap=Ge,e.getReorderSegments=xe,e.getReorderedIndices=Qe,e.getReorderedString=fe,e.openingToClosingBracket=B,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return i}const WR=/\bvoid\s+main\s*\(\s*\)\s*{/g;function p0(i){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,s){let o=yt[s];return o?p0(o):n}return i.replace(e,t)}const ni=[];for(let i=0;i<256;i++)ni[i]=(i<16?"0":"")+i.toString(16);function Y5(){const i=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ni[i&255]+ni[i>>8&255]+ni[i>>16&255]+ni[i>>24&255]+"-"+ni[e&255]+ni[e>>8&255]+"-"+ni[e>>16&15|64]+ni[e>>24&255]+"-"+ni[t&63|128]+ni[t>>8&255]+"-"+ni[t>>16&255]+ni[t>>24&255]+ni[n&255]+ni[n>>8&255]+ni[n>>16&255]+ni[n>>24&255]).toUpperCase()}const Dg=Object.assign||function(){let i=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let s in n)n.hasOwnProperty(s)&&(i[s]=n[s])}return i},H5=Date.now(),yZ=new WeakMap,BZ=new Map;let F5=1e10;function m0(i,e){const t=L5(e);let n=yZ.get(i);if(n||yZ.set(i,n=Object.create(null)),n[t])return new n[t];const s=`_onBeforeCompile${t}`,o=function(l){i.onBeforeCompile.call(this,l);const I=this.customProgramCacheKey()+"|"+l.vertexShader+"|"+l.fragmentShader;let C=BZ[I];if(!C){const u=K5(l,e,t);C=BZ[I]=u}l.vertexShader=C.vertexShader,l.fragmentShader=C.fragmentShader,Dg(l.uniforms,this.uniforms),e.timeUniform&&(l.uniforms[e.timeUniform]={get value(){return Date.now()-H5}}),this[s]&&this[s](l)},r=function(){return g(e.chained?i:i.clone())},g=function(l){const I=Object.create(l,a);return Object.defineProperty(I,"baseMaterial",{value:i}),Object.defineProperty(I,"id",{value:F5++}),I.uuid=Y5(),I.uniforms=Dg({},l.uniforms,e.uniforms),I.defines=Dg({},l.defines,e.defines),I.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",I.extensions=Dg({},l.extensions,e.extensions),I._listeners=void 0,I},a={constructor:{value:r},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return i.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return o},set(l){this[s]=l}},copy:{writable:!0,configurable:!0,value:function(l){return i.copy.call(this,l),!i.isShaderMaterial&&!i.isDerivedMaterial&&(Dg(this.extensions,l.extensions),Dg(this.defines,l.defines),Dg(this.uniforms,eh.clone(l.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const l=new i.constructor;return g(l).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let l=this._depthMaterial;return l||(l=this._depthMaterial=m0(i.isDerivedMaterial?i.getDepthMaterial():new ih({depthPacking:Sb}),e),l.defines.IS_DEPTH_MATERIAL="",l.uniforms=this.uniforms),l}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let l=this._distanceMaterial;return l||(l=this._distanceMaterial=m0(i.isDerivedMaterial?i.getDistanceMaterial():new sh,e),l.defines.IS_DISTANCE_MATERIAL="",l.uniforms=this.uniforms),l}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:l,_distanceMaterial:I}=this;l&&l.dispose(),I&&I.dispose(),i.dispose.call(this)}}};return n[t]=r,new r}function K5({vertexShader:i,fragmentShader:e},t,n){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:r,vertexTransform:g,fragmentDefs:a,fragmentMainIntro:l,fragmentMainOutro:I,fragmentColorTransform:C,customRewriter:u,timeUniform:A}=t;if(s=s||"",o=o||"",r=r||"",a=a||"",l=l||"",I=I||"",(g||u)&&(i=p0(i)),(C||u)&&(e=e.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),e=p0(e)),u){let h=u({vertexShader:i,fragmentShader:e});i=h.vertexShader,e=h.fragmentShader}if(C){let h=[];e=e.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,m=>(h.push(m),"")),I=`${C}
${h.join(`
`)}
${I}`}if(A){const h=`
uniform float ${A};
`;s=h+s,a=h+a}return g&&(i=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${i}
`,s=`${s}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${g}
}
`,o=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${o}
`,i=i.replace(/\b(position|normal|uv)\b/g,(h,m,b,G)=>/\battribute\s+vec[23]\s+$/.test(G.substr(0,b))?m:`troika_${m}_${n}`)),i=vZ(i,n,s,o,r),e=vZ(e,n,a,l,I),{vertexShader:i,fragmentShader:e}}function vZ(i,e,t,n,s){return(n||s||t)&&(i=i.replace(WR,`
${t}
void troikaOrigMain${e}() {`),i+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${s}
}`),i}function N5(i,e){return i==="uniforms"?void 0:typeof e=="function"?e.toString():e}let M5=0;const ZZ=new Map;function L5(i){const e=JSON.stringify(i,N5);let t=ZZ.get(e);return t==null&&ZZ.set(e,t=++M5),t}function z5(i,e,t){const{defaultFontURL:n}=t,s=Object.create(null),o=1/0,r=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,g=/[\s\-\u007C\u00AD\u2010\u2012-\u2014\u2027\u2056\u2E17\u2E40]/;function a(G,f){function y(){const B=v=>{console.error(`Failure loading font ${G}${G===n?"":"; trying fallback"}`,v),G!==n&&(G=n,y())};try{const v=new XMLHttpRequest;v.open("get",G,!0),v.responseType="arraybuffer",v.onload=function(){if(v.status>=400)B(new Error(v.statusText));else if(v.status>0)try{const W=i(v.response);f(W)}catch(W){B(W)}},v.onerror=B,v.send()}catch(v){B(v)}}y()}function l(G,f){G||(G=n);let y=s[G];y?y.pending?y.pending.push(f):f(y):(s[G]={pending:[f]},a(G,B=>{let v=s[G].pending;s[G]=B,v.forEach(W=>W(B))}))}function I({text:G="",font:f=n,sdfGlyphSize:y=64,fontSize:B=1,letterSpacing:v=0,lineHeight:W="normal",maxWidth:R=o,direction:Z,textAlign:V="left",textIndent:H=0,whiteSpace:P="normal",overflowWrap:E="normal",anchorX:L=0,anchorY:K=0,includeCaretPositions:O=!1,chunkedBoundsSize:q=8192,colorRanges:ne=null},k,F=!1){const z=h(),X={fontLoad:0,typesetting:0};G.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),G=G.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),B=+B,v=+v,R=+R,W=W||"normal",H=+H,l(f,T=>{const Q=isFinite(R);let ee=null,oe=null,j=null,ge=null,Ie=null,Be=null,ve=null,Ye=0,se=0,ue=P!=="nowrap";const{ascender:Ge,descender:xe,unitsPerEm:fe}=T;X.fontLoad=h()-z;const Qe=h(),de=B/fe;W==="normal"&&(W=(Ge-xe)/fe),W=W*B;const Xe=(W-(Ge-xe)*de)/2,Le=-(Ge*de+Xe),me=Math.min(W,(Ge-xe)*de),M=(Ge+xe)/2*de-me/2;let Y=H,te=new m;const ce=[te];T.forEachGlyph(G,B,v,(Ve,We,he)=>{const ze=G.charAt(he),Pe=Ve.advanceWidth*de,Te=te.count;let Fe;if("isEmpty"in Ve||(Ve.isWhitespace=!!ze&&/\s/.test(ze),Ve.canBreakAfter=!!ze&&g.test(ze),Ve.isEmpty=Ve.xMin===Ve.xMax||Ve.yMin===Ve.yMax||r.test(ze)),!Ve.isWhitespace&&!Ve.isEmpty&&se++,ue&&Q&&!Ve.isWhitespace&&We+Pe+Y>R&&Te){if(te.glyphAt(Te-1).glyphObj.canBreakAfter)Fe=new m,Y=-We;else for(let $e=Te;$e--;)if($e===0&&E==="break-word"){Fe=new m,Y=-We;break}else if(te.glyphAt($e).glyphObj.canBreakAfter){Fe=te.splitAt($e+1);const $=Fe.glyphAt(0).x;Y-=$;for(let De=Fe.count;De--;)Fe.glyphAt(De).x-=$;break}Fe&&(te.isSoftWrapped=!0,te=Fe,ce.push(te),Ye=R)}let Ke=te.glyphAt(te.count);Ke.glyphObj=Ve,Ke.x=We+Y,Ke.width=Pe,Ke.charIndex=he,ze===`
`&&(te=new m,ce.push(te),Y=-(We+Pe+v*B)+H)}),ce.forEach(Ve=>{for(let We=Ve.count;We--;){let{glyphObj:he,x:ze,width:Pe}=Ve.glyphAt(We);if(!he.isWhitespace){Ve.width=ze+Pe,Ve.width>Ye&&(Ye=Ve.width);return}}});let we=0,Re=0;if(L&&(typeof L=="number"?we=-L:typeof L=="string"&&(we=-Ye*(L==="left"?0:L==="center"?.5:L==="right"?1:u(L)))),K){if(typeof K=="number")Re=-K;else if(typeof K=="string"){let Ve=ce.length*W;Re=K==="top"?0:K==="top-baseline"?-Le:K==="middle"?Ve/2:K==="bottom"?Ve:K==="bottom-baseline"?Ve-Xe+xe*de:u(K)*Ve}}if(!F){const Ve=e.getEmbeddingLevels(G,Z);ee=new Uint16Array(se),oe=new Float32Array(se*2),j={},Be=[o,o,-o,-o],ve=[];let We=Le;O&&(Ie=new Float32Array(G.length*3)),ne&&(ge=new Uint8Array(se*3));let he=0,ze=-1,Pe=-1,Te,Fe;if(ce.forEach((Ke,$e)=>{let{count:$,width:De}=Ke;if($>0){let He=0;for(let Bt=$;Bt--&&Ke.glyphAt(Bt).glyphObj.isWhitespace;)He++;let Ae=0,ke=0;if(V==="center")Ae=(Ye-De)/2;else if(V==="right")Ae=Ye-De;else if(V==="justify"&&Ke.isSoftWrapped){let Bt=0;for(let rt=$-He;rt--;)Ke.glyphAt(rt).glyphObj.isWhitespace&&Bt++;ke=(Ye-De)/Bt}if(ke||Ae){let Bt=0;for(let rt=0;rt<$;rt++){let Kt=Ke.glyphAt(rt);const Et=Kt.glyphObj;Kt.x+=Ae+Bt,ke!==0&&Et.isWhitespace&&rt<$-He&&(Bt+=ke,Kt.width+=ke)}}const gt=e.getReorderSegments(G,Ve,Ke.glyphAt(0).charIndex,Ke.glyphAt(Ke.count-1).charIndex);for(let Bt=0;Bt<gt.length;Bt++){const[rt,Kt]=gt[Bt];let Et=1/0,_t=-1/0;for(let on=0;on<$;on++)if(Ke.glyphAt(on).charIndex>=rt){let gi=on,un=on;for(;un<$;un++){let dn=Ke.glyphAt(un);if(dn.charIndex>Kt)break;un<$-He&&(Et=Math.min(Et,dn.x),_t=Math.max(_t,dn.x+dn.width))}for(let dn=gi;dn<un;dn++){const On=Ke.glyphAt(dn);On.x=_t-(On.x+On.width-Et)}break}}let At;const Tt=Bt=>At=Bt;for(let Bt=0;Bt<$;Bt++){let rt=Ke.glyphAt(Bt);At=rt.glyphObj;const Kt=At.index,Et=Ve.levels[rt.charIndex]&1;if(Et){const _t=e.getMirroredCharacter(G[rt.charIndex]);_t&&T.forEachGlyph(_t,0,0,Tt)}if(O){const{charIndex:_t}=rt,on=rt.x+we,gi=rt.x+rt.width+we;Ie[_t*3]=Et?gi:on,Ie[_t*3+1]=Et?on:gi,Ie[_t*3+2]=We+M+Re;const un=_t-ze;un>1&&A(Ie,ze,un),ze=_t}if(ne){const{charIndex:_t}=rt;for(;_t>Pe;)Pe++,ne.hasOwnProperty(Pe)&&(Fe=ne[Pe])}if(!At.isWhitespace&&!At.isEmpty){const _t=he++;j[Kt]||(j[Kt]={path:At.path,pathBounds:[At.xMin,At.yMin,At.xMax,At.yMax]});const on=rt.x+we,gi=We+Re;oe[_t*2]=on,oe[_t*2+1]=gi;const un=on+At.xMin*de,dn=gi+At.yMin*de,On=on+At.xMax*de,_=gi+At.yMax*de;un<Be[0]&&(Be[0]=un),dn<Be[1]&&(Be[1]=dn),On>Be[2]&&(Be[2]=On),_>Be[3]&&(Be[3]=_),_t%q===0&&(Te={start:_t,end:_t,rect:[o,o,-o,-o]},ve.push(Te)),Te.end++;const le=Te.rect;if(un<le[0]&&(le[0]=un),dn<le[1]&&(le[1]=dn),On>le[2]&&(le[2]=On),_>le[3]&&(le[3]=_),ee[_t]=Kt,ne){const pe=_t*3;ge[pe]=Fe>>16&255,ge[pe+1]=Fe>>8&255,ge[pe+2]=Fe&255}}}}We-=W}),Ie){const Ke=G.length-ze;Ke>1&&A(Ie,ze,Ke)}}X.typesetting=h()-Qe,k({glyphIds:ee,glyphPositions:oe,glyphData:j,caretPositions:Ie,caretHeight:me,glyphColors:ge,chunkedBounds:ve,fontSize:B,unitsPerEm:fe,ascender:Ge*de,descender:xe*de,lineHeight:W,topBaseline:Le,blockBounds:[we,Re-ce.length*W,we+Ye,Re],visibleBounds:Be,timings:X})})}function C(G,f){I(G,y=>{const[B,v,W,R]=y.blockBounds;f({width:W-B,height:R-v})},{metricsOnly:!0})}function u(G){let f=G.match(/^([\d.]+)%$/),y=f?parseFloat(f[1]):NaN;return isNaN(y)?0:y/100}function A(G,f,y){const B=G[f*3],v=G[f*3+1],W=G[f*3+2],R=(v-B)/y;for(let Z=0;Z<y;Z++){const V=(f+Z)*3;G[V]=B+R*Z,G[V+1]=B+R*(Z+1),G[V+2]=W}}function h(){return(self.performance||Date).now()}function m(){this.data=[]}const b=["glyphObj","x","width","charIndex"];return m.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/b.length)},glyphAt(G){let f=m.flyweight;return f.data=this.data,f.index=G,f},splitAt(G){let f=new m;return f.data=this.data.splice(G*b.length),f}},m.flyweight=b.reduce((G,f,y,B)=>(Object.defineProperty(G,f,{get(){return this.data[this.index*b.length+y]},set(v){this.data[this.index*b.length+y]=v}}),G),{data:null,index:0}),{typeset:I,measure:C,loadFont:l}}const la=()=>(self.performance||Date).now(),ph=wR();let wZ;function k5(i,e,t,n,s,o,r,g,a,l,I=!0){return I?T5(i,e,t,n,s,o,r,g,a,l).then(null,C=>(wZ||(console.warn("WebGL SDF generation failed, falling back to JS",C),wZ=!0),WZ(i,e,t,n,s,o,r,g,a,l))):WZ(i,e,t,n,s,o,r,g,a,l)}const T5=function(){const i=[];let t=0;function n(){const s=la();for(;i.length&&la()-s<5;)i.shift()();t=i.length?setTimeout(n,0):0}return(...s)=>{const o=Ir();return i.push(()=>{const r=la();try{ph.webgl.generateIntoCanvas(...s),o.resolve({timing:la()-r})}catch(g){o.reject(g)}}),t||(t=setTimeout(n,0)),o}}(),WZ=function(){const t={};let n=0;return function(s,o,r,g,a,l,I,C,u,A){const h="TroikaTextSDFGenerator_JS_"+n++%4;let m=t[h];return m||(m=t[h]={workerModule:cI({name:h,workerId:h,dependencies:[wR,la],init(b,G){const f=b().javascript.generate;return function(...y){const B=G();return{textureData:f(...y),timing:G()-B}}},getTransferables(b){return[b.textureData.buffer]}}),requests:0,idleTimer:null}),m.requests++,clearTimeout(m.idleTimer),m.workerModule(s,o,r,g,a,l).then(({textureData:b,timing:G})=>{const f=la(),y=new Uint8Array(b.length*4);for(let B=0;B<b.length;B++)y[B*4+A]=b[B];return ph.webglUtils.renderImageData(I,y,C,u,s,o,1<<3-A),G+=la()-f,--m.requests===0&&(m.idleTimer=setTimeout(()=>{R5(h)},2e3)),{timing:G}})}}();function E5(i){i._warm||(ph.webgl.isSupported(i),i._warm=!0)}const _5=ph.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function J5(){return typeof window>"u"&&(self.window=self),function(i){var e={parse:function(s){var o=e._bin,r=new Uint8Array(s);if(o.readASCII(r,0,4)=="ttcf"){var g=4;o.readUshort(r,g),g+=2,o.readUshort(r,g),g+=2;var a=o.readUint(r,g);g+=4;for(var l=[],I=0;I<a;I++){var C=o.readUint(r,g);g+=4,l.push(e._readFont(r,C))}return l}return[e._readFont(r,0)]},_readFont:function(s,o){var r=e._bin,g=o;r.readFixed(s,o),o+=4;var a=r.readUshort(s,o);o+=2,r.readUshort(s,o),o+=2,r.readUshort(s,o),o+=2,r.readUshort(s,o),o+=2;for(var l=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],I={_data:s,_offset:g},C={},u=0;u<a;u++){var A=r.readASCII(s,o,4);o+=4,r.readUint(s,o),o+=4;var h=r.readUint(s,o);o+=4;var m=r.readUint(s,o);o+=4,C[A]={offset:h,length:m}}for(u=0;u<l.length;u++){var b=l[u];C[b]&&(I[b.trim()]=e[b.trim()].parse(s,C[b].offset,C[b].length,I))}return I},_tabOffset:function(s,o,r){for(var g=e._bin,a=g.readUshort(s,r+4),l=r+12,I=0;I<a;I++){var C=g.readASCII(s,l,4);l+=4,g.readUint(s,l),l+=4;var u=g.readUint(s,l);if(l+=4,g.readUint(s,l),l+=4,C==o)return u}return 0}};e._bin={readFixed:function(s,o){return(s[o]<<8|s[o+1])+(s[o+2]<<8|s[o+3])/65540},readF2dot14:function(s,o){return e._bin.readShort(s,o)/16384},readInt:function(s,o){return e._bin._view(s).getInt32(o)},readInt8:function(s,o){return e._bin._view(s).getInt8(o)},readShort:function(s,o){return e._bin._view(s).getInt16(o)},readUshort:function(s,o){return e._bin._view(s).getUint16(o)},readUshorts:function(s,o,r){for(var g=[],a=0;a<r;a++)g.push(e._bin.readUshort(s,o+2*a));return g},readUint:function(s,o){return e._bin._view(s).getUint32(o)},readUint64:function(s,o){return 4294967296*e._bin.readUint(s,o)+e._bin.readUint(s,o+4)},readASCII:function(s,o,r){for(var g="",a=0;a<r;a++)g+=String.fromCharCode(s[o+a]);return g},readUnicode:function(s,o,r){for(var g="",a=0;a<r;a++){var l=s[o++]<<8|s[o++];g+=String.fromCharCode(l)}return g},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(s,o,r){var g=e._bin._tdec;return g&&o==0&&r==s.length?g.decode(s):e._bin.readASCII(s,o,r)},readBytes:function(s,o,r){for(var g=[],a=0;a<r;a++)g.push(s[o+a]);return g},readASCIIArray:function(s,o,r){for(var g=[],a=0;a<r;a++)g.push(String.fromCharCode(s[o+a]));return g},_view:function(s){return s._dataView||(s._dataView=s.buffer?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(new Uint8Array(s).buffer))}},e._lctf={},e._lctf.parse=function(s,o,r,g,a){var l=e._bin,I={},C=o;l.readFixed(s,o),o+=4;var u=l.readUshort(s,o);o+=2;var A=l.readUshort(s,o);o+=2;var h=l.readUshort(s,o);return o+=2,I.scriptList=e._lctf.readScriptList(s,C+u),I.featureList=e._lctf.readFeatureList(s,C+A),I.lookupList=e._lctf.readLookupList(s,C+h,a),I},e._lctf.readLookupList=function(s,o,r){var g=e._bin,a=o,l=[],I=g.readUshort(s,o);o+=2;for(var C=0;C<I;C++){var u=g.readUshort(s,o);o+=2;var A=e._lctf.readLookupTable(s,a+u,r);l.push(A)}return l},e._lctf.readLookupTable=function(s,o,r){var g=e._bin,a=o,l={tabs:[]};l.ltype=g.readUshort(s,o),o+=2,l.flag=g.readUshort(s,o),o+=2;var I=g.readUshort(s,o);o+=2;for(var C=l.ltype,u=0;u<I;u++){var A=g.readUshort(s,o);o+=2;var h=r(s,C,a+A,l);l.tabs.push(h)}return l},e._lctf.numOfOnes=function(s){for(var o=0,r=0;r<32;r++)(s>>>r&1)!=0&&o++;return o},e._lctf.readClassDef=function(s,o){var r=e._bin,g=[],a=r.readUshort(s,o);if(o+=2,a==1){var l=r.readUshort(s,o);o+=2;var I=r.readUshort(s,o);o+=2;for(var C=0;C<I;C++)g.push(l+C),g.push(l+C),g.push(r.readUshort(s,o)),o+=2}if(a==2){var u=r.readUshort(s,o);for(o+=2,C=0;C<u;C++)g.push(r.readUshort(s,o)),o+=2,g.push(r.readUshort(s,o)),o+=2,g.push(r.readUshort(s,o)),o+=2}return g},e._lctf.getInterval=function(s,o){for(var r=0;r<s.length;r+=3){var g=s[r],a=s[r+1];if(s[r+2],g<=o&&o<=a)return r}return-1},e._lctf.readCoverage=function(s,o){var r=e._bin,g={};g.fmt=r.readUshort(s,o),o+=2;var a=r.readUshort(s,o);return o+=2,g.fmt==1&&(g.tab=r.readUshorts(s,o,a)),g.fmt==2&&(g.tab=r.readUshorts(s,o,3*a)),g},e._lctf.coverageIndex=function(s,o){var r=s.tab;if(s.fmt==1)return r.indexOf(o);if(s.fmt==2){var g=e._lctf.getInterval(r,o);if(g!=-1)return r[g+2]+(o-r[g])}return-1},e._lctf.readFeatureList=function(s,o){var r=e._bin,g=o,a=[],l=r.readUshort(s,o);o+=2;for(var I=0;I<l;I++){var C=r.readASCII(s,o,4);o+=4;var u=r.readUshort(s,o);o+=2;var A=e._lctf.readFeatureTable(s,g+u);A.tag=C.trim(),a.push(A)}return a},e._lctf.readFeatureTable=function(s,o){var r=e._bin,g=o,a={},l=r.readUshort(s,o);o+=2,l>0&&(a.featureParams=g+l);var I=r.readUshort(s,o);o+=2,a.tab=[];for(var C=0;C<I;C++)a.tab.push(r.readUshort(s,o+2*C));return a},e._lctf.readScriptList=function(s,o){var r=e._bin,g=o,a={},l=r.readUshort(s,o);o+=2;for(var I=0;I<l;I++){var C=r.readASCII(s,o,4);o+=4;var u=r.readUshort(s,o);o+=2,a[C.trim()]=e._lctf.readScriptTable(s,g+u)}return a},e._lctf.readScriptTable=function(s,o){var r=e._bin,g=o,a={},l=r.readUshort(s,o);o+=2,a.default=e._lctf.readLangSysTable(s,g+l);var I=r.readUshort(s,o);o+=2;for(var C=0;C<I;C++){var u=r.readASCII(s,o,4);o+=4;var A=r.readUshort(s,o);o+=2,a[u.trim()]=e._lctf.readLangSysTable(s,g+A)}return a},e._lctf.readLangSysTable=function(s,o){var r=e._bin,g={};r.readUshort(s,o),o+=2,g.reqFeature=r.readUshort(s,o),o+=2;var a=r.readUshort(s,o);return o+=2,g.features=r.readUshorts(s,o,a),g},e.CFF={},e.CFF.parse=function(s,o,r){var g=e._bin;(s=new Uint8Array(s.buffer,o,r))[o=0],s[++o],s[++o],s[++o],o++;var a=[];o=e.CFF.readIndex(s,o,a);for(var l=[],I=0;I<a.length-1;I++)l.push(g.readASCII(s,o+a[I],a[I+1]-a[I]));o+=a[a.length-1];var C=[];o=e.CFF.readIndex(s,o,C);var u=[];for(I=0;I<C.length-1;I++)u.push(e.CFF.readDict(s,o+C[I],o+C[I+1]));o+=C[C.length-1];var A=u[0],h=[];o=e.CFF.readIndex(s,o,h);var m=[];for(I=0;I<h.length-1;I++)m.push(g.readASCII(s,o+h[I],h[I+1]-h[I]));if(o+=h[h.length-1],e.CFF.readSubrs(s,o,A),A.CharStrings){o=A.CharStrings,h=[],o=e.CFF.readIndex(s,o,h);var b=[];for(I=0;I<h.length-1;I++)b.push(g.readBytes(s,o+h[I],h[I+1]-h[I]));A.CharStrings=b}if(A.ROS){o=A.FDArray;var G=[];for(o=e.CFF.readIndex(s,o,G),A.FDArray=[],I=0;I<G.length-1;I++){var f=e.CFF.readDict(s,o+G[I],o+G[I+1]);e.CFF._readFDict(s,f,m),A.FDArray.push(f)}o+=G[G.length-1],o=A.FDSelect,A.FDSelect=[];var y=s[o];if(o++,y!=3)throw y;var B=g.readUshort(s,o);for(o+=2,I=0;I<B+1;I++)A.FDSelect.push(g.readUshort(s,o),s[o+2]),o+=3}return A.Encoding&&(A.Encoding=e.CFF.readEncoding(s,A.Encoding,A.CharStrings.length)),A.charset&&(A.charset=e.CFF.readCharset(s,A.charset,A.CharStrings.length)),e.CFF._readFDict(s,A,m),A},e.CFF._readFDict=function(s,o,r){var g;for(var a in o.Private&&(g=o.Private[1],o.Private=e.CFF.readDict(s,g,g+o.Private[0]),o.Private.Subrs&&e.CFF.readSubrs(s,g+o.Private.Subrs,o.Private)),o)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)!=-1&&(o[a]=r[o[a]-426+35])},e.CFF.readSubrs=function(s,o,r){var g=e._bin,a=[];o=e.CFF.readIndex(s,o,a);var l,I=a.length;l=I<1240?107:I<33900?1131:32768,r.Bias=l,r.Subrs=[];for(var C=0;C<a.length-1;C++)r.Subrs.push(g.readBytes(s,o+a[C],a[C+1]-a[C]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(s,o){for(var r=0;r<s.charset.length;r++)if(s.charset[r]==o)return r;return-1},e.CFF.glyphBySE=function(s,o){return o<0||o>255?-1:e.CFF.glyphByUnicode(s,e.CFF.tableSE[o])},e.CFF.readEncoding=function(s,o,r){e._bin;var g=[".notdef"],a=s[o];if(o++,a!=0)throw"error: unknown encoding format: "+a;var l=s[o];o++;for(var I=0;I<l;I++)g.push(s[o+I]);return g},e.CFF.readCharset=function(s,o,r){var g=e._bin,a=[".notdef"],l=s[o];if(o++,l==0)for(var I=0;I<r;I++){var C=g.readUshort(s,o);o+=2,a.push(C)}else{if(l!=1&&l!=2)throw"error: format: "+l;for(;a.length<r;){C=g.readUshort(s,o),o+=2;var u=0;for(l==1?(u=s[o],o++):(u=g.readUshort(s,o),o+=2),I=0;I<=u;I++)a.push(C),C++}}return a},e.CFF.readIndex=function(s,o,r){var g=e._bin,a=g.readUshort(s,o)+1,l=s[o+=2];if(o++,l==1)for(var I=0;I<a;I++)r.push(s[o+I]);else if(l==2)for(I=0;I<a;I++)r.push(g.readUshort(s,o+2*I));else if(l==3)for(I=0;I<a;I++)r.push(16777215&g.readUint(s,o+3*I-1));else if(a!=1)throw"unsupported offset size: "+l+", count: "+a;return(o+=a*l)-1},e.CFF.getCharString=function(s,o,r){var g=e._bin,a=s[o],l=s[o+1];s[o+2],s[o+3],s[o+4];var I=1,C=null,u=null;a<=20&&(C=a,I=1),a==12&&(C=100*a+l,I=2),21<=a&&a<=27&&(C=a,I=1),a==28&&(u=g.readShort(s,o+1),I=3),29<=a&&a<=31&&(C=a,I=1),32<=a&&a<=246&&(u=a-139,I=1),247<=a&&a<=250&&(u=256*(a-247)+l+108,I=2),251<=a&&a<=254&&(u=256*-(a-251)-l-108,I=2),a==255&&(u=g.readInt(s,o+1)/65535,I=5),r.val=u!=null?u:"o"+C,r.size=I},e.CFF.readCharString=function(s,o,r){for(var g=o+r,a=e._bin,l=[];o<g;){var I=s[o],C=s[o+1];s[o+2],s[o+3],s[o+4];var u=1,A=null,h=null;I<=20&&(A=I,u=1),I==12&&(A=100*I+C,u=2),I!=19&&I!=20||(A=I,u=2),21<=I&&I<=27&&(A=I,u=1),I==28&&(h=a.readShort(s,o+1),u=3),29<=I&&I<=31&&(A=I,u=1),32<=I&&I<=246&&(h=I-139,u=1),247<=I&&I<=250&&(h=256*(I-247)+C+108,u=2),251<=I&&I<=254&&(h=256*-(I-251)-C-108,u=2),I==255&&(h=a.readInt(s,o+1)/65535,u=5),l.push(h!=null?h:"o"+A),o+=u}return l},e.CFF.readDict=function(s,o,r){for(var g=e._bin,a={},l=[];o<r;){var I=s[o],C=s[o+1];s[o+2],s[o+3],s[o+4];var u=1,A=null,h=null;if(I==28&&(h=g.readShort(s,o+1),u=3),I==29&&(h=g.readInt(s,o+1),u=5),32<=I&&I<=246&&(h=I-139,u=1),247<=I&&I<=250&&(h=256*(I-247)+C+108,u=2),251<=I&&I<=254&&(h=256*-(I-251)-C-108,u=2),I==255)throw h=g.readInt(s,o+1)/65535,u=5,"unknown number";if(I==30){var m=[];for(u=1;;){var b=s[o+u];u++;var G=b>>4,f=15&b;if(G!=15&&m.push(G),f!=15&&m.push(f),f==15)break}for(var y="",B=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<m.length;v++)y+=B[m[v]];h=parseFloat(y)}I<=21&&(A=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][I],u=1,I==12&&(A=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][C],u=2)),A!=null?(a[A]=l.length==1?l[0]:l,l=[]):l.push(h),o+=u}return a},e.cmap={},e.cmap.parse=function(s,o,r){s=new Uint8Array(s.buffer,o,r),o=0;var g=e._bin,a={};g.readUshort(s,o),o+=2;var l=g.readUshort(s,o);o+=2;var I=[];a.tables=[];for(var C=0;C<l;C++){var u=g.readUshort(s,o);o+=2;var A=g.readUshort(s,o);o+=2;var h=g.readUint(s,o);o+=4;var m="p"+u+"e"+A,b=I.indexOf(h);if(b==-1){var G;b=a.tables.length,I.push(h);var f=g.readUshort(s,h);f==0?G=e.cmap.parse0(s,h):f==4?G=e.cmap.parse4(s,h):f==6?G=e.cmap.parse6(s,h):f==12?G=e.cmap.parse12(s,h):console.debug("unknown format: "+f,u,A,h),a.tables.push(G)}if(a[m]!=null)throw"multiple tables for one platform+encoding";a[m]=b}return a},e.cmap.parse0=function(s,o){var r=e._bin,g={};g.format=r.readUshort(s,o),o+=2;var a=r.readUshort(s,o);o+=2,r.readUshort(s,o),o+=2,g.map=[];for(var l=0;l<a-6;l++)g.map.push(s[o+l]);return g},e.cmap.parse4=function(s,o){var r=e._bin,g=o,a={};a.format=r.readUshort(s,o),o+=2;var l=r.readUshort(s,o);o+=2,r.readUshort(s,o),o+=2;var I=r.readUshort(s,o);o+=2;var C=I/2;a.searchRange=r.readUshort(s,o),o+=2,a.entrySelector=r.readUshort(s,o),o+=2,a.rangeShift=r.readUshort(s,o),o+=2,a.endCount=r.readUshorts(s,o,C),o+=2*C,o+=2,a.startCount=r.readUshorts(s,o,C),o+=2*C,a.idDelta=[];for(var u=0;u<C;u++)a.idDelta.push(r.readShort(s,o)),o+=2;for(a.idRangeOffset=r.readUshorts(s,o,C),o+=2*C,a.glyphIdArray=[];o<g+l;)a.glyphIdArray.push(r.readUshort(s,o)),o+=2;return a},e.cmap.parse6=function(s,o){var r=e._bin,g={};g.format=r.readUshort(s,o),o+=2,r.readUshort(s,o),o+=2,r.readUshort(s,o),o+=2,g.firstCode=r.readUshort(s,o),o+=2;var a=r.readUshort(s,o);o+=2,g.glyphIdArray=[];for(var l=0;l<a;l++)g.glyphIdArray.push(r.readUshort(s,o)),o+=2;return g},e.cmap.parse12=function(s,o){var r=e._bin,g={};g.format=r.readUshort(s,o),o+=2,o+=2,r.readUint(s,o),o+=4,r.readUint(s,o),o+=4;var a=r.readUint(s,o);o+=4,g.groups=[];for(var l=0;l<a;l++){var I=o+12*l,C=r.readUint(s,I+0),u=r.readUint(s,I+4),A=r.readUint(s,I+8);g.groups.push([C,u,A])}return g},e.glyf={},e.glyf.parse=function(s,o,r,g){for(var a=[],l=0;l<g.maxp.numGlyphs;l++)a.push(null);return a},e.glyf._parseGlyf=function(s,o){var r=e._bin,g=s._data,a=e._tabOffset(g,"glyf",s._offset)+s.loca[o];if(s.loca[o]==s.loca[o+1])return null;var l={};if(l.noc=r.readShort(g,a),a+=2,l.xMin=r.readShort(g,a),a+=2,l.yMin=r.readShort(g,a),a+=2,l.xMax=r.readShort(g,a),a+=2,l.yMax=r.readShort(g,a),a+=2,l.xMin>=l.xMax||l.yMin>=l.yMax)return null;if(l.noc>0){l.endPts=[];for(var I=0;I<l.noc;I++)l.endPts.push(r.readUshort(g,a)),a+=2;var C=r.readUshort(g,a);if(a+=2,g.length-a<C)return null;l.instructions=r.readBytes(g,a,C),a+=C;var u=l.endPts[l.noc-1]+1;for(l.flags=[],I=0;I<u;I++){var A=g[a];if(a++,l.flags.push(A),(8&A)!=0){var h=g[a];a++;for(var m=0;m<h;m++)l.flags.push(A),I++}}for(l.xs=[],I=0;I<u;I++){var b=(2&l.flags[I])!=0,G=(16&l.flags[I])!=0;b?(l.xs.push(G?g[a]:-g[a]),a++):G?l.xs.push(0):(l.xs.push(r.readShort(g,a)),a+=2)}for(l.ys=[],I=0;I<u;I++)b=(4&l.flags[I])!=0,G=(32&l.flags[I])!=0,b?(l.ys.push(G?g[a]:-g[a]),a++):G?l.ys.push(0):(l.ys.push(r.readShort(g,a)),a+=2);var f=0,y=0;for(I=0;I<u;I++)f+=l.xs[I],y+=l.ys[I],l.xs[I]=f,l.ys[I]=y}else{var B;l.parts=[];do{B=r.readUshort(g,a),a+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(l.parts.push(v),v.glyphIndex=r.readUshort(g,a),a+=2,1&B){var W=r.readShort(g,a);a+=2;var R=r.readShort(g,a);a+=2}else W=r.readInt8(g,a),a++,R=r.readInt8(g,a),a++;2&B?(v.m.tx=W,v.m.ty=R):(v.p1=W,v.p2=R),8&B?(v.m.a=v.m.d=r.readF2dot14(g,a),a+=2):64&B?(v.m.a=r.readF2dot14(g,a),a+=2,v.m.d=r.readF2dot14(g,a),a+=2):128&B&&(v.m.a=r.readF2dot14(g,a),a+=2,v.m.b=r.readF2dot14(g,a),a+=2,v.m.c=r.readF2dot14(g,a),a+=2,v.m.d=r.readF2dot14(g,a),a+=2)}while(32&B);if(256&B){var Z=r.readUshort(g,a);for(a+=2,l.instr=[],I=0;I<Z;I++)l.instr.push(g[a]),a++}}return l},e.GPOS={},e.GPOS.parse=function(s,o,r,g){return e._lctf.parse(s,o,r,g,e.GPOS.subt)},e.GPOS.subt=function(s,o,r,g){var a=e._bin,l=r,I={};if(I.fmt=a.readUshort(s,r),r+=2,o==1||o==2||o==3||o==7||o==8&&I.fmt<=2){var C=a.readUshort(s,r);r+=2,I.coverage=e._lctf.readCoverage(s,C+l)}if(o==1&&I.fmt==1){var u=a.readUshort(s,r);r+=2;var A=e._lctf.numOfOnes(u);u!=0&&(I.pos=e.GPOS.readValueRecord(s,r,u))}else if(o==2&&I.fmt>=1&&I.fmt<=2){u=a.readUshort(s,r),r+=2;var h=a.readUshort(s,r);r+=2,A=e._lctf.numOfOnes(u);var m=e._lctf.numOfOnes(h);if(I.fmt==1){I.pairsets=[];var b=a.readUshort(s,r);r+=2;for(var G=0;G<b;G++){var f=l+a.readUshort(s,r);r+=2;var y=a.readUshort(s,f);f+=2;for(var B=[],v=0;v<y;v++){var W=a.readUshort(s,f);f+=2,u!=0&&(E=e.GPOS.readValueRecord(s,f,u),f+=2*A),h!=0&&(L=e.GPOS.readValueRecord(s,f,h),f+=2*m),B.push({gid2:W,val1:E,val2:L})}I.pairsets.push(B)}}if(I.fmt==2){var R=a.readUshort(s,r);r+=2;var Z=a.readUshort(s,r);r+=2;var V=a.readUshort(s,r);r+=2;var H=a.readUshort(s,r);for(r+=2,I.classDef1=e._lctf.readClassDef(s,l+R),I.classDef2=e._lctf.readClassDef(s,l+Z),I.matrix=[],G=0;G<V;G++){var P=[];for(v=0;v<H;v++){var E=null,L=null;u!=0&&(E=e.GPOS.readValueRecord(s,r,u),r+=2*A),h!=0&&(L=e.GPOS.readValueRecord(s,r,h),r+=2*m),P.push({val1:E,val2:L})}I.matrix.push(P)}}}else{if(o==9&&I.fmt==1){var K=a.readUshort(s,r);r+=2;var O=a.readUint(s,r);if(r+=4,g.ltype==9)g.ltype=K;else if(g.ltype!=K)throw"invalid extension substitution";return e.GPOS.subt(s,g.ltype,l+O)}console.debug("unsupported GPOS table LookupType",o,"format",I.fmt)}return I},e.GPOS.readValueRecord=function(s,o,r){var g=e._bin,a=[];return a.push(1&r?g.readShort(s,o):0),o+=1&r?2:0,a.push(2&r?g.readShort(s,o):0),o+=2&r?2:0,a.push(4&r?g.readShort(s,o):0),o+=4&r?2:0,a.push(8&r?g.readShort(s,o):0),o+=8&r?2:0,a},e.GSUB={},e.GSUB.parse=function(s,o,r,g){return e._lctf.parse(s,o,r,g,e.GSUB.subt)},e.GSUB.subt=function(s,o,r,g){var a=e._bin,l=r,I={};if(I.fmt=a.readUshort(s,r),r+=2,o!=1&&o!=4&&o!=5&&o!=6)return null;if(o==1||o==4||o==5&&I.fmt<=2||o==6&&I.fmt<=2){var C=a.readUshort(s,r);r+=2,I.coverage=e._lctf.readCoverage(s,l+C)}if(o==1&&I.fmt>=1&&I.fmt<=2){if(I.fmt==1)I.delta=a.readShort(s,r),r+=2;else if(I.fmt==2){var u=a.readUshort(s,r);r+=2,I.newg=a.readUshorts(s,r,u),r+=2*I.newg.length}}else if(o==4){I.vals=[],u=a.readUshort(s,r),r+=2;for(var A=0;A<u;A++){var h=a.readUshort(s,r);r+=2,I.vals.push(e.GSUB.readLigatureSet(s,l+h))}}else if(o==5&&I.fmt==2){if(I.fmt==2){var m=a.readUshort(s,r);r+=2,I.cDef=e._lctf.readClassDef(s,l+m),I.scset=[];var b=a.readUshort(s,r);for(r+=2,A=0;A<b;A++){var G=a.readUshort(s,r);r+=2,I.scset.push(G==0?null:e.GSUB.readSubClassSet(s,l+G))}}}else if(o==6&&I.fmt==3){if(I.fmt==3){for(A=0;A<3;A++){u=a.readUshort(s,r),r+=2;for(var f=[],y=0;y<u;y++)f.push(e._lctf.readCoverage(s,l+a.readUshort(s,r+2*y)));r+=2*u,A==0&&(I.backCvg=f),A==1&&(I.inptCvg=f),A==2&&(I.ahedCvg=f)}u=a.readUshort(s,r),r+=2,I.lookupRec=e.GSUB.readSubstLookupRecords(s,r,u)}}else{if(o==7&&I.fmt==1){var B=a.readUshort(s,r);r+=2;var v=a.readUint(s,r);if(r+=4,g.ltype==9)g.ltype=B;else if(g.ltype!=B)throw"invalid extension substitution";return e.GSUB.subt(s,g.ltype,l+v)}console.debug("unsupported GSUB table LookupType",o,"format",I.fmt)}return I},e.GSUB.readSubClassSet=function(s,o){var r=e._bin.readUshort,g=o,a=[],l=r(s,o);o+=2;for(var I=0;I<l;I++){var C=r(s,o);o+=2,a.push(e.GSUB.readSubClassRule(s,g+C))}return a},e.GSUB.readSubClassRule=function(s,o){var r=e._bin.readUshort,g={},a=r(s,o),l=r(s,o+=2);o+=2,g.input=[];for(var I=0;I<a-1;I++)g.input.push(r(s,o)),o+=2;return g.substLookupRecords=e.GSUB.readSubstLookupRecords(s,o,l),g},e.GSUB.readSubstLookupRecords=function(s,o,r){for(var g=e._bin.readUshort,a=[],l=0;l<r;l++)a.push(g(s,o),g(s,o+2)),o+=4;return a},e.GSUB.readChainSubClassSet=function(s,o){var r=e._bin,g=o,a=[],l=r.readUshort(s,o);o+=2;for(var I=0;I<l;I++){var C=r.readUshort(s,o);o+=2,a.push(e.GSUB.readChainSubClassRule(s,g+C))}return a},e.GSUB.readChainSubClassRule=function(s,o){for(var r=e._bin,g={},a=["backtrack","input","lookahead"],l=0;l<a.length;l++){var I=r.readUshort(s,o);o+=2,l==1&&I--,g[a[l]]=r.readUshorts(s,o,I),o+=2*g[a[l]].length}return I=r.readUshort(s,o),o+=2,g.subst=r.readUshorts(s,o,2*I),o+=2*g.subst.length,g},e.GSUB.readLigatureSet=function(s,o){var r=e._bin,g=o,a=[],l=r.readUshort(s,o);o+=2;for(var I=0;I<l;I++){var C=r.readUshort(s,o);o+=2,a.push(e.GSUB.readLigature(s,g+C))}return a},e.GSUB.readLigature=function(s,o){var r=e._bin,g={chain:[]};g.nglyph=r.readUshort(s,o),o+=2;var a=r.readUshort(s,o);o+=2;for(var l=0;l<a-1;l++)g.chain.push(r.readUshort(s,o)),o+=2;return g},e.head={},e.head.parse=function(s,o,r){var g=e._bin,a={};return g.readFixed(s,o),o+=4,a.fontRevision=g.readFixed(s,o),o+=4,g.readUint(s,o),o+=4,g.readUint(s,o),o+=4,a.flags=g.readUshort(s,o),o+=2,a.unitsPerEm=g.readUshort(s,o),o+=2,a.created=g.readUint64(s,o),o+=8,a.modified=g.readUint64(s,o),o+=8,a.xMin=g.readShort(s,o),o+=2,a.yMin=g.readShort(s,o),o+=2,a.xMax=g.readShort(s,o),o+=2,a.yMax=g.readShort(s,o),o+=2,a.macStyle=g.readUshort(s,o),o+=2,a.lowestRecPPEM=g.readUshort(s,o),o+=2,a.fontDirectionHint=g.readShort(s,o),o+=2,a.indexToLocFormat=g.readShort(s,o),o+=2,a.glyphDataFormat=g.readShort(s,o),o+=2,a},e.hhea={},e.hhea.parse=function(s,o,r){var g=e._bin,a={};return g.readFixed(s,o),o+=4,a.ascender=g.readShort(s,o),o+=2,a.descender=g.readShort(s,o),o+=2,a.lineGap=g.readShort(s,o),o+=2,a.advanceWidthMax=g.readUshort(s,o),o+=2,a.minLeftSideBearing=g.readShort(s,o),o+=2,a.minRightSideBearing=g.readShort(s,o),o+=2,a.xMaxExtent=g.readShort(s,o),o+=2,a.caretSlopeRise=g.readShort(s,o),o+=2,a.caretSlopeRun=g.readShort(s,o),o+=2,a.caretOffset=g.readShort(s,o),o+=2,o+=8,a.metricDataFormat=g.readShort(s,o),o+=2,a.numberOfHMetrics=g.readUshort(s,o),o+=2,a},e.hmtx={},e.hmtx.parse=function(s,o,r,g){for(var a=e._bin,l={aWidth:[],lsBearing:[]},I=0,C=0,u=0;u<g.maxp.numGlyphs;u++)u<g.hhea.numberOfHMetrics&&(I=a.readUshort(s,o),o+=2,C=a.readShort(s,o),o+=2),l.aWidth.push(I),l.lsBearing.push(C);return l},e.kern={},e.kern.parse=function(s,o,r,g){var a=e._bin,l=a.readUshort(s,o);if(o+=2,l==1)return e.kern.parseV1(s,o-2,r,g);var I=a.readUshort(s,o);o+=2;for(var C={glyph1:[],rval:[]},u=0;u<I;u++){o+=2,r=a.readUshort(s,o),o+=2;var A=a.readUshort(s,o);o+=2;var h=A>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;o=e.kern.readFormat0(s,o,C)}return C},e.kern.parseV1=function(s,o,r,g){var a=e._bin;a.readFixed(s,o),o+=4;var l=a.readUint(s,o);o+=4;for(var I={glyph1:[],rval:[]},C=0;C<l;C++){a.readUint(s,o),o+=4;var u=a.readUshort(s,o);o+=2,a.readUshort(s,o),o+=2;var A=u>>>8;if((A&=15)!=0)throw"unknown kern table format: "+A;o=e.kern.readFormat0(s,o,I)}return I},e.kern.readFormat0=function(s,o,r){var g=e._bin,a=-1,l=g.readUshort(s,o);o+=2,g.readUshort(s,o),o+=2,g.readUshort(s,o),o+=2,g.readUshort(s,o),o+=2;for(var I=0;I<l;I++){var C=g.readUshort(s,o);o+=2;var u=g.readUshort(s,o);o+=2;var A=g.readShort(s,o);o+=2,C!=a&&(r.glyph1.push(C),r.rval.push({glyph2:[],vals:[]}));var h=r.rval[r.rval.length-1];h.glyph2.push(u),h.vals.push(A),a=C}return o},e.loca={},e.loca.parse=function(s,o,r,g){var a=e._bin,l=[],I=g.head.indexToLocFormat,C=g.maxp.numGlyphs+1;if(I==0)for(var u=0;u<C;u++)l.push(a.readUshort(s,o+(u<<1))<<1);if(I==1)for(u=0;u<C;u++)l.push(a.readUint(s,o+(u<<2)));return l},e.maxp={},e.maxp.parse=function(s,o,r){var g=e._bin,a={},l=g.readUint(s,o);return o+=4,a.numGlyphs=g.readUshort(s,o),o+=2,l==65536&&(a.maxPoints=g.readUshort(s,o),o+=2,a.maxContours=g.readUshort(s,o),o+=2,a.maxCompositePoints=g.readUshort(s,o),o+=2,a.maxCompositeContours=g.readUshort(s,o),o+=2,a.maxZones=g.readUshort(s,o),o+=2,a.maxTwilightPoints=g.readUshort(s,o),o+=2,a.maxStorage=g.readUshort(s,o),o+=2,a.maxFunctionDefs=g.readUshort(s,o),o+=2,a.maxInstructionDefs=g.readUshort(s,o),o+=2,a.maxStackElements=g.readUshort(s,o),o+=2,a.maxSizeOfInstructions=g.readUshort(s,o),o+=2,a.maxComponentElements=g.readUshort(s,o),o+=2,a.maxComponentDepth=g.readUshort(s,o),o+=2),a},e.name={},e.name.parse=function(s,o,r){var g=e._bin,a={};g.readUshort(s,o),o+=2;var l=g.readUshort(s,o);o+=2,g.readUshort(s,o);for(var I,C=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],u=o+=2,A=0;A<l;A++){var h=g.readUshort(s,o);o+=2;var m=g.readUshort(s,o);o+=2;var b=g.readUshort(s,o);o+=2;var G=g.readUshort(s,o);o+=2;var f=g.readUshort(s,o);o+=2;var y=g.readUshort(s,o);o+=2;var B,v=C[G],W=u+12*l+y;if(h==0)B=g.readUnicode(s,W,f/2);else if(h==3&&m==0)B=g.readUnicode(s,W,f/2);else if(m==0)B=g.readASCII(s,W,f);else if(m==1)B=g.readUnicode(s,W,f/2);else if(m==3)B=g.readUnicode(s,W,f/2);else{if(h!=1)throw"unknown encoding "+m+", platformID: "+h;B=g.readASCII(s,W,f),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var R="p"+h+","+b.toString(16);a[R]==null&&(a[R]={}),a[R][v!==void 0?v:G]=B,a[R]._lang=b}for(var Z in a)if(a[Z].postScriptName!=null&&a[Z]._lang==1033)return a[Z];for(var Z in a)if(a[Z].postScriptName!=null&&a[Z]._lang==0)return a[Z];for(var Z in a)if(a[Z].postScriptName!=null&&a[Z]._lang==3084)return a[Z];for(var Z in a)if(a[Z].postScriptName!=null)return a[Z];for(var Z in a){I=Z;break}return console.debug("returning name table with languageID "+a[I]._lang),a[I]},e["OS/2"]={},e["OS/2"].parse=function(s,o,r){var g=e._bin.readUshort(s,o);o+=2;var a={};if(g==0)e["OS/2"].version0(s,o,a);else if(g==1)e["OS/2"].version1(s,o,a);else if(g==2||g==3||g==4)e["OS/2"].version2(s,o,a);else{if(g!=5)throw"unknown OS/2 table version: "+g;e["OS/2"].version5(s,o,a)}return a},e["OS/2"].version0=function(s,o,r){var g=e._bin;return r.xAvgCharWidth=g.readShort(s,o),o+=2,r.usWeightClass=g.readUshort(s,o),o+=2,r.usWidthClass=g.readUshort(s,o),o+=2,r.fsType=g.readUshort(s,o),o+=2,r.ySubscriptXSize=g.readShort(s,o),o+=2,r.ySubscriptYSize=g.readShort(s,o),o+=2,r.ySubscriptXOffset=g.readShort(s,o),o+=2,r.ySubscriptYOffset=g.readShort(s,o),o+=2,r.ySuperscriptXSize=g.readShort(s,o),o+=2,r.ySuperscriptYSize=g.readShort(s,o),o+=2,r.ySuperscriptXOffset=g.readShort(s,o),o+=2,r.ySuperscriptYOffset=g.readShort(s,o),o+=2,r.yStrikeoutSize=g.readShort(s,o),o+=2,r.yStrikeoutPosition=g.readShort(s,o),o+=2,r.sFamilyClass=g.readShort(s,o),o+=2,r.panose=g.readBytes(s,o,10),o+=10,r.ulUnicodeRange1=g.readUint(s,o),o+=4,r.ulUnicodeRange2=g.readUint(s,o),o+=4,r.ulUnicodeRange3=g.readUint(s,o),o+=4,r.ulUnicodeRange4=g.readUint(s,o),o+=4,r.achVendID=[g.readInt8(s,o),g.readInt8(s,o+1),g.readInt8(s,o+2),g.readInt8(s,o+3)],o+=4,r.fsSelection=g.readUshort(s,o),o+=2,r.usFirstCharIndex=g.readUshort(s,o),o+=2,r.usLastCharIndex=g.readUshort(s,o),o+=2,r.sTypoAscender=g.readShort(s,o),o+=2,r.sTypoDescender=g.readShort(s,o),o+=2,r.sTypoLineGap=g.readShort(s,o),o+=2,r.usWinAscent=g.readUshort(s,o),o+=2,r.usWinDescent=g.readUshort(s,o),o+=2},e["OS/2"].version1=function(s,o,r){var g=e._bin;return o=e["OS/2"].version0(s,o,r),r.ulCodePageRange1=g.readUint(s,o),o+=4,r.ulCodePageRange2=g.readUint(s,o),o+=4},e["OS/2"].version2=function(s,o,r){var g=e._bin;return o=e["OS/2"].version1(s,o,r),r.sxHeight=g.readShort(s,o),o+=2,r.sCapHeight=g.readShort(s,o),o+=2,r.usDefault=g.readUshort(s,o),o+=2,r.usBreak=g.readUshort(s,o),o+=2,r.usMaxContext=g.readUshort(s,o),o+=2},e["OS/2"].version5=function(s,o,r){var g=e._bin;return o=e["OS/2"].version2(s,o,r),r.usLowerOpticalPointSize=g.readUshort(s,o),o+=2,r.usUpperOpticalPointSize=g.readUshort(s,o),o+=2},e.post={},e.post.parse=function(s,o,r){var g=e._bin,a={};return a.version=g.readFixed(s,o),o+=4,a.italicAngle=g.readFixed(s,o),o+=4,a.underlinePosition=g.readShort(s,o),o+=2,a.underlineThickness=g.readShort(s,o),o+=2,a},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(s,o){var r=s.cmap,g=-1;if(r.p0e4!=null?g=r.p0e4:r.p3e1!=null?g=r.p3e1:r.p1e0!=null?g=r.p1e0:r.p0e3!=null&&(g=r.p0e3),g==-1)throw"no familiar platform and encoding!";var a=r.tables[g];if(a.format==0)return o>=a.map.length?0:a.map[o];if(a.format==4){for(var l=-1,I=0;I<a.endCount.length;I++)if(o<=a.endCount[I]){l=I;break}return l==-1||a.startCount[l]>o?0:65535&(a.idRangeOffset[l]!=0?a.glyphIdArray[o-a.startCount[l]+(a.idRangeOffset[l]>>1)-(a.idRangeOffset.length-l)]:o+a.idDelta[l])}if(a.format==12){if(o>a.groups[a.groups.length-1][1])return 0;for(I=0;I<a.groups.length;I++){var C=a.groups[I];if(C[0]<=o&&o<=C[1])return C[2]+(o-C[0])}return 0}throw"unknown cmap table format "+a.format},e.U.glyphToPath=function(s,o){var r={cmds:[],crds:[]};if(s.SVG&&s.SVG.entries[o]){var g=s.SVG.entries[o];return g==null?r:(typeof g=="string"&&(g=e.SVG.toPath(g),s.SVG.entries[o]=g),g)}if(s.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:s.CFF.Private?s.CFF.Private.defaultWidthX:0,open:!1},l=s.CFF,I=s.CFF.Private;if(l.ROS){for(var C=0;l.FDSelect[C+2]<=o;)C+=2;I=l.FDArray[l.FDSelect[C+1]].Private}e.U._drawCFF(s.CFF.CharStrings[o],a,l,I,r)}else s.glyf&&e.U._drawGlyf(o,s,r);return r},e.U._drawGlyf=function(s,o,r){var g=o.glyf[s];g==null&&(g=o.glyf[s]=e.glyf._parseGlyf(o,s)),g!=null&&(g.noc>-1?e.U._simpleGlyph(g,r):e.U._compoGlyph(g,o,r))},e.U._simpleGlyph=function(s,o){for(var r=0;r<s.noc;r++){for(var g=r==0?0:s.endPts[r-1]+1,a=s.endPts[r],l=g;l<=a;l++){var I=l==g?a:l-1,C=l==a?g:l+1,u=1&s.flags[l],A=1&s.flags[I],h=1&s.flags[C],m=s.xs[l],b=s.ys[l];if(l==g)if(u){if(!A){e.U.P.moveTo(o,m,b);continue}e.U.P.moveTo(o,s.xs[I],s.ys[I])}else A?e.U.P.moveTo(o,s.xs[I],s.ys[I]):e.U.P.moveTo(o,(s.xs[I]+m)/2,(s.ys[I]+b)/2);u?A&&e.U.P.lineTo(o,m,b):h?e.U.P.qcurveTo(o,m,b,s.xs[C],s.ys[C]):e.U.P.qcurveTo(o,m,b,(m+s.xs[C])/2,(b+s.ys[C])/2)}e.U.P.closePath(o)}},e.U._compoGlyph=function(s,o,r){for(var g=0;g<s.parts.length;g++){var a={cmds:[],crds:[]},l=s.parts[g];e.U._drawGlyf(l.glyphIndex,o,a);for(var I=l.m,C=0;C<a.crds.length;C+=2){var u=a.crds[C],A=a.crds[C+1];r.crds.push(u*I.a+A*I.b+I.tx),r.crds.push(u*I.c+A*I.d+I.ty)}for(C=0;C<a.cmds.length;C++)r.cmds.push(a.cmds[C])}},e.U._getGlyphClass=function(s,o){var r=e._lctf.getInterval(o,s);return r==-1?0:o[r+2]},e.U.getPairAdjustment=function(s,o,r){var g=0,a=!1;if(s.GPOS)for(var l=s.GPOS,I=l.lookupList,C=l.featureList,u=[],A=0;A<C.length;A++){var h=C[A];if(h.tag=="kern"){a=!0;for(var m=0;m<h.tab.length;m++)if(!u[h.tab[m]]){u[h.tab[m]]=!0;for(var b=I[h.tab[m]],G=0;G<b.tabs.length;G++)if(b.tabs[G]!=null){var f,y=b.tabs[G];if((!y.coverage||(f=e._lctf.coverageIndex(y.coverage,o))!=-1)&&b.ltype!=1){if(b.ltype==2){var B;if(y.fmt==1){var v=y.pairsets[f];for(A=0;A<v.length;A++)v[A].gid2==r&&(B=v[A])}else if(y.fmt==2){var W=e.U._getGlyphClass(o,y.classDef1),R=e.U._getGlyphClass(r,y.classDef2);B=y.matrix[W][R]}B&&B.val1&&B.val1[2]&&(g+=B.val1[2]),B&&B.val2&&B.val2[0]&&(g+=B.val2[0])}}}}}}if(s.kern&&!a){var Z=s.kern.glyph1.indexOf(o);if(Z!=-1){var V=s.kern.rval[Z].glyph2.indexOf(r);V!=-1&&(g+=s.kern.rval[Z].vals[V])}}return g},e.U._applySubs=function(s,o,r,g){for(var a=s.length-o-1,l=0;l<r.tabs.length;l++)if(r.tabs[l]!=null){var I,C=r.tabs[l];if(!C.coverage||(I=e._lctf.coverageIndex(C.coverage,s[o]))!=-1){if(r.ltype==1)s[o],C.fmt==1?s[o]=s[o]+C.delta:s[o]=C.newg[I];else if(r.ltype==4)for(var u=C.vals[I],A=0;A<u.length;A++){var h=u[A],m=h.chain.length;if(!(m>a)){for(var b=!0,G=0,f=0;f<m;f++){for(;s[o+G+(1+f)]==-1;)G++;h.chain[f]!=s[o+G+(1+f)]&&(b=!1)}if(b){for(s[o]=h.nglyph,f=0;f<m+G;f++)s[o+f+1]=-1;break}}}else if(r.ltype==5&&C.fmt==2)for(var y=e._lctf.getInterval(C.cDef,s[o]),B=C.cDef[y+2],v=C.scset[B],W=0;W<v.length;W++){var R=v[W],Z=R.input;if(!(Z.length>a)){for(b=!0,f=0;f<Z.length;f++){var V=e._lctf.getInterval(C.cDef,s[o+1+f]);if(y==-1&&C.cDef[V+2]!=Z[f]){b=!1;break}}if(b){var H=R.substLookupRecords;for(A=0;A<H.length;A+=2)H[A],H[A+1]}}}else if(r.ltype==6&&C.fmt==3){if(!e.U._glsCovered(s,C.backCvg,o-C.backCvg.length)||!e.U._glsCovered(s,C.inptCvg,o)||!e.U._glsCovered(s,C.ahedCvg,o+C.inptCvg.length))continue;var P=C.lookupRec;for(W=0;W<P.length;W+=2){y=P[W];var E=g[P[W+1]];e.U._applySubs(s,o+y,E,g)}}}}},e.U._glsCovered=function(s,o,r){for(var g=0;g<o.length;g++)if(e._lctf.coverageIndex(o[g],s[r+g])==-1)return!1;return!0},e.U.glyphsToPath=function(s,o,r){for(var g={cmds:[],crds:[]},a=0,l=0;l<o.length;l++){var I=o[l];if(I!=-1){for(var C=l<o.length-1&&o[l+1]!=-1?o[l+1]:0,u=e.U.glyphToPath(s,I),A=0;A<u.crds.length;A+=2)g.crds.push(u.crds[A]+a),g.crds.push(u.crds[A+1]);for(r&&g.cmds.push(r),A=0;A<u.cmds.length;A++)g.cmds.push(u.cmds[A]);r&&g.cmds.push("X"),a+=s.hmtx.aWidth[I],l<o.length-1&&(a+=e.U.getPairAdjustment(s,I,C))}}return g},e.U.P={},e.U.P.moveTo=function(s,o,r){s.cmds.push("M"),s.crds.push(o,r)},e.U.P.lineTo=function(s,o,r){s.cmds.push("L"),s.crds.push(o,r)},e.U.P.curveTo=function(s,o,r,g,a,l,I){s.cmds.push("C"),s.crds.push(o,r,g,a,l,I)},e.U.P.qcurveTo=function(s,o,r,g,a){s.cmds.push("Q"),s.crds.push(o,r,g,a)},e.U.P.closePath=function(s){s.cmds.push("Z")},e.U._drawCFF=function(s,o,r,g,a){for(var l=o.stack,I=o.nStems,C=o.haveWidth,u=o.width,A=o.open,h=0,m=o.x,b=o.y,G=0,f=0,y=0,B=0,v=0,W=0,R=0,Z=0,V=0,H=0,P={val:0,size:0};h<s.length;){e.CFF.getCharString(s,h,P);var E=P.val;if(h+=P.size,E=="o1"||E=="o18")l.length%2!=0&&!C&&(u=l.shift()+g.nominalWidthX),I+=l.length>>1,l.length=0,C=!0;else if(E=="o3"||E=="o23")l.length%2!=0&&!C&&(u=l.shift()+g.nominalWidthX),I+=l.length>>1,l.length=0,C=!0;else if(E=="o4")l.length>1&&!C&&(u=l.shift()+g.nominalWidthX,C=!0),A&&e.U.P.closePath(a),b+=l.pop(),e.U.P.moveTo(a,m,b),A=!0;else if(E=="o5")for(;l.length>0;)m+=l.shift(),b+=l.shift(),e.U.P.lineTo(a,m,b);else if(E=="o6"||E=="o7")for(var L=l.length,K=E=="o6",O=0;O<L;O++){var q=l.shift();K?m+=q:b+=q,K=!K,e.U.P.lineTo(a,m,b)}else if(E=="o8"||E=="o24"){L=l.length;for(var ne=0;ne+6<=L;)G=m+l.shift(),f=b+l.shift(),y=G+l.shift(),B=f+l.shift(),m=y+l.shift(),b=B+l.shift(),e.U.P.curveTo(a,G,f,y,B,m,b),ne+=6;E=="o24"&&(m+=l.shift(),b+=l.shift(),e.U.P.lineTo(a,m,b))}else{if(E=="o11")break;if(E=="o1234"||E=="o1235"||E=="o1236"||E=="o1237")E=="o1234"&&(f=b,y=(G=m+l.shift())+l.shift(),H=B=f+l.shift(),W=B,Z=b,m=(R=(v=(V=y+l.shift())+l.shift())+l.shift())+l.shift(),e.U.P.curveTo(a,G,f,y,B,V,H),e.U.P.curveTo(a,v,W,R,Z,m,b)),E=="o1235"&&(G=m+l.shift(),f=b+l.shift(),y=G+l.shift(),B=f+l.shift(),V=y+l.shift(),H=B+l.shift(),v=V+l.shift(),W=H+l.shift(),R=v+l.shift(),Z=W+l.shift(),m=R+l.shift(),b=Z+l.shift(),l.shift(),e.U.P.curveTo(a,G,f,y,B,V,H),e.U.P.curveTo(a,v,W,R,Z,m,b)),E=="o1236"&&(G=m+l.shift(),f=b+l.shift(),y=G+l.shift(),H=B=f+l.shift(),W=B,R=(v=(V=y+l.shift())+l.shift())+l.shift(),Z=W+l.shift(),m=R+l.shift(),e.U.P.curveTo(a,G,f,y,B,V,H),e.U.P.curveTo(a,v,W,R,Z,m,b)),E=="o1237"&&(G=m+l.shift(),f=b+l.shift(),y=G+l.shift(),B=f+l.shift(),V=y+l.shift(),H=B+l.shift(),v=V+l.shift(),W=H+l.shift(),R=v+l.shift(),Z=W+l.shift(),Math.abs(R-m)>Math.abs(Z-b)?m=R+l.shift():b=Z+l.shift(),e.U.P.curveTo(a,G,f,y,B,V,H),e.U.P.curveTo(a,v,W,R,Z,m,b));else if(E=="o14"){if(l.length>0&&!C&&(u=l.shift()+r.nominalWidthX,C=!0),l.length==4){var k=l.shift(),F=l.shift(),z=l.shift(),X=l.shift(),T=e.CFF.glyphBySE(r,z),Q=e.CFF.glyphBySE(r,X);e.U._drawCFF(r.CharStrings[T],o,r,g,a),o.x=k,o.y=F,e.U._drawCFF(r.CharStrings[Q],o,r,g,a)}A&&(e.U.P.closePath(a),A=!1)}else if(E=="o19"||E=="o20")l.length%2!=0&&!C&&(u=l.shift()+g.nominalWidthX),I+=l.length>>1,l.length=0,C=!0,h+=I+7>>3;else if(E=="o21")l.length>2&&!C&&(u=l.shift()+g.nominalWidthX,C=!0),b+=l.pop(),m+=l.pop(),A&&e.U.P.closePath(a),e.U.P.moveTo(a,m,b),A=!0;else if(E=="o22")l.length>1&&!C&&(u=l.shift()+g.nominalWidthX,C=!0),m+=l.pop(),A&&e.U.P.closePath(a),e.U.P.moveTo(a,m,b),A=!0;else if(E=="o25"){for(;l.length>6;)m+=l.shift(),b+=l.shift(),e.U.P.lineTo(a,m,b);G=m+l.shift(),f=b+l.shift(),y=G+l.shift(),B=f+l.shift(),m=y+l.shift(),b=B+l.shift(),e.U.P.curveTo(a,G,f,y,B,m,b)}else if(E=="o26")for(l.length%2&&(m+=l.shift());l.length>0;)G=m,f=b+l.shift(),m=y=G+l.shift(),b=(B=f+l.shift())+l.shift(),e.U.P.curveTo(a,G,f,y,B,m,b);else if(E=="o27")for(l.length%2&&(b+=l.shift());l.length>0;)f=b,y=(G=m+l.shift())+l.shift(),B=f+l.shift(),m=y+l.shift(),b=B,e.U.P.curveTo(a,G,f,y,B,m,b);else if(E=="o10"||E=="o29"){var ee=E=="o10"?g:r;if(l.length==0)console.debug("error: empty stack");else{var oe=l.pop(),j=ee.Subrs[oe+ee.Bias];o.x=m,o.y=b,o.nStems=I,o.haveWidth=C,o.width=u,o.open=A,e.U._drawCFF(j,o,r,g,a),m=o.x,b=o.y,I=o.nStems,C=o.haveWidth,u=o.width,A=o.open}}else if(E=="o30"||E=="o31"){var ge=l.length,Ie=(ne=0,E=="o31");for(ne+=ge-(L=-3&ge);ne<L;)Ie?(f=b,y=(G=m+l.shift())+l.shift(),b=(B=f+l.shift())+l.shift(),L-ne==5?(m=y+l.shift(),ne++):m=y,Ie=!1):(G=m,f=b+l.shift(),y=G+l.shift(),B=f+l.shift(),m=y+l.shift(),L-ne==5?(b=B+l.shift(),ne++):b=B,Ie=!0),e.U.P.curveTo(a,G,f,y,B,m,b),ne+=4}else{if((E+"").charAt(0)=="o")throw console.debug("Unknown operation: "+E,s),E;l.push(E)}}}o.x=m,o.y=b,o.nStems=I,o.haveWidth=C,o.width=u,o.open=A};var t=e,n={Typr:t};return i.Typr=t,i.default=n,Object.defineProperty(i,"__esModule",{value:!0}),i}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function U5(){return function(i){var e=Uint8Array,t=Uint16Array,n=Uint32Array,s=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),r=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=function(E,L){for(var K=new t(31),O=0;O<31;++O)K[O]=L+=1<<E[O-1];var q=new n(K[30]);for(O=1;O<30;++O)for(var ne=K[O];ne<K[O+1];++ne)q[ne]=ne-K[O]<<5|O;return[K,q]},a=g(s,2),l=a[0],I=a[1];l[28]=258,I[258]=28;for(var C=g(o,0)[0],u=new t(32768),A=0;A<32768;++A){var h=(43690&A)>>>1|(21845&A)<<1;h=(61680&(h=(52428&h)>>>2|(13107&h)<<2))>>>4|(3855&h)<<4,u[A]=((65280&h)>>>8|(255&h)<<8)>>>1}var m=function(E,L,K){for(var O=E.length,q=0,ne=new t(L);q<O;++q)++ne[E[q]-1];var k,F=new t(L);for(q=0;q<L;++q)F[q]=F[q-1]+ne[q-1]<<1;if(K){k=new t(1<<L);var z=15-L;for(q=0;q<O;++q)if(E[q])for(var X=q<<4|E[q],T=L-E[q],Q=F[E[q]-1]++<<T,ee=Q|(1<<T)-1;Q<=ee;++Q)k[u[Q]>>>z]=X}else for(k=new t(O),q=0;q<O;++q)E[q]&&(k[q]=u[F[E[q]-1]++]>>>15-E[q]);return k},b=new e(288);for(A=0;A<144;++A)b[A]=8;for(A=144;A<256;++A)b[A]=9;for(A=256;A<280;++A)b[A]=7;for(A=280;A<288;++A)b[A]=8;var G=new e(32);for(A=0;A<32;++A)G[A]=5;var f=m(b,9,1),y=m(G,5,1),B=function(E){for(var L=E[0],K=1;K<E.length;++K)E[K]>L&&(L=E[K]);return L},v=function(E,L,K){var O=L/8|0;return(E[O]|E[O+1]<<8)>>(7&L)&K},W=function(E,L){var K=L/8|0;return(E[K]|E[K+1]<<8|E[K+2]<<16)>>(7&L)},R=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Z=function(E,L,K){var O=new Error(L||R[E]);if(O.code=E,Error.captureStackTrace&&Error.captureStackTrace(O,Z),!K)throw O;return O},V=function(E,L,K){var O=E.length;if(!O||K&&!K.l&&O<5)return L||new e(0);var q=!L||K,ne=!K||K.i;K||(K={}),L||(L=new e(3*O));var k,F=function(Ke){var $e=L.length;if(Ke>$e){var $=new e(Math.max(2*$e,Ke));$.set(L),L=$}},z=K.f||0,X=K.p||0,T=K.b||0,Q=K.l,ee=K.d,oe=K.m,j=K.n,ge=8*O;do{if(!Q){K.f=z=v(E,X,1);var Ie=v(E,X+1,3);if(X+=3,!Ie){var Be=E[(Le=((k=X)/8|0)+(7&k&&1)+4)-4]|E[Le-3]<<8,ve=Le+Be;if(ve>O){ne&&Z(0);break}q&&F(T+Be),L.set(E.subarray(Le,ve),T),K.b=T+=Be,K.p=X=8*ve;continue}if(Ie==1)Q=f,ee=y,oe=9,j=5;else if(Ie==2){var Ye=v(E,X,31)+257,se=v(E,X+10,15)+4,ue=Ye+v(E,X+5,31)+1;X+=14;for(var Ge=new e(ue),xe=new e(19),fe=0;fe<se;++fe)xe[r[fe]]=v(E,X+3*fe,7);X+=3*se;var Qe=B(xe),de=(1<<Qe)-1,Xe=m(xe,Qe,1);for(fe=0;fe<ue;){var Le,me=Xe[v(E,X,de)];if(X+=15&me,(Le=me>>>4)<16)Ge[fe++]=Le;else{var M=0,Y=0;for(Le==16?(Y=3+v(E,X,3),X+=2,M=Ge[fe-1]):Le==17?(Y=3+v(E,X,7),X+=3):Le==18&&(Y=11+v(E,X,127),X+=7);Y--;)Ge[fe++]=M}}var te=Ge.subarray(0,Ye),ce=Ge.subarray(Ye);oe=B(te),j=B(ce),Q=m(te,oe,1),ee=m(ce,j,1)}else Z(1);if(X>ge){ne&&Z(0);break}}q&&F(T+131072);for(var we=(1<<oe)-1,Re=(1<<j)-1,Ve=X;;Ve=X){var We=(M=Q[W(E,X)&we])>>>4;if((X+=15&M)>ge){ne&&Z(0);break}if(M||Z(2),We<256)L[T++]=We;else{if(We==256){Ve=X,Q=null;break}var he=We-254;if(We>264){var ze=s[fe=We-257];he=v(E,X,(1<<ze)-1)+l[fe],X+=ze}var Pe=ee[W(E,X)&Re],Te=Pe>>>4;if(Pe||Z(3),X+=15&Pe,ce=C[Te],Te>3&&(ze=o[Te],ce+=W(E,X)&(1<<ze)-1,X+=ze),X>ge){ne&&Z(0);break}q&&F(T+131072);for(var Fe=T+he;T<Fe;T+=4)L[T]=L[T-ce],L[T+1]=L[T+1-ce],L[T+2]=L[T+2-ce],L[T+3]=L[T+3-ce];T=Fe}}K.l=Q,K.p=Ve,K.b=T,Q&&(z=1,K.m=oe,K.d=ee,K.n=j)}while(!z);return T==L.length?L:function(Ke,$e,$){($e==null||$e<0)&&($e=0),($==null||$>Ke.length)&&($=Ke.length);var De=new(Ke instanceof t?t:Ke instanceof n?n:e)($-$e);return De.set(Ke.subarray($e,$)),De}(L,0,T)},H=new e(0),P=typeof TextDecoder<"u"&&new TextDecoder;try{P.decode(H,{stream:!0})}catch{}return i.convert_streams=function(E){var L=new DataView(E),K=0;function O(){var Ye=L.getUint16(K);return K+=2,Ye}function q(){var Ye=L.getUint32(K);return K+=4,Ye}function ne(Ye){Be.setUint16(ve,Ye),ve+=2}function k(Ye){Be.setUint32(ve,Ye),ve+=4}for(var F={signature:q(),flavor:q(),length:q(),numTables:O(),reserved:O(),totalSfntSize:q(),majorVersion:O(),minorVersion:O(),metaOffset:q(),metaLength:q(),metaOrigLength:q(),privOffset:q(),privLength:q()},z=0;Math.pow(2,z)<=F.numTables;)z++;z--;for(var X=16*Math.pow(2,z),T=16*F.numTables-X,Q=12,ee=[],oe=0;oe<F.numTables;oe++)ee.push({tag:q(),offset:q(),compLength:q(),origLength:q(),origChecksum:q()}),Q+=16;var j,ge=new Uint8Array(12+16*ee.length+ee.reduce(function(Ye,se){return Ye+se.origLength+4},0)),Ie=ge.buffer,Be=new DataView(Ie),ve=0;return k(F.flavor),ne(F.numTables),ne(X),ne(z),ne(T),ee.forEach(function(Ye){k(Ye.tag),k(Ye.origChecksum),k(Q),k(Ye.origLength),Ye.outOffset=Q,(Q+=Ye.origLength)%4!=0&&(Q+=4-Q%4)}),ee.forEach(function(Ye){var se,ue=E.slice(Ye.offset,Ye.offset+Ye.compLength);if(Ye.compLength!=Ye.origLength){var Ge=new Uint8Array(Ye.origLength);se=new Uint8Array(ue,2),V(se,Ge)}else Ge=new Uint8Array(ue);ge.set(Ge,Ye.outOffset);var xe=0;(Q=Ye.outOffset+Ye.origLength)%4!=0&&(xe=4-Q%4),ge.set(new Uint8Array(xe).buffer,Ye.outOffset+Ye.origLength),j=Q+xe}),Ie.slice(0,j)},Object.defineProperty(i,"__esModule",{value:!0}),i}({}).convert_streams}function D5(i,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},s=1,o=2,r=4,g=8,a=16,l=32;let I;function C(B){if(!I){const v={R:o,L:s,D:r,C:a,U:l,T:g};I=new Map;for(let W in n){let R=0;n[W].split(",").forEach(Z=>{let[V,H]=Z.split("+");V=parseInt(V,36),H=H?parseInt(H,36):0,I.set(R+=V,v[W]);for(let P=H;P--;)I.set(++R,v[W])})}}return I.get(B)||l}const u=1,A=2,h=3,m=4,b=[null,"isol","init","fina","medi"];function G(B){const v=new Uint8Array(B.length);let W=l,R=u,Z=-1;for(let V=0;V<B.length;V++){const H=B.codePointAt(V);let P=C(H)|0,E=u;P&g||(W&(s|r|a)?P&(o|r|a)?(E=h,(R===u||R===h)&&v[Z]++):P&(s|l)&&(R===A||R===m)&&v[Z]--:W&(o|l)&&(R===A||R===m)&&v[Z]--,R=v[V]=E,W=P,Z=V,H>65535&&V++)}return v}function f(B,v){const W=[];for(let Z=0;Z<v.length;Z++){const V=v.codePointAt(Z);V>65535&&Z++,W.push(i.U.codeToGlyph(B,V))}const R=B.GSUB;if(R){const{lookupList:Z,featureList:V}=R;let H;const P=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,E=[];V.forEach(L=>{if(P.test(L.tag))for(let K=0;K<L.tab.length;K++){if(E[L.tab[K]])continue;E[L.tab[K]]=!0;const O=Z[L.tab[K]],q=/^(isol|init|fina|medi)$/.test(L.tag);q&&!H&&(H=G(v));for(let ne=0;ne<W.length;ne++)(!H||!q||b[H[ne]]===L.tag)&&i.U._applySubs(W,ne,O,Z)}})}return W}function y(B){const v=Object.create(null),W={unitsPerEm:B.head.unitsPerEm,ascender:B.hhea.ascender,descender:B.hhea.descender,forEachGlyph(R,Z,V,H){let P=0;const E=1/W.unitsPerEm*Z,L=f(B,R);let K=0,O=-1;return L.forEach((q,ne)=>{if(q!==-1){let k=v[q];if(!k){const{cmds:F,crds:z}=i.U.glyphToPath(B,q);let X="",T=0;for(let ge=0,Ie=F.length;ge<Ie;ge++){const Be=t[F[ge]];X+=F[ge];for(let ve=1;ve<=Be;ve++)X+=(ve>1?",":"")+z[T++]}let Q,ee,oe,j;if(z.length){Q=ee=1/0,oe=j=-1/0;for(let ge=0,Ie=z.length;ge<Ie;ge+=2){let Be=z[ge],ve=z[ge+1];Be<Q&&(Q=Be),ve<ee&&(ee=ve),Be>oe&&(oe=Be),ve>j&&(j=ve)}}else Q=oe=ee=j=0;k=v[q]={index:q,advanceWidth:B.hmtx.aWidth[q],xMin:Q,yMin:ee,xMax:oe,yMax:j,path:X,pathCommandCount:F.length}}O!==-1&&(P+=i.U.getPairAdjustment(B,O,q)*E),H.call(null,k,P,K),k.advanceWidth&&(P+=k.advanceWidth*E),V&&(P+=V*Z),O=q}K+=R.codePointAt(K)>65535?2:1}),P}};return W}return function(v){const W=new Uint8Array(v,0,4),R=i._bin.readASCII(W,0,4);if(R==="wOFF")v=e(v);else if(R==="wOF2")throw new Error("woff2 fonts not supported");return y(i.parse(v)[0])}}const P5=cI({name:"Typr Font Parser",dependencies:[J5,U5,D5],init(i,e,t){const n=i(),s=e();return t(n,s)}}),Wl={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Q5=new Ee;function Il(){return(self.performance||Date).now()}const SZ=Object.create(null);function SR(i,e){i=q5({},i);const t=Il();if(i.font=$5(i.font||Wl.defaultFontURL),i.text=""+i.text,i.sdfGlyphSize=i.sdfGlyphSize||Wl.sdfGlyphSize,i.colorRanges!=null){let C={};for(let u in i.colorRanges)if(i.colorRanges.hasOwnProperty(u)){let A=i.colorRanges[u];typeof A!="number"&&(A=Q5.set(A).getHex()),C[u]=A}i.colorRanges=C}Object.freeze(i);const{textureWidth:n,sdfExponent:s}=Wl,{sdfGlyphSize:o}=i,r=n/o*4;let g=SZ[o];if(!g){const C=document.createElement("canvas");C.width=n,C.height=o*256/r,g=SZ[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:C,sdfTexture:new Cn(C,void 0,void 0,void 0,en,en),contextLost:!1,glyphsByFont:new Map},g.sdfTexture.generateMipmaps=!1,O5(g)}const{sdfTexture:a,sdfCanvas:l}=g;let I=g.glyphsByFont.get(i.font);I||g.glyphsByFont.set(i.font,I=new Map),tL(i).then(C=>{const{glyphIds:u,glyphPositions:A,fontSize:h,unitsPerEm:m,timings:b}=C,G=[],f=new Float32Array(u.length*4),y=h/m;let B=0,v=0;const W=Il();u.forEach((P,E)=>{let L=I.get(P);if(!L){const{path:ne,pathBounds:k}=C.glyphData[P],F=Math.max(k[2]-k[0],k[3]-k[1])/o*(Wl.sdfMargin*o+.5),z=g.glyphCount++,X=[k[0]-F,k[1]-F,k[2]+F,k[3]+F];I.set(P,L={path:ne,atlasIndex:z,sdfViewBox:X}),G.push(L)}const{sdfViewBox:K}=L,O=A[v++],q=A[v++];f[B++]=O+K[0]*y,f[B++]=q+K[1]*y,f[B++]=O+K[2]*y,f[B++]=q+K[3]*y,u[E]=L.atlasIndex}),b.quads=(b.quads||0)+(Il()-W);const R=Il();b.sdf={};const Z=l.height,V=Math.ceil(g.glyphCount/r),H=Math.pow(2,Math.ceil(Math.log2(V*o)));H>Z&&(console.info(`Increasing SDF texture size ${Z}->${H}`),_5(l,n,H),a.dispose()),Ir.all(G.map(P=>RR(P,g,i.gpuAccelerateSDF).then(({timing:E})=>{b.sdf[P.atlasIndex]=E}))).then(()=>{G.length&&!g.contextLost&&(VR(g),a.needsUpdate=!0),b.sdfTotal=Il()-R,b.total=Il()-t,e(Object.freeze({parameters:i,sdfTexture:a,sdfGlyphSize:o,sdfExponent:s,glyphBounds:f,glyphAtlasIndices:u,glyphColors:C.glyphColors,caretPositions:C.caretPositions,caretHeight:C.caretHeight,chunkedBounds:C.chunkedBounds,ascender:C.ascender,descender:C.descender,lineHeight:C.lineHeight,topBaseline:C.topBaseline,blockBounds:C.blockBounds,visibleBounds:C.visibleBounds,timings:C.timings,get totalBounds(){return console.log("totalBounds deprecated, use blockBounds instead"),C.blockBounds},get totalBlockSize(){console.log("totalBlockSize deprecated, use blockBounds instead");const[P,E,L,K]=C.blockBounds;return[L-P,K-E]}}))})}),Ir.all([]).then(()=>{g.contextLost||E5(l)})}function RR({path:i,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:s,contextLost:o},r){if(o)return Promise.resolve({timing:-1});const{textureWidth:g,sdfExponent:a}=Wl,l=Math.max(t[2]-t[0],t[3]-t[1]),I=Math.floor(e/4),C=I%(g/n)*n,u=Math.floor(I/(g/n))*n,A=e%4;return k5(n,n,i,t,l,a,s,C,u,A,r)}function O5(i){const e=i.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),i.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),i.contextLost=!1;const n=[];i.glyphsByFont.forEach(s=>{s.forEach(o=>{n.push(RR(o,i,!0))})}),Ir.all(n).then(()=>{VR(i),i.sdfTexture.needsUpdate=!0})})}function j5({font:i,characters:e,sdfGlyphSize:t},n){let s=Array.isArray(e)?e.join(`
`):""+e;SR({font:i,sdfGlyphSize:t,text:s},n)}function q5(i,e){for(let t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i}let vd;function $5(i){return vd||(vd=typeof document>"u"?{}:document.createElement("a")),vd.href=i,vd.href}function VR(i){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=i,{width:n,height:s}=e,o=i.sdfCanvas.getContext("webgl");let r=t.image.data;(!r||r.length!==n*s*4)&&(r=new Uint8Array(n*s*4),t.image={width:n,height:s,data:r},t.flipY=!1,t.isDataTexture=!0),o.readPixels(0,0,n,s,o.RGBA,o.UNSIGNED_BYTE,r)}}const eL=cI({name:"Typesetter",dependencies:[Wl,P5,z5,X5],init(i,e,t,n){const{defaultFontURL:s}=i;return t(e,n(),{defaultFontURL:s})}}),tL=cI({name:"Typesetter",dependencies:[eL,x5],init(i,e){return function(t){const n=new e;return i.typeset(t,n.resolve),n}},getTransferables(i){const e=[i.glyphPositions.buffer,i.glyphIds.buffer];return i.caretPositions&&e.push(i.caretPositions.buffer),i.glyphColors&&e.push(i.glyphColors.buffer),e}}),nL=(()=>{const i={};function e(a){let l=i[a];if(!l){const I=new XA(1,1,a,a),C=I.clone(),u=I.attributes,A=C.attributes,h=new bt,m=u.uv.count;for(let b=0;b<m;b++)A.position.array[b*3]*=-1,A.normal.array[b*3+2]*=-1;["position","normal","uv"].forEach(b=>{h.setAttribute(b,new tt([...u[b].array,...A[b].array],u[b].itemSize))}),h.setIndex([...I.index.array,...C.index.array.map(b=>b+m)]),h.translate(.5,.5,0),l=i[a]=h}return l}const t="aTroikaGlyphBounds",n="aTroikaGlyphIndex",s="aTroikaGlyphColor";class o extends iG{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ar,this.boundingBox=new dr}computeBoundingSphere(){}computeBoundingBox(){}setSide(l){const I=this.getIndex().count;this.setDrawRange(l===Vi?I/2:0,l===ms?I:I/2)}set detail(l){if(l!==this._detail){this._detail=l,(typeof l!="number"||l<1)&&(l=1);let I=e(l);["position","normal","uv"].forEach(C=>{this.attributes[C]=I.attributes[C].clone()}),this.setIndex(I.getIndex().clone())}}get detail(){return this._detail}set curveRadius(l){l!==this._curveRadius&&(this._curveRadius=l,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(l,I,C,u,A){r(this,t,l,4),r(this,n,I,1),r(this,s,A,3),this._blockBounds=C,this._chunkedBounds=u,g(this,I.length),this._updateBounds()}_updateBounds(){const l=this._blockBounds;if(l){const{curveRadius:I,boundingBox:C}=this;if(I){const{PI:u,floor:A,min:h,max:m,sin:b,cos:G}=Math,f=u/2,y=u*2,B=Math.abs(I),v=l[0]/B,W=l[2]/B,R=A((v+f)/y)!==A((W+f)/y)?-B:h(b(v)*B,b(W)*B),Z=A((v-f)/y)!==A((W-f)/y)?B:m(b(v)*B,b(W)*B),V=A((v+u)/y)!==A((W+u)/y)?B*2:m(B-G(v)*B,B-G(W)*B);C.min.set(R,l[1],I<0?-V:0),C.max.set(Z,l[3],I<0?0:V)}else C.min.set(l[0],l[1],0),C.max.set(l[2],l[3],0);C.getBoundingSphere(this.boundingSphere)}}applyClipRect(l){let I=this.getAttribute(n).count,C=this._chunkedBounds;if(C)for(let u=C.length;u--;){I=C[u].end;let A=C[u].rect;if(A[1]<l.w&&A[3]>l.y&&A[0]<l.z&&A[2]>l.x)break}g(this,I)}}o.prototype.setAttribute||(o.prototype.setAttribute=function(a,l){return this.attributes[a]=l,this});function r(a,l,I,C){const u=a.getAttribute(l);I?u&&u.array.length===I.length?(u.array.set(I),u.needsUpdate=!0):(a.setAttribute(l,new Za(I,C)),delete a._maxInstanceCount,a.dispose()):u&&a.deleteAttribute(l)}function g(a,l){a[a.hasOwnProperty("instanceCount")?"instanceCount":"maxInstancedCount"]=l}return o})(),iL=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,sL=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,oL=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,rL=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function gL(i){const e=m0(i,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Se},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Ht(0,0,0,0)},uTroikaClipRect:{value:new Ht(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Se},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new Ee},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Si},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:iL,vertexTransform:sL,fragmentDefs:oL,fragmentColorTransform:rL,customRewriter({vertexShader:t,fragmentShader:n}){let s=/\buniform\s+vec3\s+diffuse\b/;return s.test(n)&&(n=n.replace(s,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),s.test(t)||(t=t.replace(WR,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const aL=(()=>{const i=new Ji({color:16777215,side:ms,transparent:!0}),e=8421504,t=new dt,n=new N,s=new N,o=[],r=new N,g="+x+y";function a(G){return Array.isArray(G)?G[0]:G}let l=()=>{const G=new fn(new XA(1,1),i);return l=()=>G,G},I=()=>{const G=new fn(new XA(1,1,32,1),i);return I=()=>G,G};const C={type:"syncstart"},u={type:"synccomplete"},A=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],h=A.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class m extends fn{constructor(){const f=new nL;super(f,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=e,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=g,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(f){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(f):(this._isSyncing=!0,this.dispatchEvent(C),SR({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},y=>{this._isSyncing=!1,this._textRenderInfo=y,this.geometry.updateGlyphs(y.glyphBounds,y.glyphAtlasIndices,y.blockBounds,y.chunkedBounds,y.glyphColors);const B=this._queuedSyncs;B&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{B.forEach(v=>v&&v())})),this.dispatchEvent(u),f&&f()})))}onBeforeRender(f,y,B,v,W,R){this.sync(),W.isTroikaTextMaterial&&this._prepareForRender(W),W._hadOwnSide=W.hasOwnProperty("side"),this.geometry.setSide(W._actualSide=W.side),W.side=rr}onAfterRender(f,y,B,v,W,R){W._hadOwnSide?W.side=W._actualSide:delete W.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let f=this._derivedMaterial;const y=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=i.clone());if((!f||f.baseMaterial!==y)&&(f=this._derivedMaterial=gL(y),y.addEventListener("dispose",function B(){y.removeEventListener("dispose",B),f.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let B=f._outlineMtl;return B||(B=f._outlineMtl=Object.create(f,{id:{value:f.id+.1}}),B.isTextOutlineMaterial=!0,B.depthWrite=!1,B.map=null,f.addEventListener("dispose",function v(){f.removeEventListener("dispose",v),B.dispose()})),[B,f]}else return f}set material(f){f&&f.isTroikaTextMaterial?(this._derivedMaterial=f,this._baseMaterial=f.baseMaterial):this._baseMaterial=f}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(f){this.geometry.detail=f}get curveRadius(){return this.geometry.curveRadius}set curveRadius(f){this.geometry.curveRadius=f}get customDepthMaterial(){return a(this.material).getDepthMaterial()}get customDistanceMaterial(){return a(this.material).getDistanceMaterial()}_prepareForRender(f){const y=f.isTextOutlineMaterial,B=f.uniforms,v=this.textRenderInfo;if(v){const{sdfTexture:Z,blockBounds:V}=v;B.uTroikaSDFTexture.value=Z,B.uTroikaSDFTextureSize.value.set(Z.image.width,Z.image.height),B.uTroikaSDFGlyphSize.value=v.sdfGlyphSize,B.uTroikaSDFExponent.value=v.sdfExponent,B.uTroikaTotalBounds.value.fromArray(V),B.uTroikaUseGlyphColors.value=!y&&!!v.glyphColors;let H=0,P=0,E=0,L,K,O,q=0,ne=0;if(y){let{outlineWidth:F,outlineOffsetX:z,outlineOffsetY:X,outlineBlur:T,outlineOpacity:Q}=this;H=this._parsePercent(F)||0,P=Math.max(0,this._parsePercent(T)||0),L=Q,q=this._parsePercent(z)||0,ne=this._parsePercent(X)||0}else E=Math.max(0,this._parsePercent(this.strokeWidth)||0),E&&(O=this.strokeColor,B.uTroikaStrokeColor.value.set(O==null?e:O),K=this.strokeOpacity,K==null&&(K=1)),L=this.fillOpacity;B.uTroikaDistanceOffset.value=H,B.uTroikaPositionOffset.value.set(q,ne),B.uTroikaBlurRadius.value=P,B.uTroikaStrokeWidth.value=E,B.uTroikaStrokeOpacity.value=K,B.uTroikaFillOpacity.value=L==null?1:L,B.uTroikaCurveRadius.value=this.curveRadius||0;let k=this.clipRect;if(k&&Array.isArray(k)&&k.length===4)B.uTroikaClipRect.value.fromArray(k);else{const F=(this.fontSize||.1)*100;B.uTroikaClipRect.value.set(V[0]-F,V[1]-F,V[2]+F,V[3]+F)}this.geometry.applyClipRect(B.uTroikaClipRect.value)}B.uTroikaSDFDebug.value=!!this.debugSDF,f.polygonOffset=!!this.depthOffset,f.polygonOffsetFactor=f.polygonOffsetUnits=this.depthOffset||0;const W=y?this.outlineColor||0:this.color;if(W==null)delete f.color;else{const Z=f.hasOwnProperty("color")?f.color:f.color=new Ee;(W!==Z._input||typeof W=="object")&&Z.set(Z._input=W)}let R=this.orientation||g;if(R!==f._orientation){let Z=B.uTroikaOrient.value;R=R.replace(/[^-+xyz]/g,"");let V=R!==g&&R.match(/^([-+])([xyz])([-+])([xyz])$/);if(V){let[,H,P,E,L]=V;n.set(0,0,0)[P]=H==="-"?1:-1,s.set(0,0,0)[L]=E==="-"?-1:1,t.lookAt(r,n.cross(s),s),Z.setFromMatrix4(t)}else Z.identity();f._orientation=R}}_parsePercent(f){if(typeof f=="string"){let y=f.match(/^(-?[\d.]+)%$/),B=y?parseFloat(y[1]):NaN;f=(isNaN(B)?0:B/100)*this.fontSize}return f}localPositionToTextCoords(f,y=new Se){y.copy(f);const B=this.curveRadius;return B&&(y.x=Math.atan2(f.x,Math.abs(B)-Math.abs(f.z))*Math.abs(B)),y}worldPositionToTextCoords(f,y=new Se){return n.copy(f),this.localPositionToTextCoords(this.worldToLocal(n),y)}raycast(f,y){const{textRenderInfo:B,curveRadius:v}=this;if(B){const W=B.blockBounds,R=v?I():l(),Z=R.geometry,{position:V,uv:H}=Z.attributes;for(let P=0;P<H.count;P++){let E=W[0]+H.getX(P)*(W[2]-W[0]);const L=W[1]+H.getY(P)*(W[3]-W[1]);let K=0;v&&(K=v-Math.cos(E/v)*v,E=Math.sin(E/v)*v),V.setXYZ(P,E,L,K)}Z.boundingSphere=this.geometry.boundingSphere,Z.boundingBox=this.geometry.boundingBox,R.matrixWorld=this.matrixWorld,R.material.side=this.material.side,o.length=0,R.raycast(f,o);for(let P=0;P<o.length;P++)o[P].object=this,y.push(o[P])}}copy(f){const y=this.geometry;return super.copy(f),this.geometry=y,h.forEach(B=>{this[B]=f[B]}),this}clone(){return new this.constructor().copy(this)}}A.forEach(G=>{const f="_private_"+G;Object.defineProperty(m.prototype,G,{get(){return this[f]},set(y){y!==this[f]&&(this[f]=y,this._needsSync=!0)}})});let b=!1;return Object.defineProperty(m.prototype,"anchor",{get(){return this._deprecated_anchor},set(G){this._deprecated_anchor=G,b||(console.warn("TextMesh: `anchor` has been deprecated; use `anchorX` and `anchorY` instead."),b=!0),Array.isArray(G)?(this.anchorX=`${(+G[0]||0)*100}%`,this.anchorY=`${(+G[1]||0)*100}%`):this.anchorX=this.anchorY=0}}),m})();function lL(i,e,t=(n,s)=>n===s){if(i===e)return!0;if(!i||!e)return!1;const n=i.length;if(e.length!==n)return!1;for(let s=0;s<n;s++)if(!t(i[s],e[s]))return!1;return!0}const Zd=[];function IL(i,e,t=!1,n={}){for(const o of Zd)if(lL(e,o.keys,o.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return o.response;if(!t)throw o.promise}const s={keys:e,equal:n.equal,promise:i(...e).then(o=>s.response=o).then(()=>{n.lifespan&&n.lifespan>0&&setTimeout(()=>{const o=Zd.indexOf(s);o!==-1&&Zd.splice(o,1)},n.lifespan)}).catch(o=>s.error=o)};if(Zd.push(s),!t)throw s.promise}const cL=(i,e,t)=>IL(i,e,!1,t),CL=Je.exports.forwardRef(({anchorX:i="center",anchorY:e="middle",font:t,children:n,characters:s,onSync:o,...r},g)=>{const a=Or(({invalidate:u})=>u),[l]=Je.exports.useState(()=>new aL),[I,C]=Je.exports.useMemo(()=>{const u=[];let A="";return Je.exports.Children.forEach(n,h=>{typeof h=="string"||typeof h=="number"?A+=h:u.push(h)}),[u,A]},[n]);return cL(()=>new Promise(u=>j5({font:t,characters:s},u)),["troika-text",t,s]),Je.exports.useLayoutEffect(()=>void l.sync(()=>{a(),o&&o(l)})),Je.exports.useEffect(()=>()=>l.dispose(),[l]),Wt("primitive",{object:l,ref:g,font:t,text:C,anchorX:i,anchorY:e,...r,children:I})}),uL=Je.exports.forwardRef(({domElement:i,selector:e,onChange:t,onLock:n,onUnlock:s,enabled:o=!0,...r},g)=>{const{camera:a,...l}=r,I=Or(({gl:f})=>f),C=Or(f=>f.camera),u=Or(f=>f.invalidate),A=Or(f=>f.raycaster),h=Or(f=>f.events),m=a||C,b=i||h.connected||I.domElement,[G]=Je.exports.useState(()=>new DM(m));return Je.exports.useEffect(()=>{if(o){G.connect(b);const f=A.computeOffsets;return A.computeOffsets=y=>({offsetX:y.target.width/2,offsetY:y.target.height/2}),()=>{G.disconnect(),A.computeOffsets=f}}},[o,G]),Je.exports.useEffect(()=>{const f=v=>{u(),t&&t(v)};G.addEventListener("change",f),n&&G.addEventListener("lock",n),s&&G.addEventListener("unlock",s);const y=()=>G.lock(),B=e?Array.from(document.querySelectorAll(e)):[document];return B.forEach(v=>v&&v.addEventListener("click",y)),()=>{G.removeEventListener("change",f),n&&G.addEventListener("lock",n),s&&G.addEventListener("unlock",s),B.forEach(v=>v?v.removeEventListener("click",y):void 0)}},[t,n,s,e]),Wt("primitive",{ref:g,object:G,...l})});let wd=null;function xR(i,e,t){return n=>{t&&t(n),i&&(wd||(wd=new B5),wd.setDecoderPath(typeof i=="string"?i:"https://www.gstatic.com/draco/versioned/decoders/1.4.3/"),n.setDRACOLoader(wd)),e&&n.setMeshoptDecoder(typeof Wm=="function"?Wm():Wm)}}function mh(i,e=!0,t=!0,n){return II(CG,i,xR(e,t,n))}mh.preload=(i,e=!0,t=!0,n)=>II.preload(CG,i,xR(e,t,n));mh.clear=i=>II.clear(CG,i);function dL(i,e,t=new N){const n=Math.PI*(i-.5),s=2*Math.PI*(e-.5);return t.x=Math.cos(s),t.y=Math.sin(n),t.z=Math.sin(s),t}const AL=Je.exports.forwardRef(({inclination:i=.6,azimuth:e=.1,distance:t=1e3,mieCoefficient:n=.005,mieDirectionalG:s=.8,rayleigh:o=.5,turbidity:r=10,sunPosition:g=dL(i,e),...a},l)=>{const I=Je.exports.useMemo(()=>new N().setScalar(t),[t]),[C]=Je.exports.useState(()=>new ig);return Wt("primitive",{dispose:void 0,object:C,ref:l,"material-uniforms-mieCoefficient-value":n,"material-uniforms-mieDirectionalG-value":s,"material-uniforms-rayleigh-value":o,"material-uniforms-sunPosition-value":g,"material-uniforms-turbidity-value":r,scale:I,...a})});var dG={exports:{}},Kl=typeof Reflect=="object"?Reflect:null,RZ=Kl&&typeof Kl.apply=="function"?Kl.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},tA;Kl&&typeof Kl.ownKeys=="function"?tA=Kl.ownKeys:Object.getOwnPropertySymbols?tA=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:tA=function(e){return Object.getOwnPropertyNames(e)};function hL(i){console&&console.warn&&console.warn(i)}var XR=Number.isNaN||function(e){return e!==e};function Ut(){Ut.init.call(this)}dG.exports=Ut;dG.exports.once=bL;Ut.EventEmitter=Ut;Ut.prototype._events=void 0;Ut.prototype._eventsCount=0;Ut.prototype._maxListeners=void 0;var VZ=10;function fh(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(Ut,"defaultMaxListeners",{enumerable:!0,get:function(){return VZ},set:function(i){if(typeof i!="number"||i<0||XR(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");VZ=i}});Ut.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ut.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||XR(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function YR(i){return i._maxListeners===void 0?Ut.defaultMaxListeners:i._maxListeners}Ut.prototype.getMaxListeners=function(){return YR(this)};Ut.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var g=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw g.context=r,g}var a=o[e];if(a===void 0)return!1;if(typeof a=="function")RZ(a,this,t);else for(var l=a.length,I=MR(a,l),n=0;n<l;++n)RZ(I[n],this,t);return!0};function HR(i,e,t,n){var s,o,r;if(fh(t),o=i._events,o===void 0?(o=i._events=Object.create(null),i._eventsCount=0):(o.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),o=i._events),r=o[e]),r===void 0)r=o[e]=t,++i._eventsCount;else if(typeof r=="function"?r=o[e]=n?[t,r]:[r,t]:n?r.unshift(t):r.push(t),s=YR(i),s>0&&r.length>s&&!r.warned){r.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=i,g.type=e,g.count=r.length,hL(g)}return i}Ut.prototype.addListener=function(e,t){return HR(this,e,t,!1)};Ut.prototype.on=Ut.prototype.addListener;Ut.prototype.prependListener=function(e,t){return HR(this,e,t,!0)};function pL(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function FR(i,e,t){var n={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},s=pL.bind(n);return s.listener=t,n.wrapFn=s,s}Ut.prototype.once=function(e,t){return fh(t),this.on(e,FR(this,e,t)),this};Ut.prototype.prependOnceListener=function(e,t){return fh(t),this.prependListener(e,FR(this,e,t)),this};Ut.prototype.removeListener=function(e,t){var n,s,o,r,g;if(fh(t),s=this._events,s===void 0)return this;if(n=s[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){g=n[r].listener,o=r;break}if(o<0)return this;o===0?n.shift():mL(n,o),n.length===1&&(s[e]=n[0]),s.removeListener!==void 0&&this.emit("removeListener",e,g||t)}return this};Ut.prototype.off=Ut.prototype.removeListener;Ut.prototype.removeAllListeners=function(e){var t,n,s;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var o=Object.keys(n),r;for(s=0;s<o.length;++s)r=o[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function KR(i,e,t){var n=i._events;if(n===void 0)return[];var s=n[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?fL(s):MR(s,s.length)}Ut.prototype.listeners=function(e){return KR(this,e,!0)};Ut.prototype.rawListeners=function(e){return KR(this,e,!1)};Ut.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):NR.call(i,e)};Ut.prototype.listenerCount=NR;function NR(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}Ut.prototype.eventNames=function(){return this._eventsCount>0?tA(this._events):[]};function MR(i,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=i[n];return t}function mL(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function fL(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function bL(i,e){return new Promise(function(t,n){function s(r){i.removeListener(e,o),n(r)}function o(){typeof i.removeListener=="function"&&i.removeListener("error",s),t([].slice.call(arguments))}LR(i,e,o,{once:!0}),e!=="error"&&GL(i,s,{once:!0})})}function GL(i,e,t){typeof i.on=="function"&&LR(i,"error",e,t)}function LR(i,e,t,n){if(typeof i.on=="function")n.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function s(o){n.once&&i.removeEventListener(e,s),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}var yL=dG.exports;function BL(i,e){var t=atob(i);if(e){for(var n=new Uint8Array(t.length),s=0,o=t.length;s<o;++s)n[s]=t.charCodeAt(s);return String.fromCharCode.apply(null,new Uint16Array(n.buffer))}return t}function vL(i,e,t){var n=e===void 0?null:e,s=t===void 0?!1:t,o=BL(i,s),r=o.indexOf(`
`,10)+1,g=o.substring(r)+(n?"//# sourceMappingURL="+n:""),a=new Blob([g],{type:"application/javascript"});return URL.createObjectURL(a)}function ZL(i,e,t){var n;return function(o){return n=n||vL(i,e,t),new Worker(n,o)}}var wL=ZL("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuZ2V0QXZlcmFnZVBvaW50TG9jYWwocG9pbnRJbnNpZGUpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IG4gPSBub3JtYWxzW2ldOwogICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tmYWNlc1tpXVswXV07IC8vIFdlIG9ubHkgbmVlZCBvbmUgcG9pbnQgaW4gdGhlIGZhY2UKICAgICAgICAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgICAgY29uc3QgdlRvUCA9IG5ldyBWZWMzKCk7CiAgICAgICAgcC52c3ViKHYsIHZUb1ApOwogICAgICAgIGNvbnN0IHIxID0gbi5kb3QodlRvUCk7CiAgICAgICAgY29uc3QgdlRvUG9pbnRJbnNpZGUgPSBuZXcgVmVjMygpOwogICAgICAgIHBvaW50SW5zaWRlLnZzdWIodiwgdlRvUG9pbnRJbnNpZGUpOwogICAgICAgIGNvbnN0IHIyID0gbi5kb3QodlRvUG9pbnRJbnNpZGUpOwoKICAgICAgICBpZiAocjEgPCAwICYmIHIyID4gMCB8fCByMSA+IDAgJiYgcjIgPCAwKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgICB9CiAgICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG1heCBhbmQgbWluIGRvdCBwcm9kdWN0IG9mIGEgY29udmV4IGh1bGwgYXQgcG9zaXRpb24gKHBvcyxxdWF0KSBwcm9qZWN0ZWQgb250byBhbiBheGlzLgogICAgICogUmVzdWx0cyBhcmUgc2F2ZWQgaW4gdGhlIGFycmF5IG1heG1pbi4KICAgICAqIEBwYXJhbSByZXN1bHQgcmVzdWx0WzBdIGFuZCByZXN1bHRbMV0gd2lsbCBiZSBzZXQgdG8gbWF4aW11bSBhbmQgbWluaW11bSwgcmVzcGVjdGl2ZWx5LgogICAgICovCgoKICAgIHN0YXRpYyBwcm9qZWN0KHNoYXBlLCBheGlzLCBwb3MsIHF1YXQsIHJlc3VsdCkgewogICAgICBjb25zdCBuID0gc2hhcGUudmVydGljZXMubGVuZ3RoOwogICAgICBjb25zdCBsb2NhbEF4aXMgPSBwcm9qZWN0X2xvY2FsQXhpczsKICAgICAgbGV0IG1heCA9IDA7CiAgICAgIGxldCBtaW4gPSAwOwogICAgICBjb25zdCBsb2NhbE9yaWdpbiA9IHByb2plY3RfbG9jYWxPcmlnaW47CiAgICAgIGNvbnN0IHZzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGxvY2FsT3JpZ2luLnNldFplcm8oKTsgLy8gVHJhbnNmb3JtIHRoZSBheGlzIHRvIGxvY2FsCgogICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgYXhpcywgbG9jYWxBeGlzKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvcywgcXVhdCwgbG9jYWxPcmlnaW4sIGxvY2FsT3JpZ2luKTsKICAgICAgY29uc3QgYWRkID0gbG9jYWxPcmlnaW4uZG90KGxvY2FsQXhpcyk7CiAgICAgIG1pbiA9IG1heCA9IHZzWzBdLmRvdChsb2NhbEF4aXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBuOyBpKyspIHsKICAgICAgICBjb25zdCB2YWwgPSB2c1tpXS5kb3QobG9jYWxBeGlzKTsKCiAgICAgICAgaWYgKHZhbCA+IG1heCkgewogICAgICAgICAgbWF4ID0gdmFsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgbWluID0gdmFsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWluIC09IGFkZDsKICAgICAgbWF4IC09IGFkZDsKCiAgICAgIGlmIChtaW4gPiBtYXgpIHsKICAgICAgICAvLyBJbmNvbnNpc3RlbnQgLSBzd2FwCiAgICAgICAgY29uc3QgdGVtcCA9IG1pbjsKICAgICAgICBtaW4gPSBtYXg7CiAgICAgICAgbWF4ID0gdGVtcDsKICAgICAgfSAvLyBPdXRwdXQKCgogICAgICByZXN1bHRbMF0gPSBtYXg7CiAgICAgIHJlc3VsdFsxXSA9IG1pbjsKICAgIH0KCiAgfQogIGNvbnN0IG1heG1pbkEgPSBbXTsKICBjb25zdCBtYXhtaW5CID0gW107CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcHJvamVjdF9sb2NhbE9yaWdpbiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgM2QgYm94IHNoYXBlLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNpemUgPSAxCiAgICogICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gbmV3IENBTk5PTi5WZWMzKHNpemUsIHNpemUsIHNpemUpCiAgICogICAgIGNvbnN0IGJveFNoYXBlID0gbmV3IENBTk5PTi5Cb3goaGFsZkV4dGVudHMpCiAgICogICAgIGNvbnN0IGJveEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogYm94U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShib3hCb2R5KQogICAqLwogIGNsYXNzIEJveCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogVGhlIGhhbGYgZXh0ZW50cyBvZiB0aGUgYm94LgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIGJ5IHRoZSBjb250YWN0IGdlbmVyYXRvciB0byBtYWtlIGNvbnRhY3RzIHdpdGggb3RoZXIgY29udmV4IHBvbHloZWRyYSBmb3IgZXhhbXBsZS4KICAgICAqLwogICAgY29uc3RydWN0b3IoaGFsZkV4dGVudHMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLkJPWAogICAgICB9KTsKICAgICAgdGhpcy5oYWxmRXh0ZW50cyA9IGhhbGZFeHRlbnRzOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IG51bGw7CiAgICAgIHRoaXMudXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgbG9jYWwgY29udmV4IHBvbHloZWRyb24gcmVwcmVzZW50YXRpb24gdXNlZCBmb3Igc29tZSBjb2xsaXNpb25zLgogICAgICovCgoKICAgIHVwZGF0ZUNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbigpIHsKICAgICAgY29uc3Qgc3ggPSB0aGlzLmhhbGZFeHRlbnRzLng7CiAgICAgIGNvbnN0IHN5ID0gdGhpcy5oYWxmRXh0ZW50cy55OwogICAgICBjb25zdCBzeiA9IHRoaXMuaGFsZkV4dGVudHMuejsKICAgICAgY29uc3QgViA9IFZlYzM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW25ldyBWKC1zeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgLXN5LCAtc3opLCBuZXcgVihzeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgc3ksIC1zeiksIG5ldyBWKC1zeCwgLXN5LCBzeiksIG5ldyBWKHN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIHN5LCBzeiksIG5ldyBWKC1zeCwgc3ksIHN6KV07CiAgICAgIGNvbnN0IGZhY2VzID0gW1szLCAyLCAxLCAwXSwgLy8gLXoKICAgICAgWzQsIDUsIDYsIDddLCAvLyAregogICAgICBbNSwgNCwgMCwgMV0sIC8vIC15CiAgICAgIFsyLCAzLCA3LCA2XSwgLy8gK3kKICAgICAgWzAsIDQsIDcsIDNdLCAvLyAteAogICAgICBbMSwgMiwgNiwgNV0gLy8gK3gKICAgICAgXTsKICAgICAgY29uc3QgYXhlcyA9IFtuZXcgVigwLCAwLCAxKSwgbmV3IFYoMCwgMSwgMCksIG5ldyBWKDEsIDAsIDApXTsKICAgICAgY29uc3QgaCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKHsKICAgICAgICB2ZXJ0aWNlcywKICAgICAgICBmYWNlcywKICAgICAgICBheGVzCiAgICAgIH0pOwogICAgICB0aGlzLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiA9IGg7CiAgICAgIGgubWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgdGhlIGluZXJ0aWEgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKHRoaXMuaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogICAgc3RhdGljIGNhbGN1bGF0ZUluZXJ0aWEoaGFsZkV4dGVudHMsIG1hc3MsIHRhcmdldCkgewogICAgICBjb25zdCBlID0gaGFsZkV4dGVudHM7CiAgICAgIHRhcmdldC54ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueCAqIDIgKiBlLnggKyAyICogZS56ICogMiAqIGUueik7CiAgICAgIHRhcmdldC56ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIGUueSAqIDIgKiBlLnkgKyAyICogZS54ICogMiAqIGUueCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYm94IDYgc2lkZSBub3JtYWxzCiAgICAgKiBAcGFyYW0gc2l4VGFyZ2V0VmVjdG9ycyBBbiBhcnJheSBvZiA2IHZlY3RvcnMsIHRvIHN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBub3JtYWxzIGluLgogICAgICogQHBhcmFtIHF1YXQgT3JpZW50YXRpb24gdG8gYXBwbHkgdG8gdGhlIG5vcm1hbCB2ZWN0b3JzLiBJZiBub3QgcHJvdmlkZWQsIHRoZSB2ZWN0b3JzIHdpbGwgYmUgaW4gcmVzcGVjdCB0byB0aGUgbG9jYWwgZnJhbWUuCiAgICAgKi8KCgogICAgZ2V0U2lkZU5vcm1hbHMoc2l4VGFyZ2V0VmVjdG9ycywgcXVhdCkgewogICAgICBjb25zdCBzaWRlcyA9IHNpeFRhcmdldFZlY3RvcnM7CiAgICAgIGNvbnN0IGV4ID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgc2lkZXNbMF0uc2V0KGV4LngsIDAsIDApOwogICAgICBzaWRlc1sxXS5zZXQoMCwgZXgueSwgMCk7CiAgICAgIHNpZGVzWzJdLnNldCgwLCAwLCBleC56KTsKICAgICAgc2lkZXNbM10uc2V0KC1leC54LCAwLCAwKTsKICAgICAgc2lkZXNbNF0uc2V0KDAsIC1leC55LCAwKTsKICAgICAgc2lkZXNbNV0uc2V0KDAsIDAsIC1leC56KTsKCiAgICAgIGlmIChxdWF0ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gc2lkZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHF1YXQudm11bHQoc2lkZXNbaV0sIHNpZGVzW2ldKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaWRlczsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyB0aGUgdm9sdW1lIG9mIHRoZSBib3guCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gOC4wICogdGhpcy5oYWxmRXh0ZW50cy54ICogdGhpcy5oYWxmRXh0ZW50cy55ICogdGhpcy5oYWxmRXh0ZW50cy56OwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cwogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5oYWxmRXh0ZW50cy5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogZm9yRWFjaFdvcmxkQ29ybmVyCiAgICAgKi8KCgogICAgZm9yRWFjaFdvcmxkQ29ybmVyKHBvcywgcXVhdCwgY2FsbGJhY2spIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSBbW2UueCwgZS55LCBlLnpdLCBbLWUueCwgZS55LCBlLnpdLCBbLWUueCwgLWUueSwgZS56XSwgWy1lLngsIC1lLnksIC1lLnpdLCBbZS54LCAtZS55LCAtZS56XSwgW2UueCwgZS55LCAtZS56XSwgWy1lLngsIGUueSwgLWUuel0sIFtlLngsIC1lLnksIGUuel1dOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3JuZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgd29ybGRDb3JuZXJUZW1wUG9zLnNldChjb3JuZXJzW2ldWzBdLCBjb3JuZXJzW2ldWzFdLCBjb3JuZXJzW2ldWzJdKTsKICAgICAgICBxdWF0LnZtdWx0KHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBwb3MudmFkZCh3b3JsZENvcm5lclRlbXBQb3MsIHdvcmxkQ29ybmVyVGVtcFBvcyk7CiAgICAgICAgY2FsbGJhY2sod29ybGRDb3JuZXJUZW1wUG9zLngsIHdvcmxkQ29ybmVyVGVtcFBvcy55LCB3b3JsZENvcm5lclRlbXBQb3Mueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuaGFsZkV4dGVudHM7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMF0uc2V0KGUueCwgZS55LCBlLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzFdLnNldCgtZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMl0uc2V0KC1lLngsIC1lLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbM10uc2V0KC1lLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzRdLnNldChlLngsIC1lLnksIC1lLnopOwogICAgICB3b3JsZENvcm5lcnNUZW1wWzVdLnNldChlLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNl0uc2V0KC1lLngsIGUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbN10uc2V0KGUueCwgLWUueSwgZS56KTsKICAgICAgY29uc3Qgd2MgPSB3b3JsZENvcm5lcnNUZW1wWzBdOwogICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgIG1heC5jb3B5KHdjKTsKICAgICAgbWluLmNvcHkod2MpOwoKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbaV07CiAgICAgICAgcXVhdC52bXVsdCh3Yywgd2MpOwogICAgICAgIHBvcy52YWRkKHdjLCB3Yyk7CiAgICAgICAgY29uc3QgeCA9IHdjLng7CiAgICAgICAgY29uc3QgeSA9IHdjLnk7CiAgICAgICAgY29uc3QgeiA9IHdjLno7CgogICAgICAgIGlmICh4ID4gbWF4LngpIHsKICAgICAgICAgIG1heC54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5ID4gbWF4LnkpIHsKICAgICAgICAgIG1heC55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6ID4gbWF4LnopIHsKICAgICAgICAgIG1heC56ID0gejsKICAgICAgICB9CgogICAgICAgIGlmICh4IDwgbWluLngpIHsKICAgICAgICAgIG1pbi54ID0geDsKICAgICAgICB9CgogICAgICAgIGlmICh5IDwgbWluLnkpIHsKICAgICAgICAgIG1pbi55ID0geTsKICAgICAgICB9CgogICAgICAgIGlmICh6IDwgbWluLnopIHsKICAgICAgICAgIG1pbi56ID0gejsKICAgICAgICB9CiAgICAgIH0gLy8gR2V0IGVhY2ggYXhpcyBtYXgKICAgICAgLy8gbWluLnNldChJbmZpbml0eSxJbmZpbml0eSxJbmZpbml0eSk7CiAgICAgIC8vIG1heC5zZXQoLUluZmluaXR5LC1JbmZpbml0eSwtSW5maW5pdHkpOwogICAgICAvLyB0aGlzLmZvckVhY2hXb3JsZENvcm5lcihwb3MscXVhdCxmdW5jdGlvbih4LHkseil7CiAgICAgIC8vICAgICBpZih4ID4gbWF4LngpewogICAgICAvLyAgICAgICAgIG1heC54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPiBtYXgueSl7CiAgICAgIC8vICAgICAgICAgbWF4LnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA+IG1heC56KXsKICAgICAgLy8gICAgICAgICBtYXgueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih4IDwgbWluLngpewogICAgICAvLyAgICAgICAgIG1pbi54ID0geDsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHkgPCBtaW4ueSl7CiAgICAgIC8vICAgICAgICAgbWluLnkgPSB5OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeiA8IG1pbi56KXsKICAgICAgLy8gICAgICAgICBtaW4ueiA9IHo7CiAgICAgIC8vICAgICB9CiAgICAgIC8vIH0pOwoKICAgIH0KCiAgfQogIGNvbnN0IHdvcmxkQ29ybmVyVGVtcFBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgd29ybGRDb3JuZXJzVGVtcCA9IFtuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpLCBuZXcgVmVjMygpXTsKCiAgLyoqCiAgICogQk9EWV9UWVBFUwogICAqLwogIGNvbnN0IEJPRFlfVFlQRVMgPSB7CiAgICAvKiogRFlOQU1JQyAqLwogICAgRFlOQU1JQzogMSwKCiAgICAvKiogU1RBVElDICovCiAgICBTVEFUSUM6IDIsCgogICAgLyoqIEtJTkVNQVRJQyAqLwogICAgS0lORU1BVElDOiA0CiAgfTsKICAvKioKICAgKiBCb2R5VHlwZQogICAqLwoKICAvKioKICAgKiBCT0RZX1NMRUVQX1NUQVRFUwogICAqLwogIGNvbnN0IEJPRFlfU0xFRVBfU1RBVEVTID0gewogICAgLyoqIEFXQUtFICovCiAgICBBV0FLRTogMCwKCiAgICAvKiogU0xFRVBZICovCiAgICBTTEVFUFk6IDEsCgogICAgLyoqIFNMRUVQSU5HICovCiAgICBTTEVFUElORzogMgogIH07CiAgLyoqCiAgICogQm9keVNsZWVwU3RhdGUKICAgKi8KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3IgYWxsIGJvZHkgdHlwZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2hhcGUgPSBuZXcgQ0FOTk9OLlNwaGVyZSgxKQogICAqICAgICBjb25zdCBib2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsKICAgKiAgICAgICBtYXNzOiAxLAogICAqICAgICAgIHNoYXBlLAogICAqICAgICB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHkpCiAgICovCiAgY2xhc3MgQm9keSBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciB0d28gYm9kaWVzIGNvbGxpZGUuIFRoaXMgZXZlbnQgaXMgZGlzcGF0Y2hlZCBvbiBlYWNoCiAgICAgKiBvZiB0aGUgdHdvIGJvZGllcyBpbnZvbHZlZCBpbiB0aGUgY29sbGlzaW9uLgogICAgICogQGV2ZW50IGNvbGxpZGUKICAgICAqIEBwYXJhbSBib2R5IFRoZSBib2R5IHRoYXQgd2FzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAcGFyYW0gY29udGFjdCBUaGUgZGV0YWlscyBvZiB0aGUgY29sbGlzaW9uLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGR5bmFtaWMgYm9keSBpcyBmdWxseSBzaW11bGF0ZWQuIENhbiBiZSBtb3ZlZCBtYW51YWxseSBieSB0aGUgdXNlciwgYnV0IG5vcm1hbGx5IHRoZXkgbW92ZSBhY2NvcmRpbmcgdG8gZm9yY2VzLiBBIGR5bmFtaWMgYm9keSBjYW4gY29sbGlkZSB3aXRoIGFsbCBib2R5IHR5cGVzLiBBIGR5bmFtaWMgYm9keSBhbHdheXMgaGFzIGZpbml0ZSwgbm9uLXplcm8gbWFzcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBzdGF0aWMgYm9keSBkb2VzIG5vdCBtb3ZlIGR1cmluZyBzaW11bGF0aW9uIGFuZCBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBTdGF0aWMgYm9kaWVzIGNhbiBiZSBtb3ZlZCBtYW51YWxseSBieSBzZXR0aW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgYm9keS4gVGhlIHZlbG9jaXR5IG9mIGEgc3RhdGljIGJvZHkgaXMgYWx3YXlzIHplcm8uIFN0YXRpYyBib2RpZXMgZG8gbm90IGNvbGxpZGUgd2l0aCBvdGhlciBzdGF0aWMgb3Iga2luZW1hdGljIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogQSBraW5lbWF0aWMgYm9keSBtb3ZlcyB1bmRlciBzaW11bGF0aW9uIGFjY29yZGluZyB0byBpdHMgdmVsb2NpdHkuIFRoZXkgZG8gbm90IHJlc3BvbmQgdG8gZm9yY2VzLiBUaGV5IGNhbiBiZSBtb3ZlZCBtYW51YWxseSwgYnV0IG5vcm1hbGx5IGEga2luZW1hdGljIGJvZHkgaXMgbW92ZWQgYnkgc2V0dGluZyBpdHMgdmVsb2NpdHkuIEEga2luZW1hdGljIGJvZHkgYmVoYXZlcyBhcyBpZiBpdCBoYXMgaW5maW5pdGUgbWFzcy4gS2luZW1hdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBV0FLRQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUFkKICAgICAqLwoKICAgIC8qKgogICAgICogU0xFRVBJTkcKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIHNsZWVwaW5nIGJvZHkgaGFzIHdva2VuIHVwLgogICAgICogQGV2ZW50IHdha2V1cAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZ29uZSBpbiB0byB0aGUgc2xlZXB5IHN0YXRlLgogICAgICogQGV2ZW50IHNsZWVweQogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgZmFsbGVuIGFzbGVlcC4KICAgICAqIEBldmVudCBzbGVlcAogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaWQgPSBCb2R5LmlkQ291bnRlcisrOwogICAgICB0aGlzLmluZGV4ID0gLTE7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnZsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IDE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgPT09ICdudW1iZXInID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA9PT0gJ2Jvb2xlYW4nID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbml0UG9zaXRpb24gPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRQb3NpdGlvbi5jb3B5KG9wdGlvbnMucG9zaXRpb24pOwogICAgICAgIHRoaXMuaW5pdFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMudmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMudmVsb2NpdHkpIHsKICAgICAgICB0aGlzLnZlbG9jaXR5LmNvcHkob3B0aW9ucy52ZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdFZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5mb3JjZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG1hc3MgPSB0eXBlb2Ygb3B0aW9ucy5tYXNzID09PSAnbnVtYmVyJyA/IG9wdGlvbnMubWFzcyA6IDA7CiAgICAgIHRoaXMubWFzcyA9IG1hc3M7CiAgICAgIHRoaXMuaW52TWFzcyA9IG1hc3MgPiAwID8gMS4wIC8gbWFzcyA6IDA7CiAgICAgIHRoaXMubWF0ZXJpYWwgPSBvcHRpb25zLm1hdGVyaWFsIHx8IG51bGw7CiAgICAgIHRoaXMubGluZWFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmxpbmVhckRhbXBpbmcgPT09ICdudW1iZXInID8gb3B0aW9ucy5saW5lYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy50eXBlID0gbWFzcyA8PSAwLjAgPyBCb2R5LlNUQVRJQyA6IEJvZHkuRFlOQU1JQzsKCiAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy50eXBlID09PSB0eXBlb2YgQm9keS5TVEFUSUMpIHsKICAgICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGU7CiAgICAgIH0KCiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9IHR5cGVvZiBvcHRpb25zLmFsbG93U2xlZXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbGxvd1NsZWVwIDogdHJ1ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy5zbGVlcFNwZWVkTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5zbGVlcFNwZWVkTGltaXQgOiAwLjE7CiAgICAgIHRoaXMuc2xlZXBUaW1lTGltaXQgPSB0eXBlb2Ygb3B0aW9ucy5zbGVlcFRpbWVMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwVGltZUxpbWl0IDogMTsKICAgICAgdGhpcy50aW1lTGFzdFNsZWVweSA9IDA7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgICB0aGlzLnRvcnF1ZSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAob3B0aW9ucy5xdWF0ZXJuaW9uKSB7CiAgICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmluaXRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KG9wdGlvbnMucXVhdGVybmlvbik7CiAgICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KSB7CiAgICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY29weShvcHRpb25zLmFuZ3VsYXJWZWxvY2l0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuaW5pdEFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuc2hhcGVzID0gW107CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzID0gW107CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5pbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQgPSBuZXcgTWF0MygpOwogICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZSA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuZml4ZWRSb3RhdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZpeGVkUm90YXRpb24gIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5maXhlZFJvdGF0aW9uIDogZmFsc2U7CiAgICAgIHRoaXMuYW5ndWxhckRhbXBpbmcgPSB0eXBlb2Ygb3B0aW9ucy5hbmd1bGFyRGFtcGluZyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ3VsYXJEYW1waW5nIDogMC4wMTsKICAgICAgdGhpcy5saW5lYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmxpbmVhckZhY3RvcikgewogICAgICAgIHRoaXMubGluZWFyRmFjdG9yLmNvcHkob3B0aW9ucy5saW5lYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IgPSBuZXcgVmVjMygxLCAxLCAxKTsKCiAgICAgIGlmIChvcHRpb25zLmFuZ3VsYXJGYWN0b3IpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJGYWN0b3IuY29weShvcHRpb25zLmFuZ3VsYXJGYWN0b3IpOwogICAgICB9CgogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdSYWRpdXMgPSAwOwogICAgICB0aGlzLndsYW1iZGEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmlzVHJpZ2dlciA9IEJvb2xlYW4ob3B0aW9ucy5pc1RyaWdnZXIpOwoKICAgICAgaWYgKG9wdGlvbnMuc2hhcGUpIHsKICAgICAgICB0aGlzLmFkZFNoYXBlKG9wdGlvbnMuc2hhcGUpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICB9CiAgICAvKioKICAgICAqIFdha2UgdGhlIGJvZHkgdXAuCiAgICAgKi8KCgogICAgd2FrZVVwKCkgewogICAgICBjb25zdCBwcmV2U3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuQVdBS0U7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwoKICAgICAgaWYgKHByZXZTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5Lndha2V1cEV2ZW50KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBGb3JjZSBib2R5IHNsZWVwCiAgICAgKi8KCgogICAgc2xlZXAoKSB7CiAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBJTkc7CiAgICAgIHRoaXMudmVsb2NpdHkuc2V0KDAsIDAsIDApOwogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsZWQgZXZlcnkgdGltZXN0ZXAgdG8gdXBkYXRlIGludGVybmFsIHNsZWVwIHRpbWVyIGFuZCBjaGFuZ2Ugc2xlZXAgc3RhdGUgaWYgbmVlZGVkLgogICAgICogQHBhcmFtIHRpbWUgVGhlIHdvcmxkIHRpbWUgaW4gc2Vjb25kcwogICAgICovCgoKICAgIHNsZWVwVGljayh0aW1lKSB7CiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBjb25zdCBzbGVlcFN0YXRlID0gdGhpcy5zbGVlcFN0YXRlOwogICAgICAgIGNvbnN0IHNwZWVkU3F1YXJlZCA9IHRoaXMudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgdGhpcy5hbmd1bGFyVmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpOwogICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkID0gdGhpcy5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuQVdBS0UgJiYgc3BlZWRTcXVhcmVkIDwgc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMuc2xlZXBTdGF0ZSA9IEJvZHkuU0xFRVBZOyAvLyBTbGVlcHkKCiAgICAgICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gdGltZTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVweUV2ZW50KTsKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHNwZWVkU3F1YXJlZCA+IHNwZWVkTGltaXRTcXVhcmVkKSB7CiAgICAgICAgICB0aGlzLndha2VVcCgpOyAvLyBXYWtlIHVwCiAgICAgICAgfSBlbHNlIGlmIChzbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQWSAmJiB0aW1lIC0gdGhpcy50aW1lTGFzdFNsZWVweSA+IHRoaXMuc2xlZXBUaW1lTGltaXQpIHsKICAgICAgICAgIHRoaXMuc2xlZXAoKTsgLy8gU2xlZXBpbmcKCiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoQm9keS5zbGVlcEV2ZW50KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogSWYgdGhlIGJvZHkgaXMgc2xlZXBpbmcsIGl0IHNob3VsZCBiZSBpbW1vdmFibGUgLyBoYXZlIGluZmluaXRlIG1hc3MgZHVyaW5nIHNvbHZlLiBXZSBzb2x2ZSBpdCBieSBoYXZpbmcgYSBzZXBhcmF0ZSAic29sdmUgbWFzcyIuCiAgICAgKi8KCgogICAgdXBkYXRlU29sdmVNYXNzUHJvcGVydGllcygpIHsKICAgICAgaWYgKHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB7CiAgICAgICAgdGhpcy5pbnZNYXNzU29sdmUgPSAwOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLnNldFplcm8oKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLnNldFplcm8oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IHRoaXMuaW52TWFzczsKICAgICAgICB0aGlzLmludkluZXJ0aWFTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYSk7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGRTb2x2ZS5jb3B5KHRoaXMuaW52SW5lcnRpYVdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgd29ybGQgcG9pbnQgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICBwb2ludFRvTG9jYWxGcmFtZSh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHRoaXMucG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCB2ZWN0b3IgdG8gbG9jYWwgYm9keSBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb0xvY2FsRnJhbWUod29ybGRWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24uY29uanVnYXRlKCkudm11bHQod29ybGRWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSBsb2NhbCBib2R5IHBvaW50IHRvIHdvcmxkIGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgdmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsVmVjdG9yLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGhpcy5xdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBzaGFwZSB0byB0aGUgYm9keSB3aXRoIGEgbG9jYWwgb2Zmc2V0IGFuZCBvcmllbnRhdGlvbi4KICAgICAqIEByZXR1cm4gVGhlIGJvZHkgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGFkZFNoYXBlKHNoYXBlLCBfb2Zmc2V0LCBfb3JpZW50YXRpb24pIHsKICAgICAgY29uc3Qgb2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKF9vZmZzZXQpIHsKICAgICAgICBvZmZzZXQuY29weShfb2Zmc2V0KTsKICAgICAgfQoKICAgICAgaWYgKF9vcmllbnRhdGlvbikgewogICAgICAgIG9yaWVudGF0aW9uLmNvcHkoX29yaWVudGF0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5zaGFwZXMucHVzaChzaGFwZSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucy5wdXNoKG9yaWVudGF0aW9uKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IHRoaXM7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBib2R5LgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlU2hhcGUoc2hhcGUpIHsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnNoYXBlcy5pbmRleE9mKHNoYXBlKTsKCiAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ1NoYXBlIGRvZXMgbm90IGJlbG9uZyB0byB0aGUgYm9keScpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT2Zmc2V0cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1JhZGl1cygpOwogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHNoYXBlLmJvZHkgPSBudWxsOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBib3VuZGluZyByYWRpdXMgb2YgdGhlIGJvZHkuIFNob3VsZCBiZSBkb25lIGlmIGFueSBvZiB0aGUgc2hhcGVzIGFyZSBjaGFuZ2VkLgogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nUmFkaXVzKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IE4gPSBzaGFwZXMubGVuZ3RoOwogICAgICBsZXQgcmFkaXVzID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsKICAgICAgICBzaGFwZS51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICAgIGNvbnN0IG9mZnNldCA9IHNoYXBlT2Zmc2V0c1tpXS5sZW5ndGgoKTsKICAgICAgICBjb25zdCByID0gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CgogICAgICAgIGlmIChvZmZzZXQgKyByID4gcmFkaXVzKSB7CiAgICAgICAgICByYWRpdXMgPSBvZmZzZXQgKyByOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IHJhZGl1czsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgLmFhYmIKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICBjb25zdCBzaGFwZXMgPSB0aGlzLnNoYXBlczsKICAgICAgY29uc3Qgc2hhcGVPZmZzZXRzID0gdGhpcy5zaGFwZU9mZnNldHM7CiAgICAgIGNvbnN0IHNoYXBlT3JpZW50YXRpb25zID0gdGhpcy5zaGFwZU9yaWVudGF0aW9uczsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGNvbnN0IG9mZnNldCA9IHRtcFZlYzsKICAgICAgY29uc3Qgb3JpZW50YXRpb24gPSB0bXBRdWF0OwogICAgICBjb25zdCBib2R5UXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3Qgc2hhcGVBQUJCID0gdXBkYXRlQUFCQl9zaGFwZUFBQkI7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGUgPSBzaGFwZXNbaV07IC8vIEdldCBzaGFwZSB3b3JsZCBwb3NpdGlvbgoKICAgICAgICBib2R5UXVhdC52bXVsdChzaGFwZU9mZnNldHNbaV0sIG9mZnNldCk7CiAgICAgICAgb2Zmc2V0LnZhZGQodGhpcy5wb3NpdGlvbiwgb2Zmc2V0KTsgLy8gR2V0IHNoYXBlIHdvcmxkIHF1YXRlcm5pb24KCiAgICAgICAgYm9keVF1YXQubXVsdChzaGFwZU9yaWVudGF0aW9uc1tpXSwgb3JpZW50YXRpb24pOyAvLyBHZXQgc2hhcGUgQUFCQgoKICAgICAgICBzaGFwZS5jYWxjdWxhdGVXb3JsZEFBQkIob2Zmc2V0LCBvcmllbnRhdGlvbiwgc2hhcGVBQUJCLmxvd2VyQm91bmQsIHNoYXBlQUFCQi51cHBlckJvdW5kKTsKCiAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgIGFhYmIuY29weShzaGFwZUFBQkIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhYWJiLmV4dGVuZChzaGFwZUFBQkIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIGAuaW5lcnRpYVdvcmxkYCBhbmQgYC5pbnZJbmVydGlhV29ybGRgCiAgICAgKi8KCgogICAgdXBkYXRlSW5lcnRpYVdvcmxkKGZvcmNlKSB7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmludkluZXJ0aWE7CgogICAgICBpZiAoSS54ID09PSBJLnkgJiYgSS55ID09PSBJLnogJiYgIWZvcmNlKSA7IGVsc2UgewogICAgICAgIGNvbnN0IG0xID0gdWl3X20xOwogICAgICAgIGNvbnN0IG0yID0gdWl3X20yOwogICAgICAgIG0xLnNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24odGhpcy5xdWF0ZXJuaW9uKTsKICAgICAgICBtMS50cmFuc3Bvc2UobTIpOwogICAgICAgIG0xLnNjYWxlKEksIG0xKTsKICAgICAgICBtMS5tbXVsdChtMiwgdGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgcG9pbnQgb2YgdGhlIGJvZHkuIFRoaXMgY291bGQgZm9yIGV4YW1wbGUgYmUgYSBwb2ludCBvbiB0aGUgQm9keSBzdXJmYWNlLgogICAgICogQXBwbHlpbmcgZm9yY2UgdGhpcyB3YXkgd2lsbCBhZGQgdG8gQm9keS5mb3JjZSBhbmQgQm9keS50b3JxdWUuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGFtb3VudCBvZiBmb3JjZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZShmb3JjZSwgcmVsYXRpdmVQb2ludCkgewogICAgICBpZiAocmVsYXRpdmVQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIE5lZWRlZD8KICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgZm9yY2UKCgogICAgICBjb25zdCByb3RGb3JjZSA9IEJvZHlfYXBwbHlGb3JjZV9yb3RGb3JjZTsKICAgICAgcmVsYXRpdmVQb2ludC5jcm9zcyhmb3JjZSwgcm90Rm9yY2UpOyAvLyBBZGQgbGluZWFyIGZvcmNlCgogICAgICB0aGlzLmZvcmNlLnZhZGQoZm9yY2UsIHRoaXMuZm9yY2UpOyAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKICAgICAgdGhpcy50b3JxdWUudmFkZChyb3RGb3JjZSwgdGhpcy50b3JxdWUpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBmb3JjZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxGb3JjZShsb2NhbEZvcmNlLCBsb2NhbFBvaW50KSB7CiAgICAgIGlmIChsb2NhbFBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICBsb2NhbFBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB3b3JsZEZvcmNlID0gQm9keV9hcHBseUxvY2FsRm9yY2Vfd29ybGRGb3JjZTsKICAgICAgY29uc3QgcmVsYXRpdmVQb2ludFdvcmxkID0gQm9keV9hcHBseUxvY2FsRm9yY2VfcmVsYXRpdmVQb2ludFdvcmxkOyAvLyBUcmFuc2Zvcm0gdGhlIGZvcmNlIHZlY3RvciB0byB3b3JsZCBzcGFjZQoKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxGb3JjZSwgd29ybGRGb3JjZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlGb3JjZSh3b3JsZEZvcmNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0b3JxdWUgdG8gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gdG9ycXVlIFRoZSBhbW91bnQgb2YgdG9ycXVlIHRvIGFkZC4KICAgICAqLwoKCiAgICBhcHBseVRvcnF1ZSh0b3JxdWUpIHsKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBBZGQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIHRoaXMudG9ycXVlLnZhZGQodG9ycXVlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGltcHVsc2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBbiBpbXB1bHNlIGlzIGEgZm9yY2UgYWRkZWQgdG8gYSBib2R5IGR1cmluZyBhIHNob3J0IHBlcmlvZCBvZiB0aW1lIChpbXB1bHNlID0gZm9yY2UgKiB0aW1lKS4KICAgICAqIEltcHVsc2VzIHdpbGwgYmUgYWRkZWQgdG8gQm9keS52ZWxvY2l0eSBhbmQgQm9keS5hbmd1bGFyVmVsb2NpdHkuCiAgICAgKiBAcGFyYW0gaW1wdWxzZSBUaGUgYW1vdW50IG9mIGltcHVsc2UgdG8gYWRkLgogICAgICogQHBhcmFtIHJlbGF0aXZlUG9pbnQgQSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3MgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMudHlwZSAhPT0gQm9keS5EWU5BTUlDKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy53YWtlVXAoKTsKICAgICAgfSAvLyBDb21wdXRlIHBvaW50IHBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBib2R5IGNlbnRlcgoKCiAgICAgIGNvbnN0IHIgPSByZWxhdGl2ZVBvaW50OyAvLyBDb21wdXRlIHByb2R1Y2VkIGNlbnRyYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3QgdmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG87CiAgICAgIHZlbG8uY29weShpbXB1bHNlKTsKICAgICAgdmVsby5zY2FsZSh0aGlzLmludk1hc3MsIHZlbG8pOyAvLyBBZGQgbGluZWFyIGltcHVsc2UKCiAgICAgIHRoaXMudmVsb2NpdHkudmFkZCh2ZWxvLCB0aGlzLnZlbG9jaXR5KTsgLy8gQ29tcHV0ZSBwcm9kdWNlZCByb3RhdGlvbmFsIGltcHVsc2UgdmVsb2NpdHkKCiAgICAgIGNvbnN0IHJvdFZlbG8gPSBCb2R5X2FwcGx5SW1wdWxzZV9yb3RWZWxvOwogICAgICByLmNyb3NzKGltcHVsc2UsIHJvdFZlbG8pOwogICAgICAvKgogICAgICAgcm90VmVsby54ICo9IHRoaXMuaW52SW5lcnRpYS54OwogICAgICAgcm90VmVsby55ICo9IHRoaXMuaW52SW5lcnRpYS55OwogICAgICAgcm90VmVsby56ICo9IHRoaXMuaW52SW5lcnRpYS56OwogICAgICAgKi8KCiAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkLnZtdWx0KHJvdFZlbG8sIHJvdFZlbG8pOyAvLyBBZGQgcm90YXRpb25hbCBJbXB1bHNlCgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS52YWRkKHJvdFZlbG8sIHRoaXMuYW5ndWxhclZlbG9jaXR5KTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgbG9jYWxseS1kZWZpbmVkIGltcHVsc2UgdG8gYSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgZm9yY2UgdmVjdG9yIHRvIGFwcGx5LCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIGJvZHkgZnJhbWUuCiAgICAgKiBAcGFyYW0gbG9jYWxQb2ludCBBIGxvY2FsIHBvaW50IGluIHRoZSBib2R5IHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUxvY2FsSW1wdWxzZShsb2NhbEltcHVsc2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkSW1wdWxzZSA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEltcHVsc2UsIHdvcmxkSW1wdWxzZSk7CiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsUG9pbnQsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuYXBwbHlJbXB1bHNlKHdvcmxkSW1wdWxzZSwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogU2hvdWxkIGJlIGNhbGxlZCB3aGVuZXZlciB5b3UgY2hhbmdlIHRoZSBib2R5IHNoYXBlIG9yIG1hc3MuCiAgICAgKi8KCgogICAgdXBkYXRlTWFzc1Byb3BlcnRpZXMoKSB7CiAgICAgIGNvbnN0IGhhbGZFeHRlbnRzID0gQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50czsKICAgICAgdGhpcy5pbnZNYXNzID0gdGhpcy5tYXNzID4gMCA/IDEuMCAvIHRoaXMubWFzcyA6IDA7CiAgICAgIGNvbnN0IEkgPSB0aGlzLmluZXJ0aWE7CiAgICAgIGNvbnN0IGZpeGVkID0gdGhpcy5maXhlZFJvdGF0aW9uOyAvLyBBcHByb3hpbWF0ZSB3aXRoIEFBQkIgYm94CgogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgaGFsZkV4dGVudHMuc2V0KCh0aGlzLmFhYmIudXBwZXJCb3VuZC54IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueCkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueSAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnkpIC8gMiwgKHRoaXMuYWFiYi51cHBlckJvdW5kLnogLSB0aGlzLmFhYmIubG93ZXJCb3VuZC56KSAvIDIpOwogICAgICBCb3guY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgdGhpcy5tYXNzLCBJKTsKICAgICAgdGhpcy5pbnZJbmVydGlhLnNldChJLnggPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueCA6IDAsIEkueSA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS55IDogMCwgSS56ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnogOiAwKTsKICAgICAgdGhpcy51cGRhdGVJbmVydGlhV29ybGQodHJ1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB3b3JsZCB2ZWxvY2l0eSBvZiBhIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIHdvcmxkUG9pbnQKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCB2ZWN0b3IuCiAgICAgKi8KCgogICAgZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod29ybGRQb2ludCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IHIgPSBuZXcgVmVjMygpOwogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcik7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHIsIHJlc3VsdCk7CiAgICAgIHRoaXMudmVsb2NpdHkudmFkZChyZXN1bHQsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIE1vdmUgdGhlIGJvZHkgZm9yd2FyZCBpbiB0aW1lLgogICAgICogQHBhcmFtIGR0IFRpbWUgc3RlcAogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemUgU2V0IHRvIHRydWUgdG8gbm9ybWFsaXplIHRoZSBib2R5IHF1YXRlcm5pb24KICAgICAqIEBwYXJhbSBxdWF0Tm9ybWFsaXplRmFzdCBJZiB0aGUgcXVhdGVybmlvbiBzaG91bGQgYmUgbm9ybWFsaXplZCB1c2luZyAiZmFzdCIgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uCiAgICAgKi8KCgogICAgaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAvLyBTYXZlIHByZXZpb3VzIHBvc2l0aW9uCiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbi5jb3B5KHRoaXMucG9zaXRpb24pOwogICAgICB0aGlzLnByZXZpb3VzUXVhdGVybmlvbi5jb3B5KHRoaXMucXVhdGVybmlvbik7CgogICAgICBpZiAoISh0aGlzLnR5cGUgPT09IEJvZHkuRFlOQU1JQyB8fCB0aGlzLnR5cGUgPT09IEJvZHkuS0lORU1BVElDKSB8fCB0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB2ZWxvID0gdGhpcy52ZWxvY2l0eTsKICAgICAgY29uc3QgYW5ndWxhclZlbG8gPSB0aGlzLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgY29uc3QgcG9zID0gdGhpcy5wb3NpdGlvbjsKICAgICAgY29uc3QgZm9yY2UgPSB0aGlzLmZvcmNlOwogICAgICBjb25zdCB0b3JxdWUgPSB0aGlzLnRvcnF1ZTsKICAgICAgY29uc3QgcXVhdCA9IHRoaXMucXVhdGVybmlvbjsKICAgICAgY29uc3QgaW52TWFzcyA9IHRoaXMuaW52TWFzczsKICAgICAgY29uc3QgaW52SW5lcnRpYSA9IHRoaXMuaW52SW5lcnRpYVdvcmxkOwogICAgICBjb25zdCBsaW5lYXJGYWN0b3IgPSB0aGlzLmxpbmVhckZhY3RvcjsKICAgICAgY29uc3QgaU1kdCA9IGludk1hc3MgKiBkdDsKICAgICAgdmVsby54ICs9IGZvcmNlLnggKiBpTWR0ICogbGluZWFyRmFjdG9yLng7CiAgICAgIHZlbG8ueSArPSBmb3JjZS55ICogaU1kdCAqIGxpbmVhckZhY3Rvci55OwogICAgICB2ZWxvLnogKz0gZm9yY2UueiAqIGlNZHQgKiBsaW5lYXJGYWN0b3IuejsKICAgICAgY29uc3QgZSA9IGludkluZXJ0aWEuZWxlbWVudHM7CiAgICAgIGNvbnN0IGFuZ3VsYXJGYWN0b3IgPSB0aGlzLmFuZ3VsYXJGYWN0b3I7CiAgICAgIGNvbnN0IHR4ID0gdG9ycXVlLnggKiBhbmd1bGFyRmFjdG9yLng7CiAgICAgIGNvbnN0IHR5ID0gdG9ycXVlLnkgKiBhbmd1bGFyRmFjdG9yLnk7CiAgICAgIGNvbnN0IHR6ID0gdG9ycXVlLnogKiBhbmd1bGFyRmFjdG9yLno7CiAgICAgIGFuZ3VsYXJWZWxvLnggKz0gZHQgKiAoZVswXSAqIHR4ICsgZVsxXSAqIHR5ICsgZVsyXSAqIHR6KTsKICAgICAgYW5ndWxhclZlbG8ueSArPSBkdCAqIChlWzNdICogdHggKyBlWzRdICogdHkgKyBlWzVdICogdHopOwogICAgICBhbmd1bGFyVmVsby56ICs9IGR0ICogKGVbNl0gKiB0eCArIGVbN10gKiB0eSArIGVbOF0gKiB0eik7IC8vIFVzZSBuZXcgdmVsb2NpdHkgIC0gbGVhcCBmcm9nCgogICAgICBwb3MueCArPSB2ZWxvLnggKiBkdDsKICAgICAgcG9zLnkgKz0gdmVsby55ICogZHQ7CiAgICAgIHBvcy56ICs9IHZlbG8ueiAqIGR0OwogICAgICBxdWF0LmludGVncmF0ZSh0aGlzLmFuZ3VsYXJWZWxvY2l0eSwgZHQsIHRoaXMuYW5ndWxhckZhY3RvciwgcXVhdCk7CgogICAgICBpZiAocXVhdE5vcm1hbGl6ZSkgewogICAgICAgIGlmIChxdWF0Tm9ybWFsaXplRmFzdCkgewogICAgICAgICAgcXVhdC5ub3JtYWxpemVGYXN0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHF1YXQubm9ybWFsaXplKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IHRydWU7IC8vIFVwZGF0ZSB3b3JsZCBpbmVydGlhCgogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCgpOwogICAgfQoKICB9CiAgQm9keS5pZENvdW50ZXIgPSAwOwogIEJvZHkuQ09MTElERV9FVkVOVF9OQU1FID0gJ2NvbGxpZGUnOwogIEJvZHkuRFlOQU1JQyA9IEJPRFlfVFlQRVMuRFlOQU1JQzsKICBCb2R5LlNUQVRJQyA9IEJPRFlfVFlQRVMuU1RBVElDOwogIEJvZHkuS0lORU1BVElDID0gQk9EWV9UWVBFUy5LSU5FTUFUSUM7CiAgQm9keS5BV0FLRSA9IEJPRFlfU0xFRVBfU1RBVEVTLkFXQUtFOwogIEJvZHkuU0xFRVBZID0gQk9EWV9TTEVFUF9TVEFURVMuU0xFRVBZOwogIEJvZHkuU0xFRVBJTkcgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUElORzsKICBCb2R5Lndha2V1cEV2ZW50ID0gewogICAgdHlwZTogJ3dha2V1cCcKICB9OwogIEJvZHkuc2xlZXB5RXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXB5JwogIH07CiAgQm9keS5zbGVlcEV2ZW50ID0gewogICAgdHlwZTogJ3NsZWVwJwogIH07CiAgY29uc3QgdG1wVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBRdWF0ID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB1cGRhdGVBQUJCX3NoYXBlQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgdWl3X20xID0gbmV3IE1hdDMoKTsKICBjb25zdCB1aXdfbTIgPSBuZXcgTWF0MygpOwogIG5ldyBNYXQzKCk7CiAgY29uc3QgQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3ZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG8gPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2Vfd29ybGRJbXB1bHNlID0gbmV3IFZlYzMoKTsKICBjb25zdCBCb2R5X2FwcGx5TG9jYWxJbXB1bHNlX3JlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfdXBkYXRlTWFzc1Byb3BlcnRpZXNfaGFsZkV4dGVudHMgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBicm9hZHBoYXNlIGltcGxlbWVudGF0aW9ucwogICAqIEBhdXRob3Igc2NodGVwcGUKICAgKi8KICBjbGFzcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBmb3IgY29sbGlzaW9ucyBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIHRydWUsIHRoZSBicm9hZHBoYXNlIHVzZXMgYm91bmRpbmcgYm94ZXMgZm9yIGludGVyc2VjdGlvbiB0ZXN0cywgZWxzZSBpdCB1c2VzIGJvdW5kaW5nIHNwaGVyZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIGlmIHRoZSBvYmplY3RzIGluIHRoZSB3b3JsZCBtb3ZlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLnVzZUJvdW5kaW5nQm94ZXMgPSBmYWxzZTsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29sbGlzaW9uIHBhaXJzIGZyb20gdGhlIHdvcmxkCiAgICAgKiBAcGFyYW0gd29ybGQgVGhlIHdvcmxkIHRvIHNlYXJjaCBpbgogICAgICogQHBhcmFtIHAxIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICogQHBhcmFtIHAyIEVtcHR5IGFycmF5IHRvIGJlIGZpbGxlZCB3aXRoIGJvZHkgb2JqZWN0cwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsaXNpb25QYWlycyBub3QgaW1wbGVtZW50ZWQgZm9yIHRoaXMgQnJvYWRQaGFzZSBjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSBib2R5IHBhaXIgbmVlZHMgdG8gYmUgaW50ZXJzZWN0aW9uIHRlc3RlZCBhdCBhbGwuCiAgICAgKi8KCgogICAgbmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYm9keUEsIGJvZHlCKSB7CiAgICAgIC8vIENoZWNrIGNvbGxpc2lvbiBmaWx0ZXIgbWFza3MKICAgICAgaWYgKChib2R5QS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlCLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5Qi5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIGJvZHlBLmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9IC8vIENoZWNrIHR5cGVzCgoKICAgICAgaWYgKCgoYm9keUEudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5QS5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSAmJiAoKGJvZHlCLnR5cGUgJiBCb2R5LlNUQVRJQykgIT09IDAgfHwgYm9keUIuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykpIHsKICAgICAgICAvLyBCb3RoIGJvZGllcyBhcmUgc3RhdGljIG9yIHNsZWVwaW5nLiBTa2lwLgogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyB2b2x1bWVzIG9mIHR3byBib2RpZXMgaW50ZXJzZWN0LgogICAgICovCgoKICAgIGludGVyc2VjdGlvblRlc3QoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMikgewogICAgICBpZiAodGhpcy51c2VCb3VuZGluZ0JveGVzKSB7CiAgICAgICAgdGhpcy5kb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqIEBwYXJhbSBwYWlyczEgYm9keUEgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqIEBwYXJhbSBwYWlyczIgYm9keUIgaXMgYXBwZW5kZWQgdG8gdGhpcyBhcnJheSBpZiBpbnRlcnNlY3Rpb24KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nU3BoZXJlQnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHIgPSBCcm9hZHBoYXNlX2NvbGxpc2lvblBhaXJzX3I7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIHIpOwogICAgICBjb25zdCBib3VuZGluZ1JhZGl1c1N1bTIgPSAoYm9keUEuYm91bmRpbmdSYWRpdXMgKyBib2R5Qi5ib3VuZGluZ1JhZGl1cykgKiogMjsKICAgICAgY29uc3Qgbm9ybTIgPSByLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChub3JtMiA8IGJvdW5kaW5nUmFkaXVzU3VtMikgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIGJveGVzIG9mIHR3byBib2RpZXMgYXJlIGludGVyc2VjdGluZy4KICAgICAqLwoKCiAgICBkb0JvdW5kaW5nQm94QnJvYWRwaGFzZShib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmIChib2R5QS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5QS51cGRhdGVBQUJCKCk7CiAgICAgIH0KCiAgICAgIGlmIChib2R5Qi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICBib2R5Qi51cGRhdGVBQUJCKCk7CiAgICAgIH0gLy8gQ2hlY2sgQUFCQiAvIEFBQkIKCgogICAgICBpZiAoYm9keUEuYWFiYi5vdmVybGFwcyhib2R5Qi5hYWJiKSkgewogICAgICAgIHBhaXJzMS5wdXNoKGJvZHlBKTsKICAgICAgICBwYWlyczIucHVzaChib2R5Qik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBkdXBsaWNhdGUgcGFpcnMgZnJvbSB0aGUgcGFpciBhcnJheXMuCiAgICAgKi8KCgogICAgbWFrZVBhaXJzVW5pcXVlKHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IHQgPSBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wOwogICAgICBjb25zdCBwMSA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxOwogICAgICBjb25zdCBwMiA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyOwogICAgICBjb25zdCBOID0gcGFpcnMxLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBwMVtpXSA9IHBhaXJzMVtpXTsKICAgICAgICBwMltpXSA9IHBhaXJzMltpXTsKICAgICAgfQoKICAgICAgcGFpcnMxLmxlbmd0aCA9IDA7CiAgICAgIHBhaXJzMi5sZW5ndGggPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGlkMSA9IHAxW2ldLmlkOwogICAgICAgIGNvbnN0IGlkMiA9IHAyW2ldLmlkOwogICAgICAgIGNvbnN0IGtleSA9IGlkMSA8IGlkMiA/IGAke2lkMX0sJHtpZDJ9YCA6IGAke2lkMn0sJHtpZDF9YDsKICAgICAgICB0W2tleV0gPSBpOwogICAgICAgIHQua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0LmtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSB0LmtleXMucG9wKCk7CiAgICAgICAgY29uc3QgcGFpckluZGV4ID0gdFtrZXldOwogICAgICAgIHBhaXJzMS5wdXNoKHAxW3BhaXJJbmRleF0pOwogICAgICAgIHBhaXJzMi5wdXNoKHAyW3BhaXJJbmRleF0pOwogICAgICAgIGRlbGV0ZSB0W2tleV07CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVG8gYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2Fzc2VzCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHt9CiAgICAvKioKICAgICAqIENoZWNrIGlmIHRoZSBib3VuZGluZyBzcGhlcmVzIG9mIHR3byBib2RpZXMgb3ZlcmxhcC4KICAgICAqLwoKCiAgICBzdGF0aWMgYm91bmRpbmdTcGhlcmVDaGVjayhib2R5QSwgYm9keUIpIHsKICAgICAgY29uc3QgZGlzdCA9IG5ldyBWZWMzKCk7IC8vIGJzY19kaXN0OwoKICAgICAgYm9keUEucG9zaXRpb24udnN1Yihib2R5Qi5wb3NpdGlvbiwgZGlzdCk7CiAgICAgIGNvbnN0IHNhID0gYm9keUEuc2hhcGVzWzBdOwogICAgICBjb25zdCBzYiA9IGJvZHlCLnNoYXBlc1swXTsKICAgICAgcmV0dXJuIE1hdGgucG93KHNhLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2IuYm91bmRpbmdTcGhlcmVSYWRpdXMsIDIpID4gZGlzdC5sZW5ndGhTcXVhcmVkKCk7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYWxsIHRoZSBib2RpZXMgd2l0aGluIHRoZSBBQUJCLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGNvbnNvbGUud2FybignLmFhYmJRdWVyeSBpcyBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBCcm9hZHBoYXNlIHN1YmNsYXNzLicpOwogICAgICByZXR1cm4gW107CiAgICB9CgogIH0gLy8gVGVtcCBvYmplY3RzCgogIGNvbnN0IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfciA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUXVhdGVybmlvbigpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfdGVtcCA9IHsKICAgIGtleXM6IFtdCiAgfTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV9wMSA9IFtdOwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AyID0gW107CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIE5haXZlIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb24sIHVzZWQgaW4gbGFjayBvZiBiZXR0ZXIgb25lcy4KICAgKgogICAqIFRoZSBuYWl2ZSBicm9hZHBoYXNlIGxvb2tzIGF0IGFsbCBwb3NzaWJsZSBwYWlycyB3aXRob3V0IHJlc3RyaWN0aW9uLCB0aGVyZWZvcmUgaXQgaGFzIGNvbXBsZXhpdHkgTl4yIF8od2hpY2ggaXMgYmFkKV8KICAgKi8KICBjbGFzcyBOYWl2ZUJyb2FkcGhhc2UgZXh0ZW5kcyBCcm9hZHBoYXNlIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgdGhlIGNvbGxpc2lvbiBwYWlycyBpbiB0aGUgcGh5c2ljcyB3b3JsZAogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwYWlyczEsIHBhaXJzMikgewogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IG4gPSBib2RpZXMubGVuZ3RoOwogICAgICBsZXQgYmk7CiAgICAgIGxldCBiajsgLy8gTmFpdmUgTl4yIGZ0dyEKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gaTsgaisrKSB7CiAgICAgICAgICBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHBhaXJzMSwgcGFpcnMyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gd29ybGQuYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0gLy8gVWdseSBoYWNrIHVudGlsIEJvZHkgZ2V0cyBhYWJiCgoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgLyoqCiAgICogU3RvcmFnZSBmb3IgUmF5IGNhc3RpbmcgZGF0YQogICAqLwogIGNsYXNzIFJheWNhc3RSZXN1bHQgewogICAgLyoqCiAgICAgKiByYXlGcm9tV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogcmF5VG9Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXROb3JtYWxXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBoaXRQb2ludFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhhc0hpdAogICAgICovCgogICAgLyoqCiAgICAgKiBzaGFwZQogICAgICovCgogICAgLyoqCiAgICAgKiBib2R5CiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleCBvZiB0aGUgaGl0IHRyaWFuZ2xlLCBpZiB0aGUgaGl0IHNoYXBlIHdhcyBhIHRyaW1lc2gKICAgICAqLwoKICAgIC8qKgogICAgICogRGlzdGFuY2UgdG8gdGhlIGhpdC4gV2lsbCBiZSBzZXQgdG8gLTEgaWYgdGhlcmUgd2FzIG5vIGhpdAogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgcmF5IHNob3VsZCBzdG9wIHRyYXZlcnNpbmcgdGhlIGJvZGllcwogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJheVRvV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIFJlc2V0IGFsbCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLnJheVRvV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdE5vcm1hbFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLnNldFplcm8oKTsKICAgICAgdGhpcy5oYXNIaXQgPSBmYWxzZTsKICAgICAgdGhpcy5zaGFwZSA9IG51bGw7CiAgICAgIHRoaXMuYm9keSA9IG51bGw7CiAgICAgIHRoaXMuaGl0RmFjZUluZGV4ID0gLTE7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSAtMTsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIGFib3J0CiAgICAgKi8KCgogICAgYWJvcnQoKSB7CiAgICAgIHRoaXMuc2hvdWxkU3RvcCA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCByZXN1bHQgZGF0YS4KICAgICAqLwoKCiAgICBzZXQocmF5RnJvbVdvcmxkLCByYXlUb1dvcmxkLCBoaXROb3JtYWxXb3JsZCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKSB7CiAgICAgIHRoaXMucmF5RnJvbVdvcmxkLmNvcHkocmF5RnJvbVdvcmxkKTsKICAgICAgdGhpcy5yYXlUb1dvcmxkLmNvcHkocmF5VG9Xb3JsZCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuY29weShoaXROb3JtYWxXb3JsZCk7CiAgICAgIHRoaXMuaGl0UG9pbnRXb3JsZC5jb3B5KGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnNoYXBlID0gc2hhcGU7CiAgICAgIHRoaXMuYm9keSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgIH0KCiAgfQoKICBsZXQgX1NoYXBlJHR5cGVzJFNQSEVSRSwgX1NoYXBlJHR5cGVzJFBMQU5FLCBfU2hhcGUkdHlwZXMkQk9YLCBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIsIF9TaGFwZSR0eXBlcyRDT05WRVhQTywgX1NoYXBlJHR5cGVzJEhFSUdIVEZJLCBfU2hhcGUkdHlwZXMkVFJJTUVTSDsKCiAgLyoqCiAgICogUkFZX01PREVTCiAgICovCiAgY29uc3QgUkFZX01PREVTID0gewogICAgLyoqIENMT1NFU1QgKi8KICAgIENMT1NFU1Q6IDEsCgogICAgLyoqIEFOWSAqLwogICAgQU5ZOiAyLAoKICAgIC8qKiBBTEwgKi8KICAgIEFMTDogNAogIH07CiAgLyoqCiAgICogUmF5TW9kZQogICAqLwoKICBfU2hhcGUkdHlwZXMkU1BIRVJFID0gU2hhcGUudHlwZXMuU1BIRVJFOwogIF9TaGFwZSR0eXBlcyRQTEFORSA9IFNoYXBlLnR5cGVzLlBMQU5FOwogIF9TaGFwZSR0eXBlcyRCT1ggPSBTaGFwZS50eXBlcy5CT1g7CiAgX1NoYXBlJHR5cGVzJENZTElOREVSID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgX1NoYXBlJHR5cGVzJENPTlZFWFBPID0gU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTjsKICBfU2hhcGUkdHlwZXMkSEVJR0hURkkgPSBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRDsKICBfU2hhcGUkdHlwZXMkVFJJTUVTSCA9IFNoYXBlLnR5cGVzLlRSSU1FU0g7CgogIC8qKgogICAqIEEgbGluZSBpbiAzRCBzcGFjZSB0aGF0IGludGVyc2VjdHMgYm9kaWVzIGFuZCByZXR1cm4gcG9pbnRzLgogICAqLwogIGNsYXNzIFJheSB7CiAgICAvKioKICAgICAqIGZyb20KICAgICAqLwoKICAgIC8qKgogICAgICogdG8KICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBwcmVjaXNpb24gb2YgdGhlIHJheS4gVXNlZCB3aGVuIGNoZWNraW5nIHBhcmFsbGVsaXR5IGV0Yy4KICAgICAqIEBkZWZhdWx0IDAuMDAwMQogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gYGZhbHNlYCBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgUmF5IHRvIHRha2UgYGNvbGxpc2lvblJlc3BvbnNlYCBmbGFncyBpbnRvIGFjY291bnQgb24gYm9kaWVzIGFuZCBzaGFwZXMuCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHNldCB0byBgdHJ1ZWAsIHRoZSByYXkgc2tpcHMgYW55IGhpdHMgd2l0aCBub3JtYWwuZG90KHJheURpcmVjdGlvbikgPCAwLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyTWFzawogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogY29sbGlzaW9uRmlsdGVyR3JvdXAKICAgICAqIEBkZWZhdWx0IC0xCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbnRlcnNlY3Rpb24gbW9kZS4gU2hvdWxkIGJlIFJheS5BTlksIFJheS5BTEwgb3IgUmF5LkNMT1NFU1QuCiAgICAgKiBAZGVmYXVsdCBSQVkuQU5ZCiAgICAgKi8KCiAgICAvKioKICAgICAqIEN1cnJlbnQgcmVzdWx0IG9iamVjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogV2lsbCBiZSBzZXQgdG8gYHRydWVgIGR1cmluZyBpbnRlcnNlY3RXb3JsZCgpIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VyLXByb3ZpZGVkIHJlc3VsdCBjYWxsYmFjay4gV2lsbCBiZSB1c2VkIGlmIG1vZGUgaXMgUmF5LkFMTC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ0xPU0VTVAogICAgICovCgogICAgLyoqCiAgICAgKiBBTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQUxMCiAgICAgKi8KICAgIGdldCBbX1NoYXBlJHR5cGVzJFNQSEVSRV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkUExBTkVdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0UGxhbmU7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQk9YXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEJveDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDWUxJTkRFUl0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkQ09OVkVYUE9dKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Q29udmV4OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJEhFSUdIVEZJXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJFRSSU1FU0hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0VHJpbWVzaDsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcihmcm9tLCB0bykgewogICAgICBpZiAoZnJvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgZnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0byA9PT0gdm9pZCAwKSB7CiAgICAgICAgdG8gPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLmZyb20gPSBmcm9tLmNsb25lKCk7CiAgICAgIHRoaXMudG8gPSB0by5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJlY2lzaW9uID0gMC4wMDAxOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0cnVlOwogICAgICB0aGlzLnNraXBCYWNrZmFjZXMgPSBmYWxzZTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSAtMTsKICAgICAgdGhpcy5tb2RlID0gUmF5LkFOWTsKICAgICAgdGhpcy5yZXN1bHQgPSBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwoKICAgICAgdGhpcy5jYWxsYmFjayA9IHJlc3VsdCA9PiB7fTsKICAgIH0KICAgIC8qKgogICAgICogRG8gaXRlcnNlY3Rpb24gYWdhaW5zdCBhbGwgYm9kaWVzIGluIHRoZSBnaXZlbiBXb3JsZC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgcmF5IGhpdCBhbnl0aGluZywgb3RoZXJ3aXNlIGZhbHNlLgogICAgICovCgoKICAgIGludGVyc2VjdFdvcmxkKHdvcmxkLCBvcHRpb25zKSB7CiAgICAgIHRoaXMubW9kZSA9IG9wdGlvbnMubW9kZSB8fCBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG9wdGlvbnMucmVzdWx0IHx8IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9ICEhb3B0aW9ucy5za2lwQmFja2ZhY2VzOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA6IC0xOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyR3JvdXAgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA6IC0xOwogICAgICB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0eXBlb2Ygb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CgogICAgICBpZiAob3B0aW9ucy5mcm9tKSB7CiAgICAgICAgdGhpcy5mcm9tLmNvcHkob3B0aW9ucy5mcm9tKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMudG8pIHsKICAgICAgICB0aGlzLnRvLmNvcHkob3B0aW9ucy50byk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FsbGJhY2sgPSBvcHRpb25zLmNhbGxiYWNrIHx8ICgoKSA9PiB7fSk7CgogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnJlc3VsdC5yZXNldCgpOwogICAgICB0aGlzLnVwZGF0ZURpcmVjdGlvbigpOwogICAgICB0aGlzLmdldEFBQkIodG1wQUFCQiQxKTsKICAgICAgdG1wQXJyYXkubGVuZ3RoID0gMDsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5hYWJiUXVlcnkod29ybGQsIHRtcEFBQkIkMSwgdG1wQXJyYXkpOwogICAgICB0aGlzLmludGVyc2VjdEJvZGllcyh0bXBBcnJheSk7CiAgICAgIHJldHVybiB0aGlzLmhhc0hpdDsKICAgIH0KICAgIC8qKgogICAgICogU2hvb3QgYSByYXkgYXQgYSBib2R5LCBnZXQgYmFjayBpbmZvcm1hdGlvbiBhYm91dCB0aGUgaGl0LgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0Qm9keShib2R5LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgPSB0aGlzLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2U7CgogICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhYm9keS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCh0aGlzLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCB8fCAoYm9keS5jb2xsaXNpb25GaWx0ZXJHcm91cCAmIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHhpID0gaW50ZXJzZWN0Qm9keV94aTsKICAgICAgY29uc3QgcWkgPSBpbnRlcnNlY3RCb2R5X3FpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSBib2R5LnNoYXBlcy5sZW5ndGg7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IGJvZHkuc2hhcGVzW2ldOwoKICAgICAgICBpZiAoY2hlY2tDb2xsaXNpb25SZXNwb25zZSAmJiAhc2hhcGUuY29sbGlzaW9uUmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwCiAgICAgICAgfQoKICAgICAgICBib2R5LnF1YXRlcm5pb24ubXVsdChib2R5LnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgYm9keS5xdWF0ZXJuaW9uLnZtdWx0KGJvZHkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgeGkudmFkZChib2R5LnBvc2l0aW9uLCB4aSk7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RTaGFwZShzaGFwZSwgcWksIHhpLCBib2R5KTsKCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhbiBhcnJheSBib2RpZXMsIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAcGFyYW0gYm9kaWVzIEFuIGFycmF5IG9mIEJvZHkgb2JqZWN0cy4KICAgICAqIEBkZXByZWNhdGVkIEBwYXJhbSByZXN1bHQgc2V0IHRoZSByZXN1bHQgcHJvcGVydHkgb2YgdGhlIFJheSBpbnN0ZWFkLgogICAgICoKICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2RpZXMoYm9kaWVzLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYm9kaWVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSA8IGw7IGkrKykgewogICAgICAgIHRoaXMuaW50ZXJzZWN0Qm9keShib2RpZXNbaV0pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZXMgdGhlIGRpcmVjdGlvbiB2ZWN0b3IuCiAgICAgKi8KCgogICAgdXBkYXRlRGlyZWN0aW9uKCkgewogICAgICB0aGlzLnRvLnZzdWIodGhpcy5mcm9tLCB0aGlzLmRpcmVjdGlvbik7CiAgICAgIHRoaXMuZGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgfQoKICAgIGludGVyc2VjdFNoYXBlKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOyAvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZQoKICAgICAgY29uc3QgZGlzdGFuY2UgPSBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgdGhpcy5kaXJlY3Rpb24sIHBvc2l0aW9uKTsKCiAgICAgIGlmIChkaXN0YW5jZSA+IHNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBpbnRlcnNlY3RNZXRob2QgPSB0aGlzW3NoYXBlLnR5cGVdOwoKICAgICAgaWYgKGludGVyc2VjdE1ldGhvZCkgewogICAgICAgIGludGVyc2VjdE1ldGhvZC5jYWxsKHRoaXMsIHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgc2hhcGUpOwogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdEJveChib3gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXgoYm94LmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpOwogICAgfQoKICAgIF9pbnRlcnNlY3RQbGFuZShzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsgLy8gR2V0IHBsYW5lIG5vcm1hbAoKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBuZXcgVmVjMygwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOwogICAgICBjb25zdCBsZW4gPSBuZXcgVmVjMygpOwogICAgICBmcm9tLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9Gcm9tID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgIHRvLnZzdWIocG9zaXRpb24sIGxlbik7CiAgICAgIGNvbnN0IHBsYW5lVG9UbyA9IGxlbi5kb3Qod29ybGROb3JtYWwpOwoKICAgICAgaWYgKHBsYW5lVG9Gcm9tICogcGxhbmVUb1RvID4gMCkgewogICAgICAgIC8vICJmcm9tIiBhbmQgInRvIiBhcmUgb24gdGhlIHNhbWUgc2lkZSBvZiB0aGUgcGxhbmUuLi4gYmFpbCBvdXQKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChmcm9tLmRpc3RhbmNlVG8odG8pIDwgcGxhbmVUb0Zyb20pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IG5fZG90X2RpciA9IHdvcmxkTm9ybWFsLmRvdChkaXJlY3Rpb24pOwoKICAgICAgaWYgKE1hdGguYWJzKG5fZG90X2RpcikgPCB0aGlzLnByZWNpc2lvbikgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcGxhbmVQb2ludFRvRnJvbSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGRpcl9zY2FsZWRfd2l0aF90ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGl0UG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgcGxhbmVQb2ludFRvRnJvbSk7CiAgICAgIGNvbnN0IHQgPSAtd29ybGROb3JtYWwuZG90KHBsYW5lUG9pbnRUb0Zyb20pIC8gbl9kb3RfZGlyOwogICAgICBkaXJlY3Rpb24uc2NhbGUodCwgZGlyX3NjYWxlZF93aXRoX3QpOwogICAgICBmcm9tLnZhZGQoZGlyX3NjYWxlZF93aXRoX3QsIGhpdFBvaW50V29ybGQpOwogICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHdvcmxkIEFBQkIgb2YgdGhlIHJheS4KICAgICAqLwoKCiAgICBnZXRBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgewogICAgICAgIGxvd2VyQm91bmQsCiAgICAgICAgdXBwZXJCb3VuZAogICAgICB9ID0gYWFiYjsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBsb3dlckJvdW5kLnggPSBNYXRoLm1pbih0by54LCBmcm9tLngpOwogICAgICBsb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0by55LCBmcm9tLnkpOwogICAgICBsb3dlckJvdW5kLnogPSBNYXRoLm1pbih0by56LCBmcm9tLnopOwogICAgICB1cHBlckJvdW5kLnggPSBNYXRoLm1heCh0by54LCBmcm9tLngpOwogICAgICB1cHBlckJvdW5kLnkgPSBNYXRoLm1heCh0by55LCBmcm9tLnkpOwogICAgICB1cHBlckJvdW5kLnogPSBNYXRoLm1heCh0by56LCBmcm9tLnopOwogICAgfQoKICAgIF9pbnRlcnNlY3RIZWlnaHRmaWVsZChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgc2hhcGUuZGF0YTsKICAgICAgc2hhcGUuZWxlbWVudFNpemU7IC8vIENvbnZlcnQgdGhlIHJheSB0byBsb2NhbCBoZWlnaHRmaWVsZCBjb29yZGluYXRlcwoKICAgICAgY29uc3QgbG9jYWxSYXkgPSBpbnRlcnNlY3RIZWlnaHRmaWVsZF9sb2NhbFJheTsgLy9uZXcgUmF5KHRoaXMuZnJvbSwgdGhpcy50byk7CgogICAgICBsb2NhbFJheS5mcm9tLmNvcHkodGhpcy5mcm9tKTsKICAgICAgbG9jYWxSYXkudG8uY29weSh0aGlzLnRvKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS5mcm9tLCBsb2NhbFJheS5mcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBsb2NhbFJheS50bywgbG9jYWxSYXkudG8pOwogICAgICBsb2NhbFJheS51cGRhdGVEaXJlY3Rpb24oKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBjb25zdCBpbmRleCA9IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4OwogICAgICBsZXQgaU1pblg7CiAgICAgIGxldCBpTWluWTsKICAgICAgbGV0IGlNYXhYOwogICAgICBsZXQgaU1heFk7IC8vIFNldCB0byBtYXgKCiAgICAgIGlNaW5YID0gaU1pblkgPSAwOwogICAgICBpTWF4WCA9IGlNYXhZID0gc2hhcGUuZGF0YS5sZW5ndGggLSAxOwogICAgICBjb25zdCBhYWJiID0gbmV3IEFBQkIoKTsKICAgICAgbG9jYWxSYXkuZ2V0QUFCQihhYWJiKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWluWCA9IE1hdGgubWF4KGlNaW5YLCBpbmRleFswXSk7CiAgICAgIGlNaW5ZID0gTWF0aC5tYXgoaU1pblksIGluZGV4WzFdKTsKICAgICAgc2hhcGUuZ2V0SW5kZXhPZlBvc2l0aW9uKGFhYmIudXBwZXJCb3VuZC54LCBhYWJiLnVwcGVyQm91bmQueSwgaW5kZXgsIHRydWUpOwogICAgICBpTWF4WCA9IE1hdGgubWluKGlNYXhYLCBpbmRleFswXSArIDEpOwogICAgICBpTWF4WSA9IE1hdGgubWluKGlNYXhZLCBpbmRleFsxXSArIDEpOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICBzaGFwZS5nZXRBYWJiQXRJbmRleChpLCBqLCBhYWJiKTsKCiAgICAgICAgICBpZiAoIWFhYmIub3ZlcmxhcHNSYXkobG9jYWxSYXkpKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfSAvLyBMb3dlciB0cmlhbmdsZQoKCiAgICAgICAgICBzaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKCiAgICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBzaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICB0aGlzLl9pbnRlcnNlY3RDb252ZXgoc2hhcGUucGlsbGFyQ29udmV4LCBxdWF0LCB3b3JsZFBpbGxhck9mZnNldCwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgaW50ZXJzZWN0Q29udmV4T3B0aW9ucyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdFNwaGVyZShzcGhlcmUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlKSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgciA9IHNwaGVyZS5yYWRpdXM7CiAgICAgIGNvbnN0IGEgPSAodG8ueCAtIGZyb20ueCkgKiogMiArICh0by55IC0gZnJvbS55KSAqKiAyICsgKHRvLnogLSBmcm9tLnopICoqIDI7CiAgICAgIGNvbnN0IGIgPSAyICogKCh0by54IC0gZnJvbS54KSAqIChmcm9tLnggLSBwb3NpdGlvbi54KSArICh0by55IC0gZnJvbS55KSAqIChmcm9tLnkgLSBwb3NpdGlvbi55KSArICh0by56IC0gZnJvbS56KSAqIChmcm9tLnogLSBwb3NpdGlvbi56KSk7CiAgICAgIGNvbnN0IGMgPSAoZnJvbS54IC0gcG9zaXRpb24ueCkgKiogMiArIChmcm9tLnkgLSBwb3NpdGlvbi55KSAqKiAyICsgKGZyb20ueiAtIHBvc2l0aW9uLnopICoqIDIgLSByICoqIDI7CiAgICAgIGNvbnN0IGRlbHRhID0gYiAqKiAyIC0gNCAqIGEgKiBjOwogICAgICBjb25zdCBpbnRlcnNlY3Rpb25Qb2ludCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfaW50ZXJzZWN0aW9uUG9pbnQ7CiAgICAgIGNvbnN0IG5vcm1hbCA9IFJheV9pbnRlcnNlY3RTcGhlcmVfbm9ybWFsOwoKICAgICAgaWYgKGRlbHRhIDwgMCkgewogICAgICAgIC8vIE5vIGludGVyc2VjdGlvbgogICAgICAgIHJldHVybjsKICAgICAgfSBlbHNlIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgIC8vIHNpbmdsZSBpbnRlcnNlY3Rpb24gcG9pbnQKICAgICAgICBmcm9tLmxlcnAodG8sIGRlbHRhLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGQxID0gKC1iIC0gTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwogICAgICAgIGNvbnN0IGQyID0gKC1iICsgTWF0aC5zcXJ0KGRlbHRhKSkgLyAoMiAqIGEpOwoKICAgICAgICBpZiAoZDEgPj0gMCAmJiBkMSA8PSAxKSB7CiAgICAgICAgICBmcm9tLmxlcnAodG8sIGQxLCBpbnRlcnNlY3Rpb25Qb2ludCk7CiAgICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3Rpb25Qb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgLTEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkMiA+PSAwICYmIGQyIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDIsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgX2ludGVyc2VjdENvbnZleChzaGFwZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUsIG9wdGlvbnMpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gaW50ZXJzZWN0Q29udmV4X25vcm1hbDsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBvcHRpb25zICYmIG9wdGlvbnMuZmFjZUxpc3QgfHwgbnVsbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGZhY2VzID0gc2hhcGUuZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gc2hhcGUudmVydGljZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSBzaGFwZS5mYWNlTm9ybWFsczsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZnJvbVRvRGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8odG8pOwogICAgICBjb25zdCBOZmFjZXMgPSBmYWNlTGlzdCA/IGZhY2VMaXN0Lmxlbmd0aCA6IGZhY2VzLmxlbmd0aDsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7CgogICAgICBmb3IgKGxldCBqID0gMDsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGogPCBOZmFjZXM7IGorKykgewogICAgICAgIGNvbnN0IGZpID0gZmFjZUxpc3QgPyBmYWNlTGlzdFtqXSA6IGo7CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ZpXTsKICAgICAgICBjb25zdCBmYWNlTm9ybWFsID0gbm9ybWFsc1tmaV07CiAgICAgICAgY29uc3QgcSA9IHF1YXQ7CiAgICAgICAgY29uc3QgeCA9IHBvc2l0aW9uOyAvLyBkZXRlcm1pbmUgaWYgcmF5IGludGVyc2VjdHMgdGhlIHBsYW5lIG9mIHRoZSBmYWNlCiAgICAgICAgLy8gbm90ZTogdGhpcyB3b3JrcyByZWdhcmRsZXNzIG9mIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGZhY2Ugbm9ybWFsCiAgICAgICAgLy8gR2V0IHBsYW5lIHBvaW50IGluIHdvcmxkIGNvb3JkaW5hdGVzLi4uCgogICAgICAgIHZlY3Rvci5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KHZlY3RvciwgdmVjdG9yKTsKICAgICAgICB2ZWN0b3IudmFkZCh4LCB2ZWN0b3IpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICB2ZWN0b3IudnN1Yihmcm9tLCB2ZWN0b3IpOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICAgIHEudm11bHQoZmFjZU5vcm1hbCwgbm9ybWFsKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gZGlyZWN0aW9uLmRvdChub3JtYWwpOyAvLyBCYWlsIG91dCBpZiByYXkgYW5kIHBsYW5lIGFyZSBwYXJhbGxlbAoKICAgICAgICBpZiAoTWF0aC5hYnMoZG90KSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCgogICAgICAgIGNvbnN0IHNjYWxhciA9IG5vcm1hbC5kb3QodmVjdG9yKSAvIGRvdDsgLy8gaWYgbmVnYXRpdmUgZGlzdGFuY2UsIHRoZW4gcGxhbmUgaXMgYmVoaW5kIHJheQoKICAgICAgICBpZiAoc2NhbGFyIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyBpZiAoZG90IDwgMCkgewogICAgICAgIC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBkaXJlY3Rpb24uc2NhbGUoc2NhbGFyLCBpbnRlcnNlY3RQb2ludCk7CiAgICAgICAgaW50ZXJzZWN0UG9pbnQudmFkZChmcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIGEgaXMgdGhlIHBvaW50IHdlIGNvbXBhcmUgcG9pbnRzIGIgYW5kIGMgd2l0aC4KCiAgICAgICAgYS5jb3B5KHZlcnRpY2VzW2ZhY2VbMF1dKTsKICAgICAgICBxLnZtdWx0KGEsIGEpOwogICAgICAgIHgudmFkZChhLCBhKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDE7ICFyZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgZmFjZS5sZW5ndGggLSAxOyBpKyspIHsKICAgICAgICAgIC8vIFRyYW5zZm9ybSAzIHZlcnRpY2VzIHRvIHdvcmxkIGNvb3JkcwogICAgICAgICAgYi5jb3B5KHZlcnRpY2VzW2ZhY2VbaV1dKTsKICAgICAgICAgIGMuY29weSh2ZXJ0aWNlc1tmYWNlW2kgKyAxXV0pOwogICAgICAgICAgcS52bXVsdChiLCBiKTsKICAgICAgICAgIHEudm11bHQoYywgYyk7CiAgICAgICAgICB4LnZhZGQoYiwgYik7CiAgICAgICAgICB4LnZhZGQoYywgYyk7CiAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGludGVyc2VjdFBvaW50LmRpc3RhbmNlVG8oZnJvbSk7CgogICAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykpIHx8IGRpc3RhbmNlID4gZnJvbVRvRGlzdGFuY2UpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBpbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgZmkpOwogICAgICAgIH0gLy8gfQoKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBPcHRpbWl6ZSBieSB0cmFuc2Zvcm1pbmcgdGhlIHdvcmxkIHRvIGxvY2FsIHNwYWNlIGZpcnN0LgogICAgICogQHRvZG8gVXNlIE9jdHJlZSBsb29rdXAKICAgICAqLwoKCiAgICBfaW50ZXJzZWN0VHJpbWVzaChtZXNoLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX25vcm1hbDsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXM7CiAgICAgIGNvbnN0IHRyZWVUcmFuc2Zvcm0gPSBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm07CiAgICAgIGNvbnN0IHZlY3RvciA9IGludGVyc2VjdENvbnZleF92ZWN0b3I7CiAgICAgIGNvbnN0IGxvY2FsRGlyZWN0aW9uID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbjsKICAgICAgY29uc3QgbG9jYWxGcm9tID0gaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb207CiAgICAgIGNvbnN0IGxvY2FsVG8gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsVG87CiAgICAgIGNvbnN0IHdvcmxkSW50ZXJzZWN0UG9pbnQgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQ7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbDsgLy8gQ2hlY2tpbmcgZmFjZXMKCiAgICAgIGNvbnN0IGluZGljZXMgPSBtZXNoLmluZGljZXM7CiAgICAgIG1lc2gudmVydGljZXM7IC8vIGNvbnN0IG5vcm1hbHMgPSBtZXNoLmZhY2VOb3JtYWxzCgogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOwogICAgICB0cmVlVHJhbnNmb3JtLnBvc2l0aW9uLmNvcHkocG9zaXRpb24pOwogICAgICB0cmVlVHJhbnNmb3JtLnF1YXRlcm5pb24uY29weShxdWF0KTsgLy8gVHJhbnNmb3JtIHJheSB0byBsb2NhbCBzcGFjZSEKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGRpcmVjdGlvbiwgbG9jYWxEaXJlY3Rpb24pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGZyb20sIGxvY2FsRnJvbSk7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgdG8sIGxvY2FsVG8pOwogICAgICBsb2NhbFRvLnggKj0gbWVzaC5zY2FsZS54OwogICAgICBsb2NhbFRvLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbFRvLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbEZyb20ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsRnJvbS55ICo9IG1lc2guc2NhbGUueTsKICAgICAgbG9jYWxGcm9tLnogKj0gbWVzaC5zY2FsZS56OwogICAgICBsb2NhbFRvLnZzdWIobG9jYWxGcm9tLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIGxvY2FsRGlyZWN0aW9uLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZVNxdWFyZWQgPSBsb2NhbEZyb20uZGlzdGFuY2VTcXVhcmVkKGxvY2FsVG8pOwogICAgICBtZXNoLnRyZWUucmF5UXVlcnkodGhpcywgdHJlZVRyYW5zZm9ybSwgdHJpYW5nbGVzKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdHJpYW5nbGVzLmxlbmd0aDsgIXRoaXMucmVzdWx0LnNob3VsZFN0b3AgJiYgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgdHJpYW5nbGVzSW5kZXggPSB0cmlhbmdsZXNbaV07CiAgICAgICAgbWVzaC5nZXROb3JtYWwodHJpYW5nbGVzSW5kZXgsIG5vcm1hbCk7IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDNdLCBhKTsgLy8gLi4uYnV0IG1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIHJheSBmcm9tLiBXZSdsbCBmaXggdGhpcyBsYXRlci4KCiAgICAgICAgYS52c3ViKGxvY2FsRnJvbSwgdmVjdG9yKTsgLy8gSWYgdGhpcyBkb3QgcHJvZHVjdCBpcyBuZWdhdGl2ZSwgd2UgaGF2ZSBzb21ldGhpbmcgaW50ZXJlc3RpbmcKCiAgICAgICAgY29uc3QgZG90ID0gbG9jYWxEaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCiAgICAgICAgLy8gaWYgKE1hdGguYWJzKCBkb3QgKSA8IHRoaXMucHJlY2lzaW9uKXsKICAgICAgICAvLyAgICAgY29udGludWU7CiAgICAgICAgLy8gfQogICAgICAgIC8vIGNhbGMgZGlzdGFuY2UgdG8gcGxhbmUKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIEludGVyc2VjdGlvbiBwb2ludCBpcyBmcm9tICsgZGlyZWN0aW9uICogc2NhbGFyCgoKICAgICAgICBsb2NhbERpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGxvY2FsRnJvbSwgaW50ZXJzZWN0UG9pbnQpOyAvLyBHZXQgdHJpYW5nbGUgdmVydGljZXMKCiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAxXSwgYik7CiAgICAgICAgbWVzaC5nZXRWZXJ0ZXgoaW5kaWNlc1t0cmlhbmdsZXNJbmRleCAqIDMgKyAyXSwgYyk7CiAgICAgICAgY29uc3Qgc3F1YXJlZERpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VTcXVhcmVkKGxvY2FsRnJvbSk7CgogICAgICAgIGlmICghKFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGIsIGEsIGMpIHx8IFJheS5wb2ludEluVHJpYW5nbGUoaW50ZXJzZWN0UG9pbnQsIGEsIGIsIGMpKSB8fCBzcXVhcmVkRGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZVNxdWFyZWQpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gdHJhbnNmb3JtIGludGVyc2VjdHBvaW50IGFuZCBub3JtYWwgdG8gd29ybGQKCgogICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUocXVhdCwgbm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvc2l0aW9uLCBxdWF0LCBpbnRlcnNlY3RQb2ludCwgd29ybGRJbnRlcnNlY3RQb2ludCk7CiAgICAgICAgdGhpcy5yZXBvcnRJbnRlcnNlY3Rpb24od29ybGROb3JtYWwsIHdvcmxkSW50ZXJzZWN0UG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIHRyaWFuZ2xlc0luZGV4KTsKICAgICAgfQoKICAgICAgdHJpYW5nbGVzLmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiB0aGUgaW50ZXJzZWN0aW9ucyBzaG91bGQgY29udGludWUKICAgICAqLwoKCiAgICByZXBvcnRJbnRlcnNlY3Rpb24obm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgaGl0RmFjZUluZGV4KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlzdGFuY2UgPSBmcm9tLmRpc3RhbmNlVG8oaGl0UG9pbnRXb3JsZCk7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OyAvLyBTa2lwIGJhY2sgZmFjZXM/CgogICAgICBpZiAodGhpcy5za2lwQmFja2ZhY2VzICYmIG5vcm1hbC5kb3QodGhpcy5kaXJlY3Rpb24pID4gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgcmVzdWx0LmhpdEZhY2VJbmRleCA9IHR5cGVvZiBoaXRGYWNlSW5kZXggIT09ICd1bmRlZmluZWQnID8gaGl0RmFjZUluZGV4IDogLTE7CgogICAgICBzd2l0Y2ggKHRoaXMubW9kZSkgewogICAgICAgIGNhc2UgUmF5LkFMTDoKICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgdGhpcy5jYWxsYmFjayhyZXN1bHQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkNMT1NFU1Q6CiAgICAgICAgICAvLyBTdG9yZSBpZiBjbG9zZXIgdGhhbiBjdXJyZW50IGNsb3Nlc3QKICAgICAgICAgIGlmIChkaXN0YW5jZSA8IHJlc3VsdC5kaXN0YW5jZSB8fCAhcmVzdWx0Lmhhc0hpdCkgewogICAgICAgICAgICB0aGlzLmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgUmF5LkFOWToKICAgICAgICAgIC8vIFJlcG9ydCBhbmQgc3RvcC4KICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdC5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0LnNob3VsZFN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXMgcGVyICJCYXJ5Y2VudHJpYyBUZWNobmlxdWUiIGFzIG5hbWVkCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly93d3cuYmxhY2twYXduLmNvbS90ZXh0cy9wb2ludGlucG9seS9kZWZhdWx0Lmh0bWwgaGVyZX0gYnV0IHdpdGhvdXQgdGhlIGRpdmlzaW9uCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50SW5UcmlhbmdsZShwLCBhLCBiLCBjKSB7CiAgICAgIGMudnN1YihhLCB2MCk7CiAgICAgIGIudnN1YihhLCB2MSk7CiAgICAgIHAudnN1YihhLCB2Mik7CiAgICAgIGNvbnN0IGRvdDAwID0gdjAuZG90KHYwKTsKICAgICAgY29uc3QgZG90MDEgPSB2MC5kb3QodjEpOwogICAgICBjb25zdCBkb3QwMiA9IHYwLmRvdCh2Mik7CiAgICAgIGNvbnN0IGRvdDExID0gdjEuZG90KHYxKTsKICAgICAgY29uc3QgZG90MTIgPSB2MS5kb3QodjIpOwogICAgICBsZXQgdTsKICAgICAgbGV0IHY7CiAgICAgIHJldHVybiAodSA9IGRvdDExICogZG90MDIgLSBkb3QwMSAqIGRvdDEyKSA+PSAwICYmICh2ID0gZG90MDAgKiBkb3QxMiAtIGRvdDAxICogZG90MDIpID49IDAgJiYgdSArIHYgPCBkb3QwMCAqIGRvdDExIC0gZG90MDEgKiBkb3QwMTsKICAgIH0KCiAgfQogIFJheS5DTE9TRVNUID0gUkFZX01PREVTLkNMT1NFU1Q7CiAgUmF5LkFOWSA9IFJBWV9NT0RFUy5BTlk7CiAgUmF5LkFMTCA9IFJBWV9NT0RFUy5BTEw7CiAgY29uc3QgdG1wQUFCQiQxID0gbmV3IEFBQkIoKTsKICBjb25zdCB0bXBBcnJheSA9IFtdOwogIGNvbnN0IHYxID0gbmV3IFZlYzMoKTsKICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV94aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Qm9keV9xaSA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgaW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGMgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFJheWNhc3RSZXN1bHQoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhPcHRpb25zID0gewogICAgZmFjZUxpc3Q6IFswXQogIH07CiAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5ID0gbmV3IFJheSgpOwogIGNvbnN0IGludGVyc2VjdEhlaWdodGZpZWxkX2luZGV4ID0gW107CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RDb252ZXhfdmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbERpcmVjdGlvbiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbEZyb20gPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF93b3JsZEludGVyc2VjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBuZXcgQUFCQigpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmVlVHJhbnNmb3JtID0gbmV3IFRyYW5zZm9ybSgpOwogIGNvbnN0IHYwID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3QgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBkaXN0YW5jZUZyb21JbnRlcnNlY3Rpb24oZnJvbSwgZGlyZWN0aW9uLCBwb3NpdGlvbikgewogICAgLy8gdjAgaXMgdmVjdG9yIGZyb20gZnJvbSB0byBwb3NpdGlvbgogICAgcG9zaXRpb24udnN1Yihmcm9tLCB2MCk7CiAgICBjb25zdCBkb3QgPSB2MC5kb3QoZGlyZWN0aW9uKTsgLy8gaW50ZXJzZWN0ID0gZGlyZWN0aW9uKmRvdCArIGZyb20KCiAgICBkaXJlY3Rpb24uc2NhbGUoZG90LCBpbnRlcnNlY3QpOwogICAgaW50ZXJzZWN0LnZhZGQoZnJvbSwgaW50ZXJzZWN0KTsKICAgIGNvbnN0IGRpc3RhbmNlID0gcG9zaXRpb24uZGlzdGFuY2VUbyhpbnRlcnNlY3QpOwogICAgcmV0dXJuIGRpc3RhbmNlOwogIH0KCiAgLyoqCiAgICogU3dlZXAgYW5kIHBydW5lIGJyb2FkcGhhc2UgYWxvbmcgb25lIGF4aXMuCiAgICovCiAgY2xhc3MgU0FQQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBMaXN0IG9mIGJvZGllcyBjdXJyZW50bHkgaW4gdGhlIGJyb2FkcGhhc2UuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3b3JsZCB0byBzZWFyY2ggaW4uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEF4aXMgdG8gc29ydCB0aGUgYm9kaWVzIGFsb25nLgogICAgICogU2V0IHRvIDAgZm9yIHggYXhpcywgYW5kIDEgZm9yIHkgYXhpcy4KICAgICAqIEZvciBiZXN0IHBlcmZvcm1hbmNlLCBwaWNrIHRoZSBheGlzIHdoZXJlIGJvZGllcyBhcmUgbW9zdCBkaXN0cmlidXRlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kcyBvZiB0d28gYm9kaWVzIG92ZXJsYXAsIGFsb25nIHRoZSBnaXZlbiBTQVAgYXhpcy4KICAgICAqLwogICAgc3RhdGljIGNoZWNrQm91bmRzKGJpLCBiaiwgYXhpc0luZGV4KSB7CiAgICAgIGxldCBiaVBvczsKICAgICAgbGV0IGJqUG9zOwoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24ueDsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLng7CiAgICAgIH0gZWxzZSBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi55OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLno7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi56OwogICAgICB9CgogICAgICBjb25zdCByaSA9IGJpLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICByaiA9IGJqLmJvdW5kaW5nUmFkaXVzLAogICAgICAgICAgICBib3VuZEEyID0gYmlQb3MgKyByaSwKICAgICAgICAgICAgYm91bmRCMSA9IGJqUG9zIC0gcmo7CiAgICAgIHJldHVybiBib3VuZEIxIDwgYm91bmRBMjsKICAgIH0gLy8gTm90ZTogdGhlc2UgYXJlIGlkZW50aWNhbCwgc2F2ZSBmb3IgeC95L3ogbG93ZXJib3VuZAoKICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFgKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFgoYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnggPD0gdi5hYWJiLmxvd2VyQm91bmQueCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WQogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WShhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueSA8PSB2LmFhYmIubG93ZXJCb3VuZC55KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRaCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRaKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC56IDw9IHYuYWFiYi5sb3dlckJvdW5kLnopIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KCiAgICBjb25zdHJ1Y3Rvcih3b3JsZCkgewogICAgICBzdXBlcigpOwogICAgICB0aGlzLmF4aXNMaXN0ID0gW107CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKCiAgICAgIHRoaXMuX2FkZEJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGF4aXNMaXN0LnB1c2goZXZlbnQuYm9keSk7CiAgICAgIH07CgogICAgICB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlciA9IGV2ZW50ID0+IHsKICAgICAgICBjb25zdCBpZHggPSBheGlzTGlzdC5pbmRleE9mKGV2ZW50LmJvZHkpOwoKICAgICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgICAgYXhpc0xpc3Quc3BsaWNlKGlkeCwgMSk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKHdvcmxkKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZCh3b3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hhbmdlIHRoZSB3b3JsZAogICAgICovCgoKICAgIHNldFdvcmxkKHdvcmxkKSB7CiAgICAgIC8vIENsZWFyIHRoZSBvbGQgYXhpcyBhcnJheQogICAgICB0aGlzLmF4aXNMaXN0Lmxlbmd0aCA9IDA7IC8vIEFkZCBhbGwgYm9kaWVzIGZyb20gdGhlIG5ldyB3b3JsZAoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JsZC5ib2RpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLmF4aXNMaXN0LnB1c2god29ybGQuYm9kaWVzW2ldKTsKICAgICAgfSAvLyBSZW1vdmUgb2xkIGhhbmRsZXJzLCBpZiBhbnkKCgogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdhZGRCb2R5JywgdGhpcy5fYWRkQm9keUhhbmRsZXIpOwogICAgICB3b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdyZW1vdmVCb2R5JywgdGhpcy5fcmVtb3ZlQm9keUhhbmRsZXIpOyAvLyBBZGQgaGFuZGxlcnMgdG8gdXBkYXRlIHRoZSBsaXN0IG9mIGJvZGllcy4KCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENvbGxlY3QgYWxsIGNvbGxpc2lvbiBwYWlycwogICAgICovCgoKICAgIGNvbGxpc2lvblBhaXJzKHdvcmxkLCBwMSwgcDIpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgTiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0gLy8gTG9vayB0aHJvdWdoIHRoZSBsaXN0CgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgTjsgaisrKSB7CiAgICAgICAgICBjb25zdCBiaiA9IGJvZGllc1tqXTsKCiAgICAgICAgICBpZiAoIXRoaXMubmVlZEJyb2FkcGhhc2VDb2xsaXNpb24oYmksIGJqKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIVNBUEJyb2FkcGhhc2UuY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uVGVzdChiaSwgYmosIHAxLCBwMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc29ydExpc3QoKSB7CiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGNvbnN0IE4gPSBheGlzTGlzdC5sZW5ndGg7IC8vIFVwZGF0ZSBBQUJCcwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiaS5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGJpLnVwZGF0ZUFBQkIoKTsKICAgICAgICB9CiAgICAgIH0gLy8gU29ydCB0aGUgbGlzdAoKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDApIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRYKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRZKGF4aXNMaXN0KTsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDIpIHsKICAgICAgICBTQVBCcm9hZHBoYXNlLmluc2VydGlvblNvcnRaKGF4aXNMaXN0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgdmFyaWFuY2Ugb2YgdGhlIGJvZHkgcG9zaXRpb25zIGFuZCBlc3RpbWF0ZXMgdGhlIGJlc3QgYXhpcyB0byB1c2UuCiAgICAgKiBXaWxsIGF1dG9tYXRpY2FsbHkgc2V0IHByb3BlcnR5IGBheGlzSW5kZXhgLgogICAgICovCgoKICAgIGF1dG9EZXRlY3RBeGlzKCkgewogICAgICBsZXQgc3VtWCA9IDA7CiAgICAgIGxldCBzdW1YMiA9IDA7CiAgICAgIGxldCBzdW1ZID0gMDsKICAgICAgbGV0IHN1bVkyID0gMDsKICAgICAgbGV0IHN1bVogPSAwOwogICAgICBsZXQgc3VtWjIgPSAwOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaW52TiA9IDEgLyBOOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgY29uc3QgY2VudGVyWCA9IGIucG9zaXRpb24ueDsKICAgICAgICBzdW1YICs9IGNlbnRlclg7CiAgICAgICAgc3VtWDIgKz0gY2VudGVyWCAqIGNlbnRlclg7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGIucG9zaXRpb24ueTsKICAgICAgICBzdW1ZICs9IGNlbnRlclk7CiAgICAgICAgc3VtWTIgKz0gY2VudGVyWSAqIGNlbnRlclk7CiAgICAgICAgY29uc3QgY2VudGVyWiA9IGIucG9zaXRpb24uejsKICAgICAgICBzdW1aICs9IGNlbnRlclo7CiAgICAgICAgc3VtWjIgKz0gY2VudGVyWiAqIGNlbnRlclo7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZhcmlhbmNlWCA9IHN1bVgyIC0gc3VtWCAqIHN1bVggKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVkgPSBzdW1ZMiAtIHN1bVkgKiBzdW1ZICogaW52TjsKICAgICAgY29uc3QgdmFyaWFuY2VaID0gc3VtWjIgLSBzdW1aICogc3VtWiAqIGludk47CgogICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VZKSB7CiAgICAgICAgaWYgKHZhcmlhbmNlWCA+IHZhcmlhbmNlWikgewogICAgICAgICAgdGhpcy5heGlzSW5kZXggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHZhcmlhbmNlWSA+IHZhcmlhbmNlWikgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDI7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gYW4gQUFCQi4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgcmVzdWx0aW5nIGJvZGllcyBpbi4KICAgICAqLwoKCiAgICBhYWJiUXVlcnkod29ybGQsIGFhYmIsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuZGlydHkpIHsKICAgICAgICB0aGlzLnNvcnRMaXN0KCk7CiAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlOwogICAgICB9CgogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgbGV0IGF4aXMgPSAneCc7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAxKSB7CiAgICAgICAgYXhpcyA9ICd5JzsKICAgICAgfQoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGF4aXMgPSAneic7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNMaXN0ID0gdGhpcy5heGlzTGlzdDsKICAgICAgYWFiYi5sb3dlckJvdW5kW2F4aXNdOwogICAgICBhYWJiLnVwcGVyQm91bmRbYXhpc107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF4aXNMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGF4aXNMaXN0W2ldOwoKICAgICAgICBpZiAoYi5hYWJiTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIGIudXBkYXRlQUFCQigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGIuYWFiYi5vdmVybGFwcyhhYWJiKSkgewogICAgICAgICAgcmVzdWx0LnB1c2goYik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CgogIGNsYXNzIFV0aWxzIHsKICAgIC8qKgogICAgICogRXh0ZW5kIGFuIG9wdGlvbnMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBUaGUgb3B0aW9ucyBvYmplY3QuIE1heSBiZSBmYWxzeTogaW4gdGhpcyBjYXNlLCBhIG5ldyBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcmV0dXJuZWQuCiAgICAgKiBAcGFyYW0gZGVmYXVsdHMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgZGVmYXVsdCB2YWx1ZXMuCiAgICAgKiBAcmV0dXJuIFRoZSBtb2RpZmllZCBvcHRpb25zIG9iamVjdC4KICAgICAqLwogICAgc3RhdGljIGRlZmF1bHRzKG9wdGlvbnMsIGRlZmF1bHRzKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGtleSBpbiBkZWZhdWx0cykgewogICAgICAgIGlmICghKGtleSBpbiBvcHRpb25zKSkgewogICAgICAgICAgb3B0aW9uc1trZXldID0gZGVmYXVsdHNba2V5XTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBvcHRpb25zOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgYmFzZSBjbGFzcwogICAqLwogIGNsYXNzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBFcXVhdGlvbnMgdG8gYmUgc29sdmVkIGluIHRoaXMgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgYm9kaWVzIHRvIGNvbGxpZGUgd2hlbiB0aGV5IGFyZSBjb25uZWN0ZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNvbGxpZGVDb25uZWN0ZWQ6IHRydWUsCiAgICAgICAgd2FrZVVwQm9kaWVzOiB0cnVlCiAgICAgIH0pOwogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgICB0aGlzLmJvZHlBID0gYm9keUE7CiAgICAgIHRoaXMuYm9keUIgPSBib2R5QjsKICAgICAgdGhpcy5pZCA9IENvbnN0cmFpbnQuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9IG9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKCiAgICAgIGlmIChvcHRpb25zLndha2VVcEJvZGllcykgewogICAgICAgIGlmIChib2R5QSkgewogICAgICAgICAgYm9keUEud2FrZVVwKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYm9keUIpIHsKICAgICAgICAgIGJvZHlCLndha2VVcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYWxsIHRoZSBlcXVhdGlvbnMgd2l0aCBkYXRhLgogICAgICovCgoKICAgIHVwZGF0ZSgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdtZXRob2QgdXBkYXRlKCkgbm90IGltcGxtZW1lbnRlZCBpbiB0aGlzIENvbnN0cmFpbnQgc3ViY2xhc3MhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEVuYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBlbmFibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRGlzYWJsZXMgYWxsIGVxdWF0aW9ucyBpbiB0aGUgY29uc3RyYWludC4KICAgICAqLwoKCiAgICBkaXNhYmxlKCkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZXFzW2ldLmVuYWJsZWQgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICB9CiAgQ29uc3RyYWludC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBbiBlbGVtZW50IGNvbnRhaW5pbmcgNiBlbnRyaWVzLCAzIHNwYXRpYWwgYW5kIDMgcm90YXRpb25hbCBkZWdyZWVzIG9mIGZyZWVkb20uCiAgICovCgogIGNsYXNzIEphY29iaWFuRWxlbWVudCB7CiAgICAvKioKICAgICAqIHNwYXRpYWwKICAgICAqLwoKICAgIC8qKgogICAgICogcm90YXRpb25hbAogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5zcGF0aWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yb3RhdGlvbmFsID0gbmV3IFZlYzMoKTsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgd2l0aCBvdGhlciBKYWNvYmlhbkVsZW1lbnQKICAgICAqLwoKCiAgICBtdWx0aXBseUVsZW1lbnQoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5zcGF0aWFsLmRvdCh0aGlzLnNwYXRpYWwpICsgZWxlbWVudC5yb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIHR3byB2ZWN0b3JzCiAgICAgKi8KCgogICAgbXVsdGlwbHlWZWN0b3JzKHNwYXRpYWwsIHJvdGF0aW9uYWwpIHsKICAgICAgcmV0dXJuIHNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyByb3RhdGlvbmFsLmRvdCh0aGlzLnJvdGF0aW9uYWwpOwogICAgfQoKICB9CgogIC8qKgogICAqIEVxdWF0aW9uIGJhc2UgY2xhc3MuCiAgICoKICAgKiBgYWAsIGBiYCBhbmQgYGVwc2AgYXJlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci81RFYwNTgvVlQxNS9sZWN0dXJlcy9TUE9PS2xhYm5vdGVzLnBkZiBTUE9PS30gcGFyYW1ldGVycyB0aGF0IGRlZmF1bHQgdG8gYDAuMGAuIFNlZSB7QGxpbmsgaHR0cHM6Ly9naXRodWIuY29tL3NjaHRlcHBlL2Nhbm5vbi5qcy9pc3N1ZXMvMjM4I2lzc3VlY29tbWVudC0xNDcxNzIzMjcgdGhpcyBleGNoYW5nZX0gZm9yIG1vcmUgZGV0YWlscyBvbiBDYW5ub24ncyBwaHlzaWNzIGltcGxlbWVudGF0aW9uLgogICAqLwogIGNsYXNzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogTWluaW11bSAocmVhZDogbmVnYXRpdmUgbWF4KSBmb3JjZSB0byBiZSBhcHBsaWVkIGJ5IHRoZSBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXhpbXVtIChyZWFkOiBwb3NpdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgbnVtYmVyLCBwcm9wb3J0aW9uYWwgdG8gdGhlIGZvcmNlIGFkZGVkIHRvIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJpLCBiaiwgbWluRm9yY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtaW5Gb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWluRm9yY2UgPSAtMWU2OwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICB0aGlzLmlkID0gRXF1YXRpb24uaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWluRm9yY2UgPSBtaW5Gb3JjZTsKICAgICAgdGhpcy5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB0aGlzLmJpID0gYmk7CiAgICAgIHRoaXMuYmogPSBiajsKICAgICAgdGhpcy5hID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuYiA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmVwcyA9IDAuMDsgLy8gU1BPT0sgcGFyYW1ldGVyCgogICAgICB0aGlzLmphY29iaWFuRWxlbWVudEEgPSBuZXcgSmFjb2JpYW5FbGVtZW50KCk7CiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QiA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5lbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5tdWx0aXBsaWVyID0gMDsKICAgICAgdGhpcy5zZXRTcG9va1BhcmFtcygxZTcsIDQsIDEgLyA2MCk7IC8vIFNldCB0eXBpY2FsIHNwb29rIHBhcmFtcwogICAgfQogICAgLyoqCiAgICAgKiBSZWNhbGN1bGF0ZXMgYSwgYiwgYW5kIGVwcy4KICAgICAqCiAgICAgKiBUaGUgRXF1YXRpb24gY29uc3RydWN0b3Igc2V0cyB0eXBpY2FsIFNQT09LIHBhcmFtZXRlcnMgYXMgc3VjaDoKICAgICAqICogYHN0aWZmbmVzc2AgPSAxZTcKICAgICAqICogYHJlbGF4YXRpb25gID0gNAogICAgICogKiBgdGltZVN0ZXBgPSAxIC8gNjAsIF9ub3RlIHRoZSBoYXJkY29kZWQgcmVmcmVzaCByYXRlLl8KICAgICAqLwoKCiAgICBzZXRTcG9va1BhcmFtcyhzdGlmZm5lc3MsIHJlbGF4YXRpb24sIHRpbWVTdGVwKSB7CiAgICAgIGNvbnN0IGQgPSByZWxheGF0aW9uOwogICAgICBjb25zdCBrID0gc3RpZmZuZXNzOwogICAgICBjb25zdCBoID0gdGltZVN0ZXA7CiAgICAgIHRoaXMuYSA9IDQuMCAvIChoICogKDEgKyA0ICogZCkpOwogICAgICB0aGlzLmIgPSA0LjAgKiBkIC8gKDEgKyA0ICogZCk7CiAgICAgIHRoaXMuZXBzID0gNC4wIC8gKGggKiBoICogayAqICgxICsgNCAqIGQpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIHJpZ2h0IGhhbmQgc2lkZSBvZiB0aGUgU1BPT0sgZXF1YXRpb24KICAgICAqLwoKCiAgICBjb21wdXRlQihhLCBiLCBoKSB7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR3EgPSB0aGlzLmNvbXB1dGVHcSgpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICByZXR1cm4gLUdxICogYSAtIEdXICogYiAtIEdpTWYgKiBoOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKnEsIHdoZXJlIHEgYXJlIHRoZSBnZW5lcmFsaXplZCBib2R5IGNvb3JkaW5hdGVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdxKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB4aSA9IGJpLnBvc2l0aW9uOwogICAgICBjb25zdCB4aiA9IGJqLnBvc2l0aW9uOwogICAgICByZXR1cm4gR0Euc3BhdGlhbC5kb3QoeGkpICsgR0Iuc3BhdGlhbC5kb3QoeGopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKlcsIHdoZXJlIFcgYXJlIHRoZSBib2R5IHZlbG9jaXRpZXMKICAgICAqLwoKCiAgICBjb21wdXRlR1coKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHZqID0gYmoudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyh2aSwgd2kpICsgR0IubXVsdGlwbHlWZWN0b3JzKHZqLCB3aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqV2xhbWJkYSwgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHV2xhbWJkYSgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52bGFtYmRhOwogICAgICBjb25zdCB2aiA9IGJqLnZsYW1iZGE7CiAgICAgIGNvbnN0IHdpID0gYmkud2xhbWJkYTsKICAgICAgY29uc3Qgd2ogPSBiai53bGFtYmRhOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqZiwgd2hlcmUgTSBpcyB0aGUgbWFzcyBtYXRyaXggd2l0aCBkaWFnb25hbCBibG9ja3MgZm9yIGVhY2ggYm9keSwgYW5kIGYgYXJlIHRoZSBmb3JjZXMgb24gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBjb21wdXRlR2lNZigpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgZmkgPSBiaS5mb3JjZTsKICAgICAgY29uc3QgdGkgPSBiaS50b3JxdWU7CiAgICAgIGNvbnN0IGZqID0gYmouZm9yY2U7CiAgICAgIGNvbnN0IHRqID0gYmoudG9ycXVlOwogICAgICBjb25zdCBpbnZNYXNzaSA9IGJpLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52TWFzc2ogPSBiai5pbnZNYXNzU29sdmU7CiAgICAgIGZpLnNjYWxlKGludk1hc3NpLCBpTWZpKTsKICAgICAgZmouc2NhbGUoaW52TWFzc2osIGlNZmopOwogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdCh0aSwgaW52SWlfdm11bHRfdGF1aSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRqLCBpbnZJal92bXVsdF90YXVqKTsKICAgICAgcmV0dXJuIEdBLm11bHRpcGx5VmVjdG9ycyhpTWZpLCBpbnZJaV92bXVsdF90YXVpKSArIEdCLm11bHRpcGx5VmVjdG9ycyhpTWZqLCBpbnZJal92bXVsdF90YXVqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRyppbnYoTSkqRycKICAgICAqLwoKCiAgICBjb21wdXRlR2lNR3QoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgY29uc3QgaW52SWkgPSBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgY29uc3QgaW52SWogPSBiai5pbnZJbmVydGlhV29ybGRTb2x2ZTsKICAgICAgbGV0IHJlc3VsdCA9IGludk1hc3NpICsgaW52TWFzc2o7CiAgICAgIGludklpLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdBLnJvdGF0aW9uYWwpOwogICAgICBpbnZJai52bXVsdChHQi5yb3RhdGlvbmFsLCB0bXApOwogICAgICByZXN1bHQgKz0gdG1wLmRvdChHQi5yb3RhdGlvbmFsKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGNvbnN0cmFpbnQgdmVsb2NpdHkgdG8gdGhlIGJvZGllcy4KICAgICAqLwoKCiAgICBhZGRUb1dsYW1iZGEoZGVsdGFsYW1iZGEpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdGVtcCA9IGFkZFRvV2xhbWJkYV90ZW1wOyAvLyBBZGQgdG8gbGluZWFyIHZlbG9jaXR5CiAgICAgIC8vIHZfbGFtYmRhICs9IGludihNKSAqIGRlbHRhX2xhbWJhICogRwoKICAgICAgYmkudmxhbWJkYS5hZGRTY2FsZWRWZWN0b3IoYmkuaW52TWFzc1NvbHZlICogZGVsdGFsYW1iZGEsIEdBLnNwYXRpYWwsIGJpLnZsYW1iZGEpOwogICAgICBiai52bGFtYmRhLmFkZFNjYWxlZFZlY3Rvcihiai5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Iuc3BhdGlhbCwgYmoudmxhbWJkYSk7IC8vIEFkZCB0byBhbmd1bGFyIHZlbG9jaXR5CgogICAgICBiaS5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQS5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmkud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJpLndsYW1iZGEpOwogICAgICBiai5pbnZJbmVydGlhV29ybGRTb2x2ZS52bXVsdChHQi5yb3RhdGlvbmFsLCB0ZW1wKTsKICAgICAgYmoud2xhbWJkYS5hZGRTY2FsZWRWZWN0b3IoZGVsdGFsYW1iZGEsIHRlbXAsIGJqLndsYW1iZGEpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBkZW5vbWluYXRvciBwYXJ0IG9mIHRoZSBTUE9PSyBlcXVhdGlvbjogQyA9IEcqaW52KE0pKkcnICsgZXBzCiAgICAgKi8KCgogICAgY29tcHV0ZUMoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbXB1dGVHaU1HdCgpICsgdGhpcy5lcHM7CiAgICB9CgogIH0KICBFcXVhdGlvbi5pZENvdW50ZXIgPSAwOwogIGNvbnN0IGlNZmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGlNZmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklpX3ZtdWx0X3RhdWkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludklqX3ZtdWx0X3RhdWogPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYWRkVG9XbGFtYmRhX3RlbXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb250YWN0L25vbi1wZW5ldHJhdGlvbiBjb25zdHJhaW50IGVxdWF0aW9uCiAgICovCiAgY2xhc3MgQ29udGFjdEVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiAiYm91bmNpbmVzcyI6IHUxID0gLWUqdTAKICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgZ29lcyBmcm9tIHRoZSBjZW50ZXIgb2YgYmkgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkLW9yaWVudGVkIHZlY3RvciB0aGF0IHN0YXJ0cyBpbiBib2R5IGogcG9zaXRpb24gYW5kIGdvZXMgdG8gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbnRhY3Qgbm9ybWFsLCBwb2ludGluZyBvdXQgb2YgYm9keSBpLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgMCwgbWF4Rm9yY2UpOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gMC4wOwogICAgICB0aGlzLnJpID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5yaiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubmkgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHJpID0gdGhpcy5yaTsKICAgICAgY29uc3QgcmogPSB0aGlzLnJqOwogICAgICBjb25zdCByaXhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanhuID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB2aSA9IGJpLnZlbG9jaXR5OwogICAgICBjb25zdCB3aSA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmkuZm9yY2U7CiAgICAgIGJpLnRvcnF1ZTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2ogPSBiai5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGJqLmZvcmNlOwogICAgICBiai50b3JxdWU7CiAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IG4gPSB0aGlzLm5pOyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKG4sIHJpeG4pOwogICAgICByai5jcm9zcyhuLCByanhuKTsgLy8gZyA9IHhqK3JqIC0oeGkrcmkpCiAgICAgIC8vIEcgPSBbIC1uaSAgLXJpeG4gIG5pICByanhuIF0KCiAgICAgIG4ubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXhuLm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KG4pOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4bik7IC8vIENhbGN1bGF0ZSB0aGUgcGVuZXRyYXRpb24gdmVjdG9yCgogICAgICBwZW5ldHJhdGlvblZlYy5jb3B5KGJqLnBvc2l0aW9uKTsKICAgICAgcGVuZXRyYXRpb25WZWMudmFkZChyaiwgcGVuZXRyYXRpb25WZWMpOwogICAgICBwZW5ldHJhdGlvblZlYy52c3ViKGJpLnBvc2l0aW9uLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIocmksIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgY29uc3QgZyA9IG4uZG90KHBlbmV0cmF0aW9uVmVjKTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgIGNvbnN0IGVQbHVzT25lID0gdGhpcy5yZXN0aXR1dGlvbiArIDE7CiAgICAgIGNvbnN0IEdXID0gZVBsdXNPbmUgKiB2ai5kb3QobikgLSBlUGx1c09uZSAqIHZpLmRvdChuKSArIHdqLmRvdChyanhuKSAtIHdpLmRvdChyaXhuKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjdXJyZW50IHJlbGF0aXZlIHZlbG9jaXR5IGluIHRoZSBjb250YWN0IHBvaW50LgogICAgICovCgoKICAgIGdldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWwoKSB7CiAgICAgIGNvbnN0IHZpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmk7CiAgICAgIGNvbnN0IHZqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmo7CiAgICAgIGNvbnN0IHhpID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGk7CiAgICAgIGNvbnN0IHhqID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGo7CiAgICAgIGNvbnN0IHJlbFZlbCA9IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3JlbFZlbDsKICAgICAgdGhpcy5iaS5wb3NpdGlvbi52YWRkKHRoaXMucmksIHhpKTsKICAgICAgdGhpcy5iai5wb3NpdGlvbi52YWRkKHRoaXMucmosIHhqKTsKICAgICAgdGhpcy5iaS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludCh4aSwgdmkpOwogICAgICB0aGlzLmJqLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhqLCB2aik7CiAgICAgIHZpLnZzdWIodmosIHJlbFZlbCk7CiAgICAgIHJldHVybiB0aGlzLm5pLmRvdChyZWxWZWwpOwogICAgfQoKICB9CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzCgogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9jb21wdXRlQl90ZW1wMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAzID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfdmogPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29ubmVjdHMgdHdvIGJvZGllcyBhdCBnaXZlbiBvZmZzZXQgcG9pbnRzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGJvZHlBID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGNvbnN0IGJvZHlCID0gbmV3IEJvZHkoeyBtYXNzOiAxIH0pCiAgICogICAgIGJvZHlBLnBvc2l0aW9uLnNldCgtMSwgMCwgMCkKICAgKiAgICAgYm9keUIucG9zaXRpb24uc2V0KDEsIDAsIDApCiAgICogICAgIGJvZHlBLmFkZFNoYXBlKHNoYXBlQSkKICAgKiAgICAgYm9keUIuYWRkU2hhcGUoc2hhcGVCKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlBKQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJvZHlCKQogICAqICAgICBjb25zdCBsb2NhbFBpdm90QSA9IG5ldyBWZWMzKDEsIDAsIDApCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RCID0gbmV3IFZlYzMoLTEsIDAsIDApCiAgICogICAgIGNvbnN0IGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChib2R5QSwgbG9jYWxQaXZvdEEsIGJvZHlCLCBsb2NhbFBpdm90QikKICAgKiAgICAgd29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KQogICAqLwogIGNsYXNzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5QS4KICAgICAqLwoKICAgIC8qKgogICAgICogUGl2b3QsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHBpdm90QSBUaGUgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIG9mIGJvZHlBIHdoaWNoIGJvZHlBIGlzIGNvbnN0cmFpbmVkIHRvLgogICAgICogQHBhcmFtIGJvZHlCIEJvZHkgdGhhdCB3aWxsIGJlIGNvbnN0cmFpbmVkIGluIGEgc2ltaWxhciB3YXkgdG8gdGhlIHNhbWUgcG9pbnQgYXMgYm9keUEuIFdlIHdpbGwgdGhlcmVmb3JlIGdldCBhIGxpbmsgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIuIElmIG5vdCBzcGVjaWZpZWQsIGJvZHlBIHdpbGwgYmUgY29uc3RyYWluZWQgdG8gYSBzdGF0aWMgcG9pbnQuCiAgICAgKiBAcGFyYW0gcGl2b3RCIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUIgd2hpY2ggYm9keUIgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gbWF4Rm9yY2UgVGhlIG1heGltdW0gZm9yY2UgdGhhdCBzaG91bGQgYmUgYXBwbGllZCB0byBjb25zdHJhaW4gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKHBpdm90QSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHBpdm90QiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCKTsKICAgICAgdGhpcy5waXZvdEEgPSBwaXZvdEEuY2xvbmUoKTsKICAgICAgdGhpcy5waXZvdEIgPSBwaXZvdEIuY2xvbmUoKTsKICAgICAgY29uc3QgeCA9IHRoaXMuZXF1YXRpb25YID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICBjb25zdCB5ID0gdGhpcy5lcXVhdGlvblkgPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHogPSB0aGlzLmVxdWF0aW9uWiA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsgLy8gRXF1YXRpb25zIHRvIGJlIGZlZCB0byB0aGUgc29sdmVyCgogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHgsIHksIHopOyAvLyBNYWtlIHRoZSBlcXVhdGlvbnMgYmlkaXJlY3Rpb25hbAoKICAgICAgeC5taW5Gb3JjZSA9IHkubWluRm9yY2UgPSB6Lm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICB4Lm1heEZvcmNlID0geS5tYXhGb3JjZSA9IHoubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgeC5uaS5zZXQoMSwgMCwgMCk7CiAgICAgIHkubmkuc2V0KDAsIDEsIDApOwogICAgICB6Lm5pLnNldCgwLCAwLCAxKTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblg7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aOyAvLyBSb3RhdGUgdGhlIHBpdm90cyB0byB3b3JsZCBzcGFjZQoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QSwgeC5yaSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5waXZvdEIsIHgucmopOwogICAgICB5LnJpLmNvcHkoeC5yaSk7CiAgICAgIHkucmouY29weSh4LnJqKTsKICAgICAgei5yaS5jb3B5KHgucmkpOwogICAgICB6LnJqLmNvcHkoeC5yaik7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uZSBlcXVhdGlvbi4gV29ya3MgdG8ga2VlcCB0aGUgZ2l2ZW4gYm9keSB3b3JsZCB2ZWN0b3JzIGFsaWduZWQsIG9yIHRpbHRlZCB3aXRoaW4gYSBnaXZlbiBhbmdsZSBmcm9tIGVhY2ggb3RoZXIuCiAgICovCiAgY2xhc3MgQ29uZUVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEEKICAgICAqLwoKICAgIC8qKgogICAgICogTG9jYWwgYXhpcyBpbiBCCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSAiY29uZSBhbmdsZSIgdG8ga2VlcAogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDI7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQyOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gVGhlIGFuZ2xlIGJldHdlZW4gdHdvIHZlY3RvciBpczoKICAgICAgLy8gY29zKHRoZXRhKSA9IGEgKiBiIC8gKGxlbmd0aChhKSAqIGxlbmd0aChiKSA9IHsgbGVuKGEpID0gbGVuKGIpID0gMSB9ID0gYSAqIGIKICAgICAgLy8gZyA9IGEgKiBiCiAgICAgIC8vIGdkb3QgPSAoYiB4IGEpICogd2kgKyAoYSB4IGIpICogd2oKICAgICAgLy8gRyA9IFswIGJ4YSAwIGF4Yl0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBjb25zdHJhaW50LiBXb3JrcyB0byBrZWVwIHRoZSBsb2NhbCB2ZWN0b3JzIG9ydGhvZ29uYWwgdG8gZWFjaCBvdGhlciBpbiB3b3JsZCBzcGFjZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBtYXhBbmdsZQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OwogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1tYXhGb3JjZSwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDAsIDEsIDApOwogICAgICB0aGlzLm1heEFuZ2xlID0gTWF0aC5QSSAvIDI7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBuaSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IG5qID0gdGhpcy5heGlzQjsKICAgICAgY29uc3Qgbml4bmogPSB0bXBWZWMxJDE7CiAgICAgIGNvbnN0IG5qeG5pID0gdG1wVmVjMiQxOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgbmkuY3Jvc3MobmosIG5peG5qKTsKICAgICAgbmouY3Jvc3MobmksIG5qeG5pKTsgLy8gZyA9IG5pICogbmoKICAgICAgLy8gZ2RvdCA9IChuaiB4IG5pKSAqIHdpICsgKG5pIHggbmopICogd2oKICAgICAgLy8gRyA9IFswIG5qeG5pIDAgbml4bmpdCiAgICAgIC8vIFcgPSBbdmkgd2kgdmogd2pdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkobmp4bmkpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkobml4bmopOwogICAgICBjb25zdCBnID0gTWF0aC5jb3ModGhpcy5tYXhBbmdsZSkgLSBuaS5kb3QobmopOwogICAgICBjb25zdCBHVyA9IHRoaXMuY29tcHV0ZUdXKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtZyAqIGEgLSBHVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCB0bXBWZWMxJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIkMSA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEEgQ29uZSBUd2lzdCBjb25zdHJhaW50LCB1c2VmdWwgZm9yIHJhZ2RvbGxzLgogICAqLwogIGNsYXNzIENvbmVUd2lzdENvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGF4aXMgZGlyZWN0aW9uIGZvciB0aGUgY29uc3RyYWludCBvZiB0aGUgYm9keSBBLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEIuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBhcGVydHVyZSBhbmdsZSBvZiB0aGUgY29uZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHR3aXN0IGFuZ2xlIG9mIHRoZSBqb2ludC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsgLy8gU2V0IHBpdm90IHBvaW50IGluIGJldHdlZW4KCiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG9wdGlvbnMuYXhpc0EgPyBvcHRpb25zLmF4aXNBLmNsb25lKCkgOiBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlkZUNvbm5lY3RlZCA9ICEhb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwogICAgICB0aGlzLmFuZ2xlID0gdHlwZW9mIG9wdGlvbnMuYW5nbGUgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5hbmdsZSA6IDA7CiAgICAgIGNvbnN0IGMgPSB0aGlzLmNvbmVFcXVhdGlvbiA9IG5ldyBDb25lRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgdCA9IHRoaXMudHdpc3RFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy50d2lzdEFuZ2xlID0gdHlwZW9mIG9wdGlvbnMudHdpc3RBbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnR3aXN0QW5nbGUgOiAwOyAvLyBNYWtlIHRoZSBjb25lIGVxdWF0aW9uIHB1c2ggdGhlIGJvZGllcyB0b3dhcmQgdGhlIGNvbmUgYXhpcywgbm90IG91dHdhcmQKCiAgICAgIGMubWF4Rm9yY2UgPSAwOwogICAgICBjLm1pbkZvcmNlID0gLW1heEZvcmNlOyAvLyBNYWtlIHRoZSB0d2lzdCBlcXVhdGlvbiBhZGQgdG9ycXVlIHRvd2FyZCB0aGUgaW5pdGlhbCBwb3NpdGlvbgoKICAgICAgdC5tYXhGb3JjZSA9IDA7CiAgICAgIHQubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goYywgdCk7CiAgICB9CgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgY29uZSA9IHRoaXMuY29uZUVxdWF0aW9uOwogICAgICBjb25zdCB0d2lzdCA9IHRoaXMudHdpc3RFcXVhdGlvbjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIFVwZGF0ZSB0aGUgYXhlcyB0byB0aGUgY29uZSBjb25zdHJhaW50CgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy5heGlzQSwgY29uZS5heGlzQSk7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNCLCBjb25lLmF4aXNCKTsgLy8gVXBkYXRlIHRoZSB3b3JsZCBheGVzIGluIHRoZSB0d2lzdCBjb25zdHJhaW50CgogICAgICB0aGlzLmF4aXNBLnRhbmdlbnRzKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQSwgdHdpc3QuYXhpc0EpOwogICAgICB0aGlzLmF4aXNCLnRhbmdlbnRzKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGJvZHlCLnZlY3RvclRvV29ybGRGcmFtZSh0d2lzdC5heGlzQiwgdHdpc3QuYXhpc0IpOwogICAgICBjb25lLmFuZ2xlID0gdGhpcy5hbmdsZTsKICAgICAgdHdpc3QubWF4QW5nbGUgPSB0aGlzLnR3aXN0QW5nbGU7CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdHdvIGJvZGllcyB0byBiZSBhdCBhIGNvbnN0YW50IGRpc3RhbmNlIGZyb20gZWFjaCBvdGhlcnMgY2VudGVyIG9mIG1hc3MuCiAgICovCiAgY2xhc3MgRGlzdGFuY2VDb25zdHJhaW50IGV4dGVuZHMgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkaXN0YW5jZSBUaGUgZGlzdGFuY2UgdG8ga2VlcC4gSWYgdW5kZWZpbmVkLCBpdCB3aWxsIGJlIHNldCB0byB0aGUgY3VycmVudCBkaXN0YW5jZSBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIGRpc3RhbmNlLCBtYXhGb3JjZSkgewogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwoKICAgICAgaWYgKHR5cGVvZiBkaXN0YW5jZSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgICBkaXN0YW5jZSA9IGJvZHlBLnBvc2l0aW9uLmRpc3RhbmNlVG8oYm9keUIucG9zaXRpb24pOwogICAgICB9CgogICAgICB0aGlzLmRpc3RhbmNlID0gZGlzdGFuY2U7CiAgICAgIGNvbnN0IGVxID0gdGhpcy5kaXN0YW5jZUVxdWF0aW9uID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsgLy8gTWFrZSBpdCBiaWRpcmVjdGlvbmFsCgogICAgICBlcS5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgZXEubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb247CiAgICAgIGNvbnN0IGhhbGZEaXN0ID0gdGhpcy5kaXN0YW5jZSAqIDAuNTsKICAgICAgY29uc3Qgbm9ybWFsID0gZXEubmk7CiAgICAgIGJvZHlCLnBvc2l0aW9uLnZzdWIoYm9keUEucG9zaXRpb24sIG5vcm1hbCk7CiAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgbm9ybWFsLnNjYWxlKGhhbGZEaXN0LCBlcS5yaSk7CiAgICAgIG5vcm1hbC5zY2FsZSgtaGFsZkRpc3QsIGVxLnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBMb2NrIGNvbnN0cmFpbnQuIFdpbGwgcmVtb3ZlIGFsbCBkZWdyZWVzIG9mIGZyZWVkb20gYmV0d2VlbiB0aGUgYm9kaWVzLgogICAqLwogIGNsYXNzIExvY2tDb25zdHJhaW50IGV4dGVuZHMgUG9pbnRUb1BvaW50Q29uc3RyYWludCB7CiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaGFsZldheSA9IG5ldyBWZWMzKCk7CiAgICAgIGJvZHlBLnBvc2l0aW9uLnZhZGQoYm9keUIucG9zaXRpb24sIGhhbGZXYXkpOwogICAgICBoYWxmV2F5LnNjYWxlKDAuNSwgaGFsZldheSk7CiAgICAgIGJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90Qik7CiAgICAgIGJvZHlBLnBvaW50VG9Mb2NhbEZyYW1lKGhhbGZXYXksIHBpdm90QSk7IC8vIFRoZSBwb2ludC10by1wb2ludCBjb25zdHJhaW50IHdpbGwga2VlcCBhIHBvaW50IHNoYXJlZCBiZXR3ZWVuIHRoZSBib2RpZXMKCiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsgLy8gU3RvcmUgaW5pdGlhbCByb3RhdGlvbiBvZiB0aGUgYm9kaWVzIGFzIHVuaXQgdmVjdG9ycyBpbiB0aGUgbG9jYWwgYm9keSBzcGFjZXMKCiAgICAgIHRoaXMueEEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnhCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9YKTsKICAgICAgdGhpcy55QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMueUIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1kpOwogICAgICB0aGlzLnpBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsKICAgICAgdGhpcy56QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWik7IC8vIC4uLmFuZCB0aGUgZm9sbG93aW5nIHJvdGF0aW9uYWwgZXF1YXRpb25zIHdpbGwga2VlcCBhbGwgcm90YXRpb25hbCBET0YncyBpbiBwbGFjZQoKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByMyA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMyA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyMSwgcjIsIHIzKTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uOwogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjI7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVGhlc2UgdmVjdG9yIHBhaXJzIG11c3QgYmUgb3J0aG9nb25hbAoKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEEsIHIxLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUIsIHIxLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueUEsIHIyLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekIsIHIyLmF4aXNCKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuekEsIHIzLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMueEIsIHIzLmF4aXNCKTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogUm90YXRpb25hbCBtb3RvciBjb25zdHJhaW50LiBUcmllcyB0byBrZWVwIHRoZSByZWxhdGl2ZSBhbmd1bGFyIHZlbG9jaXR5IG9mIHRoZSBib2RpZXMgdG8gYSBnaXZlbiB2YWx1ZS4KICAgKi8KICBjbGFzcyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1vdG9yIHZlbG9jaXR5LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmF4aXNCID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50YXJnZXRWZWxvY2l0eSA9IDA7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIHRoaXMuYmk7CiAgICAgIHRoaXMuYmo7CiAgICAgIGNvbnN0IGF4aXNBID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7IC8vIGcgPSAwCiAgICAgIC8vIGdkb3QgPSBheGlzQSAqIHdpIC0gYXhpc0IgKiB3agogICAgICAvLyBnZG90ID0gRyAqIFcgPSBHICogW3ZpIHdpIHZqIHdqXQogICAgICAvLyA9PgogICAgICAvLyBHID0gWzAgYXhpc0EgMCAtYXhpc0JdCgogICAgICBHQS5yb3RhdGlvbmFsLmNvcHkoYXhpc0EpOwogICAgICBheGlzQi5uZWdhdGUoR0Iucm90YXRpb25hbCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKSAtIHRoaXMudGFyZ2V0VmVsb2NpdHk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIGNvbnN0IEIgPSAtR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CgogIC8qKgogICAqIEhpbmdlIGNvbnN0cmFpbnQuIFRoaW5rIG9mIGl0IGFzIGEgZG9vciBoaW5nZS4gSXQgdHJpZXMgdG8ga2VlcCB0aGUgZG9vciBpbiB0aGUgY29ycmVjdCBwbGFjZSBhbmQgd2l0aCB0aGUgY29ycmVjdCBvcmllbnRhdGlvbi4KICAgKi8KICBjbGFzcyBIaW5nZUNvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogUm90YXRpb24gYXhpcywgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIGNvbnN0IHBpdm90QSA9IG9wdGlvbnMucGl2b3RBID8gb3B0aW9ucy5waXZvdEEuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBpdm90QiA9IG9wdGlvbnMucGl2b3RCID8gb3B0aW9ucy5waXZvdEIuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHN1cGVyKGJvZHlBLCBwaXZvdEEsIGJvZHlCLCBwaXZvdEIsIG1heEZvcmNlKTsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQS5ub3JtYWxpemUoKTsKICAgICAgY29uc3QgYXhpc0IgPSB0aGlzLmF4aXNCID0gb3B0aW9ucy5heGlzQiA/IG9wdGlvbnMuYXhpc0IuY2xvbmUoKSA6IG5ldyBWZWMzKDEsIDAsIDApOwogICAgICBheGlzQi5ub3JtYWxpemUoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCByb3RhdGlvbmFsMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMiA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb24gPSBuZXcgUm90YXRpb25hbE1vdG9yRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtYXhGb3JjZSk7CiAgICAgIG1vdG9yLmVuYWJsZWQgPSBmYWxzZTsgLy8gTm90IGVuYWJsZWQgYnkgZGVmYXVsdAogICAgICAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2gocm90YXRpb25hbDEsIHJvdGF0aW9uYWwyLCBtb3Rvcik7CiAgICB9CiAgICAvKioKICAgICAqIGVuYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZW5hYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogZGlzYWJsZU1vdG9yCiAgICAgKi8KCgogICAgZGlzYWJsZU1vdG9yKCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3RvclNwZWVkCiAgICAgKi8KCgogICAgc2V0TW90b3JTcGVlZChzcGVlZCkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24udGFyZ2V0VmVsb2NpdHkgPSBzcGVlZDsKICAgIH0KICAgIC8qKgogICAgICogc2V0TW90b3JNYXhGb3JjZQogICAgICovCgoKICAgIHNldE1vdG9yTWF4Rm9yY2UobWF4Rm9yY2UpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgIH0KICAgIC8qKgogICAgICogdXBkYXRlCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgbW90b3IgPSB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3Qgd29ybGRBeGlzQSA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMTsKICAgICAgY29uc3Qgd29ybGRBeGlzQiA9IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMjsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBHZXQgd29ybGQgYXhlcwoKICAgICAgYm9keUEucXVhdGVybmlvbi52bXVsdChheGlzQSwgd29ybGRBeGlzQSk7CiAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQoYXhpc0IsIHdvcmxkQXhpc0IpOwogICAgICB3b3JsZEF4aXNBLnRhbmdlbnRzKHIxLmF4aXNBLCByMi5heGlzQSk7CiAgICAgIHIxLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CiAgICAgIHIyLmF4aXNCLmNvcHkod29ybGRBeGlzQik7CgogICAgICBpZiAodGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQpIHsKICAgICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0EsIG1vdG9yLmF4aXNBKTsKICAgICAgICBib2R5Qi5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMuYXhpc0IsIG1vdG9yLmF4aXNCKTsKICAgICAgfQogICAgfQoKICB9CiAgY29uc3QgSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25zdHJhaW5zIHRoZSBzbGlwcGluZyBpbiBhIGNvbnRhY3QgYWxvbmcgYSB0YW5nZW50CiAgICovCiAgY2xhc3MgRnJpY3Rpb25FcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8vIFRhbmdlbnQKCiAgICAvKioKICAgICAqIEBwYXJhbSBzbGlwRm9yY2Ugc2hvdWxkIGJlICstRl9mcmljdGlvbiA9ICstbXUgKiBGX25vcm1hbCA9ICstbXUgKiBtICogZwogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIHNsaXBGb3JjZSkgewogICAgICBzdXBlcihib2R5QSwgYm9keUIsIC1zbGlwRm9yY2UsIHNsaXBGb3JjZSk7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy50ID0gbmV3IFZlYzMoKTsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxOwogICAgICBjb25zdCByanh0ID0gRnJpY3Rpb25FcXVhdGlvbl9jb21wdXRlQl90ZW1wMjsKICAgICAgY29uc3QgdCA9IHRoaXMudDsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICByaS5jcm9zcyh0LCByaXh0KTsKICAgICAgcmouY3Jvc3ModCwgcmp4dCk7IC8vIEcgPSBbLXQgLXJpeHQgdCByanh0XQogICAgICAvLyBBbmQgcmVtZW1iZXIsIHRoaXMgaXMgYSBwdXJlIHZlbG9jaXR5IGNvbnN0cmFpbnQsIGcgaXMgYWx3YXlzIHplcm8hCgogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIHQubmVnYXRlKEdBLnNwYXRpYWwpOwogICAgICByaXh0Lm5lZ2F0ZShHQS5yb3RhdGlvbmFsKTsKICAgICAgR0Iuc3BhdGlhbC5jb3B5KHQpOwogICAgICBHQi5yb3RhdGlvbmFsLmNvcHkocmp4dCk7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogRGVmaW5lcyB3aGF0IGhhcHBlbnMgd2hlbiB0d28gbWF0ZXJpYWxzIG1lZXQuCiAgICogQHRvZG8gUmVmYWN0b3IgbWF0ZXJpYWxzIHRvIG1hdGVyaWFsQSBhbmQgbWF0ZXJpYWxCCiAgICovCiAgY2xhc3MgQ29udGFjdE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogSWRlbnRpZmllciBvZiB0aGlzIG1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBQYXJ0aWNpcGF0aW5nIG1hdGVyaWFscy4KICAgICAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gY29lZmZpY2llbnQuCiAgICAgKiBAZGVmYXVsdCAwLjMKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBwcm9kdWNlZCBjb250YWN0IGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucy4KICAgICAqIEBkZWZhdWx0IDFlNwogICAgICovCgogICAgLyoqCiAgICAgKiBSZWxheGF0aW9uIHRpbWUgb2YgdGhlIHByb2R1Y2VkIGZyaWN0aW9uIGVxdWF0aW9ucwogICAgICogQGRlZmF1bHQgMwogICAgICovCiAgICBjb25zdHJ1Y3RvcihtMSwgbTIsIG9wdGlvbnMpIHsKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjMsCiAgICAgICAgY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbjogMywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzOiAxZTcsCiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb246IDMKICAgICAgfSk7CiAgICAgIHRoaXMuaWQgPSBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMubWF0ZXJpYWxzID0gW20xLCBtMl07CiAgICAgIHRoaXMuZnJpY3Rpb24gPSBvcHRpb25zLmZyaWN0aW9uOwogICAgICB0aGlzLnJlc3RpdHV0aW9uID0gb3B0aW9ucy5yZXN0aXR1dGlvbjsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uID0gb3B0aW9ucy5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MgPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uOwogICAgfQoKICB9CiAgQ29udGFjdE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIERlZmluZXMgYSBwaHlzaWNzIG1hdGVyaWFsLgogICAqLwogIGNsYXNzIE1hdGVyaWFsIHsKICAgIC8qKgogICAgICogTWF0ZXJpYWwgbmFtZS4KICAgICAqIElmIG9wdGlvbnMgaXMgYSBzdHJpbmcsIG5hbWUgd2lsbCBiZSBzZXQgdG8gdGhhdCBzdHJpbmcuCiAgICAgKiBAdG9kbyBEZXByZWNhdGUgdGhpcwogICAgICovCgogICAgLyoqIE1hdGVyaWFsIGlkLiAqLwoKICAgIC8qKgogICAgICogRnJpY3Rpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSBmcmljdGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlc3RpdHV0aW9uIGZvciB0aGlzIG1hdGVyaWFsLgogICAgICogSWYgbm9uLW5lZ2F0aXZlLCBpdCB3aWxsIGJlIHVzZWQgaW5zdGVhZCBvZiB0aGUgcmVzdGl0dXRpb24gZ2l2ZW4gYnkgQ29udGFjdE1hdGVyaWFscy4gSWYgdGhlcmUncyBubyBtYXRjaGluZyBDb250YWN0TWF0ZXJpYWwsIHRoZSB2YWx1ZSBmcm9tIGBkZWZhdWx0Q29udGFjdE1hdGVyaWFsYCBpbiB0aGUgV29ybGQgd2lsbCBiZSB1c2VkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGxldCBuYW1lID0gJyc7IC8vIEJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZpeAoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykgewogICAgICAgIC8vY29uc29sZS53YXJuKGBQYXNzaW5nIGEgc3RyaW5nIHRvIE1hdGVyaWFsT3B0aW9ucyBpcyBkZXByZWNhdGVkLCBhbmQgaGFzIG5vIGVmZmVjdGApCiAgICAgICAgbmFtZSA9IG9wdGlvbnM7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICB0aGlzLmlkID0gTWF0ZXJpYWwuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuZnJpY3Rpb24gPSB0eXBlb2Ygb3B0aW9ucy5mcmljdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZyaWN0aW9uIDogLTE7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSB0eXBlb2Ygb3B0aW9ucy5yZXN0aXR1dGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnJlc3RpdHV0aW9uIDogLTE7CiAgICB9CgogIH0KICBNYXRlcmlhbC5pZENvdW50ZXIgPSAwOwoKICAvKioKICAgKiBBIHNwcmluZywgY29ubmVjdGluZyB0d28gYm9kaWVzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoYm94Qm9keSwgc3BoZXJlQm9keSwgewogICAqICAgICAgIHJlc3RMZW5ndGg6IDAsCiAgICogICAgICAgc3RpZmZuZXNzOiA1MCwKICAgKiAgICAgICBkYW1waW5nOiAxLAogICAqICAgICB9KQogICAqCiAgICogICAgIC8vIENvbXB1dGUgdGhlIGZvcmNlIGFmdGVyIGVhY2ggc3RlcAogICAqICAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIChldmVudCkgPT4gewogICAqICAgICAgIHNwcmluZy5hcHBseUZvcmNlKCkKICAgKiAgICAgfSkKICAgKi8KICBjbGFzcyBTcHJpbmcgewogICAgLyoqCiAgICAgKiBSZXN0IGxlbmd0aCBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+IDAuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMTAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERhbXBpbmcgb2YgdGhlIHNwcmluZy4gQSBudW1iZXIgPj0gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogRmlyc3QgY29ubmVjdGVkIGJvZHkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNlY29uZCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QSBpbiBsb2NhbCBib2R5QSBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEEsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFuY2hvciBmb3IgYm9keUIgaW4gbG9jYWwgYm9keUIgY29vcmRpbmF0ZXMuCiAgICAgKiBXaGVyZSB0byBob29rIHRoZSBzcHJpbmcgdG8gYm9keSBCLCBpbiBsb2NhbCBib2R5IGNvb3JkaW5hdGVzLgogICAgICogQGRlZmF1bHQgbmV3IFZlYzMoKQogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yZXN0TGVuZ3RoID0gdHlwZW9mIG9wdGlvbnMucmVzdExlbmd0aCA9PT0gJ251bWJlcicgPyBvcHRpb25zLnJlc3RMZW5ndGggOiAxOwogICAgICB0aGlzLnN0aWZmbmVzcyA9IG9wdGlvbnMuc3RpZmZuZXNzIHx8IDEwMDsKICAgICAgdGhpcy5kYW1waW5nID0gb3B0aW9ucy5kYW1waW5nIHx8IDE7CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmxvY2FsQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMubG9jYWxBbmNob3JCID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQSkgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JBLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5sb2NhbEFuY2hvckIpIHsKICAgICAgICB0aGlzLmxvY2FsQW5jaG9yQi5jb3B5KG9wdGlvbnMubG9jYWxBbmNob3JCKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMud29ybGRBbmNob3JBKSB7CiAgICAgICAgdGhpcy5zZXRXb3JsZEFuY2hvckEob3B0aW9ucy53b3JsZEFuY2hvckEpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckIpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQihvcHRpb25zLndvcmxkQW5jaG9yQik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBBLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JBLCB0aGlzLmxvY2FsQW5jaG9yQSk7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgdXNpbmcgd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgc2V0V29ybGRBbmNob3JCKHdvcmxkQW5jaG9yQikgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkQW5jaG9yQiwgdGhpcy5sb2NhbEFuY2hvckIpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JBKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlBLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JBLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEIsIGluIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgdmVjdG9yIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgZ2V0V29ybGRBbmNob3JCKHJlc3VsdCkgewogICAgICB0aGlzLmJvZHlCLnBvaW50VG9Xb3JsZEZyYW1lKHRoaXMubG9jYWxBbmNob3JCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSB0aGUgc3ByaW5nIGZvcmNlIHRvIHRoZSBjb25uZWN0ZWQgYm9kaWVzLgogICAgICovCgoKICAgIGFwcGx5Rm9yY2UoKSB7CiAgICAgIGNvbnN0IGsgPSB0aGlzLnN0aWZmbmVzczsKICAgICAgY29uc3QgZCA9IHRoaXMuZGFtcGluZzsKICAgICAgY29uc3QgbCA9IHRoaXMucmVzdExlbmd0aDsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHIgPSBhcHBseUZvcmNlX3I7CiAgICAgIGNvbnN0IHJfdW5pdCA9IGFwcGx5Rm9yY2Vfcl91bml0OwogICAgICBjb25zdCB1ID0gYXBwbHlGb3JjZV91OwogICAgICBjb25zdCBmID0gYXBwbHlGb3JjZV9mOwogICAgICBjb25zdCB0bXAgPSBhcHBseUZvcmNlX3RtcDsKICAgICAgY29uc3Qgd29ybGRBbmNob3JBID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckE7CiAgICAgIGNvbnN0IHdvcmxkQW5jaG9yQiA9IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCOwogICAgICBjb25zdCByaSA9IGFwcGx5Rm9yY2Vfcmk7CiAgICAgIGNvbnN0IHJqID0gYXBwbHlGb3JjZV9yajsKICAgICAgY29uc3QgcmlfeF9mID0gYXBwbHlGb3JjZV9yaV94X2Y7CiAgICAgIGNvbnN0IHJqX3hfZiA9IGFwcGx5Rm9yY2VfcmpfeF9mOyAvLyBHZXQgd29ybGQgYW5jaG9ycwoKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckEod29ybGRBbmNob3JBKTsKICAgICAgdGhpcy5nZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKTsgLy8gR2V0IG9mZnNldCBwb2ludHMKCiAgICAgIHdvcmxkQW5jaG9yQS52c3ViKGJvZHlBLnBvc2l0aW9uLCByaSk7CiAgICAgIHdvcmxkQW5jaG9yQi52c3ViKGJvZHlCLnBvc2l0aW9uLCByaik7IC8vIENvbXB1dGUgZGlzdGFuY2UgdmVjdG9yIGJldHdlZW4gd29ybGQgYW5jaG9yIHBvaW50cwoKICAgICAgd29ybGRBbmNob3JCLnZzdWIod29ybGRBbmNob3JBLCByKTsKICAgICAgY29uc3QgcmxlbiA9IHIubGVuZ3RoKCk7CiAgICAgIHJfdW5pdC5jb3B5KHIpOwogICAgICByX3VuaXQubm9ybWFsaXplKCk7IC8vIENvbXB1dGUgcmVsYXRpdmUgdmVsb2NpdHkgb2YgdGhlIGFuY2hvciBwb2ludHMsIHUKCiAgICAgIGJvZHlCLnZlbG9jaXR5LnZzdWIoYm9keUEudmVsb2NpdHksIHUpOyAvLyBBZGQgcm90YXRpb25hbCB2ZWxvY2l0eQoKICAgICAgYm9keUIuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJqLCB0bXApOwogICAgICB1LnZhZGQodG1wLCB1KTsKICAgICAgYm9keUEuYW5ndWxhclZlbG9jaXR5LmNyb3NzKHJpLCB0bXApOwogICAgICB1LnZzdWIodG1wLCB1KTsgLy8gRiA9IC0gayAqICggeCAtIEwgKSAtIEQgKiAoIHUgKQoKICAgICAgcl91bml0LnNjYWxlKC1rICogKHJsZW4gLSBsKSAtIGQgKiB1LmRvdChyX3VuaXQpLCBmKTsgLy8gQWRkIGZvcmNlcyB0byBib2RpZXMKCiAgICAgIGJvZHlBLmZvcmNlLnZzdWIoZiwgYm9keUEuZm9yY2UpOwogICAgICBib2R5Qi5mb3JjZS52YWRkKGYsIGJvZHlCLmZvcmNlKTsgLy8gQW5ndWxhciBmb3JjZQoKICAgICAgcmkuY3Jvc3MoZiwgcmlfeF9mKTsKICAgICAgcmouY3Jvc3MoZiwgcmpfeF9mKTsKICAgICAgYm9keUEudG9ycXVlLnZzdWIocmlfeF9mLCBib2R5QS50b3JxdWUpOwogICAgICBib2R5Qi50b3JxdWUudmFkZChyal94X2YsIGJvZHlCLnRvcnF1ZSk7CiAgICB9CgogIH0KICBjb25zdCBhcHBseUZvcmNlX3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfcl91bml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3UgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2Vfd29ybGRBbmNob3JCID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JpX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yal94X2YgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdG1wID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogV2hlZWxJbmZvCiAgICovCiAgY2xhc3MgV2hlZWxJbmZvIHsKICAgIC8qKgogICAgICogTWF4IHRyYXZlbCBkaXN0YW5jZSBvZiB0aGUgc3VzcGVuc2lvbiwgaW4gbWV0ZXJzLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBTcGVlZCB0byBhcHBseSB0byB0aGUgd2hlZWwgcm90YXRpb24gd2hlbiB0aGUgd2hlZWwgaXMgc2xpZGluZy4KICAgICAqIEBkZWZhdWx0IC0wLjEKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgdGhlIGN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgc2hvdWxkIGJlIHVzZWQuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlkaW5nCiAgICAgKi8KCiAgICAvKioKICAgICAqIENvbm5lY3Rpb24gcG9pbnQsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgY2hhc3NpcyBib2R5IGZyYW1lLgogICAgICovCgogICAgLyoqCiAgICAgKiBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogZGlyZWN0aW9uV29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZUxvY2FsCiAgICAgKi8KCiAgICAvKioKICAgICAqIGF4bGVXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uUmVzdExlbmd0aAogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTWF4TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAyCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJhZGl1cwogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uU3RpZmZuZXNzCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGFtcGluZ0NvbXByZXNzaW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nUmVsYXhhdGlvbgogICAgICogQGRlZmF1bHQgMTAKICAgICAqLwoKICAgIC8qKgogICAgICogZnJpY3Rpb25TbGlwCiAgICAgKiBAZGVmYXVsdCAxMC41CiAgICAgKi8KCiAgICAvKiogZm9yd2FyZEFjY2VsZXJhdGlvbiAqLwoKICAgIC8qKiBzaWRlQWNjZWxlcmF0aW9uICovCgogICAgLyoqCiAgICAgKiBzdGVlcmluZwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBSb3RhdGlvbiB2YWx1ZSwgaW4gcmFkaWFucy4KICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogZGVsdGFSb3RhdGlvbgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiByb2xsSW5mbHVlbmNlCiAgICAgKiBAZGVmYXVsdCAwLjAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heFN1c3BlbnNpb25Gb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBlbmdpbmVGb3JjZQogICAgICovCgogICAgLyoqCiAgICAgKiBicmFrZQogICAgICovCgogICAgLyoqCiAgICAgKiBpc0Zyb250V2hlZWwKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5CiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25Gb3JjZQogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzbGlwSW5mbwogICAgICovCgogICAgLyoqCiAgICAgKiBza2lkSW5mbwogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBzdXNwZW5zaW9uTGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNpZGVJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGZvcndhcmRJbXB1bHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSByZXN1bHQgZnJvbSByYXljYXN0aW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVlbCB3b3JsZCB0cmFuc2Zvcm0uCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzSW5Db250YWN0CiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucyA9IFV0aWxzLmRlZmF1bHRzKG9wdGlvbnMsIHsKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbkxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGRpcmVjdGlvbldvcmxkOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBheGxlV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgc3VzcGVuc2lvblJlc3RMZW5ndGg6IDEsCiAgICAgICAgc3VzcGVuc2lvbk1heExlbmd0aDogMiwKICAgICAgICByYWRpdXM6IDEsCiAgICAgICAgc3VzcGVuc2lvblN0aWZmbmVzczogMTAwLAogICAgICAgIGRhbXBpbmdDb21wcmVzc2lvbjogMTAsCiAgICAgICAgZGFtcGluZ1JlbGF4YXRpb246IDEwLAogICAgICAgIGZyaWN0aW9uU2xpcDogMTAuNSwKICAgICAgICBmb3J3YXJkQWNjZWxlcmF0aW9uOiAxLAogICAgICAgIHNpZGVBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc3RlZXJpbmc6IDAsCiAgICAgICAgcm90YXRpb246IDAsCiAgICAgICAgZGVsdGFSb3RhdGlvbjogMCwKICAgICAgICByb2xsSW5mbHVlbmNlOiAwLjAxLAogICAgICAgIG1heFN1c3BlbnNpb25Gb3JjZTogTnVtYmVyLk1BWF9WQUxVRSwKICAgICAgICBpc0Zyb250V2hlZWw6IHRydWUsCiAgICAgICAgY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOiAxLAogICAgICAgIHN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OiAwLAogICAgICAgIHN1c3BlbnNpb25Gb3JjZTogMCwKICAgICAgICBzbGlwSW5mbzogMCwKICAgICAgICBza2lkSW5mbzogMCwKICAgICAgICBzdXNwZW5zaW9uTGVuZ3RoOiAwLAogICAgICAgIG1heFN1c3BlbnNpb25UcmF2ZWw6IDEsCiAgICAgICAgdXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogZmFsc2UsCiAgICAgICAgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDogLTAuMQogICAgICB9KTsKICAgICAgdGhpcy5tYXhTdXNwZW5zaW9uVHJhdmVsID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICB0aGlzLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgPSBvcHRpb25zLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQ7CiAgICAgIHRoaXMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsID0gb3B0aW9ucy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbkxvY2FsID0gb3B0aW9ucy5kaXJlY3Rpb25Mb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmRpcmVjdGlvbldvcmxkID0gb3B0aW9ucy5kaXJlY3Rpb25Xb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLmF4bGVMb2NhbCA9IG9wdGlvbnMuYXhsZUxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZVdvcmxkID0gb3B0aW9ucy5heGxlV29ybGQuY2xvbmUoKTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgIHRoaXMuc3VzcGVuc2lvbk1heExlbmd0aCA9IG9wdGlvbnMuc3VzcGVuc2lvbk1heExlbmd0aDsKICAgICAgdGhpcy5yYWRpdXMgPSBvcHRpb25zLnJhZGl1czsKICAgICAgdGhpcy5zdXNwZW5zaW9uU3RpZmZuZXNzID0gb3B0aW9ucy5zdXNwZW5zaW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmRhbXBpbmdDb21wcmVzc2lvbiA9IG9wdGlvbnMuZGFtcGluZ0NvbXByZXNzaW9uOwogICAgICB0aGlzLmRhbXBpbmdSZWxheGF0aW9uID0gb3B0aW9ucy5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgdGhpcy5mcmljdGlvblNsaXAgPSBvcHRpb25zLmZyaWN0aW9uU2xpcDsKICAgICAgdGhpcy5mb3J3YXJkQWNjZWxlcmF0aW9uID0gb3B0aW9ucy5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICB0aGlzLnNpZGVBY2NlbGVyYXRpb24gPSBvcHRpb25zLnNpZGVBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc3RlZXJpbmcgPSAwOwogICAgICB0aGlzLnJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgdGhpcy5yb2xsSW5mbHVlbmNlID0gb3B0aW9ucy5yb2xsSW5mbHVlbmNlOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25Gb3JjZSA9IG9wdGlvbnMubWF4U3VzcGVuc2lvbkZvcmNlOwogICAgICB0aGlzLmVuZ2luZUZvcmNlID0gMDsKICAgICAgdGhpcy5icmFrZSA9IDA7CiAgICAgIHRoaXMuaXNGcm9udFdoZWVsID0gb3B0aW9ucy5pc0Zyb250V2hlZWw7CiAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMTsKICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgdGhpcy5zbGlwSW5mbyA9IDA7CiAgICAgIHRoaXMuc2tpZEluZm8gPSAwOwogICAgICB0aGlzLnN1c3BlbnNpb25MZW5ndGggPSAwOwogICAgICB0aGlzLnNpZGVJbXB1bHNlID0gMDsKICAgICAgdGhpcy5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgIHRoaXMucmF5Y2FzdFJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMud29ybGRUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgICAgIHRoaXMuaXNJbkNvbnRhY3QgPSBmYWxzZTsKICAgIH0KCiAgICB1cGRhdGVXaGVlbChjaGFzc2lzKSB7CiAgICAgIGNvbnN0IHJheWNhc3RSZXN1bHQgPSB0aGlzLnJheWNhc3RSZXN1bHQ7CgogICAgICBpZiAodGhpcy5pc0luQ29udGFjdCkgewogICAgICAgIGNvbnN0IHByb2plY3QgPSByYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChyYXljYXN0UmVzdWx0LmRpcmVjdGlvbldvcmxkKTsKICAgICAgICByYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXMuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocmVscG9zLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKHByb2plY3QgPj0gLTAuMSkgewogICAgICAgICAgdGhpcy5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIHByb2plY3Q7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gcHJvalZlbCAqIGludjsKICAgICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBOb3QgaW4gY29udGFjdCA6IHBvc2l0aW9uIHdoZWVsIGluIGEgbmljZSAocmVzdCBsZW5ndGgpIHBvc2l0aW9uCiAgICAgICAgcmF5Y2FzdFJlc3VsdC5zdXNwZW5zaW9uTGVuZ3RoID0gdGhpcy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQuc2NhbGUoLTEsIHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQpOwogICAgICAgIHRoaXMuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVscG9zID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogVmVoaWNsZSBoZWxwZXIgY2xhc3MgdGhhdCBjYXN0cyByYXlzIGZyb20gdGhlIHdoZWVsIHBvc2l0aW9ucyB0b3dhcmRzIHRoZSBncm91bmQgYW5kIGFwcGxpZXMgZm9yY2VzLgogICAqLwogIGNsYXNzIFJheWNhc3RWZWhpY2xlIHsKICAgIC8qKiBUaGUgY2FyIGNoYXNzaXMgYm9keS4gKi8KCiAgICAvKiogVGhlIHdoZWVscy4gKi8KCiAgICAvKiogV2lsbCBiZSBzZXQgdG8gdHJ1ZSBpZiB0aGUgY2FyIGlzIHNsaWRpbmcuICovCgogICAgLyoqIEluZGV4IG9mIHRoZSByaWdodCBheGlzLiB4PTAsIHk9MSwgej0yICovCgogICAgLyoqIEluZGV4IG9mIHRoZSBmb3J3YXJkIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHVwIGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogVGhlIGNvbnN0cmFpbnRzLiAqLwoKICAgIC8qKiBPcHRpb25hbCBwcmUtc3RlcCBjYWxsYmFjay4gKi8KCiAgICAvKiogTnVtYmVyIG9mIHdoZWVscyBvbiB0aGUgZ3JvdW5kLiAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICB0aGlzLmNoYXNzaXNCb2R5ID0gb3B0aW9ucy5jaGFzc2lzQm9keTsKICAgICAgdGhpcy53aGVlbEluZm9zID0gW107CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwogICAgICB0aGlzLndvcmxkID0gbnVsbDsKICAgICAgdGhpcy5pbmRleFJpZ2h0QXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4UmlnaHRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgOiAyOwogICAgICB0aGlzLmluZGV4Rm9yd2FyZEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhGb3J3YXJkQXhpcyA6IDA7CiAgICAgIHRoaXMuaW5kZXhVcEF4aXMgPSB0eXBlb2Ygb3B0aW9ucy5pbmRleFVwQXhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmluZGV4VXBBeGlzIDogMTsKICAgICAgdGhpcy5jb25zdHJhaW50cyA9IFtdOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7fTsKCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDA7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSB3aGVlbC4gRm9yIGluZm9ybWF0aW9uIGFib3V0IHRoZSBvcHRpb25zLCBzZWUgYFdoZWVsSW5mb2AuCiAgICAgKi8KCgogICAgYWRkV2hlZWwob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBpbmZvID0gbmV3IFdoZWVsSW5mbyhvcHRpb25zKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLndoZWVsSW5mb3MubGVuZ3RoOwogICAgICB0aGlzLndoZWVsSW5mb3MucHVzaChpbmZvKTsKICAgICAgcmV0dXJuIGluZGV4OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHN0ZWVyaW5nIHZhbHVlIG9mIGEgd2hlZWwuCiAgICAgKi8KCgogICAgc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgd2hlZWwuc3RlZXJpbmcgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSB3aGVlbCBmb3JjZSB0byBhcHBseSBvbiBvbmUgb2YgdGhlIHdoZWVscyBlYWNoIHRpbWUgc3RlcAogICAgICovCgoKICAgIGFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmVuZ2luZUZvcmNlID0gdmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgYnJha2luZyBmb3JjZSBvZiBhIHdoZWVsCiAgICAgKi8KCgogICAgc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpIHsKICAgICAgdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdLmJyYWtlID0gYnJha2U7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCB0aGUgdmVoaWNsZSBpbmNsdWRpbmcgaXRzIGNvbnN0cmFpbnRzIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICBhZGRUb1dvcmxkKHdvcmxkKSB7CiAgICAgIHdvcmxkLmFkZEJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIGNvbnN0IHRoYXQgPSB0aGlzOwoKICAgICAgdGhpcy5wcmVTdGVwQ2FsbGJhY2sgPSAoKSA9PiB7CiAgICAgICAgdGhhdC51cGRhdGVWZWhpY2xlKHdvcmxkLmR0KTsKICAgICAgfTsKCiAgICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSB3b3JsZDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IG9uZSBvZiB0aGUgd2hlZWwgYXhsZXMsIHdvcmxkLW9yaWVudGVkLgogICAgICovCgoKICAgIGdldFZlaGljbGVBeGlzV29ybGQoYXhpc0luZGV4LCByZXN1bHQpIHsKICAgICAgcmVzdWx0LnNldChheGlzSW5kZXggPT09IDAgPyAxIDogMCwgYXhpc0luZGV4ID09PSAxID8gMSA6IDAsIGF4aXNJbmRleCA9PT0gMiA/IDEgOiAwKTsKICAgICAgdGhpcy5jaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVzdWx0LCByZXN1bHQpOwogICAgfQoKICAgIHVwZGF0ZVZlaGljbGUodGltZVN0ZXApIHsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtKGkpOwogICAgICB9CgogICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgPSAzLjYgKiBjaGFzc2lzQm9keS52ZWxvY2l0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZm9yd2FyZFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRWZWhpY2xlQXhpc1dvcmxkKHRoaXMuaW5kZXhGb3J3YXJkQXhpcywgZm9yd2FyZFdvcmxkKTsKCiAgICAgIGlmIChmb3J3YXJkV29ybGQuZG90KGNoYXNzaXNCb2R5LnZlbG9jaXR5KSA8IDApIHsKICAgICAgICB0aGlzLmN1cnJlbnRWZWhpY2xlU3BlZWRLbUhvdXIgKj0gLTE7CiAgICAgIH0gLy8gc2ltdWxhdGUgc3VzcGVuc2lvbgoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICB0aGlzLmNhc3RSYXkod2hlZWxJbmZvc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlU3VzcGVuc2lvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGltcHVsc2UgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIC8vYXBwbHkgc3VzcGVuc2lvbiBmb3JjZQogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBsZXQgc3VzcGVuc2lvbkZvcmNlID0gd2hlZWwuc3VzcGVuc2lvbkZvcmNlOwoKICAgICAgICBpZiAoc3VzcGVuc2lvbkZvcmNlID4gd2hlZWwubWF4U3VzcGVuc2lvbkZvcmNlKSB7CiAgICAgICAgICBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwLCBpbXB1bHNlKTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVscG9zKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVGcmljdGlvbih0aW1lU3RlcCk7CiAgICAgIGNvbnN0IGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2ogPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBmd2QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCB2ZWwgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsgLy9jb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwogICAgICAgIC8vd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbHBvcyk7CgogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgdmVsKTsgLy8gSGFjayB0byBnZXQgdGhlIHJvdGF0aW9uIGluIHRoZSBjb3JyZWN0IGRpcmVjdGlvbgoKICAgICAgICBsZXQgbSA9IDE7CgogICAgICAgIHN3aXRjaCAodGhpcy5pbmRleFVwQXhpcykgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtID0gLTE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvaiA9IGZ3ZC5kb3Qod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLnNjYWxlKHByb2osIGhpdE5vcm1hbFdvcmxkU2NhbGVkV2l0aFByb2opOwogICAgICAgICAgZndkLnZzdWIoaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiwgZndkKTsKICAgICAgICAgIGNvbnN0IHByb2oyID0gZndkLmRvdCh2ZWwpOwogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IG0gKiBwcm9qMiAqIHRpbWVTdGVwIC8gd2hlZWwucmFkaXVzOwogICAgICAgIH0KCiAgICAgICAgaWYgKCh3aGVlbC5zbGlkaW5nIHx8ICF3aGVlbC5pc0luQ29udGFjdCkgJiYgd2hlZWwuZW5naW5lRm9yY2UgIT09IDAgJiYgd2hlZWwudXNlQ3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCkgewogICAgICAgICAgLy8gQXBwbHkgY3VzdG9tIHJvdGF0aW9uIHdoZW4gYWNjZWxlcmF0aW5nIGFuZCBzbGlkaW5nCiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gKHdoZWVsLmVuZ2luZUZvcmNlID4gMCA/IDEgOiAtMSkgKiB3aGVlbC5jdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkICogdGltZVN0ZXA7CiAgICAgICAgfSAvLyBMb2NrIHdoZWVscwoKCiAgICAgICAgaWYgKE1hdGguYWJzKHdoZWVsLmJyYWtlKSA+IE1hdGguYWJzKHdoZWVsLmVuZ2luZUZvcmNlKSkgewogICAgICAgICAgd2hlZWwuZGVsdGFSb3RhdGlvbiA9IDA7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5yb3RhdGlvbiArPSB3aGVlbC5kZWx0YVJvdGF0aW9uOyAvLyBVc2UgdGhlIG9sZCB2YWx1ZQoKICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uICo9IDAuOTk7IC8vIGRhbXBpbmcgb2Ygcm90YXRpb24gd2hlbiBub3QgaW4gY29udGFjdAogICAgICB9CiAgICB9CgogICAgdXBkYXRlU3VzcGVuc2lvbihkZWx0YVRpbWUpIHsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBjaGFzc2lzTWFzcyA9IGNoYXNzaXNCb2R5Lm1hc3M7CiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgd19pdCA9IDA7IHdfaXQgPCBudW1XaGVlbHM7IHdfaXQrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1t3X2l0XTsKCiAgICAgICAgaWYgKHdoZWVsLmlzSW5Db250YWN0KSB7CiAgICAgICAgICBsZXQgZm9yY2U7IC8vIFNwcmluZwoKICAgICAgICAgIGNvbnN0IHN1c3BfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGg7CiAgICAgICAgICBjb25zdCBjdXJyZW50X2xlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICBjb25zdCBsZW5ndGhfZGlmZiA9IHN1c3BfbGVuZ3RoIC0gY3VycmVudF9sZW5ndGg7CiAgICAgICAgICBmb3JjZSA9IHdoZWVsLnN1c3BlbnNpb25TdGlmZm5lc3MgKiBsZW5ndGhfZGlmZiAqIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbjsgLy8gRGFtcGVyCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkX3JlbF92ZWwgPSB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eTsKICAgICAgICAgIGxldCBzdXNwX2RhbXBpbmc7CgogICAgICAgICAgaWYgKHByb2plY3RlZF9yZWxfdmVsIDwgMCkgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdXNwX2RhbXBpbmcgPSB3aGVlbC5kYW1waW5nUmVsYXhhdGlvbjsKICAgICAgICAgIH0KCiAgICAgICAgICBmb3JjZSAtPSBzdXNwX2RhbXBpbmcgKiBwcm9qZWN0ZWRfcmVsX3ZlbDsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA9IGZvcmNlICogY2hhc3Npc01hc3M7CgogICAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25Gb3JjZSA8IDApIHsKICAgICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlRnJvbVdvcmxkKHdvcmxkKSB7CiAgICAgIHRoaXMuY29uc3RyYWludHM7CiAgICAgIHdvcmxkLnJlbW92ZUJvZHkodGhpcy5jaGFzc2lzQm9keSk7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCB0aGlzLnByZVN0ZXBDYWxsYmFjayk7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgfQoKICAgIGNhc3RSYXkod2hlZWwpIHsKICAgICAgY29uc3QgcmF5dmVjdG9yID0gY2FzdFJheV9yYXl2ZWN0b3I7CiAgICAgIGNvbnN0IHRhcmdldCA9IGNhc3RSYXlfdGFyZ2V0OwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGxldCBkZXB0aCA9IC0xOwogICAgICBjb25zdCByYXlsZW4gPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLnJhZGl1czsKICAgICAgd2hlZWwuZGlyZWN0aW9uV29ybGQuc2NhbGUocmF5bGVuLCByYXl2ZWN0b3IpOwogICAgICBjb25zdCBzb3VyY2UgPSB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ7CiAgICAgIHNvdXJjZS52YWRkKHJheXZlY3RvciwgdGFyZ2V0KTsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQ7CiAgICAgIHJheWNhc3RSZXN1bHQucmVzZXQoKTsgLy8gVHVybiBvZmYgcmF5IGNvbGxpc2lvbiB3aXRoIHRoZSBjaGFzc2lzIHRlbXBvcmFyaWx5CgogICAgICBjb25zdCBvbGRTdGF0ZSA9IGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IGZhbHNlOyAvLyBDYXN0IHJheSBhZ2FpbnN0IHdvcmxkCgogICAgICB0aGlzLndvcmxkLnJheVRlc3Qoc291cmNlLCB0YXJnZXQsIHJheWNhc3RSZXN1bHQpOwogICAgICBjaGFzc2lzQm9keS5jb2xsaXNpb25SZXNwb25zZSA9IG9sZFN0YXRlOwogICAgICBjb25zdCBvYmplY3QgPSByYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuZ3JvdW5kT2JqZWN0ID0gMDsKCiAgICAgIGlmIChvYmplY3QpIHsKICAgICAgICBkZXB0aCA9IHJheWNhc3RSZXN1bHQuZGlzdGFuY2U7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgd2hlZWwuaXNJbkNvbnRhY3QgPSB0cnVlOwogICAgICAgIGNvbnN0IGhpdERpc3RhbmNlID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gaGl0RGlzdGFuY2UgLSB3aGVlbC5yYWRpdXM7IC8vIGNsYW1wIG9uIG1heCBzdXNwZW5zaW9uIHRyYXZlbAoKICAgICAgICBjb25zdCBtaW5TdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggLSB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIGNvbnN0IG1heFN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoIDwgbWluU3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1pblN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA+IG1heFN1c3BlbnNpb25MZW5ndGgpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBtYXhTdXNwZW5zaW9uTGVuZ3RoOwogICAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5yZXNldCgpOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgZGVub21pbmF0b3IgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdCh3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgICAgY29uc3QgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQgPSBuZXcgVmVjMygpOwogICAgICAgIGNoYXNzaXNCb2R5LmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwogICAgICAgIGNvbnN0IHByb2pWZWwgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkLmRvdChjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CgogICAgICAgIGlmIChkZW5vbWluYXRvciA+PSAtMC4xKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDA7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxIC8gMC4xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBpbnYgPSAtMSAvIGRlbm9taW5hdG9yOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gaW52OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL3B1dCB3aGVlbCBpbmZvIGFzIGluIHJlc3QgcG9zaXRpb24KICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvblJlc3RMZW5ndGggKyAwICogd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IDAuMDsKICAgICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uID0gMS4wOwogICAgICB9CgogICAgICByZXR1cm4gZGVwdGg7CiAgICB9CgogICAgdXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCkgewogICAgICB3aGVlbC5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNoYXNzaXNCb2R5LnBvaW50VG9Xb3JsZEZyYW1lKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwgd2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmRpcmVjdGlvbkxvY2FsLCB3aGVlbC5kaXJlY3Rpb25Xb3JsZCk7CiAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZSh3aGVlbC5heGxlTG9jYWwsIHdoZWVsLmF4bGVXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBvbmUgb2YgdGhlIHdoZWVsIHRyYW5zZm9ybS4KICAgICAqIE5vdGUgd2hlbiByZW5kZXJpbmcgd2hlZWxzOiBkdXJpbmcgZWFjaCBzdGVwLCB3aGVlbCB0cmFuc2Zvcm1zIGFyZSB1cGRhdGVkIEJFRk9SRSB0aGUgY2hhc3NpczsgaWUuIHRoZWlyIHBvc2l0aW9uIGJlY29tZXMgaW52YWxpZCBhZnRlciB0aGUgc3RlcC4gVGh1cyB3aGVuIHlvdSByZW5kZXIgd2hlZWxzLCB5b3UgbXVzdCB1cGRhdGUgd2hlZWwgdHJhbnNmb3JtcyBiZWZvcmUgcmVuZGVyaW5nIHRoZW0uIFNlZSByYXljYXN0VmVoaWNsZSBkZW1vIGZvciBhbiBleGFtcGxlLgogICAgICogQHBhcmFtIHdoZWVsSW5kZXggVGhlIHdoZWVsIGluZGV4IHRvIHVwZGF0ZS4KICAgICAqLwoKCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybSh3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHVwID0gdG1wVmVjNDsKICAgICAgY29uc3QgcmlnaHQgPSB0bXBWZWM1OwogICAgICBjb25zdCBmd2QgPSB0bXBWZWM2OwogICAgICBjb25zdCB3aGVlbCA9IHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XTsKICAgICAgdGhpcy51cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKTsKICAgICAgd2hlZWwuZGlyZWN0aW9uTG9jYWwuc2NhbGUoLTEsIHVwKTsKICAgICAgcmlnaHQuY29weSh3aGVlbC5heGxlTG9jYWwpOwogICAgICB1cC5jcm9zcyhyaWdodCwgZndkKTsKICAgICAgZndkLm5vcm1hbGl6ZSgpOwogICAgICByaWdodC5ub3JtYWxpemUoKTsgLy8gUm90YXRlIGFyb3VuZCBzdGVlcmluZyBvdmVyIHRoZSB3aGVlbEF4bGUKCiAgICAgIGNvbnN0IHN0ZWVyaW5nID0gd2hlZWwuc3RlZXJpbmc7CiAgICAgIGNvbnN0IHN0ZWVyaW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgc3RlZXJpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZSh1cCwgc3RlZXJpbmcpOwogICAgICBjb25zdCByb3RhdGluZ09ybiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHJvdGF0aW5nT3JuLnNldEZyb21BeGlzQW5nbGUocmlnaHQsIHdoZWVsLnJvdGF0aW9uKTsgLy8gV29ybGQgcm90YXRpb24gb2YgdGhlIHdoZWVsCgogICAgICBjb25zdCBxID0gd2hlZWwud29ybGRUcmFuc2Zvcm0ucXVhdGVybmlvbjsKICAgICAgdGhpcy5jaGFzc2lzQm9keS5xdWF0ZXJuaW9uLm11bHQoc3RlZXJpbmdPcm4sIHEpOwogICAgICBxLm11bHQocm90YXRpbmdPcm4sIHEpOwogICAgICBxLm5vcm1hbGl6ZSgpOyAvLyB3b3JsZCBwb3NpdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHAgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5wb3NpdGlvbjsKICAgICAgcC5jb3B5KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgcC5zY2FsZSh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoLCBwKTsKICAgICAgcC52YWRkKHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCwgcCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgdHJhbnNmb3JtIG9mIG9uZSBvZiB0aGUgd2hlZWxzCiAgICAgKi8KCgogICAgZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbEluZGV4KSB7CiAgICAgIHJldHVybiB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0ud29ybGRUcmFuc2Zvcm07CiAgICB9CgogICAgdXBkYXRlRnJpY3Rpb24odGltZVN0ZXApIHsKICAgICAgY29uc3Qgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qOyAvL2NhbGN1bGF0ZSB0aGUgaW1wdWxzZSwgc28gdGhhdCB0aGUgd2hlZWxzIGRvbid0IG1vdmUgc2lkZXdhcmRzCgogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwogICAgICBjb25zdCBmb3J3YXJkV1MgPSB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1M7CiAgICAgIGNvbnN0IGF4bGUgPSB1cGRhdGVGcmljdGlvbl9heGxlOwogICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB0aGlzLm51bVdoZWVsc09uR3JvdW5kKys7CiAgICAgICAgfQoKICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSAwOwoKICAgICAgICBpZiAoIWZvcndhcmRXU1tpXSkgewogICAgICAgICAgZm9yd2FyZFdTW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CgogICAgICAgIGlmICghYXhsZVtpXSkgewogICAgICAgICAgYXhsZVtpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgYXhsZWkgPSBheGxlW2ldOwogICAgICAgICAgY29uc3Qgd2hlZWxUcmFucyA9IHRoaXMuZ2V0V2hlZWxUcmFuc2Zvcm1Xb3JsZChpKTsgLy8gR2V0IHdvcmxkIGF4bGUKCiAgICAgICAgICB3aGVlbFRyYW5zLnZlY3RvclRvV29ybGRGcmFtZShkaXJlY3Rpb25zW3RoaXMuaW5kZXhSaWdodEF4aXNdLCBheGxlaSk7CiAgICAgICAgICBjb25zdCBzdXJmTm9ybWFsV1MgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkOwogICAgICAgICAgY29uc3QgcHJvaiA9IGF4bGVpLmRvdChzdXJmTm9ybWFsV1MpOwogICAgICAgICAgc3VyZk5vcm1hbFdTLnNjYWxlKHByb2osIHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaik7CiAgICAgICAgICBheGxlaS52c3ViKHN1cmZOb3JtYWxXU19zY2FsZWRfcHJvaiwgYXhsZWkpOwogICAgICAgICAgYXhsZWkubm9ybWFsaXplKCk7CiAgICAgICAgICBzdXJmTm9ybWFsV1MuY3Jvc3MoYXhsZWksIGZvcndhcmRXU1tpXSk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0ubm9ybWFsaXplKCk7CiAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWwoY2hhc3Npc0JvZHksIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGF4bGVpKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHNpZGVGcmljdGlvblN0aWZmbmVzczI7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBzaWRlRmFjdG9yID0gMTsKICAgICAgY29uc3QgZndkRmFjdG9yID0gMC41OwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwogICAgICAgIGxldCByb2xsaW5nRnJpY3Rpb24gPSAwOwogICAgICAgIHdoZWVsLnNsaXBJbmZvID0gMTsKCiAgICAgICAgaWYgKGdyb3VuZE9iamVjdCkgewogICAgICAgICAgY29uc3QgZGVmYXVsdFJvbGxpbmdGcmljdGlvbkltcHVsc2UgPSAwOwogICAgICAgICAgY29uc3QgbWF4SW1wdWxzZSA9IHdoZWVsLmJyYWtlID8gd2hlZWwuYnJha2UgOiBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZTsgLy8gYnRXaGVlbENvbnRhY3RQb2ludCBjb250YWN0UHQoY2hhc3Npc0JvZHksZ3JvdW5kT2JqZWN0LHdoZWVsSW5mcmF5Y2FzdEluZm8uaGl0UG9pbnRXb3JsZCxmb3J3YXJkV1Nbd2hlZWxdLG1heEltcHVsc2UpOwogICAgICAgICAgLy8gcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjb250YWN0UHQpOwoKICAgICAgICAgIHJvbGxpbmdGcmljdGlvbiA9IGNhbGNSb2xsaW5nRnJpY3Rpb24oY2hhc3Npc0JvZHksIGdyb3VuZE9iamVjdCwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBmb3J3YXJkV1NbaV0sIG1heEltcHVsc2UpOwogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uICs9IHdoZWVsLmVuZ2luZUZvcmNlICogdGltZVN0ZXA7IC8vIHJvbGxpbmdGcmljdGlvbiA9IDA7CgogICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4SW1wdWxzZSAvIHJvbGxpbmdGcmljdGlvbjsKICAgICAgICAgIHdoZWVsLnNsaXBJbmZvICo9IGZhY3RvcjsKICAgICAgICB9IC8vc3dpdGNoIGJldHdlZW4gYWN0aXZlIHJvbGxpbmcgKHRocm90dGxlKSwgYnJha2luZyBhbmQgbm9uLWFjdGl2ZSByb2xsaW5nIGZyaWN0aW9uIChudGhyb3R0bGUvYnJlYWspCgoKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CiAgICAgICAgd2hlZWwuc2tpZEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CiAgICAgICAgICBjb25zdCBtYXhpbXAgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgKiB0aW1lU3RlcCAqIHdoZWVsLmZyaWN0aW9uU2xpcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNpZGUgPSBtYXhpbXA7CiAgICAgICAgICBjb25zdCBtYXhpbXBTcXVhcmVkID0gbWF4aW1wICogbWF4aW1wU2lkZTsKICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gcm9sbGluZ0ZyaWN0aW9uOyAvL3doZWVsSW5mby5lbmdpbmVGb3JjZSogdGltZVN0ZXA7CgogICAgICAgICAgY29uc3QgeCA9IHdoZWVsLmZvcndhcmRJbXB1bHNlICogZndkRmFjdG9yIC8gd2hlZWwuZm9yd2FyZEFjY2VsZXJhdGlvbjsKICAgICAgICAgIGNvbnN0IHkgPSB3aGVlbC5zaWRlSW1wdWxzZSAqIHNpZGVGYWN0b3IgLyB3aGVlbC5zaWRlQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgaW1wdWxzZVNxdWFyZWQgPSB4ICogeCArIHkgKiB5OwogICAgICAgICAgd2hlZWwuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgICAgIGlmIChpbXB1bHNlU3F1YXJlZCA+IG1heGltcFNxdWFyZWQpIHsKICAgICAgICAgICAgdGhpcy5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgd2hlZWwuc2xpZGluZyA9IHRydWU7CiAgICAgICAgICAgIGNvbnN0IGZhY3RvciA9IG1heGltcCAvIE1hdGguc3FydChpbXB1bHNlU3F1YXJlZCk7CiAgICAgICAgICAgIHdoZWVsLnNraWRJbmZvICo9IGZhY3RvcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsaWRpbmcpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CgogICAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICAgIGlmICh3aGVlbC5za2lkSW5mbyA8IDEpIHsKICAgICAgICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgICB3aGVlbC5zaWRlSW1wdWxzZSAqPSB3aGVlbC5za2lkSW5mbzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBhcHBseSB0aGUgaW1wdWxzZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGNvbnN0IHJlbF9wb3MgPSBuZXcgVmVjMygpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxfcG9zKTsgLy8gY2Fubm9ucyBhcHBseWltcHVsc2UgaXMgdXNpbmcgd29ybGQgY29vcmQgZm9yIHRoZSBwb3NpdGlvbgogICAgICAgIC8vcmVsX3Bvcy5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgIGlmICh3aGVlbC5mb3J3YXJkSW1wdWxzZSAhPT0gMCkgewogICAgICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBmb3J3YXJkV1NbaV0uc2NhbGUod2hlZWwuZm9yd2FyZEltcHVsc2UsIGltcHVsc2UpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbF9wb3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHdoZWVsLnNpZGVJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgICBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQudnN1Yihncm91bmRPYmplY3QucG9zaXRpb24sIHJlbF9wb3MyKTsgLy9yZWxfcG9zMi5jb3B5KHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCk7CgogICAgICAgICAgY29uc3Qgc2lkZUltcCA9IG5ldyBWZWMzKCk7CiAgICAgICAgICBheGxlW2ldLnNjYWxlKHdoZWVsLnNpZGVJbXB1bHNlLCBzaWRlSW1wKTsgLy8gU2NhbGUgdGhlIHJlbGF0aXZlIHBvc2l0aW9uIGluIHRoZSB1cCBkaXJlY3Rpb24gd2l0aCByb2xsSW5mbHVlbmNlLgogICAgICAgICAgLy8gSWYgcm9sbEluZmx1ZW5jZSBpcyAxLCB0aGUgaW1wdWxzZSB3aWxsIGJlIGFwcGxpZWQgb24gdGhlIGhpdFBvaW50IChlYXN5IHRvIHJvbGwgb3ZlciksIGlmIGl0IGlzIHplcm8gaXQgd2lsbCBiZSBhcHBsaWVkIGluIHRoZSBzYW1lIHBsYW5lIGFzIHRoZSBjZW50ZXIgb2YgbWFzcyAobm90IGVhc3kgdG8gcm9sbCBvdmVyKS4KCiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb0xvY2FsRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICByZWxfcG9zWyd4eXonW3RoaXMuaW5kZXhVcEF4aXNdXSAqPSB3aGVlbC5yb2xsSW5mbHVlbmNlOwogICAgICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHJlbF9wb3MsIHJlbF9wb3MpOwogICAgICAgICAgY2hhc3Npc0JvZHkuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MpOyAvL2FwcGx5IGZyaWN0aW9uIGltcHVsc2Ugb24gdGhlIGdyb3VuZAoKICAgICAgICAgIHNpZGVJbXAuc2NhbGUoLTEsIHNpZGVJbXApOwogICAgICAgICAgZ3JvdW5kT2JqZWN0LmFwcGx5SW1wdWxzZShzaWRlSW1wLCByZWxfcG9zMik7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM0ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM1ID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWM2ID0gbmV3IFZlYzMoKTsKICBuZXcgUmF5KCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3JheXZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FzdFJheV90YXJnZXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGRpcmVjdGlvbnMgPSBbbmV3IFZlYzMoMSwgMCwgMCksIG5ldyBWZWMzKDAsIDEsIDApLCBuZXcgVmVjMygwLCAwLCAxKV07CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qID0gbmV3IFZlYzMoKTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9heGxlID0gW107CiAgY29uc3QgdXBkYXRlRnJpY3Rpb25fZm9yd2FyZFdTID0gW107CiAgY29uc3Qgc2lkZUZyaWN0aW9uU3RpZmZuZXNzMiA9IDE7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY2FsY1JvbGxpbmdGcmljdGlvbihib2R5MCwgYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQsIG1heEltcHVsc2UpIHsKICAgIGxldCBqMSA9IDA7CiAgICBjb25zdCBjb250YWN0UG9zV29ybGQgPSBmcmljdGlvblBvc1dvcmxkOyAvLyBjb25zdCByZWxfcG9zMSA9IG5ldyBWZWMzKCk7CiAgICAvLyBjb25zdCByZWxfcG9zMiA9IG5ldyBWZWMzKCk7CgogICAgY29uc3QgdmVsMSA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMTsKICAgIGNvbnN0IHZlbDIgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDsgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTAucG9zaXRpb24sIHJlbF9wb3MxKTsKICAgIC8vIGNvbnRhY3RQb3NXb3JsZC52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMik7CgogICAgYm9keTAuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwxKTsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KGNvbnRhY3RQb3NXb3JsZCwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHZyZWwgPSBmcmljdGlvbkRpcmVjdGlvbldvcmxkLmRvdCh2ZWwpOwogICAgY29uc3QgZGVub20wID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5MCwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCk7CiAgICBjb25zdCBkZW5vbTEgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkxLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IHJlbGF4YXRpb24gPSAxOwogICAgY29uc3QgamFjRGlhZ0FCSW52ID0gcmVsYXhhdGlvbiAvIChkZW5vbTAgKyBkZW5vbTEpOyAvLyBjYWxjdWxhdGUgaiB0aGF0IG1vdmVzIHVzIHRvIHplcm8gcmVsYXRpdmUgdmVsb2NpdHkKCiAgICBqMSA9IC12cmVsICogamFjRGlhZ0FCSW52OwoKICAgIGlmIChtYXhJbXB1bHNlIDwgajEpIHsKICAgICAgajEgPSBtYXhJbXB1bHNlOwogICAgfQoKICAgIGlmIChqMSA8IC1tYXhJbXB1bHNlKSB7CiAgICAgIGoxID0gLW1heEltcHVsc2U7CiAgICB9CgogICAgcmV0dXJuIGoxOwogIH0KCiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbSA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keSwgcG9zLCBub3JtYWwpIHsKICAgIGNvbnN0IHIwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9yMDsKICAgIGNvbnN0IGMwID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9jMDsKICAgIGNvbnN0IHZlYyA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfdmVjOwogICAgY29uc3QgbSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3JfbTsKICAgIHBvcy52c3ViKGJvZHkucG9zaXRpb24sIHIwKTsKICAgIHIwLmNyb3NzKG5vcm1hbCwgYzApOwogICAgYm9keS5pbnZJbmVydGlhV29ybGQudm11bHQoYzAsIG0pOwogICAgbS5jcm9zcyhyMCwgdmVjKTsKICAgIHJldHVybiBib2R5Lmludk1hc3MgKyBub3JtYWwuZG90KHZlYyk7CiAgfQoKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwgPSBuZXcgVmVjMygpOyAvLyBiaWxhdGVyYWwgY29uc3RyYWludCBiZXR3ZWVuIHR3byBkeW5hbWljIG9iamVjdHMKCiAgZnVuY3Rpb24gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChib2R5MSwgcG9zMSwgYm9keTIsIHBvczIsIG5vcm1hbCkgewogICAgY29uc3Qgbm9ybWFsTGVuU3FyID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICBpZiAobm9ybWFsTGVuU3FyID4gMS4xKSB7CiAgICAgIHJldHVybiAwOyAvLyBubyBpbXB1bHNlCiAgICB9IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgIC8vIHBvczEudnN1Yihib2R5MS5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gcG9zMi52c3ViKGJvZHkyLnBvc2l0aW9uLCByZWxfcG9zMik7CgoKICAgIGNvbnN0IHZlbDEgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDE7CiAgICBjb25zdCB2ZWwyID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyOwogICAgY29uc3QgdmVsID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWw7CiAgICBib2R5MS5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChwb3MxLCB2ZWwxKTsKICAgIGJvZHkyLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczIsIHZlbDIpOwogICAgdmVsMS52c3ViKHZlbDIsIHZlbCk7CiAgICBjb25zdCByZWxfdmVsID0gbm9ybWFsLmRvdCh2ZWwpOwogICAgY29uc3QgY29udGFjdERhbXBpbmcgPSAwLjI7CiAgICBjb25zdCBtYXNzVGVybSA9IDEgLyAoYm9keTEuaW52TWFzcyArIGJvZHkyLmludk1hc3MpOwogICAgY29uc3QgaW1wdWxzZSA9IC1jb250YWN0RGFtcGluZyAqIHJlbF92ZWwgKiBtYXNzVGVybTsKICAgIHJldHVybiBpbXB1bHNlOwogIH0KCiAgLyoqCiAgICogU3BoZXJpY2FsIHNoYXBlCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzID0gMQogICAqICAgICBjb25zdCBzcGhlcmVTaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKHJhZGl1cykKICAgKiAgICAgY29uc3Qgc3BoZXJlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBzcGhlcmVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHNwaGVyZUJvZHkpCiAgICovCiAgY2xhc3MgU3BoZXJlIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgcmFkaXVzIG9mIHRoZSBzcGhlcmUuCiAgICAgKi8KCiAgICAvKioKICAgICAqCiAgICAgKiBAcGFyYW0gcmFkaXVzIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZSwgYSBub24tbmVnYXRpdmUgbnVtYmVyLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihyYWRpdXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlNQSEVSRQogICAgICB9KTsKICAgICAgdGhpcy5yYWRpdXMgPSByYWRpdXMgIT09IHVuZGVmaW5lZCA/IHJhZGl1cyA6IDEuMDsKCiAgICAgIGlmICh0aGlzLnJhZGl1cyA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBzcGhlcmUgcmFkaXVzIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYSAqLwoKCiAgICBjYWxjdWxhdGVMb2NhbEluZXJ0aWEobWFzcywgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IEkgPSAyLjAgKiBtYXNzICogdGhpcy5yYWRpdXMgKiB0aGlzLnJhZGl1cyAvIDUuMDsKICAgICAgdGFyZ2V0LnggPSBJOwogICAgICB0YXJnZXQueSA9IEk7CiAgICAgIHRhcmdldC56ID0gSTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKiB2b2x1bWUgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIE1hdGgucG93KHRoaXMucmFkaXVzLCAzKSAvIDMuMDsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IHRoaXMucmFkaXVzOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIGNvbnN0IHIgPSB0aGlzLnJhZGl1czsKICAgICAgY29uc3QgYXhlcyA9IFsneCcsICd5JywgJ3onXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGF4ID0gYXhlc1tpXTsKICAgICAgICBtaW5bYXhdID0gcG9zW2F4XSAtIHI7CiAgICAgICAgbWF4W2F4XSA9IHBvc1theF0gKyByOwogICAgICB9CiAgICB9CgogIH0KICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsgLy8gVGVtcCB2ZWN0b3JzIGZvciBjYWxjdWxhdGlvbgoKICBuZXcgVmVjMygpOyAvLyBSZWxhdGl2ZSB2ZWxvY2l0eQoKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEN5bGluZGVyIGNsYXNzLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IHJhZGl1c1RvcCA9IDAuNQogICAqICAgICBjb25zdCByYWRpdXNCb3R0b20gPSAwLjUKICAgKiAgICAgY29uc3QgaGVpZ2h0ID0gMgogICAqICAgICBjb25zdCBudW1TZWdtZW50cyA9IDEyCiAgICogICAgIGNvbnN0IGN5bGluZGVyU2hhcGUgPSBuZXcgQ0FOTk9OLkN5bGluZGVyKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKQogICAqICAgICBjb25zdCBjeWxpbmRlckJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY3lsaW5kZXJTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGN5bGluZGVyQm9keSkKICAgKi8KCiAgY2xhc3MgQ3lsaW5kZXIgZXh0ZW5kcyBDb252ZXhQb2x5aGVkcm9uIHsKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4gKi8KCiAgICAvKiogVGhlIG51bWJlciBvZiBzZWdtZW50cyB0byBidWlsZCB0aGUgY3lsaW5kZXIgb3V0IG9mLiAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHJhZGl1c1RvcCBUaGUgcmFkaXVzIG9mIHRoZSB0b3Agb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIHJhZGl1c0JvdHRvbSBUaGUgcmFkaXVzIG9mIHRoZSBib3R0b20gb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIGhlaWdodCBUaGUgaGVpZ2h0IG9mIHRoZSBDeWxpbmRlci4KICAgICAqIEBwYXJhbSBudW1TZWdtZW50cyBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzKSB7CiAgICAgIGlmIChyYWRpdXNUb3AgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c1RvcCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1c0JvdHRvbSA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChoZWlnaHQgPT09IHZvaWQgMCkgewogICAgICAgIGhlaWdodCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChudW1TZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbnVtU2VnbWVudHMgPSA4OwogICAgICB9CgogICAgICBpZiAocmFkaXVzVG9wIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIGN5bGluZGVyIHJhZGl1c1RvcCBjYW5ub3QgYmUgbmVnYXRpdmUuJyk7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNCb3R0b20gPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzQm90dG9tIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgY29uc3QgTiA9IG51bVNlZ21lbnRzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBheGVzID0gW107CiAgICAgIGNvbnN0IGZhY2VzID0gW107CiAgICAgIGNvbnN0IGJvdHRvbWZhY2UgPSBbXTsKICAgICAgY29uc3QgdG9wZmFjZSA9IFtdOwogICAgICBjb25zdCBjb3MgPSBNYXRoLmNvczsKICAgICAgY29uc3Qgc2luID0gTWF0aC5zaW47IC8vIEZpcnN0IGJvdHRvbSBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKDApLCAtaGVpZ2h0ICogMC41LCByYWRpdXNCb3R0b20gKiBjb3MoMCkpKTsKICAgICAgYm90dG9tZmFjZS5wdXNoKDApOyAvLyBGaXJzdCB0b3AgcG9pbnQKCiAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbigwKSwgaGVpZ2h0ICogMC41LCByYWRpdXNUb3AgKiBjb3MoMCkpKTsKICAgICAgdG9wZmFjZS5wdXNoKDEpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOOyBpKyspIHsKICAgICAgICBjb25zdCB0aGV0YSA9IDIgKiBNYXRoLlBJIC8gTiAqIChpICsgMSk7CiAgICAgICAgY29uc3QgdGhldGFOID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAwLjUpOwoKICAgICAgICBpZiAoaSA8IE4gLSAxKSB7CiAgICAgICAgICAvLyBCb3R0b20KICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c0JvdHRvbSAqIHNpbih0aGV0YSksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIGJvdHRvbWZhY2UucHVzaCgyICogaSArIDIpOyAvLyBUb3AKCiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNUb3AgKiBzaW4odGhldGEpLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcyh0aGV0YSkpKTsKICAgICAgICAgIHRvcGZhY2UucHVzaCgyICogaSArIDMpOyAvLyBGYWNlCgogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMiAqIGkgKyAzLCAyICogaSArIDJdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZmFjZXMucHVzaChbMiAqIGksIDIgKiBpICsgMSwgMSwgMF0pOyAvLyBDb25uZWN0CiAgICAgICAgfSAvLyBBeGlzOiB3ZSBjYW4gY3V0IG9mZiBoYWxmIG9mIHRoZW0gaWYgd2UgaGF2ZSBldmVuIG51bWJlciBvZiBzZWdtZW50cwoKCiAgICAgICAgaWYgKE4gJSAyID09PSAxIHx8IGkgPCBOIC8gMikgewogICAgICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKC1zaW4odGhldGFOKSwgMCwgY29zKHRoZXRhTikpKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZhY2VzLnB1c2goYm90dG9tZmFjZSk7CiAgICAgIGF4ZXMucHVzaChuZXcgVmVjMygwLCAxLCAwKSk7IC8vIFJlb3JkZXIgdG9wIGZhY2UKCiAgICAgIGNvbnN0IHRlbXAgPSBbXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG9wZmFjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHRlbXAucHVzaCh0b3BmYWNlW3RvcGZhY2UubGVuZ3RoIC0gaSAtIDFdKTsKICAgICAgfQoKICAgICAgZmFjZXMucHVzaCh0ZW1wKTsKICAgICAgc3VwZXIoewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMudHlwZSA9IFNoYXBlLnR5cGVzLkNZTElOREVSOwogICAgICB0aGlzLnJhZGl1c1RvcCA9IHJhZGl1c1RvcDsKICAgICAgdGhpcy5yYWRpdXNCb3R0b20gPSByYWRpdXNCb3R0b207CiAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICB0aGlzLm51bVNlZ21lbnRzID0gbnVtU2VnbWVudHM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogUGFydGljbGUgc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGFydGljbGVTaGFwZSA9IG5ldyBDQU5OT04uUGFydGljbGUoKQogICAqICAgICBjb25zdCBwYXJ0aWNsZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogcGFydGljbGVTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KHBhcnRpY2xlQm9keSkKICAgKi8KICBjbGFzcyBQYXJ0aWNsZSBleHRlbmRzIFNoYXBlIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUEFSVElDTEUKICAgICAgfSk7CiAgICB9CiAgICAvKioKICAgICAqIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYQogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAwOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gMDsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICBtaW4uY29weShwb3MpOwogICAgICBtYXguY29weShwb3MpOwogICAgfQoKICB9CgogIC8qKgogICAqIEEgcGxhbmUsIGZhY2luZyBpbiB0aGUgWiBkaXJlY3Rpb24uIFRoZSBwbGFuZSBoYXMgaXRzIHN1cmZhY2UgYXQgej0wIGFuZCBldmVyeXRoaW5nIGJlbG93IHo9MCBpcyBhc3N1bWVkIHRvIGJlIHNvbGlkIHBsYW5lLiBUbyBtYWtlIHRoZSBwbGFuZSBmYWNlIGluIHNvbWUgb3RoZXIgZGlyZWN0aW9uIHRoYW4geiwgeW91IG11c3QgcHV0IGl0IGluc2lkZSBhIEJvZHkgYW5kIHJvdGF0ZSB0aGF0IGJvZHkuIFNlZSB0aGUgZGVtb3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcGxhbmVTaGFwZSA9IG5ldyBDQU5OT04uUGxhbmUoKQogICAqICAgICBjb25zdCBwbGFuZUJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAwLCBzaGFwZTogIHBsYW5lU2hhcGUgfSkKICAgKiAgICAgcGxhbmVCb2R5LnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKC1NYXRoLlBJIC8gMiwgMCwgMCkgLy8gbWFrZSBpdCBmYWNlIHVwCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGxhbmVCb2R5KQogICAqLwogIGNsYXNzIFBsYW5lIGV4dGVuZHMgU2hhcGUgewogICAgLyoqIHdvcmxkTm9ybWFsICovCgogICAgLyoqIHdvcmxkTm9ybWFsTmVlZHNVcGRhdGUgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuUExBTkUKICAgICAgfSk7IC8vIFdvcmxkIG9yaWVudGVkIG5vcm1hbAoKICAgICAgdGhpcy53b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgfQogICAgLyoqIGNvbXB1dGVXb3JsZE5vcm1hbCAqLwoKCiAgICBjb21wdXRlV29ybGROb3JtYWwocXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy53b3JsZE5vcm1hbDsKICAgICAgbi5zZXQoMCwgMCwgMSk7CiAgICAgIHF1YXQudm11bHQobiwgbik7CiAgICAgIHRoaXMud29ybGROb3JtYWxOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHBsYW5lIGlzIGluZmluaXRlLi4uCiAgICAgICAgTnVtYmVyLk1BWF9WQUxVRQogICAgICApOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIFRoZSBwbGFuZSBBQUJCIGlzIGluZmluaXRlLCBleGNlcHQgaWYgdGhlIG5vcm1hbCBpcyBwb2ludGluZyBhbG9uZyBhbnkgYXhpcwogICAgICB0ZW1wTm9ybWFsLnNldCgwLCAwLCAxKTsgLy8gRGVmYXVsdCBwbGFuZSBub3JtYWwgaXMgegoKICAgICAgcXVhdC52bXVsdCh0ZW1wTm9ybWFsLCB0ZW1wTm9ybWFsKTsKICAgICAgY29uc3QgbWF4VmFsID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgbWluLnNldCgtbWF4VmFsLCAtbWF4VmFsLCAtbWF4VmFsKTsKICAgICAgbWF4LnNldChtYXhWYWwsIG1heFZhbCwgbWF4VmFsKTsKCiAgICAgIGlmICh0ZW1wTm9ybWFsLnggPT09IDEpIHsKICAgICAgICBtYXgueCA9IHBvcy54OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueCA9PT0gLTEpIHsKICAgICAgICBtaW4ueCA9IHBvcy54OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC55ID09PSAxKSB7CiAgICAgICAgbWF4LnkgPSBwb3MueTsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnkgPT09IC0xKSB7CiAgICAgICAgbWluLnkgPSBwb3MueTsKICAgICAgfQoKICAgICAgaWYgKHRlbXBOb3JtYWwueiA9PT0gMSkgewogICAgICAgIG1heC56ID0gcG9zLno7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC56ID09PSAtMSkgewogICAgICAgIG1pbi56ID0gcG9zLno7CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CgogIH0KICBjb25zdCB0ZW1wTm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogSGVpZ2h0ZmllbGQgc2hhcGUgY2xhc3MuIEhlaWdodCBkYXRhIGlzIGdpdmVuIGFzIGFuIGFycmF5LiBUaGVzZSBkYXRhIHBvaW50cyBhcmUgc3ByZWFkIG91dCBldmVubHkgd2l0aCBhIGdpdmVuIGRpc3RhbmNlLgogICAqIEB0b2RvIFNob3VsZCBiZSBwb3NzaWJsZSB0byB1c2UgYWxvbmcgYWxsIGF4ZXMsIG5vdCBqdXN0IHkKICAgKiBAdG9kbyBzaG91bGQgYmUgcG9zc2libGUgdG8gc2NhbGUgYWxvbmcgYWxsIGF4ZXMKICAgKiBAdG9kbyBSZWZhY3RvciBlbGVtZW50U2l6ZSB0byBlbGVtZW50U2l6ZVggYW5kIGVsZW1lbnRTaXplWQogICAqCiAgICogQGV4YW1wbGUKICAgKiAgICAgLy8gR2VuZXJhdGUgc29tZSBoZWlnaHQgZGF0YSAoeS12YWx1ZXMpLgogICAqICAgICBjb25zdCBkYXRhID0gW10KICAgKiAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDAwOyBpKyspIHsKICAgKiAgICAgICAgIGNvbnN0IHkgPSAwLjUgKiBNYXRoLmNvcygwLjIgKiBpKQogICAqICAgICAgICAgZGF0YS5wdXNoKHkpCiAgICogICAgIH0KICAgKgogICAqICAgICAvLyBDcmVhdGUgdGhlIGhlaWdodGZpZWxkIHNoYXBlCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkU2hhcGUgPSBuZXcgQ0FOTk9OLkhlaWdodGZpZWxkKGRhdGEsIHsKICAgKiAgICAgICAgIGVsZW1lbnRTaXplOiAxIC8vIERpc3RhbmNlIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9ucwogICAqICAgICB9KQogICAqICAgICBjb25zdCBoZWlnaHRmaWVsZEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBzaGFwZTogaGVpZ2h0ZmllbGRTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGhlaWdodGZpZWxkQm9keSkKICAgKi8KICBjbGFzcyBIZWlnaHRmaWVsZCBleHRlbmRzIFNoYXBlIHsKICAgIC8qKgogICAgICogQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYXggdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBNaW5pbXVtIHZhbHVlIG9mIHRoZSBkYXRhIHBvaW50cyBpbiB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQgc3BhY2luZyBiZXR3ZWVuIHRoZSBkYXRhIHBvaW50cyBpbiBYIGFuZCBZIGRpcmVjdGlvbi4KICAgICAqIEB0b2RvIGVsZW1lbnRTaXplWCBhbmQgWQogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCB0cnVlCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBkYXRhIEFuIGFycmF5IG9mIG51bWJlcnMsIG9yIGhlaWdodCB2YWx1ZXMsIHRoYXQgYXJlIHNwcmVhZCBvdXQgYWxvbmcgdGhlIHggYXhpcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoZGF0YSwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIG1heFZhbHVlOiBudWxsLAogICAgICAgIG1pblZhbHVlOiBudWxsLAogICAgICAgIGVsZW1lbnRTaXplOiAxCiAgICAgIH0pOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuSEVJR0hURklFTEQKICAgICAgfSk7CiAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgIHRoaXMubWF4VmFsdWUgPSBvcHRpb25zLm1heFZhbHVlOwogICAgICB0aGlzLm1pblZhbHVlID0gb3B0aW9ucy5taW5WYWx1ZTsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IG9wdGlvbnMuZWxlbWVudFNpemU7CgogICAgICBpZiAob3B0aW9ucy5taW5WYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWluVmFsdWUoKTsKICAgICAgfQoKICAgICAgaWYgKG9wdGlvbnMubWF4VmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLnVwZGF0ZU1heFZhbHVlKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2FjaGVFbmFibGVkID0gdHJ1ZTsKICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsgLy8gImlfal9pc1VwcGVyIiA9PiB7IGNvbnZleDogLi4uLCBvZmZzZXQ6IC4uLiB9CiAgICAgIC8vIGZvciBleGFtcGxlOgogICAgICAvLyBfY2FjaGVkUGlsbGFyc1siMF8yXzEiXQoKICAgICAgdGhpcy5fY2FjaGVkUGlsbGFycyA9IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxsIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1pblZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1pblZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWluVmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPCBtaW5WYWx1ZSkgewogICAgICAgICAgICBtaW5WYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1pblZhbHVlID0gbWluVmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYG1heFZhbHVlYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZU1heFZhbHVlKCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgbWF4VmFsdWUgPSBkYXRhWzBdWzBdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGRhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZGF0YVtpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgdiA9IGRhdGFbaV1bal07CgogICAgICAgICAgaWYgKHYgPiBtYXhWYWx1ZSkgewogICAgICAgICAgICBtYXhWYWx1ZSA9IHY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLm1heFZhbHVlID0gbWF4VmFsdWU7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgaGVpZ2h0IHZhbHVlIGF0IGFuIGluZGV4LiBEb24ndCBmb3JnZXQgdG8gdXBkYXRlIG1heFZhbHVlIGFuZCBtaW5WYWx1ZSBhZnRlciB5b3UncmUgZG9uZS4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRWYWx1ZUF0SW5kZXgoeGksIHlpLCB2YWx1ZSkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBkYXRhW3hpXVt5aV0gPSB2YWx1ZTsgLy8gSW52YWxpZGF0ZSBjYWNoZQoKICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZmFsc2UpOwoKICAgICAgaWYgKHhpID4gMCkgewogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCB0cnVlKTsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSwgZmFsc2UpOwogICAgICB9CgogICAgICBpZiAoeWkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWkgLSAxLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDAgJiYgeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWkgLSAxLCB0cnVlKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4L21pbiBpbiBhIHJlY3RhbmdsZSBpbiB0aGUgbWF0cml4IGRhdGEKICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgdG8gc3RvcmUgdGhlIHJlc3VsdHMgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSByZXN1bHQgYXJyYXksIGlmIGl0IHdhcyBwYXNzZWQgaW4uIE1pbmltdW0gd2lsbCBiZSBhdCBwb3NpdGlvbiAwIGFuZCBtYXggYXQgMS4KICAgICAqLwoKCiAgICBnZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIH0KCiAgICAgIC8vIEdldCBtYXggYW5kIG1pbiBvZiB0aGUgZGF0YQogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOyAvLyBTZXQgZmlyc3QgdmFsdWUKCiAgICAgIGxldCBtYXggPSB0aGlzLm1pblZhbHVlOwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDw9IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPD0gaU1heFk7IGorKykgewogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAoaGVpZ2h0ID4gbWF4KSB7CiAgICAgICAgICAgIG1heCA9IGhlaWdodDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJlc3VsdFswXSA9IHRoaXMubWluVmFsdWU7CiAgICAgIHJlc3VsdFsxXSA9IG1heDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBpbmRleCBvZiBhIGxvY2FsIHBvc2l0aW9uIG9uIHRoZSBoZWlnaHRmaWVsZC4gVGhlIGluZGV4ZXMgaW5kaWNhdGUgdGhlIHJlY3RhbmdsZXMsIHNvIGlmIHlvdXIgdGVycmFpbiBpcyBtYWRlIG9mIE4geCBOIGhlaWdodCBkYXRhIHBvaW50cywgeW91IHdpbGwgaGF2ZSByZWN0YW5nbGUgaW5kZXhlcyByYW5naW5nIGZyb20gMCB0byBOLTEuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFR3by1lbGVtZW50IGFycmF5CiAgICAgKiBAcGFyYW0gY2xhbXAgSWYgdGhlIHBvc2l0aW9uIHNob3VsZCBiZSBjbGFtcGVkIHRvIHRoZSBoZWlnaHRmaWVsZCBlZGdlLgogICAgICovCgoKICAgIGdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCByZXN1bHQsIGNsYW1wKSB7CiAgICAgIC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAogICAgICBjb25zdCB3ID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgbGV0IHhpID0gTWF0aC5mbG9vcih4IC8gdyk7CiAgICAgIGxldCB5aSA9IE1hdGguZmxvb3IoeSAvIHcpOwogICAgICByZXN1bHRbMF0gPSB4aTsKICAgICAgcmVzdWx0WzFdID0geWk7CgogICAgICBpZiAoY2xhbXApIHsKICAgICAgICAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwogICAgICAgIGlmICh4aSA8IDApIHsKICAgICAgICAgIHhpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh5aSA8IDApIHsKICAgICAgICAgIHlpID0gMDsKICAgICAgICB9CgogICAgICAgIGlmICh4aSA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIHhpID0gZGF0YS5sZW5ndGggLSAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpID49IGRhdGFbMF0ubGVuZ3RoIC0gMSkgewogICAgICAgICAgeWkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgICAgfQogICAgICB9IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCgogICAgICBpZiAoeGkgPCAwIHx8IHlpIDwgMCB8fCB4aSA+PSBkYXRhLmxlbmd0aCAtIDEgfHwgeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBnZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYykgewogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgbG93ZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSB4aSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSB5aSkgKiogMjsKICAgICAgY29uc3QgdXBwZXJEaXN0MiA9ICh4IC8gZWxlbWVudFNpemUgLSAoeGkgKyAxKSkgKiogMiArICh5IC8gZWxlbWVudFNpemUgLSAoeWkgKyAxKSkgKiogMjsKICAgICAgY29uc3QgdXBwZXIgPSBsb3dlckRpc3QyID4gdXBwZXJEaXN0MjsKICAgICAgdGhpcy5nZXRUcmlhbmdsZSh4aSwgeWksIHVwcGVyLCBhLCBiLCBjKTsKICAgICAgcmV0dXJuIHVwcGVyOwogICAgfQoKICAgIGdldE5vcm1hbEF0KHgsIHksIGVkZ2VDbGFtcCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IGEgPSBnZXROb3JtYWxBdF9hOwogICAgICBjb25zdCBiID0gZ2V0Tm9ybWFsQXRfYjsKICAgICAgY29uc3QgYyA9IGdldE5vcm1hbEF0X2M7CiAgICAgIGNvbnN0IGUwID0gZ2V0Tm9ybWFsQXRfZTA7CiAgICAgIGNvbnN0IGUxID0gZ2V0Tm9ybWFsQXRfZTE7CiAgICAgIHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiLnZzdWIoYSwgZTApOwogICAgICBjLnZzdWIoYSwgZTEpOwogICAgICBlMC5jcm9zcyhlMSwgcmVzdWx0KTsKICAgICAgcmVzdWx0Lm5vcm1hbGl6ZSgpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gQUFCQiBvZiBhIHNxdWFyZSBpbiB0aGUgaGVpZ2h0ZmllbGQKICAgICAqIEBwYXJhbSB4aQogICAgICogQHBhcmFtIHlpCiAgICAgKiBAcGFyYW0gcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0QWFiYkF0SW5kZXgoeGksIHlpLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBfcmVmOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CiAgICAgIGxvd2VyQm91bmQuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgIHVwcGVyQm91bmQuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBoZWlnaHQgaW4gdGhlIGhlaWdodGZpZWxkIGF0IGEgZ2l2ZW4gcG9zaXRpb24KICAgICAqLwoKCiAgICBnZXRIZWlnaHRBdCh4LCB5LCBlZGdlQ2xhbXApIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgYSA9IGdldEhlaWdodEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXRIZWlnaHRBdF9iOwogICAgICBjb25zdCBjID0gZ2V0SGVpZ2h0QXRfYzsKICAgICAgY29uc3QgaWR4ID0gZ2V0SGVpZ2h0QXRfaWR4OwogICAgICB0aGlzLmdldEluZGV4T2ZQb3NpdGlvbih4LCB5LCBpZHgsIGVkZ2VDbGFtcCk7CiAgICAgIGxldCB4aSA9IGlkeFswXTsKICAgICAgbGV0IHlpID0gaWR4WzFdOwoKICAgICAgaWYgKGVkZ2VDbGFtcCkgewogICAgICAgIHhpID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB4aSkpOwogICAgICAgIHlpID0gTWF0aC5taW4oZGF0YVswXS5sZW5ndGggLSAyLCBNYXRoLm1heCgwLCB5aSkpOwogICAgICB9CgogICAgICBjb25zdCB1cHBlciA9IHRoaXMuZ2V0VHJpYW5nbGVBdCh4LCB5LCBlZGdlQ2xhbXAsIGEsIGIsIGMpOwogICAgICBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYS54LCBhLnksIGIueCwgYi55LCBjLngsIGMueSwgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyk7CiAgICAgIGNvbnN0IHcgPSBnZXRIZWlnaHRBdF93ZWlnaHRzOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGkgKyAxXVt5aSArIDFdICogdy54ICsgZGF0YVt4aV1beWkgKyAxXSAqIHcueSArIGRhdGFbeGkgKyAxXVt5aV0gKiB3Lno7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgcmV0dXJuIGRhdGFbeGldW3lpXSAqIHcueCArIGRhdGFbeGkgKyAxXVt5aV0gKiB3LnkgKyBkYXRhW3hpXVt5aSArIDFdICogdy56OwogICAgICB9CiAgICB9CgogICAgZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgcmV0dXJuIGAke3hpfV8ke3lpfV8ke2dldFVwcGVyVHJpYW5nbGUgPyAxIDogMH1gOwogICAgfQoKICAgIGdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CgogICAgc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCBjb252ZXgsIG9mZnNldCkgewogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXSA9IHsKICAgICAgICBjb252ZXgsCiAgICAgICAgb2Zmc2V0CiAgICAgIH07CiAgICB9CgogICAgY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgZGVsZXRlIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBmcm9tIHRoZSBoZWlnaHRmaWVsZAogICAgICovCgoKICAgIGdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpIHsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwoKICAgICAgaWYgKHVwcGVyKSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgICAgIGIuc2V0KHhpICogZWxlbWVudFNpemUsICh5aSArIDEpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0pOwogICAgICAgIGMuc2V0KCh4aSArIDEpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGEuc2V0KHhpICogZWxlbWVudFNpemUsIHlpICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSk7CiAgICAgICAgYi5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgICAgYy5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdHJpYW5nbGUgaW4gdGhlIHRlcnJhaW4gaW4gdGhlIGZvcm0gb2YgYSB0cmlhbmd1bGFyIGNvbnZleCBzaGFwZS4KICAgICAqLwoKCiAgICBnZXRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucGlsbGFyQ29udmV4OwogICAgICBsZXQgb2Zmc2V0UmVzdWx0ID0gdGhpcy5waWxsYXJPZmZzZXQ7CgogICAgICBpZiAodGhpcy5jYWNoZUVuYWJsZWQpIHsKICAgICAgICBjb25zdCBkYXRhID0gdGhpcy5nZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpOwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSBkYXRhLmNvbnZleDsKICAgICAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gZGF0YS5vZmZzZXQ7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICByZXN1bHQgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgICAgIG9mZnNldFJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5waWxsYXJDb252ZXggPSByZXN1bHQ7CiAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBvZmZzZXRSZXN1bHQ7CiAgICAgIH0KCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgZmFjZXMgPSByZXN1bHQuZmFjZXM7IC8vIFJldXNlIHZlcnRzIGlmIHBvc3NpYmxlCgogICAgICByZXN1bHQudmVydGljZXMubGVuZ3RoID0gNjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNjsgaSsrKSB7CiAgICAgICAgaWYgKCFyZXN1bHQudmVydGljZXNbaV0pIHsKICAgICAgICAgIHJlc3VsdC52ZXJ0aWNlc1tpXSA9IG5ldyBWZWMzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFJldXNlIGZhY2VzIGlmIHBvc3NpYmxlCgoKICAgICAgZmFjZXMubGVuZ3RoID0gNTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgaWYgKCFmYWNlc1tpXSkgewogICAgICAgICAgZmFjZXNbaV0gPSBbXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gcmVzdWx0LnZlcnRpY2VzOwogICAgICBjb25zdCBoID0gKE1hdGgubWluKGRhdGFbeGldW3lpXSwgZGF0YVt4aSArIDFdW3lpXSwgZGF0YVt4aV1beWkgKyAxXSwgZGF0YVt4aSArIDFdW3lpICsgMV0pIC0gdGhpcy5taW5WYWx1ZSkgLyAyICsgdGhpcy5taW5WYWx1ZTsKCiAgICAgIGlmICghZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICAgIC8vIENlbnRlciBvZiB0aGUgdHJpYW5nbGUgcGlsbGFyIC0gYWxsIHBvbHlnb25zIGFyZSBnaXZlbiByZWxhdGl2ZSB0byB0aGlzIG9uZQogICAgICAgIG9mZnNldFJlc3VsdC5zZXQoKHhpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgLy8gc29ydCBvZiBjZW50ZXIgb2YgYSB0cmlhbmdsZQogICAgICAgICh5aSArIDAuMjUpICogZWxlbWVudFNpemUsIGggLy8gdmVydGljYWwgY2VudGVyCiAgICAgICAgKTsgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzBdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1sxXS5zZXQoMC43NSAqIGVsZW1lbnRTaXplLCAtMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7CiAgICAgICAgdmVydHNbMl0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOyAvLyBib3R0b20gdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbM10uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgtMC4yNSAqIGVsZW1lbnRTaXplLCAwLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyB0b3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gLXggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAwOwogICAgICAgIGZhY2VzWzJdWzFdID0gMjsKICAgICAgICBmYWNlc1syXVsyXSA9IDU7CiAgICAgICAgZmFjZXNbMl1bM10gPSAzOyAvLyAteSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDE7CiAgICAgICAgZmFjZXNbM11bMV0gPSAwOwogICAgICAgIGZhY2VzWzNdWzJdID0gMzsKICAgICAgICBmYWNlc1szXVszXSA9IDQ7IC8vICt4eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA1OwogICAgICAgIGZhY2VzWzRdWzJdID0gMjsKICAgICAgICBmYWNlc1s0XVszXSA9IDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC43NSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgMC4yNSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpICsgMV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAtMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzRdLnNldCgtMC43NSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOwogICAgICAgIHZlcnRzWzVdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIC1NYXRoLmFicyhoKSAtIDEpOyAvLyBUb3AgdHJpYW5nbGUKCiAgICAgICAgZmFjZXNbMF1bMF0gPSAwOwogICAgICAgIGZhY2VzWzBdWzFdID0gMTsKICAgICAgICBmYWNlc1swXVsyXSA9IDI7IC8vIGJvdHRvbSB0cmlhbmdsZQoKICAgICAgICBmYWNlc1sxXVswXSA9IDU7CiAgICAgICAgZmFjZXNbMV1bMV0gPSA0OwogICAgICAgIGZhY2VzWzFdWzJdID0gMzsgLy8gK3ggZmFjaW5nIHF1YWQKCiAgICAgICAgZmFjZXNbMl1bMF0gPSAyOwogICAgICAgIGZhY2VzWzJdWzFdID0gNTsKICAgICAgICBmYWNlc1syXVsyXSA9IDM7CiAgICAgICAgZmFjZXNbMl1bM10gPSAwOyAvLyAreSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1szXVswXSA9IDM7CiAgICAgICAgZmFjZXNbM11bMV0gPSA0OwogICAgICAgIGZhY2VzWzNdWzJdID0gMTsKICAgICAgICBmYWNlc1szXVszXSA9IDA7IC8vIC14eSBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1s0XVswXSA9IDE7CiAgICAgICAgZmFjZXNbNF1bMV0gPSA0OwogICAgICAgIGZhY2VzWzRdWzJdID0gNTsKICAgICAgICBmYWNlc1s0XVszXSA9IDI7CiAgICAgIH0KCiAgICAgIHJlc3VsdC5jb21wdXRlTm9ybWFscygpOwogICAgICByZXN1bHQuY29tcHV0ZUVkZ2VzKCk7CiAgICAgIHJlc3VsdC51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB0aGlzLnNldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSwgcmVzdWx0LCBvZmZzZXRSZXN1bHQpOwogICAgfQoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNldCgwLCAwLCAwKTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiAoLy8gVGhlIHRlcnJhaW4gaXMgaW5maW5pdGUKICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoqIEBUT0RPIGRvIGl0IHByb3Blcmx5ICovCiAgICAgIG1pbi5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CiAgICAgIG1heC5zZXQoTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSwgTnVtYmVyLk1BWF9WQUxVRSk7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIFVzZSB0aGUgYm91bmRpbmcgYm94IG9mIHRoZSBtaW4vbWF4IHZhbHVlcwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBzID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IG5ldyBWZWMzKGRhdGEubGVuZ3RoICogcywgZGF0YVswXS5sZW5ndGggKiBzLCBNYXRoLm1heChNYXRoLmFicyh0aGlzLm1heFZhbHVlKSwgTWF0aC5hYnModGhpcy5taW5WYWx1ZSkpKS5sZW5ndGgoKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgaGVpZ2h0IHZhbHVlcyBmcm9tIGFuIGltYWdlLiBDdXJyZW50bHkgb25seSBzdXBwb3J0ZWQgaW4gYnJvd3Nlci4KICAgICAqLwoKCiAgICBzZXRIZWlnaHRzRnJvbUltYWdlKGltYWdlLCBzY2FsZSkgewogICAgICBjb25zdCB7CiAgICAgICAgeCwKICAgICAgICB6LAogICAgICAgIHkKICAgICAgfSA9IHNjYWxlOwogICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CiAgICAgIGNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICAgIGNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgY29udGV4dC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDApOwogICAgICBjb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSgwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTsKICAgICAgY29uc3QgbWF0cml4ID0gdGhpcy5kYXRhOwogICAgICBtYXRyaXgubGVuZ3RoID0gMDsKICAgICAgdGhpcy5lbGVtZW50U2l6ZSA9IE1hdGguYWJzKHgpIC8gaW1hZ2VEYXRhLndpZHRoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZURhdGEuaGVpZ2h0OyBpKyspIHsKICAgICAgICBjb25zdCByb3cgPSBbXTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBpbWFnZURhdGEud2lkdGg7IGorKykgewogICAgICAgICAgY29uc3QgYSA9IGltYWdlRGF0YS5kYXRhWyhpICogaW1hZ2VEYXRhLmhlaWdodCArIGopICogNF07CiAgICAgICAgICBjb25zdCBiID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMV07CiAgICAgICAgICBjb25zdCBjID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0ICsgMl07CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSAoYSArIGIgKyBjKSAvIDQgLyAyNTUgKiB6OwoKICAgICAgICAgIGlmICh4IDwgMCkgewogICAgICAgICAgICByb3cucHVzaChoZWlnaHQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcm93LnVuc2hpZnQoaGVpZ2h0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh5IDwgMCkgewogICAgICAgICAgbWF0cml4LnVuc2hpZnQocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWF0cml4LnB1c2gocm93KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZSgpOwogICAgfQoKICB9CiAgY29uc3QgZ2V0SGVpZ2h0QXRfaWR4ID0gW107CiAgY29uc3QgZ2V0SGVpZ2h0QXRfd2VpZ2h0cyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0SGVpZ2h0QXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldE5vcm1hbEF0X2UxID0gbmV3IFZlYzMoKTsgLy8gZnJvbSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CYXJ5Y2VudHJpY19jb29yZGluYXRlX3N5c3RlbQoKICBmdW5jdGlvbiBiYXJ5Y2VudHJpY1dlaWdodHMoeCwgeSwgYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcmVzdWx0KSB7CiAgICByZXN1bHQueCA9ICgoYnkgLSBjeSkgKiAoeCAtIGN4KSArIChjeCAtIGJ4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnkgPSAoKGN5IC0gYXkpICogKHggLSBjeCkgKyAoYXggLSBjeCkgKiAoeSAtIGN5KSkgLyAoKGJ5IC0gY3kpICogKGF4IC0gY3gpICsgKGN4IC0gYngpICogKGF5IC0gY3kpKTsKICAgIHJlc3VsdC56ID0gMSAtIHJlc3VsdC54IC0gcmVzdWx0Lnk7CiAgfQoKICAvKioKICAgKiBPY3RyZWVOb2RlCiAgICovCiAgY2xhc3MgT2N0cmVlTm9kZSB7CiAgICAvKiogVGhlIHJvb3Qgbm9kZSAqLwoKICAgIC8qKiBCb3VuZGFyeSBvZiB0aGlzIG5vZGUgKi8KCiAgICAvKiogQ29udGFpbmVkIGRhdGEgYXQgdGhlIGN1cnJlbnQgbm9kZSBsZXZlbCAqLwoKICAgIC8qKiBDaGlsZHJlbiB0byB0aGlzIG5vZGUgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5yb290ID0gb3B0aW9ucy5yb290IHx8IG51bGw7CiAgICAgIHRoaXMuYWFiYiA9IG9wdGlvbnMuYWFiYiA/IG9wdGlvbnMuYWFiYi5jbG9uZSgpIDogbmV3IEFBQkIoKTsKICAgICAgdGhpcy5kYXRhID0gW107CiAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogcmVzZXQKICAgICAqLwoKCiAgICByZXNldCgpIHsKICAgICAgdGhpcy5jaGlsZHJlbi5sZW5ndGggPSB0aGlzLmRhdGEubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogSW5zZXJ0IGRhdGEgaW50byB0aGlzIG5vZGUKICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBzdWNjZXNzZnVsLCBvdGhlcndpc2UgZmFsc2UKICAgICAqLwoKCiAgICBpbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsKSB7CiAgICAgIGlmIChsZXZlbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbGV2ZWwgPSAwOwogICAgICB9CgogICAgICBjb25zdCBub2RlRGF0YSA9IHRoaXMuZGF0YTsgLy8gSWdub3JlIG9iamVjdHMgdGhhdCBkbyBub3QgYmVsb25nIGluIHRoaXMgbm9kZQoKICAgICAgaWYgKCF0aGlzLmFhYmIuY29udGFpbnMoYWFiYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIG9iamVjdCBjYW5ub3QgYmUgYWRkZWQKICAgICAgfQoKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjb25zdCBtYXhEZXB0aCA9IHRoaXMubWF4RGVwdGggfHwgdGhpcy5yb290Lm1heERlcHRoOwoKICAgICAgaWYgKGxldmVsIDwgbWF4RGVwdGgpIHsKICAgICAgICAvLyBTdWJkaXZpZGUgaWYgdGhlcmUgYXJlIG5vIGNoaWxkcmVuIHlldAogICAgICAgIGxldCBzdWJkaXZpZGVkID0gZmFsc2U7CgogICAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLnN1YmRpdmlkZSgpOwogICAgICAgICAgc3ViZGl2aWRlZCA9IHRydWU7CiAgICAgICAgfSAvLyBhZGQgdG8gd2hpY2hldmVyIG5vZGUgd2lsbCBhY2NlcHQgaXQKCgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSA4OyBpKyspIHsKICAgICAgICAgIGlmIChjaGlsZHJlbltpXS5pbnNlcnQoYWFiYiwgZWxlbWVudERhdGEsIGxldmVsICsgMSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoc3ViZGl2aWRlZCkgewogICAgICAgICAgLy8gTm8gY2hpbGRyZW4gYWNjZXB0ZWQhIE1pZ2h0IGFzIHdlbGwganVzdCByZW1vdmUgZW0gc2luY2UgdGhleSBjb250YWluIG5vbmUKICAgICAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICB9IC8vIFRvbyBkZWVwLCBvciBjaGlsZHJlbiBkaWRudCB3YW50IGl0LiBhZGQgaXQgaW4gY3VycmVudCBub2RlCgoKICAgICAgbm9kZURhdGEucHVzaChlbGVtZW50RGF0YSk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBDcmVhdGUgOCBlcXVhbGx5IHNpemVkIGNoaWxkcmVuIG5vZGVzIGFuZCBwdXQgdGhlbSBpbiB0aGUgYGNoaWxkcmVuYCBhcnJheS4KICAgICAqLwoKCiAgICBzdWJkaXZpZGUoKSB7CiAgICAgIGNvbnN0IGFhYmIgPSB0aGlzLmFhYmI7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgY2hpbGRyZW4ucHVzaChuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDAsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSkpOwogICAgICB1LnZzdWIobCwgaGFsZkRpYWdvbmFsKTsKICAgICAgaGFsZkRpYWdvbmFsLnNjYWxlKDAuNSwgaGFsZkRpYWdvbmFsKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXMucm9vdCB8fCB0aGlzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5baV07IC8vIFNldCBjdXJyZW50IG5vZGUgYXMgcm9vdAoKICAgICAgICBjaGlsZC5yb290ID0gcm9vdDsgLy8gQ29tcHV0ZSBib3VuZHMKCiAgICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IGNoaWxkLmFhYmIubG93ZXJCb3VuZDsKICAgICAgICBsb3dlckJvdW5kLnggKj0gaGFsZkRpYWdvbmFsLng7CiAgICAgICAgbG93ZXJCb3VuZC55ICo9IGhhbGZEaWFnb25hbC55OwogICAgICAgIGxvd2VyQm91bmQueiAqPSBoYWxmRGlhZ29uYWwuejsKICAgICAgICBsb3dlckJvdW5kLnZhZGQobCwgbG93ZXJCb3VuZCk7IC8vIFVwcGVyIGJvdW5kIGlzIGFsd2F5cyBsb3dlciBib3VuZCArIGhhbGZEaWFnb25hbAoKICAgICAgICBsb3dlckJvdW5kLnZhZGQoaGFsZkRpYWdvbmFsLCBjaGlsZC5hYWJiLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgd2l0aGluIGFuIEFBQkIKICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIGFhYmJRdWVyeShhYWJiLCByZXN1bHQpIHsKICAgICAgdGhpcy5kYXRhOyAvLyBhYm9ydCBpZiB0aGUgcmFuZ2UgZG9lcyBub3QgaW50ZXJzZWN0IHRoaXMgbm9kZQogICAgICAvLyBpZiAoIXRoaXMuYWFiYi5vdmVybGFwcyhhYWJiKSl7CiAgICAgIC8vICAgICByZXR1cm4gcmVzdWx0OwogICAgICAvLyB9CiAgICAgIC8vIEFkZCBvYmplY3RzIGF0IHRoaXMgbGV2ZWwKICAgICAgLy8gQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocmVzdWx0LCBub2RlRGF0YSk7CiAgICAgIC8vIEFkZCBjaGlsZCBkYXRhCiAgICAgIC8vIEB0b2RvIHVud3JhcCByZWN1cnNpb24gaW50byBhIHF1ZXVlIC8gbG9vcCwgdGhhdCdzIGZhc3RlciBpbiBKUwoKICAgICAgdGhpcy5jaGlsZHJlbjsgLy8gZm9yIChsZXQgaSA9IDAsIE4gPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIC8vICAgICBjaGlsZHJlbltpXS5hYWJiUXVlcnkoYWFiYiwgcmVzdWx0KTsKICAgICAgLy8gfQoKICAgICAgY29uc3QgcXVldWUgPSBbdGhpc107CgogICAgICB3aGlsZSAocXVldWUubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOwoKICAgICAgICBpZiAobm9kZS5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGUuZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShxdWV1ZSwgbm9kZS5jaGlsZHJlbik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbGwgZGF0YSwgcG90ZW50aWFsbHkgaW50ZXJzZWN0ZWQgYnkgYSByYXkuCiAgICAgKiBAcmV0dXJuIFRoZSAicmVzdWx0IiBvYmplY3QKICAgICAqLwoKCiAgICByYXlRdWVyeShyYXksIHRyZWVUcmFuc2Zvcm0sIHJlc3VsdCkgewogICAgICAvLyBVc2UgYWFiYiBxdWVyeSBmb3Igbm93LgoKICAgICAgLyoqIEB0b2RvIGltcGxlbWVudCByZWFsIHJheSBxdWVyeSB3aGljaCBuZWVkcyBsZXNzIGxvb2t1cHMgKi8KICAgICAgcmF5LmdldEFBQkIodG1wQUFCQik7CiAgICAgIHRtcEFBQkIudG9Mb2NhbEZyYW1lKHRyZWVUcmFuc2Zvcm0sIHRtcEFBQkIpOwogICAgICB0aGlzLmFhYmJRdWVyeSh0bXBBQUJCLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiByZW1vdmVFbXB0eU5vZGVzCiAgICAgKi8KCgogICAgcmVtb3ZlRW1wdHlOb2RlcygpIHsKICAgICAgZm9yIChsZXQgaSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2ldLnJlbW92ZUVtcHR5Tm9kZXMoKTsKCiAgICAgICAgaWYgKCF0aGlzLmNoaWxkcmVuW2ldLmNoaWxkcmVuLmxlbmd0aCAmJiAhdGhpcy5jaGlsZHJlbltpXS5kYXRhLmxlbmd0aCkgewogICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogIH0KICAvKioKICAgKiBPY3RyZWUKICAgKi8KCgogIGNsYXNzIE9jdHJlZSBleHRlbmRzIE9jdHJlZU5vZGUgewogICAgLyoqCiAgICAgKiBNYXhpbXVtIHN1YmRpdmlzaW9uIGRlcHRoCiAgICAgKiBAZGVmYXVsdCA4CiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBhYWJiIFRoZSB0b3RhbCBBQUJCIG9mIHRoZSB0cmVlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGFhYmIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoewogICAgICAgIHJvb3Q6IG51bGwsCiAgICAgICAgYWFiYgogICAgICB9KTsKICAgICAgdGhpcy5tYXhEZXB0aCA9IHR5cGVvZiBvcHRpb25zLm1heERlcHRoICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4RGVwdGggOiA4OwogICAgfQoKICB9CiAgY29uc3QgaGFsZkRpYWdvbmFsID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBBQUJCID0gbmV3IEFBQkIoKTsKCiAgLyoqCiAgICogVHJpbWVzaC4KICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBIb3cgdG8gbWFrZSBhIG1lc2ggd2l0aCBhIHNpbmdsZSB0cmlhbmdsZQogICAqICAgICBjb25zdCB2ZXJ0aWNlcyA9IFsKICAgKiAgICAgICAgIDAsIDAsIDAsIC8vIHZlcnRleCAwCiAgICogICAgICAgICAxLCAwLCAwLCAvLyB2ZXJ0ZXggMQogICAqICAgICAgICAgMCwgMSwgMCAgLy8gdmVydGV4IDIKICAgKiAgICAgXQogICAqICAgICBjb25zdCBpbmRpY2VzID0gWwogICAqICAgICAgICAgMCwgMSwgMiAgLy8gdHJpYW5nbGUgMAogICAqICAgICBdCiAgICogICAgIGNvbnN0IHRyaW1lc2hTaGFwZSA9IG5ldyBDQU5OT04uVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcykKICAgKi8KICBjbGFzcyBUcmltZXNoIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiB2ZXJ0aWNlcwogICAgICovCgogICAgLyoqCiAgICAgKiBBcnJheSBvZiBpbnRlZ2VycywgaW5kaWNhdGluZyB3aGljaCB2ZXJ0aWNlcyBlYWNoIHRyaWFuZ2xlIGNvbnNpc3RzIG9mLiBUaGUgbGVuZ3RoIG9mIHRoaXMgYXJyYXkgaXMgdGh1cyAzIHRpbWVzIHRoZSBudW1iZXIgb2YgdHJpYW5nbGVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbm9ybWFscyBkYXRhLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgbG9jYWwgQUFCQiBvZiB0aGUgbWVzaC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVmZXJlbmNlcyB0byB2ZXJ0ZXggcGFpcnMsIG1ha2luZyB1cCBhbGwgdW5pcXVlIGVkZ2VzIGluIHRoZSB0cmltZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBzY2FsaW5nIG9mIHRoZSBtZXNoLiBVc2UgLnNldFNjYWxlKCkgdG8gc2V0IGl0LgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgaW5kZXhlZCB0cmlhbmdsZXMuIFVzZSAudXBkYXRlVHJlZSgpIHRvIHVwZGF0ZSBpdC4KICAgICAqLwogICAgY29uc3RydWN0b3IodmVydGljZXMsIGluZGljZXMpIHsKICAgICAgc3VwZXIoewogICAgICAgIHR5cGU6IFNoYXBlLnR5cGVzLlRSSU1FU0gKICAgICAgfSk7CiAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgRmxvYXQzMkFycmF5KHZlcnRpY2VzKTsKICAgICAgdGhpcy5pbmRpY2VzID0gbmV3IEludDE2QXJyYXkoaW5kaWNlcyk7CiAgICAgIHRoaXMubm9ybWFscyA9IG5ldyBGbG9hdDMyQXJyYXkoaW5kaWNlcy5sZW5ndGgpOwogICAgICB0aGlzLmFhYmIgPSBuZXcgQUFCQigpOwogICAgICB0aGlzLmVkZ2VzID0gbnVsbDsKICAgICAgdGhpcy5zY2FsZSA9IG5ldyBWZWMzKDEsIDEsIDEpOwogICAgICB0aGlzLnRyZWUgPSBuZXcgT2N0cmVlKCk7CiAgICAgIHRoaXMudXBkYXRlRWRnZXMoKTsKICAgICAgdGhpcy51cGRhdGVOb3JtYWxzKCk7CiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMudXBkYXRlVHJlZSgpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGVUcmVlCiAgICAgKi8KCgogICAgdXBkYXRlVHJlZSgpIHsKICAgICAgY29uc3QgdHJlZSA9IHRoaXMudHJlZTsKICAgICAgdHJlZS5yZXNldCgpOwogICAgICB0cmVlLmFhYmIuY29weSh0aGlzLmFhYmIpOwogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7IC8vIFRoZSBsb2NhbCBtZXNoIEFBQkIgaXMgc2NhbGVkLCBidXQgdGhlIG9jdHJlZSBBQUJCIHNob3VsZCBiZSB1bnNjYWxlZAoKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLmxvd2VyQm91bmQueiAqPSAxIC8gc2NhbGUuejsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueCAqPSAxIC8gc2NhbGUueDsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueSAqPSAxIC8gc2NhbGUueTsKICAgICAgdHJlZS5hYWJiLnVwcGVyQm91bmQueiAqPSAxIC8gc2NhbGUuejsgLy8gSW5zZXJ0IGFsbCB0cmlhbmdsZXMKCiAgICAgIGNvbnN0IHRyaWFuZ2xlQUFCQiA9IG5ldyBBQUJCKCk7CiAgICAgIGNvbnN0IGEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBvaW50cyA9IFthLCBiLCBjXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vdGhpcy5nZXRUcmlhbmdsZVZlcnRpY2VzKGksIGEsIGIsIGMpOwogICAgICAgIC8vIEdldCB1bnNjYWxlZCB0cmlhbmdsZSB2ZXJ0cwogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwoKICAgICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKCiAgICAgICAgdHJpYW5nbGVBQUJCLnNldEZyb21Qb2ludHMocG9pbnRzKTsKICAgICAgICB0cmVlLmluc2VydCh0cmlhbmdsZUFBQkIsIGkpOwogICAgICB9CgogICAgICB0cmVlLnJlbW92ZUVtcHR5Tm9kZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRyaWFuZ2xlcyBpbiBhIGxvY2FsIEFBQkIgZnJvbSB0aGUgdHJpbWVzaC4KICAgICAqIEBwYXJhbSByZXN1bHQgQW4gYXJyYXkgb2YgaW50ZWdlcnMsIHJlZmVyZW5jaW5nIHRoZSBxdWVyaWVkIHRyaWFuZ2xlcy4KICAgICAqLwoKCiAgICBnZXRUcmlhbmdsZXNJbkFBQkIoYWFiYiwgcmVzdWx0KSB7CiAgICAgIHVuc2NhbGVkQUFCQi5jb3B5KGFhYmIpOyAvLyBTY2FsZSBpdCB0byBsb2NhbAoKICAgICAgY29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlOwogICAgICBjb25zdCBpc3ggPSBzY2FsZS54OwogICAgICBjb25zdCBpc3kgPSBzY2FsZS55OwogICAgICBjb25zdCBpc3ogPSBzY2FsZS56OwogICAgICBjb25zdCBsID0gdW5zY2FsZWRBQUJCLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB1bnNjYWxlZEFBQkIudXBwZXJCb3VuZDsKICAgICAgbC54IC89IGlzeDsKICAgICAgbC55IC89IGlzeTsKICAgICAgbC56IC89IGlzejsKICAgICAgdS54IC89IGlzeDsKICAgICAgdS55IC89IGlzeTsKICAgICAgdS56IC89IGlzejsKICAgICAgcmV0dXJuIHRoaXMudHJlZS5hYWJiUXVlcnkodW5zY2FsZWRBQUJCLCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRTY2FsZQogICAgICovCgoKICAgIHNldFNjYWxlKHNjYWxlKSB7CiAgICAgIGNvbnN0IHdhc1VuaWZvcm0gPSB0aGlzLnNjYWxlLnggPT09IHRoaXMuc2NhbGUueSAmJiB0aGlzLnNjYWxlLnkgPT09IHRoaXMuc2NhbGUuejsKICAgICAgY29uc3QgaXNVbmlmb3JtID0gc2NhbGUueCA9PT0gc2NhbGUueSAmJiBzY2FsZS55ID09PSBzY2FsZS56OwoKICAgICAgaWYgKCEod2FzVW5pZm9ybSAmJiBpc1VuaWZvcm0pKSB7CiAgICAgICAgLy8gTm9uLXVuaWZvcm0gc2NhbGluZy4gTmVlZCB0byB1cGRhdGUgbm9ybWFscy4KICAgICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgfQoKICAgICAgdGhpcy5zY2FsZS5jb3B5KHNjYWxlKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuIFdpbGwgc2F2ZSBpbiB0aGUgYC5ub3JtYWxzYCBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGVOb3JtYWxzKCkgewogICAgICBjb25zdCBuID0gY29tcHV0ZU5vcm1hbHNfbjsgLy8gR2VuZXJhdGUgbm9ybWFscwoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMubm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICB0aGlzLmdldFZlcnRleChhLCB2YSk7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYiwgdmIpOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGMsIHZjKTsKICAgICAgICBUcmltZXNoLmNvbXB1dGVOb3JtYWwodmIsIHZhLCB2Yywgbik7CiAgICAgICAgbm9ybWFsc1tpM10gPSBuLng7CiAgICAgICAgbm9ybWFsc1tpMyArIDFdID0gbi55OwogICAgICAgIG5vcm1hbHNbaTMgKyAyXSA9IG4uejsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuZWRnZXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlRWRnZXMoKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0ge307CgogICAgICBjb25zdCBhZGQgPSAoYSwgYikgPT4gewogICAgICAgIGNvbnN0IGtleSA9IGEgPCBiID8gYCR7YX1fJHtifWAgOiBgJHtifV8ke2F9YDsKICAgICAgICBlZGdlc1trZXldID0gdHJ1ZTsKICAgICAgfTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgICAgY29uc3QgYSA9IHRoaXMuaW5kaWNlc1tpM107CiAgICAgICAgY29uc3QgYiA9IHRoaXMuaW5kaWNlc1tpMyArIDFdOwogICAgICAgIGNvbnN0IGMgPSB0aGlzLmluZGljZXNbaTMgKyAyXTsKICAgICAgICBhZGQoYSwgYik7CiAgICAgICAgYWRkKGIsIGMpOwogICAgICAgIGFkZChjLCBhKTsKICAgICAgfQoKICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGVkZ2VzKTsKICAgICAgdGhpcy5lZGdlcyA9IG5ldyBJbnQxNkFycmF5KGtleXMubGVuZ3RoICogMik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBpbmRpY2VzID0ga2V5c1tpXS5zcGxpdCgnXycpOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGldID0gcGFyc2VJbnQoaW5kaWNlc1swXSwgMTApOwogICAgICAgIHRoaXMuZWRnZXNbMiAqIGkgKyAxXSA9IHBhcnNlSW50KGluZGljZXNbMV0sIDEwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYW4gZWRnZSB2ZXJ0ZXgKICAgICAqIEBwYXJhbSBmaXJzdE9yU2Vjb25kIDAgb3IgMSwgZGVwZW5kaW5nIG9uIHdoaWNoIG9uZSBvZiB0aGUgdmVydGljZXMgeW91IG5lZWQuCiAgICAgKiBAcGFyYW0gdmVydGV4U3RvcmUgV2hlcmUgdG8gc3RvcmUgdGhlIHJlc3VsdAogICAgICovCgoKICAgIGdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCBmaXJzdE9yU2Vjb25kLCB2ZXJ0ZXhTdG9yZSkgewogICAgICBjb25zdCB2ZXJ0ZXhJbmRleCA9IHRoaXMuZWRnZXNbZWRnZUluZGV4ICogMiArIChmaXJzdE9yU2Vjb25kID8gMSA6IDApXTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodmVydGV4SW5kZXgsIHZlcnRleFN0b3JlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgdmVjdG9yIGFsb25nIGFuIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0RWRnZVZlY3RvcihlZGdlSW5kZXgsIHZlY3RvclN0b3JlKSB7CiAgICAgIGNvbnN0IHZhID0gZ2V0RWRnZVZlY3Rvcl92YTsKICAgICAgY29uc3QgdmIgPSBnZXRFZGdlVmVjdG9yX3ZiOwogICAgICB0aGlzLmdldEVkZ2VWZXJ0ZXgoZWRnZUluZGV4LCAwLCB2YSk7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDEsIHZiKTsKICAgICAgdmIudnN1Yih2YSwgdmVjdG9yU3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgZmFjZSBub3JtYWwgZ2l2ZW4gMyB2ZXJ0aWNlcwogICAgICovCgoKICAgIHN0YXRpYyBjb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCkgewogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdmVydGV4IGkuCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0VmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CgogICAgICB0aGlzLl9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpOwoKICAgICAgb3V0LnggKj0gc2NhbGUueDsKICAgICAgb3V0LnkgKj0gc2NhbGUueTsKICAgICAgb3V0LnogKj0gc2NhbGUuejsKICAgICAgcmV0dXJuIG91dDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHJhdyB2ZXJ0ZXggaQogICAgICogQHJldHVybiBUaGUgIm91dCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIF9nZXRVbnNjYWxlZFZlcnRleChpLCBvdXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICByZXR1cm4gb3V0LnNldCh2ZXJ0aWNlc1tpM10sIHZlcnRpY2VzW2kzICsgMV0sIHZlcnRpY2VzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZXJ0ZXggZnJvbSB0aGUgdHJpbWVzaCx0cmFuc2Zvcm1lZCBieSB0aGUgZ2l2ZW4gcG9zaXRpb24gYW5kIHF1YXRlcm5pb24uCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0V29ybGRWZXJ0ZXgoaSwgcG9zLCBxdWF0LCBvdXQpIHsKICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgb3V0KTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHBvcywgcXVhdCwgb3V0LCBvdXQpOwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHRocmVlIHZlcnRpY2VzIGZvciB0cmlhbmdsZSBpLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYykgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTNdLCBhKTsKICAgICAgdGhpcy5nZXRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMV0sIGIpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAyXSwgYyk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiB0cmlhbmdsZSBpLgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGdldE5vcm1hbChpLCB0YXJnZXQpIHsKICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQodGhpcy5ub3JtYWxzW2kzXSwgdGhpcy5ub3JtYWxzW2kzICsgMV0sIHRoaXMubm9ybWFsc1tpMyArIDJdKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUaGUgInRhcmdldCIgdmVjdG9yIG9iamVjdAogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgLy8gQXBwcm94aW1hdGUgd2l0aCBib3ggaW5lcnRpYQogICAgICAvLyBFeGFjdCBpbmVydGlhIGNhbGN1bGF0aW9uIGlzIG92ZXJraWxsLCBidXQgc2VlIGh0dHA6Ly9nZW9tZXRyaWN0b29scy5jb20vRG9jdW1lbnRhdGlvbi9Qb2x5aGVkcmFsTWFzc1Byb3BlcnRpZXMucGRmIGZvciB0aGUgY29ycmVjdCB3YXkgdG8gZG8gaXQKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKGNsaV9hYWJiKTsKICAgICAgY29uc3QgeCA9IGNsaV9hYWJiLnVwcGVyQm91bmQueCAtIGNsaV9hYWJiLmxvd2VyQm91bmQueDsKICAgICAgY29uc3QgeSA9IGNsaV9hYWJiLnVwcGVyQm91bmQueSAtIGNsaV9hYWJiLmxvd2VyQm91bmQueTsKICAgICAgY29uc3QgeiA9IGNsaV9hYWJiLnVwcGVyQm91bmQueiAtIGNsaV9hYWJiLmxvd2VyQm91bmQuejsKICAgICAgcmV0dXJuIHRhcmdldC5zZXQoMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB6ICogMiAqIHopLCAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeCAqIDIgKiB4ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGxvY2FsIEFBQkIgZm9yIHRoZSB0cmltZXNoCiAgICAgKi8KCgogICAgY29tcHV0ZUxvY2FsQUFCQihhYWJiKSB7CiAgICAgIGNvbnN0IGwgPSBhYWJiLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSBhYWJiLnVwcGVyQm91bmQ7CiAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsKICAgICAgdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3QgdiA9IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0OwogICAgICB0aGlzLmdldFZlcnRleCgwLCB2KTsKICAgICAgbC5jb3B5KHYpOwogICAgICB1LmNvcHkodik7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CgogICAgICAgIGlmICh2LnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IHUueCkgewogICAgICAgICAgdS54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGwueSkgewogICAgICAgICAgbC55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gdS55KSB7CiAgICAgICAgICB1LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgbC56KSB7CiAgICAgICAgICBsLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgLmFhYmJgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQUFCQigpIHsKICAgICAgdGhpcy5jb21wdXRlTG9jYWxBQUJCKHRoaXMuYWFiYik7CiAgICB9CiAgICAvKioKICAgICAqIFdpbGwgdXBkYXRlIHRoZSBgLmJvdW5kaW5nU3BoZXJlUmFkaXVzYCBwcm9wZXJ0eQogICAgICovCgoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICAvLyBBc3N1bWUgcG9pbnRzIGFyZSBkaXN0cmlidXRlZCB3aXRoIGxvY2FsICgwLDAsMCkgYXMgY2VudGVyCiAgICAgIGxldCBtYXgyID0gMDsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOID0gdmVydGljZXMubGVuZ3RoIC8gMzsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgY29uc3Qgbm9ybTIgPSB2Lmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLyoKICAgICAgICAgIGNvbnN0IG4gPSB0aGlzLnZlcnRpY2VzLmxlbmd0aCAvIDMsCiAgICAgICAgICAgICAgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICAgICAgY29uc3QgbWlueCxtaW55LG1pbnosbWF4eCxtYXh5LG1heHo7CiAgICAgICAgICAgY29uc3QgdiA9IHRlbXBXb3JsZFZlcnRleDsKICAgICAgICAgIGZvcihsZXQgaT0wOyBpPG47IGkrKyl7CiAgICAgICAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoaSwgdik7CiAgICAgICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICAgICAgICBwb3MudmFkZCh2LCB2KTsKICAgICAgICAgICAgICBpZiAodi54IDwgbWlueCB8fCBtaW54PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi54ID4gbWF4eCB8fCBtYXh4PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgIGlmICh2LnkgPCBtaW55IHx8IG1pbnk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW55ID0gdi55OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnkgPiBtYXh5IHx8IG1heHk9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh5ID0gdi55OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueiA8IG1pbnogfHwgbWluej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnogPSB2Lno7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueiA+IG1heHogfHwgbWF4ej09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHogPSB2Lno7CiAgICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgbWluLnNldChtaW54LG1pbnksbWlueik7CiAgICAgICAgICBtYXguc2V0KG1heHgsbWF4eSxtYXh6KTsKICAgICAgICAgICovCiAgICAgIC8vIEZhc3RlciBhcHByb3hpbWF0aW9uIHVzaW5nIGxvY2FsIEFBQkIKICAgICAgY29uc3QgZnJhbWUgPSBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWU7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9hYWJiOwogICAgICBmcmFtZS5wb3NpdGlvbiA9IHBvczsKICAgICAgZnJhbWUucXVhdGVybmlvbiA9IHF1YXQ7CiAgICAgIHRoaXMuYWFiYi50b1dvcmxkRnJhbWUoZnJhbWUsIHJlc3VsdCk7CiAgICAgIG1pbi5jb3B5KHJlc3VsdC5sb3dlckJvdW5kKTsKICAgICAgbWF4LmNvcHkocmVzdWx0LnVwcGVyQm91bmQpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYXBwcm94aW1hdGUgdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSBhIFRyaW1lc2ggaW5zdGFuY2UsIHNoYXBlZCBhcyBhIHRvcnVzLgogICAgICovCgoKICAgIHN0YXRpYyBjcmVhdGVUb3J1cyhyYWRpdXMsIHR1YmUsIHJhZGlhbFNlZ21lbnRzLCB0dWJ1bGFyU2VnbWVudHMsIGFyYykgewogICAgICBpZiAocmFkaXVzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpdXMgPSAxOwogICAgICB9CgogICAgICBpZiAodHViZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHViZSA9IDAuNTsKICAgICAgfQoKICAgICAgaWYgKHJhZGlhbFNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICByYWRpYWxTZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmICh0dWJ1bGFyU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHR1YnVsYXJTZWdtZW50cyA9IDY7CiAgICAgIH0KCiAgICAgIGlmIChhcmMgPT09IHZvaWQgMCkgewogICAgICAgIGFyYyA9IE1hdGguUEkgKiAyOwogICAgICB9CgogICAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdOwogICAgICBjb25zdCBpbmRpY2VzID0gW107CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwogICAgICAgICAgY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwogICAgICAgICAgY29uc3QgeCA9IChyYWRpdXMgKyB0dWJlICogTWF0aC5jb3ModikpICogTWF0aC5jb3ModSk7CiAgICAgICAgICBjb25zdCB5ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLnNpbih1KTsKICAgICAgICAgIGNvbnN0IHogPSB0dWJlICogTWF0aC5zaW4odik7CiAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKHgsIHksIHopOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IDE7IGogPD0gcmFkaWFsU2VnbWVudHM7IGorKykgewogICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IHR1YnVsYXJTZWdtZW50czsgaSsrKSB7CiAgICAgICAgICBjb25zdCBhID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogaiArIGkgLSAxOwogICAgICAgICAgY29uc3QgYiA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpIC0gMTsKICAgICAgICAgIGNvbnN0IGMgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiAoaiAtIDEpICsgaTsKICAgICAgICAgIGNvbnN0IGQgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaTsKICAgICAgICAgIGluZGljZXMucHVzaChhLCBiLCBkKTsKICAgICAgICAgIGluZGljZXMucHVzaChiLCBjLCBkKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgVHJpbWVzaCh2ZXJ0aWNlcywgaW5kaWNlcyk7CiAgICB9CgogIH0KICBjb25zdCBjb21wdXRlTm9ybWFsc19uID0gbmV3IFZlYzMoKTsKICBjb25zdCB1bnNjYWxlZEFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGdldEVkZ2VWZWN0b3JfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICBjb25zdCBhYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2xpX2FhYmIgPSBuZXcgQUFCQigpOwogIGNvbnN0IGNvbXB1dGVMb2NhbEFBQkJfd29ybGRWZXJ0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfZnJhbWUgPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgY2FsY3VsYXRlV29ybGRBQUJCX2FhYmIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBDb25zdHJhaW50IGVxdWF0aW9uIHNvbHZlciBiYXNlIGNsYXNzLgogICAqLwogIGNsYXNzIFNvbHZlciB7CiAgICAvKioKICAgICAqIEFsbCBlcXVhdGlvbnMgdG8gYmUgc29sdmVkCiAgICAgKi8KCiAgICAvKioKICAgICAqIEB0b2RvIHJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmVxdWF0aW9ucyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gc3ViY2xhc3NlcyEKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdAogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgcmV0dXJuICgvLyBTaG91bGQgcmV0dXJuIHRoZSBudW1iZXIgb2YgaXRlcmF0aW9ucyBkb25lIQogICAgICAgIDAKICAgICAgKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgYWRkRXF1YXRpb24oZXEpIHsKICAgICAgaWYgKGVxLmVuYWJsZWQgJiYgIWVxLmJpLmlzVHJpZ2dlciAmJiAhZXEuYmouaXNUcmlnZ2VyKSB7CiAgICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGFuIGVxdWF0aW9uCiAgICAgKi8KCgogICAgcmVtb3ZlRXF1YXRpb24oZXEpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IGkgPSBlcXMuaW5kZXhPZihlcSk7CgogICAgICBpZiAoaSAhPT0gLTEpIHsKICAgICAgICBlcXMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhbGwgZXF1YXRpb25zCiAgICAgKi8KCgogICAgcmVtb3ZlQWxsRXF1YXRpb25zKCkgewogICAgICB0aGlzLmVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgfQoKICB9CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gR2F1c3MtU2VpZGVsIHNvbHZlci4KICAgKiBAdG9kbyBUaGUgc3Bvb2sgcGFyYW1ldGVycyBzaG91bGQgYmUgc3BlY2lmaWVkIGZvciBlYWNoIGNvbnN0cmFpbnQsIG5vdCBnbG9iYWxseS4KICAgKiBAc2VlIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDA5L2xlY3R1cmVzL3Nwb29rbm90ZXMucGRmCiAgICovCiAgY2xhc3MgR1NTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLgogICAgICogVGhlIG1vcmUgaXRlcmF0aW9ucywgdGhlIG1vcmUgY29ycmVjdCBzaW11bGF0aW9uLiBNb3JlIGl0ZXJhdGlvbnMgbmVlZCBtb3JlIGNvbXB1dGF0aW9ucyB0aG91Z2guIElmIHlvdSBoYXZlIGEgbGFyZ2UgZ3Jhdml0eSBmb3JjZSBpbiB5b3VyIHdvcmxkLCB5b3Ugd2lsbCBuZWVkIG1vcmUgaXRlcmF0aW9ucy4KICAgICAqLwoKICAgIC8qKgogICAgICogV2hlbiB0b2xlcmFuY2UgaXMgcmVhY2hlZCwgdGhlIHN5c3RlbSBpcyBhc3N1bWVkIHRvIGJlIGNvbnZlcmdlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBsZXQgaXRlciA9IDA7CiAgICAgIGNvbnN0IG1heEl0ZXIgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IHRvbFNxdWFyZWQgPSB0aGlzLnRvbGVyYW5jZSAqIHRoaXMudG9sZXJhbmNlOwogICAgICBjb25zdCBlcXVhdGlvbnMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgTmVxID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gd29ybGQuYm9kaWVzOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgaCA9IGR0OwogICAgICBsZXQgQjsKICAgICAgbGV0IGludkM7CiAgICAgIGxldCBkZWx0YWxhbWJkYTsKICAgICAgbGV0IGRlbHRhbGFtYmRhVG90OwogICAgICBsZXQgR1dsYW1iZGE7CiAgICAgIGxldCBsYW1iZGFqOyAvLyBVcGRhdGUgc29sdmUgbWFzcwoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYm9kaWVzOyBpKyspIHsKICAgICAgICAgIGJvZGllc1tpXS51cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgICAgfQogICAgICB9IC8vIFRoaW5ncyB0aGF0IGRvIG5vdCBjaGFuZ2UgZHVyaW5nIGl0ZXJhdGlvbiBjYW4gYmUgY29tcHV0ZWQgb25jZQoKCiAgICAgIGNvbnN0IGludkNzID0gR1NTb2x2ZXJfc29sdmVfaW52Q3M7CiAgICAgIGNvbnN0IEJzID0gR1NTb2x2ZXJfc29sdmVfQnM7CiAgICAgIGNvbnN0IGxhbWJkYSA9IEdTU29sdmVyX3NvbHZlX2xhbWJkYTsKICAgICAgaW52Q3MubGVuZ3RoID0gTmVxOwogICAgICBCcy5sZW5ndGggPSBOZXE7CiAgICAgIGxhbWJkYS5sZW5ndGggPSBOZXE7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gZXF1YXRpb25zW2ldOwogICAgICAgIGxhbWJkYVtpXSA9IDAuMDsKICAgICAgICBCc1tpXSA9IGMuY29tcHV0ZUIoaCk7CiAgICAgICAgaW52Q3NbaV0gPSAxLjAgLyBjLmNvbXB1dGVDKCk7CiAgICAgIH0KCiAgICAgIGlmIChOZXEgIT09IDApIHsKICAgICAgICAvLyBSZXNldCB2bGFtYmRhCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHZsYW1iZGEgPSBiLnZsYW1iZGE7CiAgICAgICAgICBjb25zdCB3bGFtYmRhID0gYi53bGFtYmRhOwogICAgICAgICAgdmxhbWJkYS5zZXQoMCwgMCwgMCk7CiAgICAgICAgICB3bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICB9IC8vIEl0ZXJhdGUgb3ZlciBlcXVhdGlvbnMKCgogICAgICAgIGZvciAoaXRlciA9IDA7IGl0ZXIgIT09IG1heEl0ZXI7IGl0ZXIrKykgewogICAgICAgICAgLy8gQWNjdW11bGF0ZSB0aGUgdG90YWwgZXJyb3IgZm9yIGVhY2ggaXRlcmF0aW9uLgogICAgICAgICAgZGVsdGFsYW1iZGFUb3QgPSAwLjA7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IE5lcTsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbal07IC8vIENvbXB1dGUgaXRlcmF0aW9uCgogICAgICAgICAgICBCID0gQnNbal07CiAgICAgICAgICAgIGludkMgPSBpbnZDc1tqXTsKICAgICAgICAgICAgbGFtYmRhaiA9IGxhbWJkYVtqXTsKICAgICAgICAgICAgR1dsYW1iZGEgPSBjLmNvbXB1dGVHV2xhbWJkYSgpOwogICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGludkMgKiAoQiAtIEdXbGFtYmRhIC0gYy5lcHMgKiBsYW1iZGFqKTsgLy8gQ2xhbXAgaWYgd2UgYXJlIG5vdCB3aXRoaW4gdGhlIG1pbi9tYXggaW50ZXJ2YWwKCiAgICAgICAgICAgIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPCBjLm1pbkZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1pbkZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfSBlbHNlIGlmIChsYW1iZGFqICsgZGVsdGFsYW1iZGEgPiBjLm1heEZvcmNlKSB7CiAgICAgICAgICAgICAgZGVsdGFsYW1iZGEgPSBjLm1heEZvcmNlIC0gbGFtYmRhajsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFtYmRhW2pdICs9IGRlbHRhbGFtYmRhOwogICAgICAgICAgICBkZWx0YWxhbWJkYVRvdCArPSBkZWx0YWxhbWJkYSA+IDAuMCA/IGRlbHRhbGFtYmRhIDogLWRlbHRhbGFtYmRhOyAvLyBhYnMoZGVsdGFsYW1iZGEpCgogICAgICAgICAgICBjLmFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSk7CiAgICAgICAgICB9IC8vIElmIHRoZSB0b3RhbCBlcnJvciBpcyBzbWFsbCBlbm91Z2ggLSBzdG9wIGl0ZXJhdGUKCgogICAgICAgICAgaWYgKGRlbHRhbGFtYmRhVG90ICogZGVsdGFsYW1iZGFUb3QgPCB0b2xTcXVhcmVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gQWRkIHJlc3VsdCB0byB2ZWxvY2l0eQoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICAgIGNvbnN0IHYgPSBiLnZlbG9jaXR5OwogICAgICAgICAgY29uc3QgdyA9IGIuYW5ndWxhclZlbG9jaXR5OwogICAgICAgICAgYi52bGFtYmRhLnZtdWwoYi5saW5lYXJGYWN0b3IsIGIudmxhbWJkYSk7CiAgICAgICAgICB2LnZhZGQoYi52bGFtYmRhLCB2KTsKICAgICAgICAgIGIud2xhbWJkYS52bXVsKGIuYW5ndWxhckZhY3RvciwgYi53bGFtYmRhKTsKICAgICAgICAgIHcudmFkZChiLndsYW1iZGEsIHcpOwogICAgICAgIH0gLy8gU2V0IHRoZSBgLm11bHRpcGxpZXJgIHByb3BlcnR5IG9mIGVhY2ggZXF1YXRpb24KCgogICAgICAgIGxldCBsID0gZXF1YXRpb25zLmxlbmd0aDsKICAgICAgICBjb25zdCBpbnZEdCA9IDEgLyBoOwoKICAgICAgICB3aGlsZSAobC0tKSB7CiAgICAgICAgICBlcXVhdGlvbnNbbF0ubXVsdGlwbGllciA9IGxhbWJkYVtsXSAqIGludkR0OwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGl0ZXI7CiAgICB9CgogIH0gLy8gSnVzdCB0ZW1wb3JhcnkgbnVtYmVyIGhvbGRlcnMgdGhhdCB3ZSB3YW50IHRvIHJldXNlIGVhY2ggaXRlcmF0aW9uLgoKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9sYW1iZGEgPSBbXTsKICBjb25zdCBHU1NvbHZlcl9zb2x2ZV9pbnZDcyA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX0JzID0gW107CgogIC8qKgogICAqIFNwbGl0cyB0aGUgZXF1YXRpb25zIGludG8gaXNsYW5kcyBhbmQgc29sdmVzIHRoZW0gaW5kZXBlbmRlbnRseS4gQ2FuIGltcHJvdmUgcGVyZm9ybWFuY2UuCiAgICovCiAgY2xhc3MgU3BsaXRTb2x2ZXIgZXh0ZW5kcyBTb2x2ZXIgewogICAgLyoqCiAgICAgKiBUaGUgbnVtYmVyIG9mIHNvbHZlciBpdGVyYXRpb25zIGRldGVybWluZXMgcXVhbGl0eSBvZiB0aGUgY29uc3RyYWludHMgaW4gdGhlIHdvcmxkLiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqIHN1YnNvbHZlciAqLwogICAgY29uc3RydWN0b3Ioc3Vic29sdmVyKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuaXRlcmF0aW9ucyA9IDEwOwogICAgICB0aGlzLnRvbGVyYW5jZSA9IDFlLTc7CiAgICAgIHRoaXMuc3Vic29sdmVyID0gc3Vic29sdmVyOwogICAgICB0aGlzLm5vZGVzID0gW107CiAgICAgIHRoaXMubm9kZVBvb2wgPSBbXTsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlICh0aGlzLm5vZGVQb29sLmxlbmd0aCA8IDEyOCkgewogICAgICAgIHRoaXMubm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogY3JlYXRlTm9kZQogICAgICovCgoKICAgIGNyZWF0ZU5vZGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYm9keTogbnVsbCwKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgZXFzOiBbXSwKICAgICAgICB2aXNpdGVkOiBmYWxzZQogICAgICB9OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSB0aGUgc3Vic3lzdGVtcwogICAgICogQHJldHVybiBudW1iZXIgb2YgaXRlcmF0aW9ucyBwZXJmb3JtZWQKICAgICAqLwoKCiAgICBzb2x2ZShkdCwgd29ybGQpIHsKICAgICAgY29uc3Qgbm9kZXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlczsKICAgICAgY29uc3Qgbm9kZVBvb2wgPSB0aGlzLm5vZGVQb29sOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBOYm9kaWVzID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3Qgc3Vic29sdmVyID0gdGhpcy5zdWJzb2x2ZXI7IC8vIENyZWF0ZSBuZWVkZWQgbm9kZXMsIHJldXNlIGlmIHBvc3NpYmxlCgogICAgICB3aGlsZSAobm9kZVBvb2wubGVuZ3RoIDwgTmJvZGllcykgewogICAgICAgIG5vZGVQb29sLnB1c2godGhpcy5jcmVhdGVOb2RlKCkpOwogICAgICB9CgogICAgICBub2Rlcy5sZW5ndGggPSBOYm9kaWVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOYm9kaWVzOyBpKyspIHsKICAgICAgICBub2Rlc1tpXSA9IG5vZGVQb29sW2ldOwogICAgICB9IC8vIFJlc2V0IG5vZGUgdmFsdWVzCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgICBub2RlLmJvZHkgPSBib2RpZXNbaV07CiAgICAgICAgbm9kZS5jaGlsZHJlbi5sZW5ndGggPSAwOwogICAgICAgIG5vZGUuZXFzLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS52aXNpdGVkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBOZXE7IGsrKykgewogICAgICAgIGNvbnN0IGVxID0gZXF1YXRpb25zW2tdOwogICAgICAgIGNvbnN0IGkgPSBib2RpZXMuaW5kZXhPZihlcS5iaSk7CiAgICAgICAgY29uc3QgaiA9IGJvZGllcy5pbmRleE9mKGVxLmJqKTsKICAgICAgICBjb25zdCBuaSA9IG5vZGVzW2ldOwogICAgICAgIGNvbnN0IG5qID0gbm9kZXNbal07CiAgICAgICAgbmkuY2hpbGRyZW4ucHVzaChuaik7CiAgICAgICAgbmkuZXFzLnB1c2goZXEpOwogICAgICAgIG5qLmNoaWxkcmVuLnB1c2gobmkpOwogICAgICAgIG5qLmVxcy5wdXNoKGVxKTsKICAgICAgfQoKICAgICAgbGV0IGNoaWxkOwogICAgICBsZXQgbiA9IDA7CiAgICAgIGxldCBlcXMgPSBTcGxpdFNvbHZlcl9zb2x2ZV9lcXM7CiAgICAgIHN1YnNvbHZlci50b2xlcmFuY2UgPSB0aGlzLnRvbGVyYW5jZTsKICAgICAgc3Vic29sdmVyLml0ZXJhdGlvbnMgPSB0aGlzLml0ZXJhdGlvbnM7CiAgICAgIGNvbnN0IGR1bW15V29ybGQgPSBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkOwoKICAgICAgd2hpbGUgKGNoaWxkID0gZ2V0VW52aXNpdGVkTm9kZShub2RlcykpIHsKICAgICAgICBlcXMubGVuZ3RoID0gMDsKICAgICAgICBkdW1teVdvcmxkLmJvZGllcy5sZW5ndGggPSAwOwogICAgICAgIGJmcyhjaGlsZCwgdmlzaXRGdW5jLCBkdW1teVdvcmxkLmJvZGllcywgZXFzKTsKICAgICAgICBjb25zdCBOZXFzID0gZXFzLmxlbmd0aDsKICAgICAgICBlcXMgPSBlcXMuc29ydChzb3J0QnlJZCk7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXFzOyBpKyspIHsKICAgICAgICAgIHN1YnNvbHZlci5hZGRFcXVhdGlvbihlcXNbaV0pOwogICAgICAgIH0KCiAgICAgICAgc3Vic29sdmVyLnNvbHZlKGR0LCBkdW1teVdvcmxkKTsKICAgICAgICBzdWJzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7CiAgICAgICAgbisrOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KCiAgfSAvLyBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc3Vic3lzdGVtcwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9ub2RlcyA9IFtdOyAvLyBBbGwgYWxsb2NhdGVkIG5vZGUgb2JqZWN0cwoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9lcXMgPSBbXTsgLy8gVGVtcCBhcnJheQoKICBjb25zdCBTcGxpdFNvbHZlcl9zb2x2ZV9kdW1teVdvcmxkID0gewogICAgYm9kaWVzOiBbXQogIH07IC8vIFRlbXAgb2JqZWN0CgogIGNvbnN0IFNUQVRJQyA9IEJvZHkuU1RBVElDOwoKICBmdW5jdGlvbiBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSB7CiAgICBjb25zdCBObm9kZXMgPSBub2Rlcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ub2RlczsgaSsrKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKCiAgICAgIGlmICghbm9kZS52aXNpdGVkICYmICEobm9kZS5ib2R5LnR5cGUgJiBTVEFUSUMpKSB7CiAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBjb25zdCBxdWV1ZSA9IFtdOwoKICBmdW5jdGlvbiBiZnMocm9vdCwgdmlzaXRGdW5jLCBiZHMsIGVxcykgewogICAgcXVldWUucHVzaChyb290KTsKICAgIHJvb3QudmlzaXRlZCA9IHRydWU7CiAgICB2aXNpdEZ1bmMocm9vdCwgYmRzLCBlcXMpOwoKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IHF1ZXVlLnBvcCgpOyAvLyBMb29wIG92ZXIgdW52aXNpdGVkIGNoaWxkIG5vZGVzCgogICAgICBsZXQgY2hpbGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGUuY2hpbGRyZW4pKSB7CiAgICAgICAgY2hpbGQudmlzaXRlZCA9IHRydWU7CiAgICAgICAgdmlzaXRGdW5jKGNoaWxkLCBiZHMsIGVxcyk7CiAgICAgICAgcXVldWUucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHZpc2l0RnVuYyhub2RlLCBiZHMsIGVxcykgewogICAgYmRzLnB1c2gobm9kZS5ib2R5KTsKICAgIGNvbnN0IE5lcXMgPSBub2RlLmVxcy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICBjb25zdCBlcSA9IG5vZGUuZXFzW2ldOwoKICAgICAgaWYgKCFlcXMuaW5jbHVkZXMoZXEpKSB7CiAgICAgICAgZXFzLnB1c2goZXEpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBzb3J0QnlJZChhLCBiKSB7CiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7CiAgfQoKICAvKioKICAgKiBGb3IgcG9vbGluZyBvYmplY3RzIHRoYXQgY2FuIGJlIHJldXNlZC4KICAgKi8KICBjbGFzcyBQb29sIHsKICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgICAgdGhpcy50eXBlID0gT2JqZWN0OwogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBhbiBvYmplY3QgYWZ0ZXIgdXNlCiAgICAgKi8KICAgIHJlbGVhc2UoKSB7CiAgICAgIGNvbnN0IE5hcmdzID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOYXJnczsgaSsrKSB7CiAgICAgICAgdGhpcy5vYmplY3RzLnB1c2goaSA8IDAgfHwgYXJndW1lbnRzLmxlbmd0aCA8PSBpID8gdW5kZWZpbmVkIDogYXJndW1lbnRzW2ldKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBvYmplY3QKICAgICAqLwoKCiAgICBnZXQoKSB7CiAgICAgIGlmICh0aGlzLm9iamVjdHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29uc3RydWN0T2JqZWN0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRoaXMub2JqZWN0cy5wb3AoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYW4gb2JqZWN0LiBTaG91bGQgYmUgaW1wbGVtZW50ZWQgaW4gZWFjaCBzdWJjbGFzcy4KICAgICAqLwoKCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY29uc3RydWN0T2JqZWN0KCkgbm90IGltcGxlbWVudGVkIGluIHRoaXMgUG9vbCBzdWJjbGFzcyB5ZXQhJyk7CiAgICB9CiAgICAvKioKICAgICAqIEByZXR1cm4gU2VsZiwgZm9yIGNoYWluaW5nCiAgICAgKi8KCgogICAgcmVzaXplKHNpemUpIHsKICAgICAgY29uc3Qgb2JqZWN0cyA9IHRoaXMub2JqZWN0czsKCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA+IHNpemUpIHsKICAgICAgICBvYmplY3RzLnBvcCgpOwogICAgICB9CgogICAgICB3aGlsZSAob2JqZWN0cy5sZW5ndGggPCBzaXplKSB7CiAgICAgICAgb2JqZWN0cy5wdXNoKHRoaXMuY29uc3RydWN0T2JqZWN0KCkpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgfQoKICAvKioKICAgKiBWZWMzUG9vbAogICAqLwoKICBjbGFzcyBWZWMzUG9vbCBleHRlbmRzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7CiAgICAgIHRoaXMudHlwZSA9IFZlYzM7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3QgYSB2ZWN0b3IKICAgICAqLwogICAgY29uc3RydWN0T2JqZWN0KCkgewogICAgICByZXR1cm4gbmV3IFZlYzMoKTsKICAgIH0KCiAgfQoKICAvLyBOYW1pbmcgcnVsZTogYmFzZWQgb2YgdGhlIG9yZGVyIGluIFNIQVBFX1RZUEVTLAogIC8vIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBtZXRob2QgaXMgZm9ybWVkIGJ5IHRoZQogIC8vIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBiZWZvcmUsIGluIHRoZSBzZWNvbmQgcGFydAogIC8vIHRoZXJlIGlzIHRoZSBzaGFwZSB0eXBlIHRoYXQgY29tZXMgYWZ0ZXIgaW4gdGhlIFNIQVBFX1RZUEVTIGxpc3QKICBjb25zdCBDT0xMSVNJT05fVFlQRVMgPSB7CiAgICBzcGhlcmVTcGhlcmU6IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHNwaGVyZVBsYW5lOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5QTEFORSwKICAgIGJveEJveDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQk9YLAogICAgc3BoZXJlQm94OiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBwbGFuZUJveDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5CT1gsCiAgICBjb252ZXhDb252ZXg6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVDb252ZXg6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBwbGFuZUNvbnZleDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgYm94Q29udmV4OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgc3BoZXJlSGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgYm94SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgY29udmV4SGVpZ2h0ZmllbGQ6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRCwKICAgIHNwaGVyZVBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLlNQSEVSRSwKICAgIHBsYW5lUGFydGljbGU6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBib3hQYXJ0aWNsZTogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuUEFSVElDTEUsCiAgICBjb252ZXhQYXJ0aWNsZTogU2hhcGUudHlwZXMuUEFSVElDTEUgfCBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OLAogICAgY3lsaW5kZXJDeWxpbmRlcjogU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVDeWxpbmRlcjogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwbGFuZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgYm94Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgY29udmV4Q3lsaW5kZXI6IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04gfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBwYXJ0aWNsZUN5bGluZGVyOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgc3BoZXJlVHJpbWVzaDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuVFJJTUVTSCwKICAgIHBsYW5lVHJpbWVzaDogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5UUklNRVNICiAgfTsKCiAgLyoqCiAgICogSGVscGVyIGNsYXNzIGZvciB0aGUgV29ybGQuIEdlbmVyYXRlcyBDb250YWN0RXF1YXRpb25zLgogICAqIEB0b2RvIFNwaGVyZS1Db252ZXhQb2x5aGVkcm9uIGNvbnRhY3RzCiAgICogQHRvZG8gQ29udGFjdCByZWR1Y3Rpb24KICAgKiBAdG9kbyBzaG91bGQgbW92ZSBtZXRob2RzIHRvIHByb3RvdHlwZQogICAqLwogIGNsYXNzIE5hcnJvd3BoYXNlIHsKICAgIC8qKgogICAgICogSW50ZXJuYWwgc3RvcmFnZSBvZiBwb29sZWQgY29udGFjdCBwb2ludHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBvb2xlZCB2ZWN0b3JzLgogICAgICovCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVTcGhlcmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVTcGhlcmU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlUGxhbmVdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVQbGFuZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQm94OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQm94XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZUNvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveENvbnZleF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZUhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lUGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveFBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94UGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jeWxpbmRlckN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUNvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5ib3hDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5oZWlnaHRmaWVsZEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuaGVpZ2h0ZmllbGRDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wYXJ0aWNsZUN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGFydGljbGVDeWxpbmRlcjsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVUcmltZXNoXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlVHJpbWVzaDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5wbGFuZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZVRyaW1lc2g7CiAgICB9IC8vIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleFRyaW1lc2hdKCkgewogICAgLy8gICByZXR1cm4gdGhpcy5jb252ZXhUcmltZXNoCiAgICAvLyB9CgoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107CiAgICAgIHRoaXMucmVzdWx0ID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25SZXN1bHQgPSBbXTsKICAgICAgdGhpcy52M3Bvb2wgPSBuZXcgVmVjM1Bvb2woKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICB0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgYSBjb250YWN0IG9iamVjdCwgYnkgdXNpbmcgdGhlIGludGVybmFsIHBvb2wgb3IgY3JlYXRpbmcgYSBuZXcgb25lLgogICAgICovCgoKICAgIGNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgb3ZlcnJpZGVTaGFwZUEsIG92ZXJyaWRlU2hhcGVCKSB7CiAgICAgIGxldCBjOwoKICAgICAgaWYgKHRoaXMuY29udGFjdFBvaW50UG9vbC5sZW5ndGgpIHsKICAgICAgICBjID0gdGhpcy5jb250YWN0UG9pbnRQb29sLnBvcCgpOwogICAgICAgIGMuYmkgPSBiaTsKICAgICAgICBjLmJqID0gYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYyA9IG5ldyBDb250YWN0RXF1YXRpb24oYmksIGJqKTsKICAgICAgfQoKICAgICAgYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOwogICAgICBjLnJlc3RpdHV0aW9uID0gY20ucmVzdGl0dXRpb247CiAgICAgIGMuc2V0U3Bvb2tQYXJhbXMoY20uY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzLCBjbS5jb250YWN0RXF1YXRpb25SZWxheGF0aW9uLCB0aGlzLndvcmxkLmR0KTsKICAgICAgY29uc3QgbWF0QSA9IHNpLm1hdGVyaWFsIHx8IGJpLm1hdGVyaWFsOwogICAgICBjb25zdCBtYXRCID0gc2oubWF0ZXJpYWwgfHwgYmoubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEucmVzdGl0dXRpb24gPj0gMCAmJiBtYXRCLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICBjLnJlc3RpdHV0aW9uID0gbWF0QS5yZXN0aXR1dGlvbiAqIG1hdEIucmVzdGl0dXRpb247CiAgICAgIH0KCiAgICAgIGMuc2kgPSBvdmVycmlkZVNoYXBlQSB8fCBzaTsKICAgICAgYy5zaiA9IG92ZXJyaWRlU2hhcGVCIHx8IHNqOwogICAgICByZXR1cm4gYzsKICAgIH0KCiAgICBjcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGNvbnRhY3RFcXVhdGlvbiwgb3V0QXJyYXkpIHsKICAgICAgY29uc3QgYm9keUEgPSBjb250YWN0RXF1YXRpb24uYmk7CiAgICAgIGNvbnN0IGJvZHlCID0gY29udGFjdEVxdWF0aW9uLmJqOwogICAgICBjb25zdCBzaGFwZUEgPSBjb250YWN0RXF1YXRpb24uc2k7CiAgICAgIGNvbnN0IHNoYXBlQiA9IGNvbnRhY3RFcXVhdGlvbi5zajsKICAgICAgY29uc3Qgd29ybGQgPSB0aGlzLndvcmxkOwogICAgICBjb25zdCBjbSA9IHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbDsgLy8gSWYgZnJpY3Rpb24gb3IgcmVzdGl0dXRpb24gd2VyZSBzcGVjaWZpZWQgaW4gdGhlIG1hdGVyaWFsLCB1c2UgdGhlbQoKICAgICAgbGV0IGZyaWN0aW9uID0gY20uZnJpY3Rpb247CiAgICAgIGNvbnN0IG1hdEEgPSBzaGFwZUEubWF0ZXJpYWwgfHwgYm9keUEubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzaGFwZUIubWF0ZXJpYWwgfHwgYm9keUIubWF0ZXJpYWw7CgogICAgICBpZiAobWF0QSAmJiBtYXRCICYmIG1hdEEuZnJpY3Rpb24gPj0gMCAmJiBtYXRCLmZyaWN0aW9uID49IDApIHsKICAgICAgICBmcmljdGlvbiA9IG1hdEEuZnJpY3Rpb24gKiBtYXRCLmZyaWN0aW9uOwogICAgICB9CgogICAgICBpZiAoZnJpY3Rpb24gPiAwKSB7CiAgICAgICAgLy8gQ3JlYXRlIDIgdGFuZ2VudCBlcXVhdGlvbnMKICAgICAgICAvLyBVc2VycyBtYXkgcHJvdmlkZSBhIGZvcmNlIGRpZmZlcmVudCBmcm9tIGdsb2JhbCBncmF2aXR5IHRvIHVzZSB3aGVuIGNvbXB1dGluZyBjb250YWN0IGZyaWN0aW9uLgogICAgICAgIGNvbnN0IG11ZyA9IGZyaWN0aW9uICogKHdvcmxkLmZyaWN0aW9uR3Jhdml0eSB8fCB3b3JsZC5ncmF2aXR5KS5sZW5ndGgoKTsKICAgICAgICBsZXQgcmVkdWNlZE1hc3MgPSBib2R5QS5pbnZNYXNzICsgYm9keUIuaW52TWFzczsKCiAgICAgICAgaWYgKHJlZHVjZWRNYXNzID4gMCkgewogICAgICAgICAgcmVkdWNlZE1hc3MgPSAxIC8gcmVkdWNlZE1hc3M7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBwb29sID0gdGhpcy5mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgICBjb25zdCBjMSA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJvZHlBLCBib2R5QiwgbXVnICogcmVkdWNlZE1hc3MpOwogICAgICAgIGNvbnN0IGMyID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgYzEuYmkgPSBjMi5iaSA9IGJvZHlBOwogICAgICAgIGMxLmJqID0gYzIuYmogPSBib2R5QjsKICAgICAgICBjMS5taW5Gb3JjZSA9IGMyLm1pbkZvcmNlID0gLW11ZyAqIHJlZHVjZWRNYXNzOwogICAgICAgIGMxLm1heEZvcmNlID0gYzIubWF4Rm9yY2UgPSBtdWcgKiByZWR1Y2VkTWFzczsgLy8gQ29weSBvdmVyIHRoZSByZWxhdGl2ZSB2ZWN0b3JzCgogICAgICAgIGMxLnJpLmNvcHkoY29udGFjdEVxdWF0aW9uLnJpKTsKICAgICAgICBjMS5yai5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaik7CiAgICAgICAgYzIucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMyLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsgLy8gQ29uc3RydWN0IHRhbmdlbnRzCgogICAgICAgIGNvbnRhY3RFcXVhdGlvbi5uaS50YW5nZW50cyhjMS50LCBjMi50KTsgLy8gU2V0IHNwb29rIHBhcmFtcwoKICAgICAgICBjMS5zZXRTcG9va1BhcmFtcyhjbS5mcmljdGlvbkVxdWF0aW9uU3RpZmZuZXNzLCBjbS5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiwgd29ybGQuZHQpOwogICAgICAgIGMyLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjb250YWN0RXF1YXRpb24uZW5hYmxlZDsKICAgICAgICBvdXRBcnJheS5wdXNoKGMxLCBjMik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogVGFrZSB0aGUgYXZlcmFnZSBOIGxhdGVzdCBjb250YWN0IHBvaW50IG9uIHRoZSBwbGFuZS4KICAgICAqLwoKCiAgICBjcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKSB7CiAgICAgIC8vIFRoZSBsYXN0IGNvbnRhY3RFcXVhdGlvbgogICAgICBsZXQgYyA9IHRoaXMucmVzdWx0W3RoaXMucmVzdWx0Lmxlbmd0aCAtIDFdOyAvLyBDcmVhdGUgdGhlIHJlc3VsdDogdHdvICJhdmVyYWdlIiBmcmljdGlvbiBlcXVhdGlvbnMKCiAgICAgIGlmICghdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KGMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpIHx8IG51bUNvbnRhY3RzID09PSAxKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBmMSA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAyXTsKICAgICAgY29uc3QgZjIgPSB0aGlzLmZyaWN0aW9uUmVzdWx0W3RoaXMuZnJpY3Rpb25SZXN1bHQubGVuZ3RoIC0gMV07CiAgICAgIGF2ZXJhZ2VOb3JtYWwuc2V0WmVybygpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRCLnNldFplcm8oKTsKICAgICAgY29uc3QgYm9keUEgPSBjLmJpOwogICAgICBjLmJqOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG51bUNvbnRhY3RzOyBpKyspIHsKICAgICAgICBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMSAtIGldOwoKICAgICAgICBpZiAoYy5iaSAhPT0gYm9keUEpIHsKICAgICAgICAgIGF2ZXJhZ2VOb3JtYWwudmFkZChjLm5pLCBhdmVyYWdlTm9ybWFsKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnZhZGQoYy5yaSwgYXZlcmFnZUNvbnRhY3RQb2ludEEpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50Qik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGF2ZXJhZ2VOb3JtYWwudnN1YihjLm5pLCBhdmVyYWdlTm9ybWFsKTsKICAgICAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnZhZGQoYy5yaiwgYXZlcmFnZUNvbnRhY3RQb2ludEEpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50Qik7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBpbnZOdW1Db250YWN0cyA9IDEgLyBudW1Db250YWN0czsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEuc2NhbGUoaW52TnVtQ29udGFjdHMsIGYxLnJpKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2NhbGUoaW52TnVtQ29udGFjdHMsIGYxLnJqKTsKICAgICAgZjIucmkuY29weShmMS5yaSk7IC8vIFNob3VsZCBiZSB0aGUgc2FtZQoKICAgICAgZjIucmouY29weShmMS5yaik7CiAgICAgIGF2ZXJhZ2VOb3JtYWwubm9ybWFsaXplKCk7CiAgICAgIGF2ZXJhZ2VOb3JtYWwudGFuZ2VudHMoZjEudCwgZjIudCk7IC8vIHJldHVybiBlcTsKICAgIH0KICAgIC8qKgogICAgICogR2VuZXJhdGUgYWxsIGNvbnRhY3RzIGJldHdlZW4gYSBsaXN0IG9mIGJvZHkgcGFpcnMKICAgICAqIEBwYXJhbSBwMSBBcnJheSBvZiBib2R5IGluZGljZXMKICAgICAqIEBwYXJhbSBwMiBBcnJheSBvZiBib2R5IGluZGljZXMKICAgICAqIEBwYXJhbSByZXN1bHQgQXJyYXkgdG8gc3RvcmUgZ2VuZXJhdGVkIGNvbnRhY3RzCiAgICAgKiBAcGFyYW0gb2xkY29udGFjdHMgT3B0aW9uYWwuIEFycmF5IG9mIHJldXNhYmxlIGNvbnRhY3Qgb2JqZWN0cwogICAgICovCgoKICAgIGdldENvbnRhY3RzKHAxLCBwMiwgd29ybGQsIHJlc3VsdCwgb2xkY29udGFjdHMsIGZyaWN0aW9uUmVzdWx0LCBmcmljdGlvblBvb2wpIHsKICAgICAgLy8gU2F2ZSBvbGQgY29udGFjdCBvYmplY3RzCiAgICAgIHRoaXMuY29udGFjdFBvaW50UG9vbCA9IG9sZGNvbnRhY3RzOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sID0gZnJpY3Rpb25Qb29sOwogICAgICB0aGlzLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IGZyaWN0aW9uUmVzdWx0OwogICAgICBjb25zdCBxaSA9IHRtcFF1YXQxOwogICAgICBjb25zdCBxaiA9IHRtcFF1YXQyOwogICAgICBjb25zdCB4aSA9IHRtcFZlYzE7CiAgICAgIGNvbnN0IHhqID0gdG1wVmVjMjsKCiAgICAgIGZvciAobGV0IGsgPSAwLCBOID0gcDEubGVuZ3RoOyBrICE9PSBOOyBrKyspIHsKICAgICAgICAvLyBHZXQgY3VycmVudCBjb2xsaXNpb24gYm9kaWVzCiAgICAgICAgY29uc3QgYmkgPSBwMVtrXTsKICAgICAgICBjb25zdCBiaiA9IHAyW2tdOyAvLyBHZXQgY29udGFjdCBtYXRlcmlhbAoKICAgICAgICBsZXQgYm9keUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgYm9keUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChiaS5tYXRlcmlhbCwgYmoubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBqdXN0VGVzdCA9IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5TVEFUSUMgfHwgYmkudHlwZSAmIEJvZHkuU1RBVElDICYmIGJqLnR5cGUgJiBCb2R5LktJTkVNQVRJQyB8fCBiaS50eXBlICYgQm9keS5LSU5FTUFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpLnNoYXBlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgYmkucXVhdGVybmlvbi5tdWx0KGJpLnNoYXBlT3JpZW50YXRpb25zW2ldLCBxaSk7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLnZtdWx0KGJpLnNoYXBlT2Zmc2V0c1tpXSwgeGkpOwogICAgICAgICAgeGkudmFkZChiaS5wb3NpdGlvbiwgeGkpOwogICAgICAgICAgY29uc3Qgc2kgPSBiaS5zaGFwZXNbaV07CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBiai5zaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgICAgLy8gQ29tcHV0ZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygc2hhcGVzCiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24ubXVsdChiai5zaGFwZU9yaWVudGF0aW9uc1tqXSwgcWopOwogICAgICAgICAgICBiai5xdWF0ZXJuaW9uLnZtdWx0KGJqLnNoYXBlT2Zmc2V0c1tqXSwgeGopOwogICAgICAgICAgICB4ai52YWRkKGJqLnBvc2l0aW9uLCB4aik7CiAgICAgICAgICAgIGNvbnN0IHNqID0gYmouc2hhcGVzW2pdOwoKICAgICAgICAgICAgaWYgKCEoc2kuY29sbGlzaW9uRmlsdGVyTWFzayAmIHNqLmNvbGxpc2lvbkZpbHRlckdyb3VwICYmIHNqLmNvbGxpc2lvbkZpbHRlck1hc2sgJiBzaS5jb2xsaXNpb25GaWx0ZXJHcm91cCkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9IC8vIEdldCBjb2xsaXNpb24gbWF0ZXJpYWwKCgogICAgICAgICAgICBsZXQgc2hhcGVDb250YWN0TWF0ZXJpYWwgPSBudWxsOwoKICAgICAgICAgICAgaWYgKHNpLm1hdGVyaWFsICYmIHNqLm1hdGVyaWFsKSB7CiAgICAgICAgICAgICAgc2hhcGVDb250YWN0TWF0ZXJpYWwgPSB3b3JsZC5nZXRDb250YWN0TWF0ZXJpYWwoc2kubWF0ZXJpYWwsIHNqLm1hdGVyaWFsKSB8fCBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWwgPSBzaGFwZUNvbnRhY3RNYXRlcmlhbCB8fCBib2R5Q29udGFjdE1hdGVyaWFsIHx8IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7IC8vIEdldCBjb250YWN0cwoKICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXJJbmRleCA9IHNpLnR5cGUgfCBzai50eXBlOwogICAgICAgICAgICBjb25zdCByZXNvbHZlciA9IHRoaXNbcmVzb2x2ZXJJbmRleF07CgogICAgICAgICAgICBpZiAocmVzb2x2ZXIpIHsKICAgICAgICAgICAgICBsZXQgcmV0dmFsID0gZmFsc2U7IC8vIFRPIERPOiBpbnZlc3RpZ2F0ZSB3aHkgc3BoZXJlUGFydGljbGUgYW5kIGNvbnZleFBhcnRpY2xlCiAgICAgICAgICAgICAgLy8gcmVzb2x2ZXJzIGV4cGVjdCBzaSBhbmQgc2ogc2hhcGVzIHRvIGJlIGluIHJldmVyc2Ugb3JkZXIKICAgICAgICAgICAgICAvLyAoaS5lLiBsYXJnZXIgaW50ZWdlciB2YWx1ZSB0eXBlIGZpcnN0IGluc3RlYWQgb2Ygc21hbGxlciBmaXJzdCkKCiAgICAgICAgICAgICAgaWYgKHNpLnR5cGUgPCBzai50eXBlKSB7CiAgICAgICAgICAgICAgICByZXR2YWwgPSByZXNvbHZlci5jYWxsKHRoaXMsIHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyZXR2YWwgJiYganVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIC8vIFJlZ2lzdGVyIG92ZXJsYXAKICAgICAgICAgICAgICAgIHdvcmxkLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgICAgICAgICAgIHdvcmxkLmJvZHlPdmVybGFwS2VlcGVyLnNldChiaS5pZCwgYmouaWQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVNwaGVyZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICByZXR1cm4geGkuZGlzdGFuY2VTcXVhcmVkKHhqKSA8IChzaS5yYWRpdXMgKyBzai5yYWRpdXMpICoqIDI7CiAgICAgIH0gLy8gV2Ugd2lsbCBoYXZlIG9ubHkgb25lIGNvbnRhY3QgaW4gdGhpcyBjYXNlCgoKICAgICAgY29uc3QgY29udGFjdEVxID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgIHhqLnZzdWIoeGksIGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5uaS5ub3JtYWxpemUoKTsgLy8gQ29udGFjdCBwb2ludCBsb2NhdGlvbnMKCiAgICAgIGNvbnRhY3RFcS5yaS5jb3B5KGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5yai5jb3B5KGNvbnRhY3RFcS5uaSk7CiAgICAgIGNvbnRhY3RFcS5yaS5zY2FsZShzaS5yYWRpdXMsIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yai5zY2FsZSgtc2oucmFkaXVzLCBjb250YWN0RXEucmopOwogICAgICBjb250YWN0RXEucmkudmFkZCh4aSwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJpLnZzdWIoYmkucG9zaXRpb24sIGNvbnRhY3RFcS5yaSk7CiAgICAgIGNvbnRhY3RFcS5yai52YWRkKHhqLCBjb250YWN0RXEucmopOwogICAgICBjb250YWN0RXEucmoudnN1Yihiai5wb3NpdGlvbiwgY29udGFjdEVxLnJqKTsKICAgICAgdGhpcy5yZXN1bHQucHVzaChjb250YWN0RXEpOwogICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgIH0KCiAgICBzcGhlcmVQbGFuZShzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBXZSB3aWxsIGhhdmUgb25lIGNvbnRhY3QgaW4gdGhpcyBjYXNlCiAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgci5uaS5zZXQoMCwgMCwgMSk7CiAgICAgIHFqLnZtdWx0KHIubmksIHIubmkpOwogICAgICByLm5pLm5lZ2F0ZShyLm5pKTsgLy8gYm9keSBpIGlzIHRoZSBzcGhlcmUsIGZsaXAgbm9ybWFsCgogICAgICByLm5pLm5vcm1hbGl6ZSgpOyAvLyBOZWVkZWQ/CiAgICAgIC8vIFZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gY29udGFjdCBwb2ludAoKICAgICAgci5uaS5zY2FsZShzaS5yYWRpdXMsIHIucmkpOyAvLyBQcm9qZWN0IGRvd24gc3BoZXJlIG9uIHBsYW5lCgogICAgICB4aS52c3ViKHhqLCBwb2ludF9vbl9wbGFuZV90b19zcGhlcmUpOwogICAgICByLm5pLnNjYWxlKHIubmkuZG90KHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSksIHBsYW5lX3RvX3NwaGVyZV9vcnRobyk7CiAgICAgIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZS52c3ViKHBsYW5lX3RvX3NwaGVyZV9vcnRobywgci5yaik7IC8vIFRoZSBzcGhlcmUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHBsYW5lCgogICAgICBpZiAoLXBvaW50X29uX3BsYW5lX3RvX3NwaGVyZS5kb3Qoci5uaSkgPD0gc2kucmFkaXVzKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IC8vIE1ha2UgaXQgcmVsYXRpdmUgdG8gdGhlIGJvZHkKCgogICAgICAgIGNvbnN0IHJpID0gci5yaTsKICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94Qm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzai5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZUJveChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCB2M3Bvb2wgPSB0aGlzLnYzcG9vbDsgLy8gd2UgcmVmZXIgdG8gdGhlIGJveCBhcyBib2R5IGoKCiAgICAgIGNvbnN0IHNpZGVzID0gc3BoZXJlQm94X3NpZGVzOwogICAgICB4aS52c3ViKHhqLCBib3hfdG9fc3BoZXJlKTsKICAgICAgc2ouZ2V0U2lkZU5vcm1hbHMoc2lkZXMsIHFqKTsKICAgICAgY29uc3QgUiA9IHNpLnJhZGl1czsKCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBTdG9yZSB0aGUgcmVzdWx0aW5nIHNpZGUgcGVuZXRyYXRpb24gaW5mbwoKICAgICAgY29uc3Qgc2lkZV9ucyA9IHNwaGVyZUJveF9zaWRlX25zOwogICAgICBjb25zdCBzaWRlX25zMSA9IHNwaGVyZUJveF9zaWRlX25zMTsKICAgICAgY29uc3Qgc2lkZV9uczIgPSBzcGhlcmVCb3hfc2lkZV9uczI7CiAgICAgIGxldCBzaWRlX2ggPSBudWxsOwogICAgICBsZXQgc2lkZV9wZW5ldHJhdGlvbnMgPSAwOwogICAgICBsZXQgc2lkZV9kb3QxID0gMDsKICAgICAgbGV0IHNpZGVfZG90MiA9IDA7CiAgICAgIGxldCBzaWRlX2Rpc3RhbmNlID0gbnVsbDsKCiAgICAgIGZvciAobGV0IGlkeCA9IDAsIG5zaWRlcyA9IHNpZGVzLmxlbmd0aDsgaWR4ICE9PSBuc2lkZXMgJiYgZm91bmQgPT09IGZhbHNlOyBpZHgrKykgewogICAgICAgIC8vIEdldCB0aGUgcGxhbmUgc2lkZSBub3JtYWwgKG5zKQogICAgICAgIGNvbnN0IG5zID0gc3BoZXJlQm94X25zOwogICAgICAgIG5zLmNvcHkoc2lkZXNbaWR4XSk7CiAgICAgICAgY29uc3QgaCA9IG5zLmxlbmd0aCgpOwogICAgICAgIG5zLm5vcm1hbGl6ZSgpOyAvLyBUaGUgbm9ybWFsL2Rpc3RhbmNlIGRvdCBwcm9kdWN0IHRlbGxzIHdoaWNoIHNpZGUgb2YgdGhlIHBsYW5lIHdlIGFyZQoKICAgICAgICBjb25zdCBkb3QgPSBib3hfdG9fc3BoZXJlLmRvdChucyk7CgogICAgICAgIGlmIChkb3QgPCBoICsgUiAmJiBkb3QgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgdGhlIG90aGVyIHR3byBkaW1lbnNpb25zCiAgICAgICAgICBjb25zdCBuczEgPSBzcGhlcmVCb3hfbnMxOwogICAgICAgICAgY29uc3QgbnMyID0gc3BoZXJlQm94X25zMjsKICAgICAgICAgIG5zMS5jb3B5KHNpZGVzWyhpZHggKyAxKSAlIDNdKTsKICAgICAgICAgIG5zMi5jb3B5KHNpZGVzWyhpZHggKyAyKSAlIDNdKTsKICAgICAgICAgIGNvbnN0IGgxID0gbnMxLmxlbmd0aCgpOwogICAgICAgICAgY29uc3QgaDIgPSBuczIubGVuZ3RoKCk7CiAgICAgICAgICBuczEubm9ybWFsaXplKCk7CiAgICAgICAgICBuczIubm9ybWFsaXplKCk7CiAgICAgICAgICBjb25zdCBkb3QxID0gYm94X3RvX3NwaGVyZS5kb3QobnMxKTsKICAgICAgICAgIGNvbnN0IGRvdDIgPSBib3hfdG9fc3BoZXJlLmRvdChuczIpOwoKICAgICAgICAgIGlmIChkb3QxIDwgaDEgJiYgZG90MSA+IC1oMSAmJiBkb3QyIDwgaDIgJiYgZG90MiA+IC1oMikgewogICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5hYnMoZG90IC0gaCAtIFIpOwoKICAgICAgICAgICAgaWYgKHNpZGVfZGlzdGFuY2UgPT09IG51bGwgfHwgZGlzdCA8IHNpZGVfZGlzdGFuY2UpIHsKICAgICAgICAgICAgICBzaWRlX2Rpc3RhbmNlID0gZGlzdDsKICAgICAgICAgICAgICBzaWRlX2RvdDEgPSBkb3QxOwogICAgICAgICAgICAgIHNpZGVfZG90MiA9IGRvdDI7CiAgICAgICAgICAgICAgc2lkZV9oID0gaDsKICAgICAgICAgICAgICBzaWRlX25zLmNvcHkobnMpOwogICAgICAgICAgICAgIHNpZGVfbnMxLmNvcHkobnMxKTsKICAgICAgICAgICAgICBzaWRlX25zMi5jb3B5KG5zMik7CiAgICAgICAgICAgICAgc2lkZV9wZW5ldHJhdGlvbnMrKzsKCiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzaWRlX3BlbmV0cmF0aW9ucykgewogICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBzaWRlX25zLnNjYWxlKC1SLCByLnJpKTsgLy8gU3BoZXJlIHIKCiAgICAgICAgci5uaS5jb3B5KHNpZGVfbnMpOwogICAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBOb3JtYWwgc2hvdWxkIGJlIG91dCBvZiBzcGhlcmUKCiAgICAgICAgc2lkZV9ucy5zY2FsZShzaWRlX2gsIHNpZGVfbnMpOwogICAgICAgIHNpZGVfbnMxLnNjYWxlKHNpZGVfZG90MSwgc2lkZV9uczEpOwogICAgICAgIHNpZGVfbnMudmFkZChzaWRlX25zMSwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczIuc2NhbGUoc2lkZV9kb3QyLCBzaWRlX25zMik7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMyLCByLnJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfSAvLyBDaGVjayBjb3JuZXJzCgoKICAgICAgbGV0IHJqID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXI7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gMiAmJiAhZm91bmQ7IGorKykgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSAyICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBmb3IgKGxldCBsID0gMDsgbCAhPT0gMiAmJiAhZm91bmQ7IGwrKykgewogICAgICAgICAgICByai5zZXQoMCwgMCwgMCk7CgogICAgICAgICAgICBpZiAoaikgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzBdLCByaik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChrKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMV0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGwpIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1syXSwgcmopOwogICAgICAgICAgICB9IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKCiAgICAgICAgICAgIHhqLnZhZGQocmosIHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICBzcGhlcmVfdG9fY29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICAgICAgaWYgKHNwaGVyZV90b19jb3JuZXIubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIHIucmkuY29weShzcGhlcmVfdG9fY29ybmVyKTsKICAgICAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgICAgICByLnJpLnNjYWxlKFIsIHIucmkpOwogICAgICAgICAgICAgIHIucmouY29weShyaik7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHYzcG9vbC5yZWxlYXNlKHJqKTsKICAgICAgcmogPSBudWxsOyAvLyBDaGVjayBlZGdlcwoKICAgICAgY29uc3QgZWRnZVRhbmdlbnQgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGVkZ2VDZW50ZXIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHIgPSB2M3Bvb2wuZ2V0KCk7IC8vIHIgPSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyCgogICAgICBjb25zdCBvcnRob2dvbmFsID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBkaXN0ID0gdjNwb29sLmdldCgpOwogICAgICBjb25zdCBOc2lkZXMgPSBzaWRlcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTnNpZGVzICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5zaWRlcyAmJiAhZm91bmQ7IGsrKykgewogICAgICAgICAgaWYgKGogJSAzICE9PSBrICUgMykgewogICAgICAgICAgICAvLyBHZXQgZWRnZSB0YW5nZW50CiAgICAgICAgICAgIHNpZGVzW2tdLmNyb3NzKHNpZGVzW2pdLCBlZGdlVGFuZ2VudCk7CiAgICAgICAgICAgIGVkZ2VUYW5nZW50Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBzaWRlc1tqXS52YWRkKHNpZGVzW2tdLCBlZGdlQ2VudGVyKTsKICAgICAgICAgICAgci5jb3B5KHhpKTsKICAgICAgICAgICAgci52c3ViKGVkZ2VDZW50ZXIsIHIpOwogICAgICAgICAgICByLnZzdWIoeGosIHIpOwogICAgICAgICAgICBjb25zdCBvcnRob25vcm0gPSByLmRvdChlZGdlVGFuZ2VudCk7IC8vIGRpc3RhbmNlIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KCiAgICAgICAgICAgIGVkZ2VUYW5nZW50LnNjYWxlKG9ydGhvbm9ybSwgb3J0aG9nb25hbCk7IC8vIFZlY3RvciBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIgaW4gdGhlIHRhbmdlbnQgZGlyZWN0aW9uCiAgICAgICAgICAgIC8vIEZpbmQgdGhlIHRoaXJkIHNpZGUgb3J0aG9nb25hbCB0byB0aGlzIG9uZQoKICAgICAgICAgICAgbGV0IGwgPSAwOwoKICAgICAgICAgICAgd2hpbGUgKGwgPT09IGogJSAzIHx8IGwgPT09IGsgJSAzKSB7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICB9IC8vIHZlYyBmcm9tIGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBwcm9qZWN0ZWQgdG8gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gdGhlIGVkZ2UgdGFuZ2VudAoKCiAgICAgICAgICAgIGRpc3QuY29weSh4aSk7CiAgICAgICAgICAgIGRpc3QudnN1YihvcnRob2dvbmFsLCBkaXN0KTsKICAgICAgICAgICAgZGlzdC52c3ViKGVkZ2VDZW50ZXIsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoeGosIGRpc3QpOyAvLyBEaXN0YW5jZXMgaW4gdGFuZ2VudCBkaXJlY3Rpb24gYW5kIGRpc3RhbmNlIGluIHRoZSBwbGFuZSBvcnRob2dvbmFsIHRvIGl0CgogICAgICAgICAgICBjb25zdCB0ZGlzdCA9IE1hdGguYWJzKG9ydGhvbm9ybSk7CiAgICAgICAgICAgIGNvbnN0IG5kaXN0ID0gZGlzdC5sZW5ndGgoKTsKCiAgICAgICAgICAgIGlmICh0ZGlzdCA8IHNpZGVzW2xdLmxlbmd0aCgpICYmIG5kaXN0IDwgUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgcmVzID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICBlZGdlQ2VudGVyLnZhZGQob3J0aG9nb25hbCwgcmVzLnJqKTsgLy8gYm94IHJqCgogICAgICAgICAgICAgIHJlcy5yai5jb3B5KHJlcy5yaik7CiAgICAgICAgICAgICAgZGlzdC5uZWdhdGUocmVzLm5pKTsKICAgICAgICAgICAgICByZXMubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICByZXMucmkudmFkZCh4aiwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkudnN1Yih4aSwgcmVzLnJpKTsKICAgICAgICAgICAgICByZXMucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgcmVzLnJpLnNjYWxlKFIsIHJlcy5yaSk7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKGJpLnBvc2l0aW9uLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yai52YWRkKHhqLCByZXMucmopOwogICAgICAgICAgICAgIHJlcy5yai52c3ViKGJqLnBvc2l0aW9uLCByZXMucmopOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocmVzKTsKICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QocmVzLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UoZWRnZVRhbmdlbnQsIGVkZ2VDZW50ZXIsIHIsIG9ydGhvZ29uYWwsIGRpc3QpOwogICAgfQoKICAgIHBsYW5lQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmlkID0gc2ouaWQ7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4KHNpLCBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHNpLCBzaiwganVzdFRlc3QpOwogICAgfQoKICAgIGNvbnZleENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCwgZmFjZUxpc3RBLCBmYWNlTGlzdEIpIHsKICAgICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwoKICAgICAgaWYgKHhpLmRpc3RhbmNlVG8oeGopID4gc2kuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzai5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNpLmZpbmRTZXBhcmF0aW5nQXhpcyhzaiwgeGksIHFpLCB4aiwgcWosIHNlcEF4aXMsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSkgewogICAgICAgIGNvbnN0IHJlcyA9IFtdOwogICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgICAgICBzaS5jbGlwQWdhaW5zdEh1bGwoeGksIHFpLCBzaiwgeGosIHFqLCBzZXBBeGlzLCAtMTAwLCAxMDAsIHJlcyk7CiAgICAgICAgbGV0IG51bUNvbnRhY3RzID0gMDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHJlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOwogICAgICAgICAgc2VwQXhpcy5uZWdhdGUoci5uaSk7CiAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgICAgICAgIHEuc2NhbGUocmVzW2pdLmRlcHRoLCBxKTsKICAgICAgICAgIHJlc1tqXS5wb2ludC52YWRkKHEsIHJpKTsKICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsgLy8gQ29udGFjdCBwb2ludHMgYXJlIGluIHdvcmxkIGNvb3JkaW5hdGVzLiBUcmFuc2Zvcm0gYmFjayB0byByZWxhdGl2ZQoKICAgICAgICAgIHJpLnZzdWIoeGksIHJpKTsKICAgICAgICAgIHJqLnZzdWIoeGosIHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAgICAgICByai52YWRkKHhqLCByaik7CiAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgbnVtQ29udGFjdHMrKzsKCiAgICAgICAgICBpZiAoIXRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24pIHsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gJiYgbnVtQ29udGFjdHMpIHsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlQ29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOwogICAgICB4aS52c3ViKHhqLCBjb252ZXhfdG9fc3BoZXJlKTsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNqLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBmYWNlcyA9IHNqLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0cyA9IHNqLnZlcnRpY2VzOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwogICAgICAvLyAgICAgcmV0dXJuOwogICAgICAvLyB9CgogICAgICBsZXQgZm91bmQgPSBmYWxzZTsgLy8gQ2hlY2sgY29ybmVycwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHZlcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ldOyAvLyBXb3JsZCBwb3NpdGlvbiBvZiBjb3JuZXIKCiAgICAgICAgY29uc3Qgd29ybGRDb3JuZXIgPSBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXI7CiAgICAgICAgcWoudm11bHQodiwgd29ybGRDb3JuZXIpOwogICAgICAgIHhqLnZhZGQod29ybGRDb3JuZXIsIHdvcmxkQ29ybmVyKTsKICAgICAgICBjb25zdCBzcGhlcmVfdG9fY29ybmVyID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyOwogICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGksIHNwaGVyZV90b19jb3JuZXIpOwoKICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgci5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuY29weShyLnJpKTsKICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICB3b3JsZENvcm5lci52c3ViKHhqLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBzaWRlIChwbGFuZSkgaW50ZXJzZWN0aW9ucwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBmYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGkrKykgewogICAgICAgIGNvbnN0IG5vcm1hbCA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgZmFjZSA9IGZhY2VzW2ldOyAvLyBHZXQgd29ybGQtdHJhbnNmb3JtZWQgbm9ybWFsIG9mIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gc3BoZXJlQ29udmV4X3dvcmxkTm9ybWFsOwogICAgICAgIHFqLnZtdWx0KG5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBHZXQgYSB3b3JsZCB2ZXJ0ZXggZnJvbSB0aGUgZmFjZQoKICAgICAgICBjb25zdCB3b3JsZFBvaW50ID0gc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQ7CiAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVswXV0sIHdvcmxkUG9pbnQpOwogICAgICAgIHdvcmxkUG9pbnQudmFkZCh4aiwgd29ybGRQb2ludCk7IC8vIEdldCBhIHBvaW50IG9uIHRoZSBzcGhlcmUsIGNsb3Nlc3QgdG8gdGhlIGZhY2Ugbm9ybWFsCgogICAgICAgIGNvbnN0IHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSA9IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmU7CiAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7CiAgICAgICAgeGkudmFkZCh3b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUsIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSk7IC8vIFZlY3RvciBmcm9tIGEgZmFjZSBwb2ludCB0byB0aGUgY2xvc2VzdCBwb2ludCBvbiB0aGUgc3BoZXJlCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjID0gc3BoZXJlQ29udmV4X3BlbmV0cmF0aW9uVmVjOwogICAgICAgIHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZS52c3ViKHdvcmxkUG9pbnQsIHBlbmV0cmF0aW9uVmVjKTsgLy8gVGhlIHBlbmV0cmF0aW9uLiBOZWdhdGl2ZSB2YWx1ZSBtZWFucyBvdmVybGFwLgoKICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uVmVjLmRvdCh3b3JsZE5vcm1hbCk7CiAgICAgICAgY29uc3Qgd29ybGRQb2ludFRvU3BoZXJlID0gc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludDsKICAgICAgICB4aS52c3ViKHdvcmxkUG9pbnQsIHdvcmxkUG9pbnRUb1NwaGVyZSk7CgogICAgICAgIGlmIChwZW5ldHJhdGlvbiA8IDAgJiYgd29ybGRQb2ludFRvU3BoZXJlLmRvdCh3b3JsZE5vcm1hbCkgPiAwKSB7CiAgICAgICAgICAvLyBJbnRlcnNlY3RzIHBsYW5lLiBOb3cgY2hlY2sgaWYgdGhlIHNwaGVyZSBpcyBpbnNpZGUgdGhlIGZhY2UgcG9seWdvbgogICAgICAgICAgY29uc3QgZmFjZVZlcnRzID0gW107IC8vIEZhY2UgdmVydGljZXMsIGluIHdvcmxkIGNvb3JkcwoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOdmVydHMgPSBmYWNlLmxlbmd0aDsgaiAhPT0gTnZlcnRzOyBqKyspIHsKICAgICAgICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2Vbal1dLCB3b3JsZFZlcnRleCk7CiAgICAgICAgICAgIHhqLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgZmFjZVZlcnRzLnB1c2god29ybGRWZXJ0ZXgpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChwb2ludEluUG9seWdvbihmYWNlVmVydHMsIHdvcmxkTm9ybWFsLCB4aSkpIHsKICAgICAgICAgICAgLy8gSXMgdGhlIHNwaGVyZSBjZW50ZXIgaW4gdGhlIGZhY2UgcG9seWdvbj8KICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1SLCByLnJpKTsgLy8gQ29udGFjdCBvZmZzZXQsIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0CgogICAgICAgICAgICB3b3JsZE5vcm1hbC5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBwb2ludGluZyBvdXQgb2Ygc3BoZXJlCgogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblZlYzIgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKC1wZW5ldHJhdGlvbiwgcGVuZXRyYXRpb25WZWMyKTsKICAgICAgICAgICAgY29uc3QgcGVuZXRyYXRpb25TcGhlcmVQb2ludCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOyAvL3hpLnZzdWIoeGopLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCkudmFkZChwZW5ldHJhdGlvblZlYzIgLCByLnJqKTsKCiAgICAgICAgICAgIHhpLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZhZGQocGVuZXRyYXRpb25TcGhlcmVQb2ludCwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblZlYzIsIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShwZW5ldHJhdGlvblNwaGVyZVBvaW50KTsKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOyAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgogICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybjsgLy8gV2Ugb25seSBleHBlY3QgKm9uZSogZmFjZSBjb250YWN0CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFZGdlPwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gZmFjZS5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgIC8vIEdldCB0d28gd29ybGQgdHJhbnNmb3JtZWQgdmVydGljZXMKICAgICAgICAgICAgICBjb25zdCB2MSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMSkgJSBmYWNlLmxlbmd0aF1dLCB2MSk7CiAgICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVsoaiArIDIpICUgZmFjZS5sZW5ndGhdXSwgdjIpOwogICAgICAgICAgICAgIHhqLnZhZGQodjEsIHYxKTsKICAgICAgICAgICAgICB4ai52YWRkKHYyLCB2Mik7IC8vIENvbnN0cnVjdCBlZGdlIHZlY3RvcgoKICAgICAgICAgICAgICBjb25zdCBlZGdlID0gc3BoZXJlQ29udmV4X2VkZ2U7CiAgICAgICAgICAgICAgdjIudnN1Yih2MSwgZWRnZSk7IC8vIENvbnN0cnVjdCB0aGUgc2FtZSB2ZWN0b3IsIGJ1dCBub3JtYWxpemVkCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2VVbml0ID0gc3BoZXJlQ29udmV4X2VkZ2VVbml0OwogICAgICAgICAgICAgIGVkZ2UudW5pdChlZGdlVW5pdCk7IC8vIHAgaXMgeGkgcHJvamVjdGVkIG9udG8gdGhlIGVkZ2UKCiAgICAgICAgICAgICAgY29uc3QgcCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICBjb25zdCB2MV90b194aSA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgICB4aS52c3ViKHYxLCB2MV90b194aSk7CiAgICAgICAgICAgICAgY29uc3QgZG90ID0gdjFfdG9feGkuZG90KGVkZ2VVbml0KTsKICAgICAgICAgICAgICBlZGdlVW5pdC5zY2FsZShkb3QsIHApOwogICAgICAgICAgICAgIHAudmFkZCh2MSwgcCk7IC8vIENvbXB1dGUgYSB2ZWN0b3IgZnJvbSBwIHRvIHRoZSBjZW50ZXIgb2YgdGhlIHNwaGVyZQoKICAgICAgICAgICAgICBjb25zdCB4aV90b19wID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHAudnN1Yih4aSwgeGlfdG9fcCk7IC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAvLyBBTkQgaWYgcCBpcyBpbiBiZXR3ZWVuIHYxIGFuZCB2MgoKICAgICAgICAgICAgICBpZiAoZG90ID4gMCAmJiBkb3QgKiBkb3QgPCBlZGdlLmxlbmd0aFNxdWFyZWQoKSAmJiB4aV90b19wLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICAgICAgICAvLyBDb2xsaXNpb24gaWYgdGhlIGVkZ2Utc3BoZXJlIGRpc3RhbmNlIGlzIGxlc3MgdGhhbiB0aGUgcmFkaXVzCiAgICAgICAgICAgICAgICAvLyBFZGdlIGNvbnRhY3QhCiAgICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGosIHIucmopOwogICAgICAgICAgICAgICAgcC52c3ViKHhpLCByLm5pKTsKICAgICAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgICByLm5pLnNjYWxlKFIsIHIucmkpOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgICAgICAgICAgci5yaS52c3ViKGJpLnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMCwgTmZhY2V2ZXJ0cyA9IGZhY2VWZXJ0cy5sZW5ndGg7IGogIT09IE5mYWNldmVydHM7IGorKykgewogICAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZShmYWNlVmVydHNbal0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYyKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MV90b194aSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2MSk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHhpX3RvX3ApOwogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyBSZWxlYXNlIHdvcmxkIHZlcnRpY2VzCgoKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgcGxhbmVDb252ZXgocGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHBsYW5lUG9zaXRpb24sIGNvbnZleFBvc2l0aW9uLCBwbGFuZVF1YXQsIGNvbnZleFF1YXQsIHBsYW5lQm9keSwgY29udmV4Qm9keSwgc2ksIHNqLCBqdXN0VGVzdCkgewogICAgICAvLyBTaW1wbHkgcmV0dXJuIHRoZSBwb2ludHMgYmVoaW5kIHRoZSBwbGFuZS4KICAgICAgY29uc3Qgd29ybGRWZXJ0ZXggPSBwbGFuZUNvbnZleF92OwogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IHBsYW5lQ29udmV4X25vcm1hbDsKICAgICAgd29ybGROb3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQod29ybGROb3JtYWwsIHdvcmxkTm9ybWFsKTsgLy8gVHVybiBub3JtYWwgYWNjb3JkaW5nIHRvIHBsYW5lIG9yaWVudGF0aW9uCgogICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwogICAgICBjb25zdCByZWxwb3MgPSBwbGFuZUNvbnZleF9yZWxwb3M7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gY29udmV4U2hhcGUudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgY29udmV4IHZlcnRleAogICAgICAgIHdvcmxkVmVydGV4LmNvcHkoY29udmV4U2hhcGUudmVydGljZXNbaV0pOwogICAgICAgIGNvbnZleFF1YXQudm11bHQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICBjb252ZXhQb3NpdGlvbi52YWRkKHdvcmxkVmVydGV4LCB3b3JsZFZlcnRleCk7CiAgICAgICAgd29ybGRWZXJ0ZXgudnN1YihwbGFuZVBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpOwoKICAgICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihwbGFuZUJvZHksIGNvbnZleEJvZHksIHBsYW5lU2hhcGUsIGNvbnZleFNoYXBlLCBzaSwgc2opOyAvLyBHZXQgdmVydGV4IHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBsYW5lQ29udmV4X3Byb2plY3RlZDsKICAgICAgICAgIHdvcmxkTm9ybWFsLnNjYWxlKHdvcmxkTm9ybWFsLmRvdChyZWxwb3MpLCBwcm9qZWN0ZWQpOwogICAgICAgICAgd29ybGRWZXJ0ZXgudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7CiAgICAgICAgICBwcm9qZWN0ZWQudnN1YihwbGFuZVBvc2l0aW9uLCByLnJpKTsgLy8gRnJvbSBwbGFuZSB0byB2ZXJ0ZXggcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgci5uaS5jb3B5KHdvcmxkTm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbCBvdXQgZnJvbSBwbGFuZQogICAgICAgICAgLy8gcmogaXMgbm93IGp1c3QgdGhlIHZlY3RvciBmcm9tIHRoZSBjb252ZXggY2VudGVyIHRvIHRoZSB2ZXJ0ZXgKCiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKGNvbnZleFBvc2l0aW9uLCByLnJqKTsgLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKICAgICAgICAgIHIucmkudmFkZChwbGFuZVBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai52YWRkKGNvbnZleFBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHIucmoudnN1Yihjb252ZXhCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25Gcm9tQXZlcmFnZShudW1Db250YWN0cyk7CiAgICAgIH0KICAgIH0KCiAgICBib3hDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXgoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlSGVpZ2h0ZmllbGQoc3BoZXJlU2hhcGUsIGhmU2hhcGUsIHNwaGVyZVBvcywgaGZQb3MsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgcmFkaXVzID0gc3BoZXJlU2hhcGUucmFkaXVzOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3Qgd29ybGRQaWxsYXJPZmZzZXQgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAyOyAvLyBHZXQgc3BoZXJlIHBvc2l0aW9uIHRvIGhlaWdodGZpZWxkIGxvY2FsIQoKICAgICAgY29uc3QgbG9jYWxTcGhlcmVQb3MgPSBzcGhlcmVIZWlnaHRmaWVsZF90bXAxOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUoaGZQb3MsIGhmUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgaW5kZXggb2YgdGhlIGRhdGEgcG9pbnRzIHRvIHRlc3QgYWdhaW5zdAoKICAgICAgbGV0IGlNaW5YID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueCAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WCA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueCArIHJhZGl1cykgLyB3KSArIDE7CiAgICAgIGxldCBpTWluWSA9IE1hdGguZmxvb3IoKGxvY2FsU3BoZXJlUG9zLnkgLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFkgPSBNYXRoLmNlaWwoKGxvY2FsU3BoZXJlUG9zLnkgKyByYWRpdXMpIC8gdykgKyAxOyAvLyBCYWlsIG91dCBpZiB3ZSBhcmUgb3V0IG9mIHRoZSB0ZXJyYWluCgogICAgICBpZiAoaU1heFggPCAwIHx8IGlNYXhZIDwgMCB8fCBpTWluWCA+IGRhdGEubGVuZ3RoIHx8IGlNaW5ZID4gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gQ2xhbXAgaW5kZXggdG8gZWRnZXMKCgogICAgICBpZiAoaU1pblggPCAwKSB7CiAgICAgICAgaU1pblggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFggPCAwKSB7CiAgICAgICAgaU1heFggPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPCAwKSB7CiAgICAgICAgaU1pblkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPCAwKSB7CiAgICAgICAgaU1heFkgPSAwOwogICAgICB9CgogICAgICBpZiAoaU1pblggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWluWCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1heFggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNYXhZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1pblkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWluWSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgY29uc3QgbWluTWF4ID0gW107CiAgICAgIGhmU2hhcGUuZ2V0UmVjdE1pbk1heChpTWluWCwgaU1pblksIGlNYXhYLCBpTWF4WSwgbWluTWF4KTsKICAgICAgY29uc3QgbWluID0gbWluTWF4WzBdOwogICAgICBjb25zdCBtYXggPSBtaW5NYXhbMV07IC8vIEJhaWwgb3V0IGlmIHdlIGNhbid0IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxTcGhlcmVQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbFNwaGVyZVBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGkgPSBpTWluWDsgaSA8IGlNYXhYOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gaU1pblk7IGogPCBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBudW1Db250YWN0c0JlZm9yZSA9IHJlc3VsdC5sZW5ndGg7CiAgICAgICAgICBsZXQgaW50ZXJzZWN0aW5nID0gZmFsc2U7IC8vIExvd2VyIHRyaWFuZ2xlCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCBmYWxzZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9IC8vIFVwcGVyIHRyaWFuZ2xlCgoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUoaGZQb3MsIGhmUXVhdCwgaGZTaGFwZS5waWxsYXJPZmZzZXQsIHdvcmxkUGlsbGFyT2Zmc2V0KTsKCiAgICAgICAgICBpZiAoc3BoZXJlUG9zLmRpc3RhbmNlVG8od29ybGRQaWxsYXJPZmZzZXQpIDwgaGZTaGFwZS5waWxsYXJDb252ZXguYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzcGhlcmVTaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1cykgewogICAgICAgICAgICBpbnRlcnNlY3RpbmcgPSB0aGlzLnNwaGVyZUNvbnZleChzcGhlcmVTaGFwZSwgaGZTaGFwZS5waWxsYXJDb252ZXgsIHNwaGVyZVBvcywgd29ybGRQaWxsYXJPZmZzZXQsIHNwaGVyZVF1YXQsIGhmUXVhdCwgc3BoZXJlQm9keSwgaGZCb2R5LCBzcGhlcmVTaGFwZSwgaGZTaGFwZSwganVzdFRlc3QpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChqdXN0VGVzdCAmJiBpbnRlcnNlY3RpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbnVtQ29udGFjdHMgPSByZXN1bHQubGVuZ3RoIC0gbnVtQ29udGFjdHNCZWZvcmU7CgogICAgICAgICAgaWYgKG51bUNvbnRhY3RzID4gMikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvKgogICAgICAgICAgICAvLyBTa2lwIGFsbCBidXQgMQogICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IG51bUNvbnRhY3RzIC0gMTsgaysrKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICovCgogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGJveEhlaWdodGZpZWxkKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgZGF0YSA9IGhmU2hhcGUuZGF0YTsKICAgICAgY29uc3QgdyA9IGhmU2hhcGUuZWxlbWVudFNpemU7CiAgICAgIGNvbnN0IHJhZGl1cyA9IGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDI7CiAgICAgIGNvbnN0IGZhY2VMaXN0ID0gY29udmV4SGVpZ2h0ZmllbGRfZmFjZUxpc3Q7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbENvbnZleFBvcyA9IGNvbnZleEhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBjb252ZXhQb3MsIGxvY2FsQ29udmV4UG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxDb252ZXhQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxDb252ZXhQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UncmUgY2FudCB0b3VjaCB0aGUgYm91bmRpbmcgaGVpZ2h0IGJveAoKICAgICAgaWYgKGxvY2FsQ29udmV4UG9zLnogLSByYWRpdXMgPiBtYXggfHwgbG9jYWxDb252ZXhQb3MueiArIHJhZGl1cyA8IG1pbikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChjb252ZXhQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIGNvbnZleFNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuY29udmV4Q29udmV4KGNvbnZleFNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgY29udmV4UG9zLCB3b3JsZFBpbGxhck9mZnNldCwgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIG51bGwsIG51bGwsIGp1c3RUZXN0LCBmYWNlTGlzdCwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICAvLyBUaGUgbm9ybWFsIGlzIHRoZSB1bml0IHZlY3RvciBmcm9tIHNwaGVyZSBjZW50ZXIgdG8gcGFydGljbGUgY2VudGVyCiAgICAgIGNvbnN0IG5vcm1hbCA9IHBhcnRpY2xlU3BoZXJlX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgeGkudnN1Yih4aiwgbm9ybWFsKTsKICAgICAgY29uc3QgbGVuZ3RoU3F1YXJlZCA9IG5vcm1hbC5sZW5ndGhTcXVhcmVkKCk7CgogICAgICBpZiAobGVuZ3RoU3F1YXJlZCA8PSBzai5yYWRpdXMgKiBzai5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICAgIHIucmouY29weShub3JtYWwpOwogICAgICAgIHIucmouc2NhbGUoc2oucmFkaXVzLCByLnJqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAgICAgci5yaS5zZXQoMCwgMCwgMCk7IC8vIENlbnRlciBvZiBwYXJ0aWNsZQoKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIHBsYW5lUGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVQbGFuZV9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIGJqLnF1YXRlcm5pb24udm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGNvbnN0IHJlbHBvcyA9IHBhcnRpY2xlUGxhbmVfcmVscG9zOwogICAgICB4aS52c3ViKGJqLnBvc2l0aW9uLCByZWxwb3MpOwogICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICBpZiAoZG90IDw9IDAuMCkgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCiAgICAgICAgLy8gR2V0IHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCBvbiBwbGFuZQoKICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZDsKICAgICAgICBub3JtYWwuc2NhbGUobm9ybWFsLmRvdCh4aSksIHByb2plY3RlZCk7CiAgICAgICAgeGkudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vcHJvamVjdGVkLnZhZGQoYmoucG9zaXRpb24scHJvamVjdGVkKTsKICAgICAgICAvLyByaiBpcyBub3cgdGhlIHByb2plY3RlZCB3b3JsZCBwb3NpdGlvbiBtaW51cyBwbGFuZSBwb3NpdGlvbgoKICAgICAgICByLnJqLmNvcHkocHJvamVjdGVkKTsKICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgfQogICAgfQoKICAgIGJveFBhcnRpY2xlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNpLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgbGV0IHBlbmV0cmF0ZWRGYWNlSW5kZXggPSAtMTsKICAgICAgY29uc3QgcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBjb252ZXhQYXJ0aWNsZV9wZW5ldHJhdGVkRmFjZU5vcm1hbDsKICAgICAgY29uc3Qgd29ybGRQZW5ldHJhdGlvblZlYyA9IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWM7CiAgICAgIGxldCBtaW5QZW5ldHJhdGlvbiA9IG51bGw7CgogICAgICBjb25zdCBsb2NhbCA9IGNvbnZleFBhcnRpY2xlX2xvY2FsOwogICAgICBsb2NhbC5jb3B5KHhpKTsKICAgICAgbG9jYWwudnN1Yih4aiwgbG9jYWwpOyAvLyBDb252ZXJ0IHBvc2l0aW9uIHRvIHJlbGF0aXZlIHRoZSBjb252ZXggb3JpZ2luCgogICAgICBxai5jb25qdWdhdGUoY3FqKTsKICAgICAgY3FqLnZtdWx0KGxvY2FsLCBsb2NhbCk7CgogICAgICBpZiAoc2oucG9pbnRJc0luc2lkZShsb2NhbCkpIHsKICAgICAgICBpZiAoc2oud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRWZXJ0aWNlcyh4aiwgcWopOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNqLndvcmxkRmFjZU5vcm1hbHNOZWVkc1VwZGF0ZSkgewogICAgICAgICAgc2ouY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocWopOwogICAgICAgIH0gLy8gRm9yIGVhY2ggd29ybGQgcG9seWdvbiBpbiB0aGUgcG9seWhlZHJhCgoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbmZhY2VzID0gc2ouZmFjZXMubGVuZ3RoOyBpICE9PSBuZmFjZXM7IGkrKykgewogICAgICAgICAgLy8gQ29uc3RydWN0IHdvcmxkIGZhY2UgdmVydGljZXMKICAgICAgICAgIGNvbnN0IHZlcnRzID0gW3NqLndvcmxkVmVydGljZXNbc2ouZmFjZXNbaV1bMF1dXTsKICAgICAgICAgIGNvbnN0IG5vcm1hbCA9IHNqLndvcmxkRmFjZU5vcm1hbHNbaV07IC8vIENoZWNrIGhvdyBtdWNoIHRoZSBwYXJ0aWNsZSBwZW5ldHJhdGVzIHRoZSBwb2x5Z29uIHBsYW5lLgoKICAgICAgICAgIHhpLnZzdWIodmVydHNbMF0sIGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwogICAgICAgICAgY29uc3QgcGVuZXRyYXRpb24gPSAtbm9ybWFsLmRvdChjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlKTsKCiAgICAgICAgICBpZiAobWluUGVuZXRyYXRpb24gPT09IG51bGwgfHwgTWF0aC5hYnMocGVuZXRyYXRpb24pIDwgTWF0aC5hYnMobWluUGVuZXRyYXRpb24pKSB7CiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtaW5QZW5ldHJhdGlvbiA9IHBlbmV0cmF0aW9uOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZUluZGV4ID0gaTsKICAgICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuY29weShub3JtYWwpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHBlbmV0cmF0ZWRGYWNlSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAvLyBTZXR1cCBjb250YWN0CiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLnNjYWxlKG1pblBlbmV0cmF0aW9uLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsgLy8gcmogaXMgdGhlIHBhcnRpY2xlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgZmFjZQoKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudmFkZCh4aSwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICB3b3JsZFBlbmV0cmF0aW9uVmVjLnZzdWIoeGosIHdvcmxkUGVuZXRyYXRpb25WZWMpOwogICAgICAgICAgci5yai5jb3B5KHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvL2NvbnN0IHByb2plY3RlZFRvRmFjZSA9IHhpLnZzdWIoeGopLnZhZGQod29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICAvL3Byb2plY3RlZFRvRmFjZS5jb3B5KHIucmopOwogICAgICAgICAgLy9xai52bXVsdChyLnJqLHIucmopOwoKICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gQ29udGFjdCBub3JtYWwKCiAgICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgICAgY29uc3QgcmogPSByLnJqOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2FybignUG9pbnQgZm91bmQgaW5zaWRlIGNvbnZleCwgYnV0IGRpZCBub3QgZmluZCBwZW5ldHJhdGluZyBmYWNlIScpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGhlaWdodGZpZWxkQ3lsaW5kZXIoaGZTaGFwZSwgY29udmV4U2hhcGUsIGhmUG9zLCBjb252ZXhQb3MsIGhmUXVhdCwgY29udmV4UXVhdCwgaGZCb2R5LCBjb252ZXhCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4SGVpZ2h0ZmllbGQoY29udmV4U2hhcGUsIGhmU2hhcGUsIGNvbnZleFBvcywgaGZQb3MsIGNvbnZleFF1YXQsIGhmUXVhdCwgY29udmV4Qm9keSwgaGZCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHBhcnRpY2xlQ3lsaW5kZXIoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4UGFydGljbGUoc2osIHNpLCB4aiwgeGksIHFqLCBxaSwgYmosIGJpLCByc2ksIHJzaiwganVzdFRlc3QpOwogICAgfQoKICAgIHNwaGVyZVRyaW1lc2goc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgc3BoZXJlUG9zLCB0cmltZXNoUG9zLCBzcGhlcmVRdWF0LCB0cmltZXNoUXVhdCwgc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBlZGdlVmVydGV4QSA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEE7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhCID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QjsKICAgICAgY29uc3QgZWRnZVZlY3RvciA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvcjsKICAgICAgY29uc3QgZWRnZVZlY3RvclVuaXQgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0OwogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVQb3M7CiAgICAgIGNvbnN0IHRtcCA9IHNwaGVyZVRyaW1lc2hfdG1wOwogICAgICBjb25zdCBsb2NhbFNwaGVyZUFBQkIgPSBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlQUFCQjsKICAgICAgY29uc3QgdjIgPSBzcGhlcmVUcmltZXNoX3YyOwogICAgICBjb25zdCByZWxwb3MgPSBzcGhlcmVUcmltZXNoX3JlbHBvczsKICAgICAgY29uc3QgdHJpYW5nbGVzID0gc3BoZXJlVHJpbWVzaF90cmlhbmdsZXM7IC8vIENvbnZlcnQgc3BoZXJlIHBvc2l0aW9uIHRvIGxvY2FsIGluIHRoZSB0cmltZXNoCgogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHNwaGVyZVBvcywgbG9jYWxTcGhlcmVQb3MpOyAvLyBHZXQgdGhlIGFhYmIgb2YgdGhlIHNwaGVyZSBsb2NhbGx5IGluIHRoZSB0cmltZXNoCgogICAgICBjb25zdCBzcGhlcmVSYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGxvY2FsU3BoZXJlQUFCQi5sb3dlckJvdW5kLnNldChsb2NhbFNwaGVyZVBvcy54IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy55IC0gc3BoZXJlUmFkaXVzLCBsb2NhbFNwaGVyZVBvcy56IC0gc3BoZXJlUmFkaXVzKTsKICAgICAgbG9jYWxTcGhlcmVBQUJCLnVwcGVyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgKyBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogKyBzcGhlcmVSYWRpdXMpOwogICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVzSW5BQUJCKGxvY2FsU3BoZXJlQUFCQiwgdHJpYW5nbGVzKTsgLy9mb3IgKGxldCBpID0gMDsgaSA8IHRyaW1lc2hTaGFwZS5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgdHJpYW5nbGVzLnB1c2goaSk7IC8vIEFsbAogICAgICAvLyBWZXJ0aWNlcwoKICAgICAgY29uc3QgdiA9IHNwaGVyZVRyaW1lc2hfdjsKICAgICAgY29uc3QgcmFkaXVzU3F1YXJlZCA9IHNwaGVyZVNoYXBlLnJhZGl1cyAqIHNwaGVyZVNoYXBlLnJhZGl1czsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCB2KTsgLy8gQ2hlY2sgdmVydGV4IG92ZXJsYXAgaW4gc3BoZXJlCgogICAgICAgICAgdi52c3ViKGxvY2FsU3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgIGlmIChyZWxwb3MubGVuZ3RoU3F1YXJlZCgpIDw9IHJhZGl1c1NxdWFyZWQpIHsKICAgICAgICAgICAgLy8gU2FmZSB1cAogICAgICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsKICAgICAgICAgICAgdi52c3ViKHNwaGVyZVBvcywgcmVscG9zKTsKCiAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHNwaGVyZUJvZHksIHRyaW1lc2hCb2R5LCBzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICAgIHIubmkuY29weShyZWxwb3MpOwogICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOyAvLyByaSBpcyB0aGUgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byB0aGUgc3BoZXJlIHN1cmZhY2UKCiAgICAgICAgICAgIHIucmkuY29weShyLm5pKTsKICAgICAgICAgICAgci5yaS5zY2FsZShzcGhlcmVTaGFwZS5yYWRpdXMsIHIucmkpOwogICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICByLnJqLmNvcHkodik7CiAgICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDaGVjayBhbGwgZWRnZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRyaWFuZ2xlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMzsgaisrKSB7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyBqXSwgZWRnZVZlcnRleEEpOwogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgKGogKyAxKSAlIDNdLCBlZGdlVmVydGV4Qik7CiAgICAgICAgICBlZGdlVmVydGV4Qi52c3ViKGVkZ2VWZXJ0ZXhBLCBlZGdlVmVjdG9yKTsgLy8gUHJvamVjdCBzcGhlcmUgcG9zaXRpb24gdG8gdGhlIGVkZ2UKCiAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhCLCB0bXApOwogICAgICAgICAgY29uc3QgcG9zaXRpb25BbG9uZ0VkZ2VCID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICBsZXQgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yKTsKCiAgICAgICAgICBpZiAocG9zaXRpb25BbG9uZ0VkZ2VBID4gMCAmJiBwb3NpdGlvbkFsb25nRWRnZUIgPCAwKSB7CiAgICAgICAgICAgIC8vIE5vdyBjaGVjayB0aGUgb3J0aG9nb25hbCBkaXN0YW5jZSBmcm9tIGVkZ2UgdG8gc3BoZXJlIGNlbnRlcgogICAgICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKGVkZ2VWZXJ0ZXhBLCB0bXApOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5jb3B5KGVkZ2VWZWN0b3IpOwogICAgICAgICAgICBlZGdlVmVjdG9yVW5pdC5ub3JtYWxpemUoKTsKICAgICAgICAgICAgcG9zaXRpb25BbG9uZ0VkZ2VBID0gdG1wLmRvdChlZGdlVmVjdG9yVW5pdCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LnNjYWxlKHBvc2l0aW9uQWxvbmdFZGdlQSwgdG1wKTsKICAgICAgICAgICAgdG1wLnZhZGQoZWRnZVZlcnRleEEsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBjZW50ZXIgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBlZGdlLCBkZWZpbmVkIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2ggZnJhbWUKCiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgICAgICBpZiAoZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgICB0bXAudnN1Yihsb2NhbFNwaGVyZVBvcywgci5uaSk7CiAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52YWRkKHNwaGVyZVBvcywgci5yaSk7CiAgICAgICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgICAgIHRtcC52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBUcmlhbmdsZSBmYWNlcwoKCiAgICAgIGNvbnN0IHZhID0gc3BoZXJlVHJpbWVzaF92YTsKICAgICAgY29uc3QgdmIgPSBzcGhlcmVUcmltZXNoX3ZiOwogICAgICBjb25zdCB2YyA9IHNwaGVyZVRyaW1lc2hfdmM7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHNwaGVyZVRyaW1lc2hfbm9ybWFsOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VHJpYW5nbGVWZXJ0aWNlcyh0cmlhbmdsZXNbaV0sIHZhLCB2YiwgdmMpOwogICAgICAgIHRyaW1lc2hTaGFwZS5nZXROb3JtYWwodHJpYW5nbGVzW2ldLCBub3JtYWwpOwogICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIodmEsIHRtcCk7CiAgICAgICAgbGV0IGRpc3QgPSB0bXAuZG90KG5vcm1hbCk7CiAgICAgICAgbm9ybWFsLnNjYWxlKGRpc3QsIHRtcCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih0bXAsIHRtcCk7IC8vIHRtcCBpcyBub3cgdGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIHRyaWFuZ2xlIHBsYW5lCgogICAgICAgIGRpc3QgPSB0bXAuZGlzdGFuY2VUbyhsb2NhbFNwaGVyZVBvcyk7CgogICAgICAgIGlmIChSYXkucG9pbnRJblRyaWFuZ2xlKHRtcCwgdmEsIHZiLCB2YykgJiYgZGlzdCA8IHNwaGVyZVNoYXBlLnJhZGl1cykgewogICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7CiAgICAgICAgICByLm5pLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihzcGhlcmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdG1wLCB0bXApOwogICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZSh0cmltZXNoUXVhdCwgci5uaSwgci5uaSk7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLnJpLCByLnJpKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KCiAgICBwbGFuZVRyaW1lc2gocGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBwbGFuZVBvcywgdHJpbWVzaFBvcywgcGxhbmVRdWF0LCB0cmltZXNoUXVhdCwgcGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIE1ha2UgY29udGFjdHMhCiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBub3JtYWwgPSBwbGFuZVRyaW1lc2hfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICBwbGFuZVF1YXQudm11bHQobm9ybWFsLCBub3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLnZlcnRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCB2ZXJ0ZXggZnJvbSB0cmltZXNoCiAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleChpLCB2KTsgLy8gU2FmZSB1cAoKICAgICAgICBjb25zdCB2MiA9IG5ldyBWZWMzKCk7CiAgICAgICAgdjIuY29weSh2KTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodHJpbWVzaFBvcywgdHJpbWVzaFF1YXQsIHYyLCB2KTsgLy8gQ2hlY2sgcGxhbmUgc2lkZQoKICAgICAgICBjb25zdCByZWxwb3MgPSBwbGFuZVRyaW1lc2hfcmVscG9zOwogICAgICAgIHYudnN1YihwbGFuZVBvcywgcmVscG9zKTsKICAgICAgICBjb25zdCBkb3QgPSBub3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgdHJpbWVzaEJvZHksIHBsYW5lU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgci5uaS5jb3B5KG5vcm1hbCk7IC8vIENvbnRhY3Qgbm9ybWFsIGlzIHRoZSBwbGFuZSBub3JtYWwKICAgICAgICAgIC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVUcmltZXNoX3Byb2plY3RlZDsKICAgICAgICAgIG5vcm1hbC5zY2FsZShyZWxwb3MuZG90KG5vcm1hbCksIHByb2plY3RlZCk7CiAgICAgICAgICB2LnZzdWIocHJvamVjdGVkLCBwcm9qZWN0ZWQpOyAvLyByaSBpcyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgICAgci5yaS5jb3B5KHByb2plY3RlZCk7CiAgICAgICAgICByLnJpLnZzdWIocGxhbmVCb2R5LnBvc2l0aW9uLCByLnJpKTsKICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgIHIucmoudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7IC8vIFN0b3JlIHJlc3VsdAoKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgfQogICAgICB9CiAgICB9IC8vIGNvbnZleFRyaW1lc2goCiAgICAvLyAgIHNpOiBDb252ZXhQb2x5aGVkcm9uLCBzajogVHJpbWVzaCwgeGk6IFZlYzMsIHhqOiBWZWMzLCBxaTogUXVhdGVybmlvbiwgcWo6IFF1YXRlcm5pb24sCiAgICAvLyAgIGJpOiBCb2R5LCBiajogQm9keSwgcnNpPzogU2hhcGUgfCBudWxsLCByc2o/OiBTaGFwZSB8IG51bGwsCiAgICAvLyAgIGZhY2VMaXN0QT86IG51bWJlcltdIHwgbnVsbCwgZmFjZUxpc3RCPzogbnVtYmVyW10gfCBudWxsLAogICAgLy8gKSB7CiAgICAvLyAgIGNvbnN0IHNlcEF4aXMgPSBjb252ZXhDb252ZXhfc2VwQXhpczsKICAgIC8vICAgaWYoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKXsKICAgIC8vICAgICAgIHJldHVybjsKICAgIC8vICAgfQogICAgLy8gICAvLyBDb25zdHJ1Y3QgYSB0ZW1wIGh1bGwgZm9yIGVhY2ggdHJpYW5nbGUKICAgIC8vICAgY29uc3QgaHVsbEIgPSBuZXcgQ29udmV4UG9seWhlZHJvbigpOwogICAgLy8gICBodWxsQi5mYWNlcyA9IFtbMCwxLDJdXTsKICAgIC8vICAgY29uc3QgdmEgPSBuZXcgVmVjMygpOwogICAgLy8gICBjb25zdCB2YiA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICAgIC8vICAgaHVsbEIudmVydGljZXMgPSBbCiAgICAvLyAgICAgICB2YSwKICAgIC8vICAgICAgIHZiLAogICAgLy8gICAgICAgdmMKICAgIC8vICAgXTsKICAgIC8vICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzai5pbmRpY2VzLmxlbmd0aCAvIDM7IGkrKykgewogICAgLy8gICAgICAgY29uc3QgdHJpYW5nbGVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgLy8gICAgICAgc2ouZ2V0Tm9ybWFsKGksIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgIGh1bGxCLmZhY2VOb3JtYWxzID0gW3RyaWFuZ2xlTm9ybWFsXTsKICAgIC8vICAgICAgIHNqLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgdmEsIHZiLCB2Yyk7CiAgICAvLyAgICAgICBsZXQgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgIHRyaWFuZ2xlTm9ybWFsLnNjYWxlKC0xLCB0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgZCA9IHNpLnRlc3RTZXBBeGlzKHRyaWFuZ2xlTm9ybWFsLCBodWxsQiwgeGksIHFpLCB4aiwgcWopOwogICAgLy8gICAgICAgICAgIGlmKCFkKXsKICAgIC8vICAgICAgICAgICAgICAgY29udGludWU7CiAgICAvLyAgICAgICAgICAgfQogICAgLy8gICAgICAgfQogICAgLy8gICAgICAgY29uc3QgcmVzOiBDb252ZXhQb2x5aGVkcm9uQ29udGFjdFBvaW50W10gPSBbXTsKICAgIC8vICAgICAgIGNvbnN0IHEgPSBjb252ZXhDb252ZXhfcTsKICAgIC8vICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSxxaSxodWxsQix4aixxaix0cmlhbmdsZU5vcm1hbCwtMTAwLDEwMCxyZXMpOwogICAgLy8gICAgICAgZm9yKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKXsKICAgIC8vICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksYmosc2ksc2oscnNpLHJzaiksCiAgICAvLyAgICAgICAgICAgICAgIHJpID0gci5yaSwKICAgIC8vICAgICAgICAgICAgICAgcmogPSByLnJqOwogICAgLy8gICAgICAgICAgIHIubmkuY29weSh0cmlhbmdsZU5vcm1hbCk7CiAgICAvLyAgICAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLm5vcm1hbC5uZWdhdGUocSk7CiAgICAvLyAgICAgICAgICAgcS5tdWx0KHJlc1tqXS5kZXB0aCwgcSk7CiAgICAvLyAgICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLmNvcHkocmVzW2pdLnBvaW50KTsKICAgIC8vICAgICAgICAgICAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCiAgICAvLyAgICAgICAgICAgcmkudnN1Yih4aSxyaSk7CiAgICAvLyAgICAgICAgICAgcmoudnN1Yih4aixyaik7CiAgICAvLyAgICAgICAgICAgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKICAgIC8vICAgICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAvLyAgICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgLy8gICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgIC8vICAgICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAvLyAgICAgICAgICAgcmVzdWx0LnB1c2gocik7CiAgICAvLyAgICAgICB9CiAgICAvLyAgIH0KICAgIC8vIH0KCgogIH0KICBjb25zdCBhdmVyYWdlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXZlcmFnZUNvbnRhY3RQb2ludEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQxID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCB0bXBRdWF0MiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogIGNvbnN0IHBsYW5lVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9yZWxwb3MgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lVHJpbWVzaF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdjIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlcnRleEIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF90bXAgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdmMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlcyA9IFtdOwogIGNvbnN0IHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVfdG9fc3BoZXJlX29ydGhvID0gbmV3IFZlYzMoKTsgLy8gU2VlIGh0dHA6Ly9idWxsZXRwaHlzaWNzLmNvbS9CdWxsZXQvQnVsbGV0RnVsbC9TcGhlcmVUcmlhbmdsZURldGVjdG9yXzhjcHBfc291cmNlLmh0bWwKCiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcG9pbnRJblBvbHlnb25fdnRwID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gcG9pbnRJblBvbHlnb24odmVydHMsIG5vcm1hbCwgcCkgewogICAgbGV0IHBvc2l0aXZlUmVzdWx0ID0gbnVsbDsKICAgIGNvbnN0IE4gPSB2ZXJ0cy5sZW5ndGg7CgogICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIEdldCBlZGdlIHRvIHRoZSBuZXh0IHZlcnRleAoKICAgICAgY29uc3QgZWRnZSA9IHBvaW50SW5Qb2x5Z29uX2VkZ2U7CiAgICAgIHZlcnRzWyhpICsgMSkgJSBOXS52c3ViKHYsIGVkZ2UpOyAvLyBHZXQgY3Jvc3MgcHJvZHVjdCBiZXR3ZWVuIHBvbHlnb24gbm9ybWFsIGFuZCB0aGUgZWRnZQoKICAgICAgY29uc3QgZWRnZV94X25vcm1hbCA9IHBvaW50SW5Qb2x5Z29uX2VkZ2VfeF9ub3JtYWw7IC8vY29uc3QgZWRnZV94X25vcm1hbCA9IG5ldyBWZWMzKCk7CgogICAgICBlZGdlLmNyb3NzKG5vcm1hbCwgZWRnZV94X25vcm1hbCk7IC8vIEdldCB2ZWN0b3IgYmV0d2VlbiBwb2ludCBhbmQgY3VycmVudCB2ZXJ0ZXgKCiAgICAgIGNvbnN0IHZlcnRleF90b19wID0gcG9pbnRJblBvbHlnb25fdnRwOwogICAgICBwLnZzdWIodiwgdmVydGV4X3RvX3ApOyAvLyBUaGlzIGRvdCBwcm9kdWN0IGRldGVybWluZXMgd2hpY2ggc2lkZSBvZiB0aGUgZWRnZSB0aGUgcG9pbnQgaXMKCiAgICAgIGNvbnN0IHIgPSBlZGdlX3hfbm9ybWFsLmRvdCh2ZXJ0ZXhfdG9fcCk7IC8vIElmIGFsbCBzdWNoIGRvdCBwcm9kdWN0cyBoYXZlIHNhbWUgc2lnbiwgd2UgYXJlIGluc2lkZSB0aGUgcG9seWdvbi4KCiAgICAgIGlmIChwb3NpdGl2ZVJlc3VsdCA9PT0gbnVsbCB8fCByID4gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gdHJ1ZSB8fCByIDw9IDAgJiYgcG9zaXRpdmVSZXN1bHQgPT09IGZhbHNlKSB7CiAgICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsKSB7CiAgICAgICAgICBwb3NpdGl2ZVJlc3VsdCA9IHIgPiAwOwogICAgICAgIH0KCiAgICAgICAgY29udGludWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBFbmNvdW50ZXJlZCBzb21lIG90aGVyIHNpZ24uIEV4aXQuCiAgICAgIH0KICAgIH0gLy8gSWYgd2UgZ290IGhlcmUsIGFsbCBkb3QgcHJvZHVjdHMgd2VyZSBvZiB0aGUgc2FtZSBzaWduLgoKCiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIGNvbnN0IGJveF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwogIGNvbnN0IHNwaGVyZUJveF9zcGhlcmVfdG9fY29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9ucyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X3NpZGVfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleF90b19zcGhlcmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfZWRnZVVuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb0Nvcm5lciA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9zcGhlcmVUb1dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF92ID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcHJvamVjdGVkID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfc2VwQXhpcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4Q29udmV4X3EgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlU3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7IC8vIFdJUAoKICBjb25zdCBjcWogPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX2xvY2FsID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV92ZXJ0ZXhUb1BhcnRpY2xlID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhQYXJ0aWNsZV93b3JsZFBlbmV0cmF0aW9uVmVjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdCA9IFswXTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVIZWlnaHRmaWVsZF90bXAyID0gbmV3IFZlYzMoKTsKCiAgY2xhc3MgT3ZlcmxhcEtlZXBlciB7CiAgICAvKioKICAgICAqIEB0b2RvIFJlbW92ZSB1c2VsZXNzIGNvbnN0cnVjdG9yCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLmN1cnJlbnQgPSBbXTsKICAgICAgdGhpcy5wcmV2aW91cyA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiBnZXRLZXkKICAgICAqLwoKCiAgICBnZXRLZXkoaSwgaikgewogICAgICBpZiAoaiA8IGkpIHsKICAgICAgICBjb25zdCB0ZW1wID0gajsKICAgICAgICBqID0gaTsKICAgICAgICBpID0gdGVtcDsKICAgICAgfQoKICAgICAgcmV0dXJuIGkgPDwgMTYgfCBqOwogICAgfQogICAgLyoqCiAgICAgKiBzZXQKICAgICAqLwoKCiAgICBzZXQoaSwgaikgewogICAgICAvLyBJbnNlcnRpb24gc29ydC4gVGhpcyB3YXkgdGhlIGRpZmYgd2lsbCBoYXZlIGxpbmVhciBjb21wbGV4aXR5LgogICAgICBjb25zdCBrZXkgPSB0aGlzLmdldEtleShpLCBqKTsKICAgICAgY29uc3QgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICAgICAgbGV0IGluZGV4ID0gMDsKCiAgICAgIHdoaWxlIChrZXkgPiBjdXJyZW50W2luZGV4XSkgewogICAgICAgIGluZGV4Kys7CiAgICAgIH0KCiAgICAgIGlmIChrZXkgPT09IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgcmV0dXJuOyAvLyBQYWlyIHdhcyBhbHJlYWR5IGFkZGVkCiAgICAgIH0KCiAgICAgIGZvciAobGV0IGogPSBjdXJyZW50Lmxlbmd0aCAtIDE7IGogPj0gaW5kZXg7IGotLSkgewogICAgICAgIGN1cnJlbnRbaiArIDFdID0gY3VycmVudFtqXTsKICAgICAgfQoKICAgICAgY3VycmVudFtpbmRleF0gPSBrZXk7CiAgICB9CiAgICAvKioKICAgICAqIHRpY2sKICAgICAqLwoKCiAgICB0aWNrKCkgewogICAgICBjb25zdCB0bXAgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMucHJldmlvdXM7CiAgICAgIHRoaXMucHJldmlvdXMgPSB0bXA7CiAgICAgIHRoaXMuY3VycmVudC5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBnZXREaWZmCiAgICAgKi8KCgogICAgZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmN1cnJlbnQ7CiAgICAgIGNvbnN0IGIgPSB0aGlzLnByZXZpb3VzOwogICAgICBjb25zdCBhbCA9IGEubGVuZ3RoOwogICAgICBjb25zdCBibCA9IGIubGVuZ3RoOwogICAgICBsZXQgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlBID0gYVtpXTsKCiAgICAgICAgd2hpbGUgKGtleUEgPiBiW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGtleUEgPT09IGJbal07CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2goYWRkaXRpb25zLCBrZXlBKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGogPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBibDsgaSsrKSB7CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgY29uc3Qga2V5QiA9IGJbaV07CgogICAgICAgIHdoaWxlIChrZXlCID4gYVtqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KCiAgICAgICAgZm91bmQgPSBhW2pdID09PSBrZXlCOwoKICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICB1bnBhY2tBbmRQdXNoKHJlbW92YWxzLCBrZXlCKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQoKICBmdW5jdGlvbiB1bnBhY2tBbmRQdXNoKGFycmF5LCBrZXkpIHsKICAgIGFycmF5LnB1c2goKGtleSAmIDB4ZmZmZjAwMDApID4+IDE2LCBrZXkgJiAweDAwMDBmZmZmKTsKICB9CgogIGNvbnN0IGdldEtleSA9IChpLCBqKSA9PiBpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWA7CiAgLyoqCiAgICogVHVwbGVEaWN0aW9uYXJ5CiAgICovCgoKICBjbGFzcyBUdXBsZURpY3Rpb25hcnkgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZGF0YSA9IHsKICAgICAgICBrZXlzOiBbXQogICAgICB9OwogICAgfQoKICAgIC8qKiBnZXQgKi8KICAgIGdldChpLCBqKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsKICAgICAgcmV0dXJuIHRoaXMuZGF0YVtrZXldOwogICAgfQogICAgLyoqIHNldCAqLwoKCiAgICBzZXQoaSwgaiwgdmFsdWUpIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOyAvLyBDaGVjayBpZiBrZXkgYWxyZWFkeSBleGlzdHMKCiAgICAgIGlmICghdGhpcy5nZXQoaSwgaikpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5wdXNoKGtleSk7CiAgICAgIH0KCiAgICAgIHRoaXMuZGF0YVtrZXldID0gdmFsdWU7CiAgICB9CiAgICAvKiogZGVsZXRlICovCgoKICAgIGRlbGV0ZShpLCBqKSB7CiAgICAgIGNvbnN0IGtleSA9IGdldEtleShpLCBqKTsKICAgICAgY29uc3QgaW5kZXggPSB0aGlzLmRhdGEua2V5cy5pbmRleE9mKGtleSk7CgogICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgdGhpcy5kYXRhLmtleXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQoKICAgICAgZGVsZXRlIHRoaXMuZGF0YVtrZXldOwogICAgfQogICAgLyoqIHJlc2V0ICovCgoKICAgIHJlc2V0KCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBrZXlzID0gZGF0YS5rZXlzOwoKICAgICAgd2hpbGUgKGtleXMubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IGtleSA9IGtleXMucG9wKCk7CiAgICAgICAgZGVsZXRlIGRhdGFba2V5XTsKICAgICAgfQogICAgfQoKICB9CgogIC8qKgogICAqIFRoZSBwaHlzaWNzIHdvcmxkCiAgICovCiAgY2xhc3MgV29ybGQgZXh0ZW5kcyBFdmVudFRhcmdldCB7CiAgICAvKioKICAgICAqIEN1cnJlbnRseSAvIGxhc3QgdXNlZCB0aW1lc3RlcC4gSXMgc2V0IHRvIC0xIGlmIG5vdCBhdmFpbGFibGUuIFRoaXMgdmFsdWUgaXMgdXBkYXRlZCBiZWZvcmUgZWFjaCBpbnRlcm5hbCBzdGVwLCB3aGljaCBtZWFucyB0aGF0IGl0IGlzICJmcmVzaCIgaW5zaWRlIGV2ZW50IGNhbGxiYWNrcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTWFrZXMgYm9kaWVzIGdvIHRvIHNsZWVwIHdoZW4gdGhleSd2ZSBiZWVuIGluYWN0aXZlLgogICAgICogQGRlZmF1bHQgZmFsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIHRoZSBjdXJyZW50IGNvbnRhY3RzIChpbnN0YW5jZXMgb2YgQ29udGFjdEVxdWF0aW9uKSBpbiB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEhvdyBvZnRlbiB0byBub3JtYWxpemUgcXVhdGVybmlvbnMuIFNldCB0byAwIGZvciBldmVyeSBzdGVwLCAxIGZvciBldmVyeSBzZWNvbmQgZXRjLi4gQSBsYXJnZXIgdmFsdWUgaW5jcmVhc2VzIHBlcmZvcm1hbmNlLiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gYSBzbWFsbGVyIHZhbHVlICh6ZXJvIHRvIGJlIHN1cmUgbm90aGluZyBjYW4gZ28gd3JvbmcpLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBTZXQgdG8gdHJ1ZSB0byB1c2UgZmFzdCBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24uIEl0IGlzIG9mdGVuIGVub3VnaCBhY2N1cmF0ZSB0byB1c2UuCiAgICAgKiBJZiBib2RpZXMgdGVuZCB0byBleHBsb2RlLCBzZXQgdG8gZmFsc2UuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgd2FsbC1jbG9jayB0aW1lIHNpbmNlIHNpbXVsYXRpb24gc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE51bWJlciBvZiB0aW1lc3RlcHMgdGFrZW4gc2luY2Ugc3RhcnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERlZmF1bHQgYW5kIGxhc3QgdGltZXN0ZXAgc2l6ZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBncmF2aXR5IG9mIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogR3Jhdml0eSB0byB1c2Ugd2hlbiBhcHByb3hpbWF0aW5nIHRoZSBmcmljdGlvbiBtYXggZm9yY2UgKG11Km1hc3MqZ3Jhdml0eSkuCiAgICAgKiBJZiB1bmRlZmluZWQsIGdsb2JhbCBncmF2aXR5IHdpbGwgYmUgdXNlZC4KICAgICAqIFVzZSB0byBlbmFibGUgZnJpY3Rpb24gaW4gYSBXb3JsZCB3aXRoIGEgbnVsbCBncmF2aXR5IHZlY3RvciAobm8gZ3Jhdml0eSkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBicm9hZHBoYXNlIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBOYWl2ZUJyb2FkcGhhc2UKICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGJvZGllcyBpbiB0aGlzIHdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRydWUgaWYgYW55IGJvZGllcyBhcmUgbm90IHNsZWVwaW5nLCBmYWxzZSBpZiBldmVyeSBib2R5IGlzIHNsZWVwaW5nLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgc29sdmVyIGFsZ29yaXRobSB0byB1c2UuCiAgICAgKiBAZGVmYXVsdCBHU1NvbHZlcgogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25NYXRyaXgKICAgICAqLwoKICAgIC8qKgogICAgICogQ29sbGlzaW9uTWF0cml4IGZyb20gdGhlIHByZXZpb3VzIHN0ZXAuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCBhZGRlZCBjb250YWN0bWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBVc2VkIHRvIGxvb2sgdXAgYSBDb250YWN0TWF0ZXJpYWwgZ2l2ZW4gdHdvIGluc3RhbmNlcyBvZiBNYXRlcmlhbC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGRlZmF1bHQgbWF0ZXJpYWwgb2YgdGhlIGJvZGllcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhpcyBjb250YWN0IG1hdGVyaWFsIGlzIHVzZWQgaWYgbm8gc3VpdGFibGUgY29udGFjdG1hdGVyaWFsIGlzIGZvdW5kIGZvciBhIGNvbnRhY3QuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRpbWUgYWNjdW11bGF0b3IgZm9yIGludGVycG9sYXRpb24uCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2FmZmVyb25nYW1lcy5jb20vZ2FtZS1waHlzaWNzL2ZpeC15b3VyLXRpbWVzdGVwLwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgYm9keSBoYXMgYmVlbiBhZGRlZCB0byB0aGUgd29ybGQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgd29ybGQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5kdCA9IC0xOwogICAgICB0aGlzLmFsbG93U2xlZXAgPSAhIW9wdGlvbnMuYWxsb3dTbGVlcDsKICAgICAgdGhpcy5jb250YWN0cyA9IFtdOwogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zID0gW107CiAgICAgIHRoaXMucXVhdE5vcm1hbGl6ZVNraXAgPSBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnF1YXROb3JtYWxpemVTa2lwIDogMDsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplRmFzdCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZUZhc3QgOiBmYWxzZTsKICAgICAgdGhpcy50aW1lID0gMC4wOwogICAgICB0aGlzLnN0ZXBudW1iZXIgPSAwOwogICAgICB0aGlzLmRlZmF1bHRfZHQgPSAxIC8gNjA7CiAgICAgIHRoaXMubmV4dElkID0gMDsKICAgICAgdGhpcy5ncmF2aXR5ID0gbmV3IFZlYzMoKTsKCiAgICAgIGlmIChvcHRpb25zLmdyYXZpdHkpIHsKICAgICAgICB0aGlzLmdyYXZpdHkuY29weShvcHRpb25zLmdyYXZpdHkpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5mcmljdGlvbkdyYXZpdHkpIHsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eSA9IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5mcmljdGlvbkdyYXZpdHkuY29weShvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIHRoaXMuYnJvYWRwaGFzZSA9IG9wdGlvbnMuYnJvYWRwaGFzZSAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5icm9hZHBoYXNlIDogbmV3IE5haXZlQnJvYWRwaGFzZSgpOwogICAgICB0aGlzLmJvZGllcyA9IFtdOwogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGZhbHNlOwogICAgICB0aGlzLnNvbHZlciA9IG9wdGlvbnMuc29sdmVyICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLnNvbHZlciA6IG5ldyBHU1NvbHZlcigpOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CiAgICAgIHRoaXMubmFycm93cGhhc2UgPSBuZXcgTmFycm93cGhhc2UodGhpcyk7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4ID0gbmV3IEFycmF5Q29sbGlzaW9uTWF0cml4KCk7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlciA9IG5ldyBPdmVybGFwS2VlcGVyKCk7CiAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzID0gW107CiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUgPSBuZXcgVHVwbGVEaWN0aW9uYXJ5KCk7CiAgICAgIHRoaXMuZGVmYXVsdE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKCdkZWZhdWx0Jyk7CiAgICAgIHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbCA9IG5ldyBDb250YWN0TWF0ZXJpYWwodGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHRoaXMuZGVmYXVsdE1hdGVyaWFsLCB7CiAgICAgICAgZnJpY3Rpb246IDAuMywKICAgICAgICByZXN0aXR1dGlvbjogMC4wCiAgICAgIH0pOwogICAgICB0aGlzLmRvUHJvZmlsaW5nID0gZmFsc2U7CiAgICAgIHRoaXMucHJvZmlsZSA9IHsKICAgICAgICBzb2x2ZTogMCwKICAgICAgICBtYWtlQ29udGFjdENvbnN0cmFpbnRzOiAwLAogICAgICAgIGJyb2FkcGhhc2U6IDAsCiAgICAgICAgaW50ZWdyYXRlOiAwLAogICAgICAgIG5hcnJvd3BoYXNlOiAwCiAgICAgIH07CiAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSAwOwogICAgICB0aGlzLnN1YnN5c3RlbXMgPSBbXTsKICAgICAgdGhpcy5hZGRCb2R5RXZlbnQgPSB7CiAgICAgICAgdHlwZTogJ2FkZEJvZHknLAogICAgICAgIGJvZHk6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQgPSB7CiAgICAgICAgdHlwZTogJ3JlbW92ZUJvZHknLAogICAgICAgIGJvZHk6IG51bGwKICAgICAgfTsKICAgICAgdGhpcy5pZFRvQm9keU1hcCA9IHt9OwogICAgICB0aGlzLmJyb2FkcGhhc2Uuc2V0V29ybGQodGhpcyk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgY29udGFjdCBtYXRlcmlhbCBiZXR3ZWVuIG1hdGVyaWFscyBtMSBhbmQgbTIKICAgICAqIEByZXR1cm4gVGhlIGNvbnRhY3QgbWF0ZXJpYWwgaWYgaXQgd2FzIGZvdW5kLgogICAgICovCgoKICAgIGdldENvbnRhY3RNYXRlcmlhbChtMSwgbTIpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuZ2V0KG0xLmlkLCBtMi5pZCk7CiAgICB9CiAgICAvKioKICAgICAqIFN0b3JlIG9sZCBjb2xsaXNpb24gc3RhdGUgaW5mbwogICAgICovCgoKICAgIGNvbGxpc2lvbk1hdHJpeFRpY2soKSB7CiAgICAgIGNvbnN0IHRlbXAgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzID0gdGhpcy5jb2xsaXNpb25NYXRyaXg7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4ID0gdGVtcDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXgucmVzZXQoKTsKICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci50aWNrKCk7CiAgICAgIHRoaXMuc2hhcGVPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgY29uc3RyYWludCB0byB0aGUgc2ltdWxhdGlvbi4KICAgICAqLwoKCiAgICBhZGRDb25zdHJhaW50KGMpIHsKICAgICAgdGhpcy5jb25zdHJhaW50cy5wdXNoKGMpOwogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGEgY29uc3RyYWludAogICAgICovCgoKICAgIHJlbW92ZUNvbnN0cmFpbnQoYykgewogICAgICBjb25zdCBpZHggPSB0aGlzLmNvbnN0cmFpbnRzLmluZGV4T2YoYyk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIHRoaXMuY29uc3RyYWludHMuc3BsaWNlKGlkeCwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmF5Y2FzdCB0ZXN0CiAgICAgKiBAZGVwcmVjYXRlZCBVc2UgLnJheWNhc3RBbGwsIC5yYXljYXN0Q2xvc2VzdCBvciAucmF5Y2FzdEFueSBpbnN0ZWFkLgogICAgICovCgoKICAgIHJheVRlc3QoZnJvbSwgdG8sIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0IGluc3RhbmNlb2YgUmF5Y2FzdFJlc3VsdCkgewogICAgICAgIC8vIERvIHJheWNhc3RDbG9zZXN0CiAgICAgICAgdGhpcy5yYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgewogICAgICAgICAgc2tpcEJhY2tmYWNlczogdHJ1ZQogICAgICAgIH0sIHJlc3VsdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdEFsbAogICAgICAgIHRoaXMucmF5Y2FzdEFsbChmcm9tLCB0bywgewogICAgICAgICAgc2tpcEJhY2tmYWNlczogdHJ1ZQogICAgICAgIH0sIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QgYWdhaW5zdCBhbGwgYm9kaWVzLiBUaGUgcHJvdmlkZWQgY2FsbGJhY2sgd2lsbCBiZSBleGVjdXRlZCBmb3IgZWFjaCBoaXQgd2l0aCBhIFJheWNhc3RSZXN1bHQgYXMgc2luZ2xlIGFyZ3VtZW50LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdEFsbChmcm9tLCB0bywgb3B0aW9ucywgY2FsbGJhY2spIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFMTDsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLmNhbGxiYWNrID0gY2FsbGJhY2s7CiAgICAgIHJldHVybiB0bXBSYXkuaW50ZXJzZWN0V29ybGQodGhpcywgb3B0aW9ucyk7CiAgICB9CiAgICAvKioKICAgICAqIFJheSBjYXN0LCBhbmQgc3RvcCBhdCB0aGUgZmlyc3QgcmVzdWx0LiBOb3RlIHRoYXQgdGhlIG9yZGVyIGlzIHJhbmRvbSAtIGJ1dCB0aGUgbWV0aG9kIGlzIGZhc3QuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QW55KGZyb20sIHRvLCBvcHRpb25zLCByZXN1bHQpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5tb2RlID0gUmF5LkFOWTsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCByZXR1cm4gaW5mb3JtYXRpb24gb2YgdGhlIGNsb3Nlc3QgaGl0LgogICAgICogQHJldHVybiBUcnVlIGlmIGFueSBib2R5IHdhcyBoaXQuCiAgICAgKi8KCgogICAgcmF5Y2FzdENsb3Nlc3QoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQ0xPU0VTVDsKICAgICAgb3B0aW9ucy5mcm9tID0gZnJvbTsKICAgICAgb3B0aW9ucy50byA9IHRvOwogICAgICBvcHRpb25zLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIGEgcmlnaWQgYm9keSB0byB0aGUgc2ltdWxhdGlvbi4KICAgICAqIEB0b2RvIElmIHRoZSBzaW11bGF0aW9uIGhhcyBub3QgeWV0IHN0YXJ0ZWQsIHdoeSByZWNyZXRlIGFuZCBjb3B5IGFycmF5cyBmb3IgZWFjaCBib2R5PyBBY2N1bXVsYXRlIGluIGR5bmFtaWMgYXJyYXlzIGluIHRoaXMgY2FzZS4KICAgICAqIEB0b2RvIEFkZGluZyBhbiBhcnJheSBvZiBib2RpZXMgc2hvdWxkIGJlIHBvc3NpYmxlLiBUaGlzIHdvdWxkIHNhdmUgc29tZSBsb29wcyB0b28KICAgICAqLwoKCiAgICBhZGRCb2R5KGJvZHkpIHsKICAgICAgaWYgKHRoaXMuYm9kaWVzLmluY2x1ZGVzKGJvZHkpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBib2R5LmluZGV4ID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICB0aGlzLmJvZGllcy5wdXNoKGJvZHkpOwogICAgICBib2R5LndvcmxkID0gdGhpczsKICAgICAgYm9keS5pbml0UG9zaXRpb24uY29weShib2R5LnBvc2l0aW9uKTsKICAgICAgYm9keS5pbml0VmVsb2NpdHkuY29weShib2R5LnZlbG9jaXR5KTsKICAgICAgYm9keS50aW1lTGFzdFNsZWVweSA9IHRoaXMudGltZTsKCiAgICAgIGlmIChib2R5IGluc3RhbmNlb2YgQm9keSkgewogICAgICAgIGJvZHkuaW5pdEFuZ3VsYXJWZWxvY2l0eS5jb3B5KGJvZHkuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgICBib2R5LmluaXRRdWF0ZXJuaW9uLmNvcHkoYm9keS5xdWF0ZXJuaW9uKTsKICAgICAgfQoKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyh0aGlzLmJvZGllcy5sZW5ndGgpOwogICAgICB0aGlzLmFkZEJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXSA9IGJvZHk7CiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudCh0aGlzLmFkZEJvZHlFdmVudCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHJpZ2lkIGJvZHkgZnJvbSB0aGUgc2ltdWxhdGlvbi4KICAgICAqLwoKCiAgICByZW1vdmVCb2R5KGJvZHkpIHsKICAgICAgYm9keS53b3JsZCA9IG51bGw7CiAgICAgIGNvbnN0IG4gPSB0aGlzLmJvZGllcy5sZW5ndGggLSAxOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3QgaWR4ID0gYm9kaWVzLmluZGV4T2YoYm9keSk7CgogICAgICBpZiAoaWR4ICE9PSAtMSkgewogICAgICAgIGJvZGllcy5zcGxpY2UoaWR4LCAxKTsgLy8gVG9kbzogc2hvdWxkIHVzZSBhIGdhcmJhZ2UgZnJlZSBtZXRob2QKICAgICAgICAvLyBSZWNvbXB1dGUgaW5kZXgKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IGJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLmluZGV4ID0gaTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4LnNldE51bU9iamVjdHMobik7CiAgICAgICAgdGhpcy5yZW1vdmVCb2R5RXZlbnQuYm9keSA9IGJvZHk7CiAgICAgICAgZGVsZXRlIHRoaXMuaWRUb0JvZHlNYXBbYm9keS5pZF07CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMucmVtb3ZlQm9keUV2ZW50KTsKICAgICAgfQogICAgfQoKICAgIGdldEJvZHlCeUlkKGlkKSB7CiAgICAgIHJldHVybiB0aGlzLmlkVG9Cb2R5TWFwW2lkXTsKICAgIH0KICAgIC8qKgogICAgICogQHRvZG8gTWFrZSBhIGZhc3RlciBtYXAKICAgICAqLwoKCiAgICBnZXRTaGFwZUJ5SWQoaWQpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlcyA9IGJvZGllc1tpXS5zaGFwZXM7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hhcGVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tqXTsKCiAgICAgICAgICBpZiAoc2hhcGUuaWQgPT09IGlkKSB7CiAgICAgICAgICAgIHJldHVybiBzaGFwZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqCiAgICAgKiBBZGRzIGEgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgV29ybGQKICAgICAqLwoKCiAgICBhZGRDb250YWN0TWF0ZXJpYWwoY21hdCkgewogICAgICAvLyBBZGQgY29udGFjdCBtYXRlcmlhbAogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMucHVzaChjbWF0KTsgLy8gQWRkIGN1cnJlbnQgY29udGFjdCBtYXRlcmlhbCB0byB0aGUgbWF0ZXJpYWwgdGFibGUKCiAgICAgIHRoaXMuY29udGFjdE1hdGVyaWFsVGFibGUuc2V0KGNtYXQubWF0ZXJpYWxzWzBdLmlkLCBjbWF0Lm1hdGVyaWFsc1sxXS5pZCwgY21hdCk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb250YWN0IG1hdGVyaWFsIGZyb20gdGhlIFdvcmxkLgogICAgICovCgoKICAgIHJlbW92ZUNvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29udGFjdG1hdGVyaWFscy5pbmRleE9mKGNtYXQpOwoKICAgICAgaWYgKGlkeCA9PT0gLTEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5zcGxpY2UoaWR4LCAxKTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5kZWxldGUoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RlcCB0aGUgc2ltdWxhdGlvbiBmb3J3YXJkIGtlZXBpbmcgdHJhY2sgb2YgbGFzdCBjYWxsZWQgdGltZQogICAgICogdG8gYmUgYWJsZSB0byBzdGVwIHRoZSB3b3JsZCBhdCBhIGZpeGVkIHJhdGUsIGluZGVwZW5kZW50bHkgb2YgZnJhbWVyYXRlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlIChkZWZhdWx0OiAxIC8gNjApLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9wb3N0L2ZpeF95b3VyX3RpbWVzdGVwLwogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBSdW4gdGhlIHNpbXVsYXRpb24gaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUgZXZlcnkgMSAvIDYwIG1zCiAgICAgKiAgICAgd29ybGQuZml4ZWRTdGVwKCkKICAgICAqLwoKCiAgICBmaXhlZFN0ZXAoZHQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChkdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgZHQgPSAxIC8gNjA7CiAgICAgIH0KCiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgY29uc3QgdGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC8gMTAwMDsgLy8gc2Vjb25kcwoKICAgICAgaWYgKCF0aGlzLmxhc3RDYWxsVGltZSkgewogICAgICAgIHRoaXMuc3RlcChkdCwgdW5kZWZpbmVkLCBtYXhTdWJTdGVwcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENhbGxlZCA9IHRpbWUgLSB0aGlzLmxhc3RDYWxsVGltZTsKICAgICAgICB0aGlzLnN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfQoKICAgICAgdGhpcy5sYXN0Q2FsbFRpbWUgPSB0aW1lOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBwaHlzaWNzIHdvcmxkIGZvcndhcmQgaW4gdGltZS4KICAgICAqCiAgICAgKiBUaGVyZSBhcmUgdHdvIG1vZGVzLiBUaGUgc2ltcGxlIG1vZGUgaXMgZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbi4gSW4gdGhpcyBjYXNlIHlvdSBvbmx5IHVzZSB0aGUgZmlyc3QgYXJndW1lbnQuIFRoZSBzZWNvbmQgY2FzZSB1c2VzIGludGVycG9sYXRpb24uIEluIHRoYXQgeW91IGFsc28gcHJvdmlkZSB0aGUgdGltZSBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgdXNlZCwgYXMgd2VsbCBhcyB0aGUgbWF4aW11bSBmaXhlZCB0aW1lc3RlcHMgdG8gdGFrZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZHQgVGhlIGZpeGVkIHRpbWUgc3RlcCBzaXplIHRvIHVzZS4KICAgICAqIEBwYXJhbSB0aW1lU2luY2VMYXN0Q2FsbGVkIFRoZSB0aW1lIGVsYXBzZWQgc2luY2UgdGhlIGZ1bmN0aW9uIHdhcyBsYXN0IGNhbGxlZC4KICAgICAqIEBwYXJhbSBtYXhTdWJTdGVwcyBNYXhpbXVtIG51bWJlciBvZiBmaXhlZCBzdGVwcyB0byB0YWtlIHBlciBmdW5jdGlvbiBjYWxsIChkZWZhdWx0OiAxMCkuCiAgICAgKiBAc2VlIGh0dHBzOi8vd2ViLmFyY2hpdmUub3JnL3dlYi8yMDE4MDQyNjE1NDUzMS9odHRwOi8vYnVsbGV0cGh5c2ljcy5vcmcvbWVkaWF3aWtpLTEuNS44L2luZGV4LnBocC9TdGVwcGluZ19UaGVfV29ybGQjV2hhdF9kb190aGVfcGFyYW1ldGVyc190b19idER5bmFtaWNzV29ybGQ6OnN0ZXBTaW11bGF0aW9uX21lYW4uM0YKICAgICAqIEBleGFtcGxlCiAgICAgKiAgICAgLy8gZml4ZWQgdGltZXN0ZXBwaW5nIHdpdGhvdXQgaW50ZXJwb2xhdGlvbgogICAgICogICAgIHdvcmxkLnN0ZXAoMSAvIDYwKQogICAgICovCgoKICAgIHN0ZXAoZHQsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKSB7CiAgICAgIGlmIChtYXhTdWJTdGVwcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4U3ViU3RlcHMgPSAxMDsKICAgICAgfQoKICAgICAgaWYgKHRpbWVTaW5jZUxhc3RDYWxsZWQgPT09IHVuZGVmaW5lZCkgewogICAgICAgIC8vIEZpeGVkLCBzaW1wbGUgc3RlcHBpbmcKICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7IC8vIEluY3JlbWVudCB0aW1lCgogICAgICAgIHRoaXMudGltZSArPSBkdDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgICAgY29uc3QgdDAgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICBsZXQgc3Vic3RlcHMgPSAwOwoKICAgICAgICB3aGlsZSAodGhpcy5hY2N1bXVsYXRvciA+PSBkdCAmJiBzdWJzdGVwcyA8IG1heFN1YlN0ZXBzKSB7CiAgICAgICAgICAvLyBEbyBmaXhlZCBzdGVwcyB0byBjYXRjaCB1cAogICAgICAgICAgdGhpcy5pbnRlcm5hbFN0ZXAoZHQpOwogICAgICAgICAgdGhpcy5hY2N1bXVsYXRvciAtPSBkdDsKICAgICAgICAgIHN1YnN0ZXBzKys7CgogICAgICAgICAgaWYgKHBlcmZvcm1hbmNlLm5vdygpIC0gdDAgPiBkdCAqIDEwMDApIHsKICAgICAgICAgICAgLy8gVGhlIGZyYW1lcmF0ZSBpcyBub3QgaW50ZXJhY3RpdmUgYW55bW9yZS4KICAgICAgICAgICAgLy8gV2UgYXJlIGJlbG93IHRoZSB0YXJnZXQgZnJhbWVyYXRlLgogICAgICAgICAgICAvLyBCZXR0ZXIgYmFpbCBvdXQuCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0gLy8gUmVtb3ZlIHRoZSBleGNlc3MgYWNjdW11bGF0b3IsIHNpbmNlIHdlIG1heSBub3QKICAgICAgICAvLyBoYXZlIGhhZCBlbm91Z2ggc3Vic3RlcHMgYXZhaWxhYmxlIHRvIGNhdGNoIHVwCgoKICAgICAgICB0aGlzLmFjY3VtdWxhdG9yID0gdGhpcy5hY2N1bXVsYXRvciAlIGR0OwogICAgICAgIGNvbnN0IHQgPSB0aGlzLmFjY3VtdWxhdG9yIC8gZHQ7CgogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSB0aGlzLmJvZGllcy5sZW5ndGg7IGorKykgewogICAgICAgICAgY29uc3QgYiA9IHRoaXMuYm9kaWVzW2pdOwogICAgICAgICAgYi5wcmV2aW91c1Bvc2l0aW9uLmxlcnAoYi5wb3NpdGlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRQb3NpdGlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5zbGVycChiLnF1YXRlcm5pb24sIHQsIGIuaW50ZXJwb2xhdGVkUXVhdGVybmlvbik7CiAgICAgICAgICBiLnByZXZpb3VzUXVhdGVybmlvbi5ub3JtYWxpemUoKTsKICAgICAgICB9CgogICAgICAgIHRoaXMudGltZSArPSB0aW1lU2luY2VMYXN0Q2FsbGVkOwogICAgICB9CiAgICB9CgogICAgaW50ZXJuYWxTdGVwKGR0KSB7CiAgICAgIHRoaXMuZHQgPSBkdDsKICAgICAgY29uc3QgY29udGFjdHMgPSB0aGlzLmNvbnRhY3RzOwogICAgICBjb25zdCBwMSA9IFdvcmxkX3N0ZXBfcDE7CiAgICAgIGNvbnN0IHAyID0gV29ybGRfc3RlcF9wMjsKICAgICAgY29uc3QgTiA9IHRoaXMuYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IHNvbHZlciA9IHRoaXMuc29sdmVyOwogICAgICBjb25zdCBncmF2aXR5ID0gdGhpcy5ncmF2aXR5OwogICAgICBjb25zdCBkb1Byb2ZpbGluZyA9IHRoaXMuZG9Qcm9maWxpbmc7CiAgICAgIGNvbnN0IHByb2ZpbGUgPSB0aGlzLnByb2ZpbGU7CiAgICAgIGNvbnN0IERZTkFNSUMgPSBCb2R5LkRZTkFNSUM7CiAgICAgIGxldCBwcm9maWxpbmdTdGFydCA9IC1JbmZpbml0eTsKICAgICAgY29uc3QgY29uc3RyYWludHMgPSB0aGlzLmNvbnN0cmFpbnRzOwogICAgICBjb25zdCBmcmljdGlvbkVxdWF0aW9uUG9vbCA9IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgIGdyYXZpdHkubGVuZ3RoKCk7CiAgICAgIGNvbnN0IGd4ID0gZ3Jhdml0eS54OwogICAgICBjb25zdCBneSA9IGdyYXZpdHkueTsKICAgICAgY29uc3QgZ3ogPSBncmF2aXR5Lno7CiAgICAgIGxldCBpID0gMDsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0gLy8gQWRkIGdyYXZpdHkgdG8gYWxsIG9iamVjdHMKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgPT09IERZTkFNSUMpIHsKICAgICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMgYm9kaWVzCiAgICAgICAgICBjb25zdCBmID0gYmkuZm9yY2U7CiAgICAgICAgICBjb25zdCBtID0gYmkubWFzczsKICAgICAgICAgIGYueCArPSBtICogZ3g7CiAgICAgICAgICBmLnkgKz0gbSAqIGd5OwogICAgICAgICAgZi56ICs9IG0gKiBnejsKICAgICAgICB9CiAgICAgIH0gLy8gVXBkYXRlIHN1YnN5c3RlbXMKCgogICAgICBmb3IgKGxldCBpID0gMCwgTnN1YnN5c3RlbXMgPSB0aGlzLnN1YnN5c3RlbXMubGVuZ3RoOyBpICE9PSBOc3Vic3lzdGVtczsgaSsrKSB7CiAgICAgICAgdGhpcy5zdWJzeXN0ZW1zW2ldLnVwZGF0ZSgpOwogICAgICB9IC8vIENvbGxpc2lvbiBkZXRlY3Rpb24KCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBwMS5sZW5ndGggPSAwOyAvLyBDbGVhbiB1cCBwYWlyIGFycmF5cyBmcm9tIGxhc3Qgc3RlcAoKICAgICAgcDIubGVuZ3RoID0gMDsKICAgICAgdGhpcy5icm9hZHBoYXNlLmNvbGxpc2lvblBhaXJzKHRoaXMsIHAxLCBwMik7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLmJyb2FkcGhhc2UgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBjb25zdHJhaW5lZCBwYWlycyB3aXRoIGNvbGxpZGVDb25uZWN0ZWQgPT0gZmFsc2UKCgogICAgICBsZXQgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CgogICAgICAgIGlmICghYy5jb2xsaWRlQ29ubmVjdGVkKSB7CiAgICAgICAgICBmb3IgKGxldCBqID0gcDEubGVuZ3RoIC0gMTsgaiA+PSAwOyBqIC09IDEpIHsKICAgICAgICAgICAgaWYgKGMuYm9keUEgPT09IHAxW2pdICYmIGMuYm9keUIgPT09IHAyW2pdIHx8IGMuYm9keUIgPT09IHAxW2pdICYmIGMuYm9keUEgPT09IHAyW2pdKSB7CiAgICAgICAgICAgICAgcDEuc3BsaWNlKGosIDEpOwogICAgICAgICAgICAgIHAyLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhUaWNrKCk7IC8vIEdlbmVyYXRlIGNvbnRhY3RzCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBvbGRjb250YWN0cyA9IFdvcmxkX3N0ZXBfb2xkQ29udGFjdHM7CiAgICAgIGNvbnN0IE5vbGRDb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5vbGRDb250YWN0czsgaSsrKSB7CiAgICAgICAgb2xkY29udGFjdHMucHVzaChjb250YWN0c1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnRhY3RzLmxlbmd0aCA9IDA7IC8vIFRyYW5zZmVyIEZyaWN0aW9uRXF1YXRpb24gZnJvbSBjdXJyZW50IGxpc3QgdG8gdGhlIHBvb2wgZm9yIHJldXNlCgogICAgICBjb25zdCBOb2xkRnJpY3Rpb25FcXVhdGlvbnMgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE5vbGRGcmljdGlvbkVxdWF0aW9uczsgaSsrKSB7CiAgICAgICAgZnJpY3Rpb25FcXVhdGlvblBvb2wucHVzaCh0aGlzLmZyaWN0aW9uRXF1YXRpb25zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5sZW5ndGggPSAwOwogICAgICB0aGlzLm5hcnJvd3BoYXNlLmdldENvbnRhY3RzKHAxLCBwMiwgdGhpcywgY29udGFjdHMsIG9sZGNvbnRhY3RzLCAvLyBUbyBiZSByZXVzZWQKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9ucywgZnJpY3Rpb25FcXVhdGlvblBvb2wpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5uYXJyb3dwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gTG9vcCBvdmVyIGFsbCBjb2xsaXNpb25zCgoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgYWxsIGZyaWN0aW9uIGVxcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgPCB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICBjb25zdCBuY29udGFjdHMgPSBjb250YWN0cy5sZW5ndGg7CgogICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gbmNvbnRhY3RzOyBrKyspIHsKICAgICAgICAvLyBDdXJyZW50IGNvbnRhY3QKICAgICAgICBjb25zdCBjID0gY29udGFjdHNba107IC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBpbmRlY2VzCgogICAgICAgIGNvbnN0IGJpID0gYy5iaTsKICAgICAgICBjb25zdCBiaiA9IGMuYmo7CiAgICAgICAgY29uc3Qgc2kgPSBjLnNpOwogICAgICAgIGNvbnN0IHNqID0gYy5zajsgLy8gR2V0IGNvbGxpc2lvbiBwcm9wZXJ0aWVzCgogICAgICAgIGxldCBjbTsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBjbSA9IHRoaXMuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbSA9IHRoaXMuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsKICAgICAgICB9IC8vIGMuZW5hYmxlZCA9IGJpLmNvbGxpc2lvblJlc3BvbnNlICYmIGJqLmNvbGxpc2lvblJlc3BvbnNlICYmIHNpLmNvbGxpc2lvblJlc3BvbnNlICYmIHNqLmNvbGxpc2lvblJlc3BvbnNlOwoKCiAgICAgICAgY20uZnJpY3Rpb247IC8vIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgICAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICAgIGlmIChiaS5tYXRlcmlhbCAmJiBiai5tYXRlcmlhbCkgewogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLmZyaWN0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCkgewogICAgICAgICAgICBiaS5tYXRlcmlhbC5mcmljdGlvbiAqIGJqLm1hdGVyaWFsLmZyaWN0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChiaS5tYXRlcmlhbC5yZXN0aXR1dGlvbiA+PSAwICYmIGJqLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDApIHsKICAgICAgICAgICAgYy5yZXN0aXR1dGlvbiA9IGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uICogYmoubWF0ZXJpYWwucmVzdGl0dXRpb247CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBjLnNldFNwb29rUGFyYW1zKAogICAgICAgIC8vICAgICAgICAgICBjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sCiAgICAgICAgLy8gICAgICAgICAgIGR0CiAgICAgICAgLy8gICAgICAgKTsKCgogICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihjKTsgLy8gLy8gQWRkIGZyaWN0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgICAgICAvLyBpZihtdSA+IDApewogICAgICAgIC8vIAkvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIAljb25zdCBtdWcgPSBtdSAqIGdub3JtOwogICAgICAgIC8vIAljb25zdCByZWR1Y2VkTWFzcyA9IChiaS5pbnZNYXNzICsgYmouaW52TWFzcyk7CiAgICAgICAgLy8gCWlmKHJlZHVjZWRNYXNzID4gMCl7CiAgICAgICAgLy8gCQlyZWR1Y2VkTWFzcyA9IDEvcmVkdWNlZE1hc3M7CiAgICAgICAgLy8gCX0KICAgICAgICAvLyAJY29uc3QgcG9vbCA9IGZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIC8vIAljb25zdCBjMSA9IHBvb2wubGVuZ3RoID8gcG9vbC5wb3AoKSA6IG5ldyBGcmljdGlvbkVxdWF0aW9uKGJpLGJqLG11ZypyZWR1Y2VkTWFzcyk7CiAgICAgICAgLy8gCWNvbnN0IGMyID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJdGhpcy5mcmljdGlvbkVxdWF0aW9ucy5wdXNoKGMxLCBjMik7CiAgICAgICAgLy8gCWMxLmJpID0gYzIuYmkgPSBiaTsKICAgICAgICAvLyAJYzEuYmogPSBjMi5iaiA9IGJqOwogICAgICAgIC8vIAljMS5taW5Gb3JjZSA9IGMyLm1pbkZvcmNlID0gLW11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZypyZWR1Y2VkTWFzczsKICAgICAgICAvLyAJLy8gQ29weSBvdmVyIHRoZSByZWxhdGl2ZSB2ZWN0b3JzCiAgICAgICAgLy8gCWMxLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMxLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCWMyLnJpLmNvcHkoYy5yaSk7CiAgICAgICAgLy8gCWMyLnJqLmNvcHkoYy5yaik7CiAgICAgICAgLy8gCS8vIENvbnN0cnVjdCB0YW5nZW50cwogICAgICAgIC8vIAljLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOwogICAgICAgIC8vICAgICAgICAgICAvLyBTZXQgc3Bvb2sgcGFyYW1zCiAgICAgICAgLy8gICAgICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMyLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCBkdCk7CiAgICAgICAgLy8gICAgICAgICAgIGMxLmVuYWJsZWQgPSBjMi5lbmFibGVkID0gYy5lbmFibGVkOwogICAgICAgIC8vIAkvLyBBZGQgZXF1YXRpb25zIHRvIHNvbHZlcgogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzEpOwogICAgICAgIC8vIAlzb2x2ZXIuYWRkRXF1YXRpb24oYzIpOwogICAgICAgIC8vIH0KCiAgICAgICAgaWYgKGJpLmFsbG93U2xlZXAgJiYgYmkudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJpLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiai50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQiA9IGJqLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJqLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEIgPSBiai5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQiA+PSBzcGVlZExpbWl0U3F1YXJlZEIgKiAyKSB7CiAgICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGJqLmFsbG93U2xlZXAgJiYgYmoudHlwZSA9PT0gQm9keS5EWU5BTUlDICYmIGJqLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBiaS50eXBlICE9PSBCb2R5LlNUQVRJQykgewogICAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkQSA9IGJpLnZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKSArIGJpLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgICBjb25zdCBzcGVlZExpbWl0U3F1YXJlZEEgPSBiaS5zbGVlcFNwZWVkTGltaXQgKiogMjsKCiAgICAgICAgICBpZiAoc3BlZWRTcXVhcmVkQSA+PSBzcGVlZExpbWl0U3F1YXJlZEEgKiAyKSB7CiAgICAgICAgICAgIGJqLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gLy8gTm93IHdlIGtub3cgdGhhdCBpIGFuZCBqIGFyZSBpbiBjb250YWN0LiBTZXQgY29sbGlzaW9uIG1hdHJpeCBzdGF0ZQoKCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0KGJpLCBiaiwgdHJ1ZSk7CgogICAgICAgIGlmICghdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cy5nZXQoYmksIGJqKSkgewogICAgICAgICAgLy8gRmlyc3QgY29udGFjdCEKICAgICAgICAgIC8vIFdlIHJldXNlIHRoZSBjb2xsaWRlRXZlbnQgb2JqZWN0LCBvdGhlcndpc2Ugd2Ugd2lsbCBlbmQgdXAgY3JlYXRpbmcgbmV3IG9iamVjdHMgZm9yIGVhY2ggbmV3IGNvbnRhY3QsIGV2ZW4gaWYgdGhlcmUncyBubyBldmVudCBsaXN0ZW5lciBhdHRhY2hlZC4KICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiajsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmNvbnRhY3QgPSBjOwogICAgICAgICAgYmkuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCk7CiAgICAgICAgICBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudC5ib2R5ID0gYmk7CiAgICAgICAgICBiai5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuc2V0KHNpLmlkLCBzai5pZCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdENvbnRhY3RFdmVudHMoKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUubWFrZUNvbnRhY3RDb25zdHJhaW50cyA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBXYWtlIHVwIGJvZGllcwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSkgewogICAgICAgICAgYmkud2FrZVVwKCk7CiAgICAgICAgICBiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IC8vIEFkZCB1c2VyLWFkZGVkIGNvbnN0cmFpbnRzCgoKICAgICAgTmNvbnN0cmFpbnRzID0gY29uc3RyYWludHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTmNvbnN0cmFpbnRzOyBpKyspIHsKICAgICAgICBjb25zdCBjID0gY29uc3RyYWludHNbaV07CiAgICAgICAgYy51cGRhdGUoKTsKCiAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5lcSA9IGMuZXF1YXRpb25zLmxlbmd0aDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGVxID0gYy5lcXVhdGlvbnNbal07CiAgICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24oZXEpOwogICAgICAgIH0KICAgICAgfSAvLyBTb2x2ZSB0aGUgY29uc3RyYWluZWQgc3lzdGVtCgoKICAgICAgc29sdmVyLnNvbHZlKGR0LCB0aGlzKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuc29sdmUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFJlbW92ZSBhbGwgY29udGFjdHMgZnJvbSBzb2x2ZXIKCgogICAgICBzb2x2ZXIucmVtb3ZlQWxsRXF1YXRpb25zKCk7IC8vIEFwcGx5IGRhbXBpbmcsIHNlZSBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvYnVsbGV0L2lzc3Vlcy9kZXRhaWw/aWQ9NzQgZm9yIGRldGFpbHMKCiAgICAgIGNvbnN0IHBvdyA9IE1hdGgucG93OwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS50eXBlICYgRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGxkID0gcG93KDEuMCAtIGJpLmxpbmVhckRhbXBpbmcsIGR0KTsKICAgICAgICAgIGNvbnN0IHYgPSBiaS52ZWxvY2l0eTsKICAgICAgICAgIHYuc2NhbGUobGQsIHYpOwogICAgICAgICAgY29uc3QgYXYgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CgogICAgICAgICAgaWYgKGF2KSB7CiAgICAgICAgICAgIGNvbnN0IGFkID0gcG93KDEuMCAtIGJpLmFuZ3VsYXJEYW1waW5nLCBkdCk7CiAgICAgICAgICAgIGF2LnNjYWxlKGFkLCBhdik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wcmVTdGVwRXZlbnQpOyAvLyBMZWFwIGZyb2cKICAgICAgLy8gdm5ldyA9IHYgKyBoKmYvbQogICAgICAvLyB4bmV3ID0geCArIGgqdm5ldwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfQoKICAgICAgY29uc3Qgc3RlcG51bWJlciA9IHRoaXMuc3RlcG51bWJlcjsKICAgICAgY29uc3QgcXVhdE5vcm1hbGl6ZSA9IHN0ZXBudW1iZXIgJSAodGhpcy5xdWF0Tm9ybWFsaXplU2tpcCArIDEpID09PSAwOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplRmFzdCA9IHRoaXMucXVhdE5vcm1hbGl6ZUZhc3Q7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBib2RpZXNbaV0uaW50ZWdyYXRlKGR0LCBxdWF0Tm9ybWFsaXplLCBxdWF0Tm9ybWFsaXplRmFzdCk7CiAgICAgIH0KCiAgICAgIHRoaXMuY2xlYXJGb3JjZXMoKTsKICAgICAgdGhpcy5icm9hZHBoYXNlLmRpcnR5ID0gdHJ1ZTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuaW50ZWdyYXRlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBVcGRhdGUgc3RlcCBudW1iZXIKCgogICAgICB0aGlzLnN0ZXBudW1iZXIgKz0gMTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCk7IC8vIFNsZWVwaW5nIHVwZGF0ZQoKICAgICAgbGV0IGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CgogICAgICBpZiAodGhpcy5hbGxvd1NsZWVwKSB7CiAgICAgICAgaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CgogICAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CiAgICAgICAgICBiaS5zbGVlcFRpY2sodGhpcy50aW1lKTsKCiAgICAgICAgICBpZiAoYmkuc2xlZXBTdGF0ZSAhPT0gQm9keS5TTEVFUElORykgewogICAgICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5oYXNBY3RpdmVCb2RpZXMgPSBoYXNBY3RpdmVCb2RpZXM7CiAgICB9CgogICAgZW1pdENvbnRhY3RFdmVudHMoKSB7CiAgICAgIGNvbnN0IGhhc0JlZ2luQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5Db250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZENvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpbkNvbnRhY3QgfHwgaGFzRW5kQ29udGFjdCkgewogICAgICAgIHRoaXMuYm9keU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gYWRkaXRpb25zLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSB0aGlzLmdldEJvZHlCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5Db250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5Db250YWN0RXZlbnQuYm9keUEgPSBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGlmIChoYXNFbmRDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQocmVtb3ZhbHNbaV0pOwogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGVuZENvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUEgPSBlbmRDb250YWN0RXZlbnQuYm9keUIgPSBudWxsOwogICAgICB9CgogICAgICBhZGRpdGlvbnMubGVuZ3RoID0gcmVtb3ZhbHMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgaGFzQmVnaW5TaGFwZUNvbnRhY3QgPSB0aGlzLmhhc0FueUV2ZW50TGlzdGVuZXIoJ2JlZ2luU2hhcGVDb250YWN0Jyk7CiAgICAgIGNvbnN0IGhhc0VuZFNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kU2hhcGVDb250YWN0Jyk7CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QgfHwgaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIuZ2V0RGlmZihhZGRpdGlvbnMsIHJlbW92YWxzKTsKICAgICAgfQoKICAgICAgaWYgKGhhc0JlZ2luU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaV0pOwogICAgICAgICAgY29uc3Qgc2hhcGVCID0gdGhpcy5nZXRTaGFwZUJ5SWQoYWRkaXRpb25zW2kgKyAxXSk7CiAgICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IHNoYXBlQTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IHNoYXBlQi5ib2R5OwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGJlZ2luU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZFNoYXBlQ29udGFjdCkgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gcmVtb3ZhbHMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBjb25zdCBzaGFwZUEgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChyZW1vdmFsc1tpICsgMV0pOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gc2hhcGVCOwogICAgICAgICAgaWYgKHNoYXBlQSkgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBzaGFwZUEuYm9keTsKICAgICAgICAgIGlmIChzaGFwZUIpIGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kU2hhcGVDb250YWN0RXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUEgPSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LnNoYXBlQiA9IG51bGw7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyBhbGwgYm9keSBmb3JjZXMgaW4gdGhlIHdvcmxkIHRvIHplcm8uCiAgICAgKi8KCgogICAgY2xlYXJGb3JjZXMoKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgIGIuZm9yY2U7CiAgICAgICAgYi50b3JxdWU7CiAgICAgICAgYi5mb3JjZS5zZXQoMCwgMCwgMCk7CiAgICAgICAgYi50b3JxdWUuc2V0KDAsIDAsIDApOwogICAgICB9CiAgICB9CgogIH0gLy8gVGVtcCBzdHVmZgoKICBuZXcgQUFCQigpOwogIGNvbnN0IHRtcFJheSA9IG5ldyBSYXkoKTsgLy8gcGVyZm9ybWFuY2Uubm93KCkgZmFsbGJhY2sgb24gRGF0ZS5ub3coKQoKICBjb25zdCBwZXJmb3JtYW5jZSA9IGdsb2JhbFRoaXMucGVyZm9ybWFuY2UgfHwge307CgogIGlmICghcGVyZm9ybWFuY2Uubm93KSB7CiAgICBsZXQgbm93T2Zmc2V0ID0gRGF0ZS5ub3coKTsKCiAgICBpZiAocGVyZm9ybWFuY2UudGltaW5nICYmIHBlcmZvcm1hbmNlLnRpbWluZy5uYXZpZ2F0aW9uU3RhcnQpIHsKICAgICAgbm93T2Zmc2V0ID0gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydDsKICAgIH0KCiAgICBwZXJmb3JtYW5jZS5ub3cgPSAoKSA9PiBEYXRlLm5vdygpIC0gbm93T2Zmc2V0OwogIH0KCiAgbmV3IFZlYzMoKTsgLy8gRGlzcGF0Y2hlZCBhZnRlciB0aGUgd29ybGQgaGFzIHN0ZXBwZWQgZm9yd2FyZCBpbiB0aW1lLgogIC8vIFJldXNhYmxlIGV2ZW50IG9iamVjdHMgdG8gc2F2ZSBtZW1vcnkuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcG9zdFN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwb3N0U3RlcCcKICB9OyAvLyBEaXNwYXRjaGVkIGJlZm9yZSB0aGUgd29ybGQgc3RlcHMgZm9yd2FyZCBpbiB0aW1lLgoKICBjb25zdCBXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCA9IHsKICAgIHR5cGU6ICdwcmVTdGVwJwogIH07CiAgY29uc3QgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQgPSB7CiAgICB0eXBlOiBCb2R5LkNPTExJREVfRVZFTlRfTkFNRSwKICAgIGJvZHk6IG51bGwsCiAgICBjb250YWN0OiBudWxsCiAgfTsgLy8gUG9vbHMgZm9yIHVudXNlZCBvYmplY3RzCgogIGNvbnN0IFdvcmxkX3N0ZXBfb2xkQ29udGFjdHMgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX2ZyaWN0aW9uRXF1YXRpb25Qb29sID0gW107IC8vIFJldXNhYmxlIGFycmF5cyBmb3IgY29sbGlzaW9uIHBhaXJzCgogIGNvbnN0IFdvcmxkX3N0ZXBfcDEgPSBbXTsKICBjb25zdCBXb3JsZF9zdGVwX3AyID0gW107IC8vIFN0dWZmIGZvciBlbWl0Q29udGFjdEV2ZW50cwoKICBjb25zdCBhZGRpdGlvbnMgPSBbXTsKICBjb25zdCByZW1vdmFscyA9IFtdOwogIGNvbnN0IGJlZ2luQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBlbmRDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsCiAgfTsKICBjb25zdCBiZWdpblNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2JlZ2luU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwogIGNvbnN0IGVuZFNoYXBlQ29udGFjdEV2ZW50ID0gewogICAgdHlwZTogJ2VuZFNoYXBlQ29udGFjdCcsCiAgICBib2R5QTogbnVsbCwKICAgIGJvZHlCOiBudWxsLAogICAgc2hhcGVBOiBudWxsLAogICAgc2hhcGVCOiBudWxsCiAgfTsKCiAgY29uc3QgYWRkQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjcmVhdGVNYXRlcmlhbCwgX3JlZiwgdXVpZCkgPT4gewogICAgbGV0IFttYXRlcmlhbEEsIG1hdGVyaWFsQiwgb3B0aW9uc10gPSBfcmVmOwogICAgY29uc3QgbWF0QSA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsQSk7CiAgICBjb25zdCBtYXRCID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxCKTsKICAgIGNvbnN0IGNvbnRhY3RNYXRlcmlhbCA9IG5ldyBDb250YWN0TWF0ZXJpYWwobWF0QSwgbWF0Qiwgb3B0aW9ucyk7CiAgICBjb250YWN0TWF0ZXJpYWwudXVpZCA9IHV1aWQ7CiAgICB3b3JsZC5hZGRDb250YWN0TWF0ZXJpYWwoY29udGFjdE1hdGVyaWFsKTsKICB9OwogIGNvbnN0IHJlbW92ZUNvbnRhY3RNYXRlcmlhbCA9ICh3b3JsZCwgY21VVUlEKSA9PiB7CiAgICBjb25zdCBpbmRleCA9IHdvcmxkLmNvbnRhY3RtYXRlcmlhbHMuZmluZEluZGV4KF9yZWYyID0+IHsKICAgICAgbGV0IHsKICAgICAgICB1dWlkCiAgICAgIH0gPSBfcmVmMjsKICAgICAgcmV0dXJuIHV1aWQgPT09IGNtVVVJRDsKICAgIH0pOwogICAgY29uc3QgW3sKICAgICAgaWQ6IGkKICAgIH0sIHsKICAgICAgaWQ6IGoKICAgIH1dID0gd29ybGQuY29udGFjdG1hdGVyaWFsc1tpbmRleF0ubWF0ZXJpYWxzOwogICAgd29ybGQuY29udGFjdG1hdGVyaWFscy5zcGxpY2UoaW5kZXgsIDEpOwogICAgZGVsZXRlIHdvcmxkLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRhdGFbaSA8IGogPyBgJHtpfS0ke2p9YCA6IGAke2p9LSR7aX1gXTsKICB9OwoKICBsZXQgbWF0ZXJpYWxJZCA9IDA7CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWxGYWN0b3J5ID0gbWF0ZXJpYWxzID0+IGZ1bmN0aW9uIChuYW1lT3JPcHRpb25zKSB7CiAgICBpZiAobmFtZU9yT3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgIG5hbWVPck9wdGlvbnMgPSB7fTsKICAgIH0KCiAgICBjb25zdCBtYXRlcmlhbE9wdGlvbnMgPSB0eXBlb2YgbmFtZU9yT3B0aW9ucyA9PT0gJ3N0cmluZycgPyB7CiAgICAgIG5hbWU6IG5hbWVPck9wdGlvbnMKICAgIH0gOiB7CiAgICAgIG5hbWU6IFN5bWJvbC5mb3IoYE1hdGVyaWFsJHttYXRlcmlhbElkKyt9YCksCiAgICAgIC4uLm5hbWVPck9wdGlvbnMKICAgIH07CiAgICBjb25zdCB7CiAgICAgIG5hbWUKICAgIH0gPSBtYXRlcmlhbE9wdGlvbnM7CiAgICBtYXRlcmlhbHNbbmFtZV0gPSBtYXRlcmlhbHNbbmFtZV0gfHwgbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucyk7CiAgICByZXR1cm4gbWF0ZXJpYWxzW25hbWVdOwogIH07CgogIC8qKgogICAqIEB0eXBlZGVmIHsgaW1wb3J0KCdjYW5ub24tZXMnKS5NYXRlcmlhbE9wdGlvbnMgfSBNYXRlcmlhbE9wdGlvbnMKICAgKi8KCiAgY29uc3QgbWFrZVZlYzMgPSBfcmVmID0+IHsKICAgIGxldCBbeCwgeSwgel0gPSBfcmVmOwogICAgcmV0dXJuIG5ldyBWZWMzKHgsIHksIHopOwogIH07CgogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwoKICBjb25zdCBwcmVwYXJlQ29udmV4UG9seWhlZHJvbiA9IF9yZWYyID0+IHsKICAgIGxldCBbdiwgZmFjZXMsIG4sIGEsIGJvdW5kaW5nU3BoZXJlUmFkaXVzXSA9IF9yZWYyOwogICAgcmV0dXJuIFt7CiAgICAgIGF4ZXM6IGEgPyBhLm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQsCiAgICAgIGJvdW5kaW5nU3BoZXJlUmFkaXVzLAogICAgICBmYWNlcywKICAgICAgbm9ybWFsczogbiA/IG4ubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgdmVydGljZXM6IHYgPyB2Lm1hcChtYWtlVmVjMykgOiB1bmRlZmluZWQKICAgIH1dOwogIH07CgogIGZ1bmN0aW9uIGNyZWF0ZVNoYXBlKHR5cGUsIGFyZ3MpIHsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdCb3gnOgogICAgICAgIHJldHVybiBuZXcgQm94KG5ldyBWZWMzKC4uLmFyZ3MubWFwKHYgPT4gdiAvIDIpKSk7CiAgICAgIC8vIGV4dGVudHMgPT4gaGFsZkV4dGVudHMKCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CgogICAgICBjYXNlICdDeWxpbmRlcic6CiAgICAgICAgcmV0dXJuIG5ldyBDeWxpbmRlciguLi5hcmdzKTsKICAgICAgLy8gWyByYWRpdXNUb3AsIHJhZGl1c0JvdHRvbSwgaGVpZ2h0LCBudW1TZWdtZW50cyBdID0gYXJncwoKICAgICAgY2FzZSAnSGVpZ2h0ZmllbGQnOgogICAgICAgIHJldHVybiBuZXcgSGVpZ2h0ZmllbGQoLi4uYXJncyk7CiAgICAgIC8vIFsgQXJyYXkgZGF0YSwgb3B0aW9uczoge21pblZhbHVlLCBtYXhWYWx1ZSwgZWxlbWVudFNpemV9ICBdID0gYXJncwoKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwoKICAgICAgY2FzZSAnUGxhbmUnOgogICAgICAgIHJldHVybiBuZXcgUGxhbmUoKTsKICAgICAgLy8gbm8gYXJncywgaW5maW5pdGUgeCBhbmQgeQoKICAgICAgY2FzZSAnU3BoZXJlJzoKICAgICAgICByZXR1cm4gbmV3IFNwaGVyZSguLi5wcmVwYXJlU3BoZXJlKGFyZ3MpKTsKICAgICAgLy8gcmFkaXVzID0gYXJncwoKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KCgogIGNvbnN0IHByb3BzVG9Cb2R5ID0gb3B0aW9ucyA9PiB7CiAgICBjb25zdCB7CiAgICAgIHV1aWQsCiAgICAgIHByb3BzLAogICAgICB0eXBlLAogICAgICBjcmVhdGVNYXRlcmlhbCA9IG1hdGVyaWFsT3B0aW9ucyA9PiBuZXcgTWF0ZXJpYWwobWF0ZXJpYWxPcHRpb25zKQogICAgfSA9IG9wdGlvbnM7CiAgICBjb25zdCB7CiAgICAgIGFuZ3VsYXJGYWN0b3IgPSBbMSwgMSwgMV0sCiAgICAgIGFuZ3VsYXJWZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgYXJncyA9IFtdLAogICAgICBjb2xsaXNpb25SZXNwb25zZSwKICAgICAgbGluZWFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBtYXNzLAogICAgICBtYXRlcmlhbCwKICAgICAgb25Db2xsaWRlLAogICAgICBwb3NpdGlvbiA9IFswLCAwLCAwXSwKICAgICAgcm90YXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHNoYXBlcywKICAgICAgdHlwZTogYm9keVR5cGUsCiAgICAgIHZlbG9jaXR5ID0gWzAsIDAsIDBdLAogICAgICAuLi5leHRyYQogICAgfSA9IHByb3BzOwogICAgY29uc3QgYm9keSA9IG5ldyBCb2R5KHsgLi4uZXh0cmEsCiAgICAgIG1hc3M6IGJvZHlUeXBlID09PSAnU3RhdGljJyA/IDAgOiBtYXNzLAogICAgICBtYXRlcmlhbDogbWF0ZXJpYWwgPyBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbCkgOiB1bmRlZmluZWQsCiAgICAgIHR5cGU6IGJvZHlUeXBlID8gQm9keVtib2R5VHlwZS50b1VwcGVyQ2FzZSgpXSA6IHVuZGVmaW5lZAogICAgfSk7CiAgICBib2R5LnV1aWQgPSB1dWlkOwoKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KCiAgICBpZiAodHlwZSA9PT0gJ0NvbXBvdW5kJykgewogICAgICBzaGFwZXMuZm9yRWFjaChfcmVmMyA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBhcmdzLAogICAgICAgICAgcG9zaXRpb24sCiAgICAgICAgICByb3RhdGlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjM7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHJvdGF0aW9uID8gbmV3IFF1YXRlcm5pb24oKS5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pIDogdW5kZWZpbmVkKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQoKICAgIGJvZHkucG9zaXRpb24uc2V0KHBvc2l0aW9uWzBdLCBwb3NpdGlvblsxXSwgcG9zaXRpb25bMl0pOwogICAgYm9keS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihyb3RhdGlvblswXSwgcm90YXRpb25bMV0sIHJvdGF0aW9uWzJdKTsKICAgIGJvZHkudmVsb2NpdHkuc2V0KHZlbG9jaXR5WzBdLCB2ZWxvY2l0eVsxXSwgdmVsb2NpdHlbMl0pOwogICAgYm9keS5hbmd1bGFyVmVsb2NpdHkuc2V0KGFuZ3VsYXJWZWxvY2l0eVswXSwgYW5ndWxhclZlbG9jaXR5WzFdLCBhbmd1bGFyVmVsb2NpdHlbMl0pOwogICAgYm9keS5saW5lYXJGYWN0b3Iuc2V0KGxpbmVhckZhY3RvclswXSwgbGluZWFyRmFjdG9yWzFdLCBsaW5lYXJGYWN0b3JbMl0pOwogICAgYm9keS5hbmd1bGFyRmFjdG9yLnNldChhbmd1bGFyRmFjdG9yWzBdLCBhbmd1bGFyRmFjdG9yWzFdLCBhbmd1bGFyRmFjdG9yWzJdKTsKICAgIHJldHVybiBib2R5OwogIH07CgogIGNvbnN0IGFkZEJvZGllcyA9IChzdGF0ZSwgY3JlYXRlTWF0ZXJpYWwsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHByb3BzLAogICAgICB0eXBlLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKCiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnUG9pbnRUb1BvaW50JzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IFBvaW50VG9Qb2ludENvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgdHJpcGxldFRvVmVjMyhwaXZvdEEpLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB0cmlwbGV0VG9WZWMzKHBpdm90QiksIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0NvbmVUd2lzdCc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25lVHdpc3RDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGFuZ2xlLAogICAgICAgICAgYXhpc0E6IHRyaXBsZXRUb1ZlYzMoYXhpc0EpLAogICAgICAgICAgYXhpc0I6IHRyaXBsZXRUb1ZlYzMoYXhpc0IpLAogICAgICAgICAgY29sbGlkZUNvbm5lY3RlZCwKICAgICAgICAgIG1heEZvcmNlLAogICAgICAgICAgcGl2b3RBOiB0cmlwbGV0VG9WZWMzKHBpdm90QSksCiAgICAgICAgICBwaXZvdEI6IHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwKICAgICAgICAgIHR3aXN0QW5nbGUKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdEaXN0YW5jZSc6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBEaXN0YW5jZUNvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgZGlzdGFuY2UsIG1heEZvcmNlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ0xvY2snOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgTG9ja0NvbnN0cmFpbnQoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICAgICAgbWF4Rm9yY2UKICAgICAgICB9KTsKICAgICAgICBicmVhazsKCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KCiAgICBjb25zdHJhaW50LnV1aWQgPSB1dWlkOwogICAgc3RhdGUud29ybGQuYWRkQ29uc3RyYWludChjb25zdHJhaW50KTsKCiAgICBpZiAobWF4TXVsdGlwbGllciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnN0IHBvc3RTdGVwQ29uc3RyYWludCA9ICgpID0+IHsKICAgICAgICAvLyBUaGUgbXVsdGlwbGllciBpcyBwcm9wb3J0aW9uYWwgdG8gaG93IG11Y2ggZm9yY2UgaXMgYWRkZWQgdG8gdGhlIGJvZGllcyBieSB0aGUgY29uc3RyYWludC4KICAgICAgICAvLyBJZiB0aGlzIGV4Y2VlZHMgYSBsaW1pdCB0aGUgY29uc3RyYWludCBpcyBkaXNhYmxlZC4KICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gTWF0aC5hYnMoY29uc3RyYWludC5lcXVhdGlvbnNbMF0ubXVsdGlwbGllcik7CgogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgc3RhdGUuY29uc3RyYWludHNbdXVpZF0gPSBwb3N0U3RlcENvbnN0cmFpbnQ7CiAgICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuY29uc3RyYWludHNbdXVpZF0pOwogICAgfQogIH07CgogIGZ1bmN0aW9uIHRvVXBwZXJjYXNlKHN0cikgewogICAgcmV0dXJuIHN0ci50b1VwcGVyQ2FzZSgpOwogIH0KCiAgY29uc3QgYWRkUmF5ID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogewogICAgICAgIGZyb20sCiAgICAgICAgbW9kZSwKICAgICAgICB0bywKICAgICAgICAuLi5yYXlPcHRpb25zCiAgICAgIH0sCiAgICAgIHV1aWQKICAgIH0gPSBfcmVmOwogICAgY29uc3QgcmF5ID0gbmV3IFJheSh0cmlwbGV0VG9WZWMzKGZyb20pLCB0cmlwbGV0VG9WZWMzKHRvKSk7CiAgICBjb25zdCBvcHRpb25zID0gewogICAgICBtb2RlOiBSQVlfTU9ERVNbdG9VcHBlcmNhc2UobW9kZSldLAogICAgICByZXN1bHQ6IG5ldyBSYXljYXN0UmVzdWx0KCksCiAgICAgIC4uLnJheU9wdGlvbnMKICAgIH07CgogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7IC4uLnNoYXBlLAogICAgICAgICAgYm9keTogYm9keVVVSUQKICAgICAgICB9IDogbnVsbCwKICAgICAgICB0eXBlOiAncmF5aGl0JywKICAgICAgICAuLi5yZXN0CiAgICAgIH0pOwogICAgfTsKCiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdoZWVsSW5mb3MubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgewogICAgICAgIGF4bGVMb2NhbCwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwsCiAgICAgICAgZGlyZWN0aW9uTG9jYWwsCiAgICAgICAgLi4ucmVzdAogICAgICB9ID0gd2hlZWxJbmZvc1tpXTsKICAgICAgdmVoaWNsZS5hZGRXaGVlbCh7CiAgICAgICAgYXhsZUxvY2FsOiB0cmlwbGV0VG9WZWMzKGF4bGVMb2NhbCksCiAgICAgICAgY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsOiB0cmlwbGV0VG9WZWMzKGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IHRyaXBsZXRUb1ZlYzMoZGlyZWN0aW9uTG9jYWwpLAogICAgICAgIC4uLnJlc3QKICAgICAgfSk7CiAgICB9CgogICAgY29uc3QgcHJlU3RlcCA9ICgpID0+IHsKICAgICAgdmVoaWNsZS51cGRhdGVWZWhpY2xlKHN0YXRlLndvcmxkLmR0KTsKICAgIH07CgogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKCiAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdID0gewogICAgICBwb3N0U3RlcCwKICAgICAgcHJlU3RlcCwKICAgICAgdmVoaWNsZQogICAgfTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBwcmVTdGVwKTsKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgcG9zdFN0ZXApOwogIH07CgogIGNvbnN0IGFkZFNwcmluZyA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBkYW1waW5nLAogICAgICAgIGxvY2FsQW5jaG9yQSwKICAgICAgICBsb2NhbEFuY2hvckIsCiAgICAgICAgcmVzdExlbmd0aCwKICAgICAgICBzdGlmZm5lc3MsCiAgICAgICAgd29ybGRBbmNob3JBLAogICAgICAgIHdvcmxkQW5jaG9yQgogICAgICB9XSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBjb25zdCBzcHJpbmcgPSBuZXcgU3ByaW5nKHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgZGFtcGluZywKICAgICAgbG9jYWxBbmNob3JBOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQSksCiAgICAgIGxvY2FsQW5jaG9yQjogdHJpcGxldFRvVmVjMyhsb2NhbEFuY2hvckIpLAogICAgICByZXN0TGVuZ3RoLAogICAgICBzdGlmZm5lc3MsCiAgICAgIHdvcmxkQW5jaG9yQTogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckEpLAogICAgICB3b3JsZEFuY2hvckI6IHRyaXBsZXRUb1ZlYzMod29ybGRBbmNob3JCKQogICAgfSk7CiAgICBzcHJpbmcudXVpZCA9IHV1aWQ7CgogICAgY29uc3QgcG9zdFN0ZXBTcHJpbmcgPSAoKSA9PiBzcHJpbmcuYXBwbHlGb3JjZSgpOwoKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCgogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW3V1aWRdKTsKICB9OwoKICBmdW5jdGlvbiBlbWl0QmVnaW5Db250YWN0KF9yZWYpIHsKICAgIGxldCB7CiAgICAgIGJvZHlBLAogICAgICBib2R5QgogICAgfSA9IF9yZWY7CiAgICBpZiAoIShib2R5QSAhPSBudWxsICYmIGJvZHlBLnV1aWQpIHx8ICEoYm9keUIgIT0gbnVsbCAmJiBib2R5Qi51dWlkKSkgcmV0dXJuOwogICAgc2VsZi5wb3N0TWVzc2FnZSh7CiAgICAgIGJvZHlBOiBib2R5QS51dWlkLAogICAgICBib2R5QjogYm9keUIudXVpZCwKICAgICAgb3A6ICdldmVudCcsCiAgICAgIHR5cGU6ICdjb2xsaWRlQmVnaW4nCiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CgogIGNvbnN0IGluaXQgPSAod29ybGQsIF9yZWYzKSA9PiB7CiAgICBsZXQgewogICAgICBhbGxvd1NsZWVwLAogICAgICBheGlzSW5kZXggPSAwLAogICAgICBicm9hZHBoYXNlLAogICAgICBkZWZhdWx0Q29udGFjdE1hdGVyaWFsLAogICAgICBmcmljdGlvbkdyYXZpdHksCiAgICAgIGdyYXZpdHksCiAgICAgIGl0ZXJhdGlvbnMsCiAgICAgIHF1YXROb3JtYWxpemVGYXN0LAogICAgICBxdWF0Tm9ybWFsaXplU2tpcCwKICAgICAgc29sdmVyLAogICAgICB0b2xlcmFuY2UKICAgIH0gPSBfcmVmMzsKICAgIHdvcmxkLmFsbG93U2xlZXAgPSBhbGxvd1NsZWVwOwogICAgd29ybGQuZ3Jhdml0eS5zZXQoLi4uZ3Jhdml0eSk7CiAgICB3b3JsZC5mcmljdGlvbkdyYXZpdHkgPSBmcmljdGlvbkdyYXZpdHkgPyBuZXcgVmVjMyguLi5mcmljdGlvbkdyYXZpdHkpIDogdW5kZWZpbmVkOwogICAgd29ybGQucXVhdE5vcm1hbGl6ZUZhc3QgPSBxdWF0Tm9ybWFsaXplRmFzdDsKICAgIHdvcmxkLnF1YXROb3JtYWxpemVTa2lwID0gcXVhdE5vcm1hbGl6ZVNraXA7CgogICAgaWYgKHNvbHZlciA9PT0gJ1NwbGl0JykgewogICAgICB3b3JsZC5zb2x2ZXIgPSBuZXcgU3BsaXRTb2x2ZXIobmV3IEdTU29sdmVyKCkpOwogICAgfQoKICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CgogICAgd29ybGQuYnJvYWRwaGFzZSA9IGJyb2FkcGhhc2UgPT09ICdTQVAnID8gbmV3IFNBUEJyb2FkcGhhc2Uod29ybGQpIDogbmV3IE5haXZlQnJvYWRwaGFzZSgpOwoKICAgIGlmICh3b3JsZC5icm9hZHBoYXNlIGluc3RhbmNlb2YgU0FQQnJvYWRwaGFzZSkgewogICAgICB3b3JsZC5icm9hZHBoYXNlLmF4aXNJbmRleCA9IGF4aXNJbmRleDsKICAgIH0KCiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CgogIGNvbnN0IHN0ZXAgPSAoc3RhdGUsIF9yZWYpID0+IHsKICAgIGxldCB7CiAgICAgIHBvc2l0aW9ucywKICAgICAgcHJvcHM6IHsKICAgICAgICBtYXhTdWJTdGVwcywKICAgICAgICBzdGVwU2l6ZSwKICAgICAgICB0aW1lU2luY2VMYXN0Q2FsbGVkCiAgICAgIH0sCiAgICAgIHF1YXRlcm5pb25zCiAgICB9ID0gX3JlZjsKICAgIHN0YXRlLndvcmxkLnN0ZXAoc3RlcFNpemUsIHRpbWVTaW5jZUxhc3RDYWxsZWQsIG1heFN1YlN0ZXBzKTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0YXRlLndvcmxkLmJvZGllcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBjb25zdCBwID0gc3RhdGUud29ybGQuYm9kaWVzW2ldLnBvc2l0aW9uOwogICAgICBjb25zdCBxID0gc3RhdGUud29ybGQuYm9kaWVzW2ldLnF1YXRlcm5pb247CiAgICAgIHBvc2l0aW9uc1szICogaSArIDBdID0gcC54OwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAxXSA9IHAueTsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMl0gPSBwLno7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMF0gPSBxLng7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMV0gPSBxLnk7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgMl0gPSBxLno7CiAgICAgIHF1YXRlcm5pb25zWzQgKiBpICsgM10gPSBxLnc7CiAgICB9CgogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CgogICAgZm9yIChjb25zdCBpZCBvZiBPYmplY3Qua2V5cyhzdGF0ZS5zdWJzY3JpcHRpb25zKSkgewogICAgICBjb25zdCBbdXVpZCwgdHlwZSwgdGFyZ2V0ID0gJ2JvZGllcyddID0gc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF07CiAgICAgIGNvbnN0IHsKICAgICAgICBib2RpZXMsCiAgICAgICAgdmVoaWNsZXMKICAgICAgfSA9IHN0YXRlOwogICAgICBjb25zdCB2YWx1ZSA9IHRhcmdldCA9PT0gJ3ZlaGljbGVzJyA/IC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHZlaGljbGVzW3V1aWRdLnZlaGljbGVbdHlwZV0gOiAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IERpZmZlcmVudGlhdGUgdGhlc2UgInR5cGVzIgogICAgICBib2RpZXNbdXVpZF1bdHlwZV07CiAgICAgIGNvbnN0IHNlcmlhbGl6YWJsZVZhbHVlID0gaXNRb3JWKHZhbHVlKSA/IHZhbHVlLnRvQXJyYXkoKSA6IHZhbHVlOwogICAgICBvYnNlcnZhdGlvbnMucHVzaChbTnVtYmVyKGlkKSwgc2VyaWFsaXphYmxlVmFsdWUsIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIHR5cGVdKTsKICAgIH0KCiAgICBjb25zdCBtZXNzYWdlID0gewogICAgICBhY3RpdmU6IHN0YXRlLndvcmxkLmhhc0FjdGl2ZUJvZGllcywKICAgICAgb2JzZXJ2YXRpb25zLAogICAgICBvcDogJ2ZyYW1lJywKICAgICAgcG9zaXRpb25zLAogICAgICBxdWF0ZXJuaW9ucwogICAgfTsKCiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KCiAgICBzZWxmLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIFtwb3NpdGlvbnMuYnVmZmVyLCBxdWF0ZXJuaW9ucy5idWZmZXJdKTsKICB9OwoKICBjb25zdCBzdGF0ZSA9IHsKICAgIGJvZGllczoge30sCiAgICBib2RpZXNOZWVkU3luY2luZzogZmFsc2UsCiAgICBjb25zdHJhaW50czoge30sCiAgICBtYXRlcmlhbHM6IHt9LAogICAgcmF5czoge30sCiAgICBzcHJpbmdJbnN0YW5jZXM6IHt9LAogICAgc3ByaW5nczoge30sCiAgICBzdWJzY3JpcHRpb25zOiB7fSwKICAgIHZlaGljbGVzOiB7fSwKICAgIHdvcmxkOiBuZXcgV29ybGQoKQogIH07CgogIC8vLyA8cmVmZXJlbmNlIG5vLWRlZmF1bHQtbGliPSJ0cnVlIi8+CgogIGNvbnN0IGlzSGluZ2VDb25zdHJhaW50ID0gYyA9PiBjIGluc3RhbmNlb2YgSGluZ2VDb25zdHJhaW50OwoKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7IC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CgogIGNvbnN0IGJyb2FkcGhhc2VzID0gewogICAgTmFpdmVCcm9hZHBoYXNlLAogICAgU0FQQnJvYWRwaGFzZQogIH07CiAgY29uc3QgY3JlYXRlTWF0ZXJpYWwgPSBjcmVhdGVNYXRlcmlhbEZhY3Rvcnkoc3RhdGUubWF0ZXJpYWxzKTsKCiAgc2VsZi5vbm1lc3NhZ2UgPSBfcmVmID0+IHsKICAgIGxldCB7CiAgICAgIGRhdGEKICAgIH0gPSBfcmVmOwoKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3N0ZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0ZXAoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQm9kaWVzJzoKICAgICAgICB7CiAgICAgICAgICBhZGRCb2RpZXMoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhKTsKICAgICAgICAgIHN5bmNCb2RpZXMoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICB9CgogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGlkLAogICAgICAgICAgICB0YXJnZXQsCiAgICAgICAgICAgIHR5cGUKICAgICAgICAgIH0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUuc3Vic2NyaXB0aW9uc1tpZF0gPSBbZGF0YS51dWlkLCB0eXBlLCB0YXJnZXRdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5zdWJzY3JpcHRpb25zW2RhdGEucHJvcHNdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFF1YXRlcm5pb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnF1YXRlcm5pb24uc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0sIGRhdGEucHJvcHNbM10pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Um90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnF1YXRlcm5pb24uc2V0RnJvbUV1bGVyKGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJWZWxvY2l0eSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYW5ndWxhclZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldExpbmVhckZhY3Rvcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubGluZWFyRmFjdG9yLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0TWFzcyc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWFzcyA9IGRhdGEucHJvcHM7CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0udXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldE1hdGVyaWFsJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXRlcmlhbCA9IGRhdGEucHJvcHMgPyBjcmVhdGVNYXRlcmlhbChkYXRhLnByb3BzKSA6IG51bGw7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyRGFtcGluZyA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBbGxvd1NsZWVwJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbGxvd1NsZWVwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldFNsZWVwVGltZUxpbWl0JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcFRpbWVMaW1pdCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25GaWx0ZXJHcm91cCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb2xsaXNpb25SZXNwb25zZSc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uUmVzcG9uc2UgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0Rml4ZWRSb3RhdGlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uZml4ZWRSb3RhdGlvbiA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldElzVHJpZ2dlcic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uaXNUcmlnZ2VyID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldEdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmdyYXZpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRJdGVyYXRpb25zJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci5pdGVyYXRpb25zID0gZGF0YS5wcm9wczsKICAgICAgICB9CgogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnc2V0QnJvYWRwaGFzZSc6CiAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZSA9IG5ldyAoYnJvYWRwaGFzZXNbYCR7ZGF0YS5wcm9wc31Ccm9hZHBoYXNlYF0gfHwgTmFpdmVCcm9hZHBoYXNlKShzdGF0ZS53b3JsZCk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRBeGlzSW5kZXgnOgogICAgICAgIGlmIChzdGF0ZS53b3JsZC5icm9hZHBoYXNlIGluc3RhbmNlb2YgU0FQQnJvYWRwaGFzZSkgewogICAgICAgICAgc3RhdGUud29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBkYXRhLnByb3BzID09PSB1bmRlZmluZWQgfHwgZGF0YS5wcm9wcyA9PT0gbnVsbCA/IDAgOiBkYXRhLnByb3BzOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUZvcmNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdhcHBseUltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5SW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FwcGx5TG9jYWxJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsSW1wdWxzZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSwgbmV3IFZlYzMoLi4uZGF0YS5wcm9wc1sxXSkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYXBwbHlUb3JxdWUnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5VG9ycXVlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKF9yZWYyID0+IHsKICAgICAgICAgIGxldCB7CiAgICAgICAgICAgIHV1aWQKICAgICAgICAgIH0gPSBfcmVmMjsKICAgICAgICAgIHJldHVybiB1dWlkID09PSBkYXRhLnV1aWQ7CiAgICAgICAgfSkubWFwKGMgPT4gc3RhdGUud29ybGQucmVtb3ZlQ29uc3RyYWludChjKSk7CgogICAgICAgIGlmIChzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3N0U3RlcCcsIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLmNvbnN0cmFpbnRzW2RhdGEudXVpZF07CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2VuYWJsZUNvbnN0cmFpbnQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5tYXAoYyA9PiBjLmVuYWJsZSgpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2Rpc2FibGVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkubWFwKGMgPT4gYy5kaXNhYmxlKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnZGlzYWJsZUNvbnN0cmFpbnRNb3Rvcic6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5kaXNhYmxlTW90b3IoKSk7CiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICdzZXRDb25zdHJhaW50TW90b3JTcGVlZCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLmZpbHRlcihpc0hpbmdlQ29uc3RyYWludCkubWFwKGMgPT4gYy5zZXRNb3RvclNwZWVkKGRhdGEucHJvcHMpKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnYWRkU3ByaW5nJzoKICAgICAgICB7CiAgICAgICAgICBhZGRTcHJpbmcoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nU3RpZmZuZXNzJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5zdGlmZm5lc3MgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdzZXRTcHJpbmdEYW1waW5nJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5zcHJpbmdJbnN0YW5jZXNbZGF0YS51dWlkXS5kYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3JlbW92ZVNwcmluZyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5zcHJpbmdzW2RhdGEudXVpZF0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5JzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5yZW1vdmVFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5yYXlzW2RhdGEudXVpZF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhZGRSYXljYXN0VmVoaWNsZSc6CiAgICAgICAgewogICAgICAgICAgYWRkUmF5Y2FzdFZlaGljbGUoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgIGNhc2UgJ3NldFJheWNhc3RWZWhpY2xlU3RlZXJpbmdWYWx1ZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW3ZhbHVlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0U3RlZXJpbmdWYWx1ZSh2YWx1ZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2V0UmF5Y2FzdFZlaGljbGVCcmFrZSc6CiAgICAgICAgewogICAgICAgICAgY29uc3QgW2JyYWtlLCB3aGVlbEluZGV4XSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnZlaGljbGUuc2V0QnJha2UoYnJha2UsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnYWRkQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICBhZGRDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBkYXRhLnByb3BzLCBkYXRhLnV1aWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICBjYXNlICd3YWtlVXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLndha2VVcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgY2FzZSAnc2xlZXAnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICB9CiAgfTsKCn0pKCk7Cgo=",null,!1);class WL extends yL{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.postMessage({op:"setBroadphase",props:e})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(e){this.config.frictionGravity=e,this.postMessage({op:"setFrictionGravity",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.postMessage({op:"setTolerance",props:e})}constructor(e){let{allowSleep:t=!1,axisIndex:n=0,broadphase:s="Naive",defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:r=null,gravity:g=[0,-9.81,0],iterations:a=5,quatNormalizeFast:l=!1,quatNormalizeSkip:I=0,size:C=1e3,solver:u="GS",tolerance:A=.001}=e;super(),this.messageQueue=[],this.worker=null,this.config={allowSleep:t,axisIndex:n,broadphase:s,defaultContactMaterial:o,frictionGravity:r,gravity:g,iterations:a,quatNormalizeFast:l,quatNormalizeSkip:I,size:C,solver:u,tolerance:A},this.buffers={positions:new Float32Array(C*3),quaternions:new Float32Array(C*4)}}addBodies(e){let{props:t,type:n,uuid:s}=e;this.postMessage({op:"addBodies",props:t,type:n,uuid:s})}addConstraint(e){let{props:[t,n,s],type:o,uuid:r}=e;this.postMessage({op:"addConstraint",props:[t,n,s],type:o,uuid:r})}addContactMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"addContactMaterial",props:t,uuid:n})}addRay(e){let{props:t,uuid:n}=e;this.postMessage({op:"addRay",props:t,uuid:n})}addRaycastVehicle(e){let{props:[t,n,s,o,r,g],uuid:a}=e;this.postMessage({op:"addRaycastVehicle",props:[t,n,s,o,r,g],uuid:a})}addSpring(e){let{props:[t,n,s],uuid:o}=e;this.postMessage({op:"addSpring",props:[t,n,s],uuid:o})}applyForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyForce",props:t,uuid:n})}applyImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyImpulse",props:t,uuid:n})}applyLocalForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalForce",props:t,uuid:n})}applyLocalImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}applyTorque(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyTorque",props:t,uuid:n})}connect(){this.worker=new wL,this.worker.onmessage=e=>{if(e.data.op==="frame"){this.buffers.positions=e.data.positions,this.buffers.quaternions=e.data.quaternions,this.emit(e.data.op,e.data);return}this.emit(e.data.type,e.data)};for(const e of this.messageQueue)this.worker.postMessage(e);this.messageQueue.length=0}disableConstraint(e){let{uuid:t}=e;this.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"disableConstraintMotor",uuid:t})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(e){let{uuid:t}=e;this.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:s,frictionGravity:o,gravity:r,iterations:g,quatNormalizeFast:a,quatNormalizeSkip:l,solver:I,tolerance:C}=this.config;this.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:s,frictionGravity:o,gravity:r,iterations:g,quatNormalizeFast:a,quatNormalizeSkip:l,solver:I,tolerance:C}})}removeBodies(e){let{uuid:t}=e;this.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAllowSleep",props:t,uuid:n})}setAngularDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularDamping",props:t,uuid:n})}setAngularFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularFactor",props:t,uuid:n})}setAngularVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularVelocity",props:t,uuid:n})}setCollisionFilterGroup(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}setCollisionFilterMask(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}setCollisionResponse(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionResponse",props:t,uuid:n})}setConstraintMotorMaxForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}setConstraintMotorSpeed(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}setFixedRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setFixedRotation",props:t,uuid:n})}setIsTrigger(e){let{props:t,uuid:n}=e;this.postMessage({op:"setIsTrigger",props:t,uuid:n})}setLinearDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearDamping",props:t,uuid:n})}setLinearFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearFactor",props:t,uuid:n})}setMass(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMass",props:t,uuid:n})}setMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMaterial",props:t,uuid:n})}setPosition(e){let{props:t,uuid:n}=e;this.postMessage({op:"setPosition",props:t,uuid:n})}setQuaternion(e){let{props:[t,n,s,o],uuid:r}=e;this.postMessage({op:"setQuaternion",props:[t,n,s,o],uuid:r})}setRaycastVehicleBrake(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}setRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRotation",props:t,uuid:n})}setSleepSpeedLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}setSleepTimeLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}setSpringDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringDamping",props:t,uuid:n})}setSpringRestLength(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringRestLength",props:t,uuid:n})}setSpringStiffness(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringStiffness",props:t,uuid:n})}setUserData(e){let{props:t,uuid:n}=e;this.postMessage({op:"setUserData",props:t,uuid:n})}setVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setVelocity",props:t,uuid:n})}sleep(e){let{uuid:t}=e;this.postMessage({op:"sleep",uuid:t})}step(e){var t;const{buffers:{positions:n,quaternions:s}}=this;!n.byteLength&&!s.byteLength||(t=this.worker)==null||t.postMessage({op:"step",positions:n,props:e,quaternions:s},[n.buffer,s.buffer])}subscribe(e){let{props:{id:t,target:n,type:s},uuid:o}=e;this.postMessage({op:"subscribe",props:{id:t,target:n,type:s},uuid:o})}terminate(){var e;(e=this.worker)==null||e.terminate(),this.worker=null}unsubscribe(e){let{props:t}=e;this.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.postMessage({op:"wakeUp",uuid:t})}postMessage(e){if(this.worker)return this.worker.postMessage(e);this.messageQueue.push(e)}}class qo{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new J);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new J);const n=this.elements,s=e.x,o=e.y,r=e.z;return t.x=n[0]*s+n[1]*o+n[2]*r,t.y=n[3]*s+n[4]*o+n[5]*r,t.z=n[6]*s+n[7]*o+n[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new qo);const n=this.elements,s=e.elements,o=t.elements,r=n[0],g=n[1],a=n[2],l=n[3],I=n[4],C=n[5],u=n[6],A=n[7],h=n[8],m=s[0],b=s[1],G=s[2],f=s[3],y=s[4],B=s[5],v=s[6],W=s[7],R=s[8];return o[0]=r*m+g*f+a*v,o[1]=r*b+g*y+a*W,o[2]=r*G+g*B+a*R,o[3]=l*m+I*f+C*v,o[4]=l*b+I*y+C*W,o[5]=l*G+I*B+C*R,o[6]=u*m+A*f+h*v,o[7]=u*b+A*y+h*W,o[8]=u*G+A*B+h*R,t}scale(e,t){t===void 0&&(t=new qo);const n=this.elements,s=t.elements;for(let o=0;o!==3;o++)s[3*o+0]=e.x*n[3*o+0],s[3*o+1]=e.y*n[3*o+1],s[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new J);const n=3,s=4,o=[];let r,g;for(r=0;r<n*s;r++)o.push(0);for(r=0;r<3;r++)for(g=0;g<3;g++)o[r+s*g]=this.elements[r+3*g];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let a=3;const l=a;let I;const C=4;let u;do{if(r=l-a,o[r+s*r]===0){for(g=r+1;g<l;g++)if(o[r+s*g]!==0){I=C;do u=C-I,o[u+s*r]+=o[u+s*g];while(--I);break}}if(o[r+s*r]!==0)for(g=r+1;g<l;g++){const A=o[r+s*g]/o[r+s*r];I=C;do u=C-I,o[u+s*g]=u<=r?0:o[u+s*g]-o[u+s*r]*A;while(--I)}}while(--a);if(t.z=o[2*s+3]/o[2*s+2],t.y=(o[1*s+3]-o[1*s+2]*t.z)/o[1*s+1],t.x=(o[0*s+3]-o[0*s+2]*t.z-o[0*s+1]*t.y)/o[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new qo);const t=3,n=6,s=SL;let o,r;for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+n*r]=this.elements[o+3*r];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let g=3;const a=g;let l;const I=n;let C;do{if(o=a-g,s[o+n*o]===0){for(r=o+1;r<a;r++)if(s[o+n*r]!==0){l=I;do C=I-l,s[C+n*o]+=s[C+n*r];while(--l);break}}if(s[o+n*o]!==0)for(r=o+1;r<a;r++){const u=s[o+n*r]/s[o+n*o];l=I;do C=I-l,s[C+n*r]=C<=o?0:s[C+n*r]-s[C+n*o]*u;while(--l)}}while(--g);o=2;do{r=o-1;do{const u=s[o+n*r]/s[o+n*o];l=n;do C=n-l,s[C+n*r]=s[C+n*r]-s[C+n*o]*u;while(--l)}while(r--)}while(--o);o=2;do{const u=1/s[o+n*o];l=n;do C=n-l,s[C+n*o]=s[C+n*o]*u;while(--l)}while(o--);o=2;do{r=2;do{if(C=s[t+r+n*o],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,r,C)}while(r--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,o=e.w,r=t+t,g=n+n,a=s+s,l=t*r,I=t*g,C=t*a,u=n*g,A=n*a,h=s*a,m=o*r,b=o*g,G=o*a,f=this.elements;return f[3*0+0]=1-(u+h),f[3*0+1]=I-G,f[3*0+2]=C+b,f[3*1+0]=I+G,f[3*1+1]=1-(l+h),f[3*1+2]=A-m,f[3*2+0]=C-b,f[3*2+1]=A+m,f[3*2+2]=1-(l+u),this}transpose(e){e===void 0&&(e=new qo);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const SL=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class J{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new J);const n=e.x,s=e.y,o=e.z,r=this.x,g=this.y,a=this.z;return t.x=g*o-a*s,t.y=a*n-r*o,t.z=r*s-g*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new J(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new J(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new qo([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const o=1/s;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new J);const t=this.x,n=this.y,s=this.z;let o=Math.sqrt(t*t+n*n+s*s);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=s*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,o=e.x,r=e.y,g=e.z;return Math.sqrt((o-t)*(o-t)+(r-n)*(r-n)+(g-s)*(g-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,o=e.x,r=e.y,g=e.z;return(o-t)*(o-t)+(r-n)*(r-n)+(g-s)*(g-s)}scale(e,t){t===void 0&&(t=new J);const n=this.x,s=this.y,o=this.z;return t.x=e*n,t.y=e*s,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new J),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new J),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new J),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=RL,o=1/n;s.set(this.x*o,this.y*o,this.z*o);const r=VL;Math.abs(s.x)<.9?(r.set(1,0,0),s.cross(r,e)):(r.set(0,1,0),s.cross(r,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,o=this.y,r=this.z;n.x=s+(e.x-s)*t,n.y=o+(e.y-o)*t,n.z=r+(e.z-r)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(xZ),xZ.almostEquals(e,t)}clone(){return new J(this.x,this.y,this.z)}}J.ZERO=new J(0,0,0);J.UNIT_X=new J(1,0,0);J.UNIT_Y=new J(0,1,0);J.UNIT_Z=new J(0,0,1);const RL=new J,VL=new J,xZ=new J;class vs{constructor(e){e===void 0&&(e={}),this.lowerBound=new J,this.upperBound=new J,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const o=this.lowerBound,r=this.upperBound,g=n;o.copy(e[0]),g&&g.vmult(o,o),r.copy(o);for(let a=1;a<e.length;a++){let l=e[a];g&&(g.vmult(l,XZ),l=XZ),l.x>r.x&&(r.x=l.x),l.x<o.x&&(o.x=l.x),l.y>r.y&&(r.y=l.y),l.y<o.y&&(o.y=l.y),l.z>r.z&&(r.z=l.z),l.z<o.z&&(o.z=l.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),s&&(o.x-=s,o.y-=s,o.z-=s,r.x+=s,r.y+=s,r.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new vs().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,o=e.upperBound,r=s.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,g=s.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,a=s.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return r&&g&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,o=e.upperBound;return t.x<=s.x&&n.x>=o.x&&t.y<=s.y&&n.y>=o.y&&t.z<=s.z&&n.z>=o.z}getCorners(e,t,n,s,o,r,g,a){const l=this.lowerBound,I=this.upperBound;e.copy(l),t.set(I.x,l.y,l.z),n.set(I.x,I.y,l.z),s.set(l.x,I.y,I.z),o.set(I.x,l.y,I.z),r.set(l.x,I.y,l.z),g.set(l.x,l.y,I.z),a.copy(I)}toLocalFrame(e,t){const n=YZ,s=n[0],o=n[1],r=n[2],g=n[3],a=n[4],l=n[5],I=n[6],C=n[7];this.getCorners(s,o,r,g,a,l,I,C);for(let u=0;u!==8;u++){const A=n[u];e.pointToLocal(A,A)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=YZ,s=n[0],o=n[1],r=n[2],g=n[3],a=n[4],l=n[5],I=n[6],C=n[7];this.getCorners(s,o,r,g,a,l,I,C);for(let u=0;u!==8;u++){const A=n[u];e.pointToWorld(A,A)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,o=1/t.y,r=1/t.z,g=(this.lowerBound.x-n.x)*s,a=(this.upperBound.x-n.x)*s,l=(this.lowerBound.y-n.y)*o,I=(this.upperBound.y-n.y)*o,C=(this.lowerBound.z-n.z)*r,u=(this.upperBound.z-n.z)*r,A=Math.max(Math.max(Math.min(g,a),Math.min(l,I)),Math.min(C,u)),h=Math.min(Math.min(Math.max(g,a),Math.max(l,I)),Math.max(C,u));return!(h<0||A>h)}}const XZ=new J,YZ=[new J,new J,new J,new J,new J,new J,new J,new J];class wi{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new J),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=xL,s=XL;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new wi);const n=this.x,s=this.y,o=this.z,r=this.w,g=e.x,a=e.y,l=e.z,I=e.w;return t.x=n*I+r*g+s*l-o*a,t.y=s*I+r*a+o*g-n*l,t.z=o*I+r*l+n*a-s*g,t.w=r*I-n*g-s*a-o*l,t}inverse(e){e===void 0&&(e=new wi);const t=this.x,n=this.y,s=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+n*n+s*s+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return e===void 0&&(e=new wi),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new J);const n=e.x,s=e.y,o=e.z,r=this.x,g=this.y,a=this.z,l=this.w,I=l*n+g*o-a*s,C=l*s+a*n-r*o,u=l*o+r*s-g*n,A=-r*n-g*s-a*o;return t.x=I*l+A*-r+C*-a-u*-g,t.y=C*l+A*-g+u*-r-I*-a,t.z=u*l+A*-a+I*-g-C*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,s,o;const r=this.x,g=this.y,a=this.z,l=this.w;switch(t){case"YZX":const I=r*g+a*l;if(I>.499&&(n=2*Math.atan2(r,l),s=Math.PI/2,o=0),I<-.499&&(n=-2*Math.atan2(r,l),s=-Math.PI/2,o=0),n===void 0){const C=r*r,u=g*g,A=a*a;n=Math.atan2(2*g*l-2*r*a,1-2*u-2*A),s=Math.asin(2*I),o=Math.atan2(2*r*l-2*g*a,1-2*C-2*A)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=s,e.x=o}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const o=Math.cos(e/2),r=Math.cos(t/2),g=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),I=Math.sin(n/2);return s==="XYZ"?(this.x=a*r*g+o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g-a*l*I):s==="YXZ"?(this.x=a*r*g+o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g+a*l*I):s==="ZXY"?(this.x=a*r*g-o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g-a*l*I):s==="ZYX"?(this.x=a*r*g-o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g+a*l*I):s==="YZX"?(this.x=a*r*g+o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g-a*l*I):s==="XZY"&&(this.x=a*r*g-o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g+a*l*I),this}clone(){return new wi(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new wi);const s=this.x,o=this.y,r=this.z,g=this.w;let a=e.x,l=e.y,I=e.z,C=e.w,u,A,h,m,b;return A=s*a+o*l+r*I+g*C,A<0&&(A=-A,a=-a,l=-l,I=-I,C=-C),1-A>1e-6?(u=Math.acos(A),h=Math.sin(u),m=Math.sin((1-t)*u)/h,b=Math.sin(t*u)/h):(m=1-t,b=t),n.x=m*s+b*a,n.y=m*o+b*l,n.z=m*r+b*I,n.w=m*g+b*C,n}integrate(e,t,n,s){s===void 0&&(s=new wi);const o=e.x*n.x,r=e.y*n.y,g=e.z*n.z,a=this.x,l=this.y,I=this.z,C=this.w,u=t*.5;return s.x+=u*(o*C+r*I-g*l),s.y+=u*(r*C+g*a-o*I),s.z+=u*(g*C+o*l-r*a),s.w+=u*(-o*a-r*l-g*I),s}}const xL=new J,XL=new J,YL={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class it{constructor(e){e===void 0&&(e={}),this.id=it.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}it.idCounter=0;it.types=YL;class ki{constructor(e){e===void 0&&(e={}),this.position=new J,this.quaternion=new wi,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return ki.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return ki.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new J),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new J),n.vsub(e,s),t.conjugate(HZ),HZ.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new J),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new J),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new J),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const HZ=new wi;new J;new J;new J;new J;new J,new J,new J,new J,new J,new J,new J,new J;new J;new wi;new vs;new qo;new qo;new qo;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new wi;new J;new J;new J;new J;class f0{constructor(){this.rayFromWorld=new J,this.rayToWorld=new J,this.hitNormalWorld=new J,this.hitPointWorld=new J,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,o,r,g){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=o,this.body=r,this.distance=g}}let zR,kR,TR,ER,_R,JR,UR;const AG={CLOSEST:1,ANY:2,ALL:4};zR=it.types.SPHERE;kR=it.types.PLANE;TR=it.types.BOX;ER=it.types.CYLINDER;_R=it.types.CONVEXPOLYHEDRON;JR=it.types.HEIGHTFIELD;UR=it.types.TRIMESH;class Ai{get[zR](){return this._intersectSphere}get[kR](){return this._intersectPlane}get[TR](){return this._intersectBox}get[ER](){return this._intersectConvex}get[_R](){return this._intersectConvex}get[JR](){return this._intersectHeightfield}get[UR](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new J),t===void 0&&(t=new J),this.from=e.clone(),this.to=t.clone(),this.direction=new J,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ai.ANY,this.result=new f0,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Ai.ANY,this.result=t.result||new f0,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(FZ),Rm.length=0,e.broadphase.aabbQuery(e,FZ,Rm),this.intersectBodies(Rm),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const s=HL,o=FL;for(let r=0,g=e.shapes.length;r<g;r++){const a=e.shapes[r];if(!(n&&!a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],s),s.vadd(e.position,s),this.intersectShape(a,o,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){const o=this.from;if(QL(o,this.direction,n)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,o)}_intersectPlane(e,t,n,s,o){const r=this.from,g=this.to,a=this.direction,l=new J(0,0,1);t.vmult(l,l);const I=new J;r.vsub(n,I);const C=I.dot(l);g.vsub(n,I);const u=I.dot(l);if(C*u>0||r.distanceTo(g)<C)return;const A=l.dot(a);if(Math.abs(A)<this.precision)return;const h=new J,m=new J,b=new J;r.vsub(n,h);const G=-l.dot(h)/A;a.scale(G,m),r.vadd(m,b),this.reportIntersection(l,b,o,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,o=this.from;t.x=Math.min(s.x,o.x),t.y=Math.min(s.y,o.y),t.z=Math.min(s.z,o.z),n.x=Math.max(s.x,o.x),n.y=Math.max(s.y,o.y),n.z=Math.max(s.z,o.z)}_intersectHeightfield(e,t,n,s,o){e.data,e.elementSize;const r=KL;r.from.copy(this.from),r.to.copy(this.to),ki.pointToLocalFrame(n,t,r.from,r.from),ki.pointToLocalFrame(n,t,r.to,r.to),r.updateDirection();const g=NL;let a,l,I,C;a=l=0,I=C=e.data.length-1;const u=new vs;r.getAABB(u),e.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,g,!0),a=Math.max(a,g[0]),l=Math.max(l,g[1]),e.getIndexOfPosition(u.upperBound.x,u.upperBound.y,g,!0),I=Math.min(I,g[0]+1),C=Math.min(C,g[1]+1);for(let A=a;A<I;A++)for(let h=l;h<C;h++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,h,u),!!u.overlapsRay(r)){if(e.getConvexTrianglePillar(A,h,!1),ki.pointToWorldFrame(n,t,e.pillarOffset,Wd),this._intersectConvex(e.pillarConvex,t,Wd,s,o,KZ),this.result.shouldStop)return;e.getConvexTrianglePillar(A,h,!0),ki.pointToWorldFrame(n,t,e.pillarOffset,Wd),this._intersectConvex(e.pillarConvex,t,Wd,s,o,KZ)}}}_intersectSphere(e,t,n,s,o){const r=this.from,g=this.to,a=e.radius,l=(g.x-r.x)**2+(g.y-r.y)**2+(g.z-r.z)**2,I=2*((g.x-r.x)*(r.x-n.x)+(g.y-r.y)*(r.y-n.y)+(g.z-r.z)*(r.z-n.z)),C=(r.x-n.x)**2+(r.y-n.y)**2+(r.z-n.z)**2-a**2,u=I**2-4*l*C,A=ML,h=LL;if(!(u<0))if(u===0)r.lerp(g,u,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1);else{const m=(-I-Math.sqrt(u))/(2*l),b=(-I+Math.sqrt(u))/(2*l);if(m>=0&&m<=1&&(r.lerp(g,m,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1)),this.result.shouldStop)return;b>=0&&b<=1&&(r.lerp(g,b,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1))}}_intersectConvex(e,t,n,s,o,r){const g=zL,a=NZ,l=r&&r.faceList||null,I=e.faces,C=e.vertices,u=e.faceNormals,A=this.direction,h=this.from,m=this.to,b=h.distanceTo(m),G=l?l.length:I.length,f=this.result;for(let y=0;!f.shouldStop&&y<G;y++){const B=l?l[y]:y,v=I[B],W=u[B],R=t,Z=n;a.copy(C[v[0]]),R.vmult(a,a),a.vadd(Z,a),a.vsub(h,a),R.vmult(W,g);const V=A.dot(g);if(Math.abs(V)<this.precision)continue;const H=g.dot(a)/V;if(!(H<0)){A.scale(H,Li),Li.vadd(h,Li),Ns.copy(C[v[0]]),R.vmult(Ns,Ns),Z.vadd(Ns,Ns);for(let P=1;!f.shouldStop&&P<v.length-1;P++){go.copy(C[v[P]]),ao.copy(C[v[P+1]]),R.vmult(go,go),R.vmult(ao,ao),Z.vadd(go,go),Z.vadd(ao,ao);const E=Li.distanceTo(h);!(Ai.pointInTriangle(Li,Ns,go,ao)||Ai.pointInTriangle(Li,go,Ns,ao))||E>b||this.reportIntersection(g,Li,o,s,B)}}}}_intersectTrimesh(e,t,n,s,o,r){const g=kL,a=DL,l=PL,I=NZ,C=TL,u=EL,A=_L,h=UL,m=JL,b=e.indices;e.vertices;const G=this.from,f=this.to,y=this.direction;l.position.copy(n),l.quaternion.copy(t),ki.vectorToLocalFrame(n,t,y,C),ki.pointToLocalFrame(n,t,G,u),ki.pointToLocalFrame(n,t,f,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,A.vsub(u,C),C.normalize();const B=u.distanceSquared(A);e.tree.rayQuery(this,l,a);for(let v=0,W=a.length;!this.result.shouldStop&&v!==W;v++){const R=a[v];e.getNormal(R,g),e.getVertex(b[R*3],Ns),Ns.vsub(u,I);const Z=C.dot(g),V=g.dot(I)/Z;if(V<0)continue;C.scale(V,Li),Li.vadd(u,Li),e.getVertex(b[R*3+1],go),e.getVertex(b[R*3+2],ao);const H=Li.distanceSquared(u);!(Ai.pointInTriangle(Li,go,Ns,ao)||Ai.pointInTriangle(Li,Ns,go,ao))||H>B||(ki.vectorToWorldFrame(t,g,m),ki.pointToWorldFrame(n,t,Li,h),this.reportIntersection(m,h,o,s,R))}a.length=0}reportIntersection(e,t,n,s,o){const r=this.from,g=this.to,a=r.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case Ai.ALL:this.hasHit=!0,l.set(r,g,e,t,n,s,a),l.hasHit=!0,this.callback(l);break;case Ai.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,n,s,a));break;case Ai.ANY:this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,n,s,a),l.shouldStop=!0;break}}static pointInTriangle(e,t,n,s){s.vsub(t,ea),n.vsub(t,gc),e.vsub(t,Vm);const o=ea.dot(ea),r=ea.dot(gc),g=ea.dot(Vm),a=gc.dot(gc),l=gc.dot(Vm);let I,C;return(I=a*g-r*l)>=0&&(C=o*l-r*g)>=0&&I+C<o*a-r*r}}Ai.CLOSEST=AG.CLOSEST;Ai.ANY=AG.ANY;Ai.ALL=AG.ALL;const FZ=new vs,Rm=[],gc=new J,Vm=new J,HL=new J,FL=new wi,Li=new J,Ns=new J,go=new J,ao=new J;new J;new f0;const KZ={faceList:[0]},Wd=new J,KL=new Ai,NL=[],ML=new J,LL=new J,zL=new J;new J;new J;const NZ=new J,kL=new J,TL=new J,EL=new J,_L=new J,JL=new J,UL=new J;new vs;const DL=[],PL=new ki,ea=new J,Sd=new J;function QL(i,e,t){t.vsub(i,ea);const n=ea.dot(e);return e.scale(n,Sd),Sd.vadd(i,Sd),t.distanceTo(Sd)}new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new Ai;new J;new J;new J;new J(1,0,0),new J(0,1,0),new J(0,0,1);new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new vs;new J;new vs;new J;new J;new J;new J;new J;new J;new J;new vs;new J;new ki;new vs;it.types.SPHERE,it.types.SPHERE|it.types.PLANE,it.types.BOX|it.types.BOX,it.types.SPHERE|it.types.BOX,it.types.PLANE|it.types.BOX,it.types.CONVEXPOLYHEDRON,it.types.SPHERE|it.types.CONVEXPOLYHEDRON,it.types.PLANE|it.types.CONVEXPOLYHEDRON,it.types.BOX|it.types.CONVEXPOLYHEDRON,it.types.SPHERE|it.types.HEIGHTFIELD,it.types.BOX|it.types.HEIGHTFIELD,it.types.CONVEXPOLYHEDRON|it.types.HEIGHTFIELD,it.types.PARTICLE|it.types.SPHERE,it.types.PLANE|it.types.PARTICLE,it.types.BOX|it.types.PARTICLE,it.types.PARTICLE|it.types.CONVEXPOLYHEDRON,it.types.CYLINDER,it.types.SPHERE|it.types.CYLINDER,it.types.PLANE|it.types.CYLINDER,it.types.BOX|it.types.CYLINDER,it.types.CONVEXPOLYHEDRON|it.types.CYLINDER,it.types.HEIGHTFIELD|it.types.CYLINDER,it.types.PARTICLE|it.types.CYLINDER,it.types.SPHERE|it.types.TRIMESH,it.types.PLANE|it.types.TRIMESH;new J;new J;new J;new J;new J;new wi;new wi;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new vs;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J,new J,new J,new J,new J,new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new wi;new J;new J;new J;new J;new J;new J;new J;new J;new J;new vs;new Ai;const ac=globalThis.performance||{};if(!ac.now){let i=Date.now();ac.timing&&ac.timing.navigationStart&&(i=ac.timing.navigationStart),ac.now=()=>Date.now()-i}new J;class $o{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new U);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new U);const n=this.elements,s=e.x,o=e.y,r=e.z;return t.x=n[0]*s+n[1]*o+n[2]*r,t.y=n[3]*s+n[4]*o+n[5]*r,t.z=n[6]*s+n[7]*o+n[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new $o);const n=this.elements,s=e.elements,o=t.elements,r=n[0],g=n[1],a=n[2],l=n[3],I=n[4],C=n[5],u=n[6],A=n[7],h=n[8],m=s[0],b=s[1],G=s[2],f=s[3],y=s[4],B=s[5],v=s[6],W=s[7],R=s[8];return o[0]=r*m+g*f+a*v,o[1]=r*b+g*y+a*W,o[2]=r*G+g*B+a*R,o[3]=l*m+I*f+C*v,o[4]=l*b+I*y+C*W,o[5]=l*G+I*B+C*R,o[6]=u*m+A*f+h*v,o[7]=u*b+A*y+h*W,o[8]=u*G+A*B+h*R,t}scale(e,t){t===void 0&&(t=new $o);const n=this.elements,s=t.elements;for(let o=0;o!==3;o++)s[3*o+0]=e.x*n[3*o+0],s[3*o+1]=e.y*n[3*o+1],s[3*o+2]=e.z*n[3*o+2];return t}solve(e,t){t===void 0&&(t=new U);const n=3,s=4,o=[];let r,g;for(r=0;r<n*s;r++)o.push(0);for(r=0;r<3;r++)for(g=0;g<3;g++)o[r+s*g]=this.elements[r+3*g];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let a=3;const l=a;let I;const C=4;let u;do{if(r=l-a,o[r+s*r]===0){for(g=r+1;g<l;g++)if(o[r+s*g]!==0){I=C;do u=C-I,o[u+s*r]+=o[u+s*g];while(--I);break}}if(o[r+s*r]!==0)for(g=r+1;g<l;g++){const A=o[r+s*g]/o[r+s*r];I=C;do u=C-I,o[u+s*g]=u<=r?0:o[u+s*g]-o[u+s*r]*A;while(--I)}}while(--a);if(t.z=o[2*s+3]/o[2*s+2],t.y=(o[1*s+3]-o[1*s+2]*t.z)/o[1*s+1],t.x=(o[0*s+3]-o[0*s+2]*t.z-o[0*s+1]*t.y)/o[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let n=0;n<9;n++)e+=this.elements[n]+t;return e}reverse(e){e===void 0&&(e=new $o);const t=3,n=6,s=OL;let o,r;for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+n*r]=this.elements[o+3*r];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let g=3;const a=g;let l;const I=n;let C;do{if(o=a-g,s[o+n*o]===0){for(r=o+1;r<a;r++)if(s[o+n*r]!==0){l=I;do C=I-l,s[C+n*o]+=s[C+n*r];while(--l);break}}if(s[o+n*o]!==0)for(r=o+1;r<a;r++){const u=s[o+n*r]/s[o+n*o];l=I;do C=I-l,s[C+n*r]=C<=o?0:s[C+n*r]-s[C+n*o]*u;while(--l)}}while(--g);o=2;do{r=o-1;do{const u=s[o+n*r]/s[o+n*o];l=n;do C=n-l,s[C+n*r]=s[C+n*r]-s[C+n*o]*u;while(--l)}while(r--)}while(--o);o=2;do{const u=1/s[o+n*o];l=n;do C=n-l,s[C+n*o]=s[C+n*o]*u;while(--l)}while(o--);o=2;do{r=2;do{if(C=s[t+r+n*o],isNaN(C)||C===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,r,C)}while(r--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,s=e.z,o=e.w,r=t+t,g=n+n,a=s+s,l=t*r,I=t*g,C=t*a,u=n*g,A=n*a,h=s*a,m=o*r,b=o*g,G=o*a,f=this.elements;return f[3*0+0]=1-(u+h),f[3*0+1]=I-G,f[3*0+2]=C+b,f[3*1+0]=I+G,f[3*1+1]=1-(l+h),f[3*1+2]=A-m,f[3*2+0]=C-b,f[3*2+1]=A+m,f[3*2+2]=1-(l+u),this}transpose(e){e===void 0&&(e=new $o);const t=this.elements,n=e.elements;let s;return n[0]=t[0],n[4]=t[4],n[8]=t[8],s=t[1],n[1]=t[3],n[3]=s,s=t[2],n[2]=t[6],n[6]=s,s=t[5],n[5]=t[7],n[7]=s,e}}const OL=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class U{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new U);const n=e.x,s=e.y,o=e.z,r=this.x,g=this.y,a=this.z;return t.x=g*o-a*s,t.y=a*n-r*o,t.z=r*s-g*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new U(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new U(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new $o([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,s=Math.sqrt(e*e+t*t+n*n);if(s>0){const o=1/s;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new U);const t=this.x,n=this.y,s=this.z;let o=Math.sqrt(t*t+n*n+s*s);return o>0?(o=1/o,e.x=t*o,e.y=n*o,e.z=s*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,s=this.z,o=e.x,r=e.y,g=e.z;return Math.sqrt((o-t)*(o-t)+(r-n)*(r-n)+(g-s)*(g-s))}distanceSquared(e){const t=this.x,n=this.y,s=this.z,o=e.x,r=e.y,g=e.z;return(o-t)*(o-t)+(r-n)*(r-n)+(g-s)*(g-s)}scale(e,t){t===void 0&&(t=new U);const n=this.x,s=this.y,o=this.z;return t.x=e*n,t.y=e*s,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new U),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new U),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new U),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const s=jL,o=1/n;s.set(this.x*o,this.y*o,this.z*o);const r=qL;Math.abs(s.x)<.9?(r.set(1,0,0),s.cross(r,e)):(r.set(0,1,0),s.cross(r,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const s=this.x,o=this.y,r=this.z;n.x=s+(e.x-s)*t,n.y=o+(e.y-o)*t,n.z=r+(e.z-r)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(MZ),MZ.almostEquals(e,t)}clone(){return new U(this.x,this.y,this.z)}}U.ZERO=new U(0,0,0);U.UNIT_X=new U(1,0,0);U.UNIT_Y=new U(0,1,0);U.UNIT_Z=new U(0,0,1);const jL=new U,qL=new U,MZ=new U;class Zs{constructor(e){e===void 0&&(e={}),this.lowerBound=new U,this.upperBound=new U,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,s){const o=this.lowerBound,r=this.upperBound,g=n;o.copy(e[0]),g&&g.vmult(o,o),r.copy(o);for(let a=1;a<e.length;a++){let l=e[a];g&&(g.vmult(l,LZ),l=LZ),l.x>r.x&&(r.x=l.x),l.x<o.x&&(o.x=l.x),l.y>r.y&&(r.y=l.y),l.y<o.y&&(o.y=l.y),l.z>r.z&&(r.z=l.z),l.z<o.z&&(o.z=l.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),s&&(o.x-=s,o.y-=s,o.z-=s,r.x+=s,r.y+=s,r.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Zs().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,o=e.upperBound,r=s.x<=n.x&&n.x<=o.x||t.x<=o.x&&o.x<=n.x,g=s.y<=n.y&&n.y<=o.y||t.y<=o.y&&o.y<=n.y,a=s.z<=n.z&&n.z<=o.z||t.z<=o.z&&o.z<=n.z;return r&&g&&a}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,s=e.lowerBound,o=e.upperBound;return t.x<=s.x&&n.x>=o.x&&t.y<=s.y&&n.y>=o.y&&t.z<=s.z&&n.z>=o.z}getCorners(e,t,n,s,o,r,g,a){const l=this.lowerBound,I=this.upperBound;e.copy(l),t.set(I.x,l.y,l.z),n.set(I.x,I.y,l.z),s.set(l.x,I.y,I.z),o.set(I.x,l.y,I.z),r.set(l.x,I.y,l.z),g.set(l.x,l.y,I.z),a.copy(I)}toLocalFrame(e,t){const n=zZ,s=n[0],o=n[1],r=n[2],g=n[3],a=n[4],l=n[5],I=n[6],C=n[7];this.getCorners(s,o,r,g,a,l,I,C);for(let u=0;u!==8;u++){const A=n[u];e.pointToLocal(A,A)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=zZ,s=n[0],o=n[1],r=n[2],g=n[3],a=n[4],l=n[5],I=n[6],C=n[7];this.getCorners(s,o,r,g,a,l,I,C);for(let u=0;u!==8;u++){const A=n[u];e.pointToWorld(A,A)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,s=1/t.x,o=1/t.y,r=1/t.z,g=(this.lowerBound.x-n.x)*s,a=(this.upperBound.x-n.x)*s,l=(this.lowerBound.y-n.y)*o,I=(this.upperBound.y-n.y)*o,C=(this.lowerBound.z-n.z)*r,u=(this.upperBound.z-n.z)*r,A=Math.max(Math.max(Math.min(g,a),Math.min(l,I)),Math.min(C,u)),h=Math.min(Math.min(Math.max(g,a),Math.max(l,I)),Math.max(C,u));return!(h<0||A>h)}}const LZ=new U,zZ=[new U,new U,new U,new U,new U,new U,new U,new U];class Wi{constructor(e,t,n,s){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=n,this.w=s}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new U),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=$L,s=ez;e.tangents(n,s),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Wi);const n=this.x,s=this.y,o=this.z,r=this.w,g=e.x,a=e.y,l=e.z,I=e.w;return t.x=n*I+r*g+s*l-o*a,t.y=s*I+r*a+o*g-n*l,t.z=o*I+r*l+n*a-s*g,t.w=r*I-n*g-s*a-o*l,t}inverse(e){e===void 0&&(e=new Wi);const t=this.x,n=this.y,s=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+n*n+s*s+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return e===void 0&&(e=new Wi),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new U);const n=e.x,s=e.y,o=e.z,r=this.x,g=this.y,a=this.z,l=this.w,I=l*n+g*o-a*s,C=l*s+a*n-r*o,u=l*o+r*s-g*n,A=-r*n-g*s-a*o;return t.x=I*l+A*-r+C*-a-u*-g,t.y=C*l+A*-g+u*-r-I*-a,t.z=u*l+A*-a+I*-g-C*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,s,o;const r=this.x,g=this.y,a=this.z,l=this.w;switch(t){case"YZX":const I=r*g+a*l;if(I>.499&&(n=2*Math.atan2(r,l),s=Math.PI/2,o=0),I<-.499&&(n=-2*Math.atan2(r,l),s=-Math.PI/2,o=0),n===void 0){const C=r*r,u=g*g,A=a*a;n=Math.atan2(2*g*l-2*r*a,1-2*u-2*A),s=Math.asin(2*I),o=Math.atan2(2*r*l-2*g*a,1-2*C-2*A)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=s,e.x=o}setFromEuler(e,t,n,s){s===void 0&&(s="XYZ");const o=Math.cos(e/2),r=Math.cos(t/2),g=Math.cos(n/2),a=Math.sin(e/2),l=Math.sin(t/2),I=Math.sin(n/2);return s==="XYZ"?(this.x=a*r*g+o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g-a*l*I):s==="YXZ"?(this.x=a*r*g+o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g+a*l*I):s==="ZXY"?(this.x=a*r*g-o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g-a*l*I):s==="ZYX"?(this.x=a*r*g-o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g+a*l*I):s==="YZX"?(this.x=a*r*g+o*l*I,this.y=o*l*g+a*r*I,this.z=o*r*I-a*l*g,this.w=o*r*g-a*l*I):s==="XZY"&&(this.x=a*r*g-o*l*I,this.y=o*l*g-a*r*I,this.z=o*r*I+a*l*g,this.w=o*r*g+a*l*I),this}clone(){return new Wi(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new Wi);const s=this.x,o=this.y,r=this.z,g=this.w;let a=e.x,l=e.y,I=e.z,C=e.w,u,A,h,m,b;return A=s*a+o*l+r*I+g*C,A<0&&(A=-A,a=-a,l=-l,I=-I,C=-C),1-A>1e-6?(u=Math.acos(A),h=Math.sin(u),m=Math.sin((1-t)*u)/h,b=Math.sin(t*u)/h):(m=1-t,b=t),n.x=m*s+b*a,n.y=m*o+b*l,n.z=m*r+b*I,n.w=m*g+b*C,n}integrate(e,t,n,s){s===void 0&&(s=new Wi);const o=e.x*n.x,r=e.y*n.y,g=e.z*n.z,a=this.x,l=this.y,I=this.z,C=this.w,u=t*.5;return s.x+=u*(o*C+r*I-g*l),s.y+=u*(r*C+g*a-o*I),s.z+=u*(g*C+o*l-r*a),s.w+=u*(-o*a-r*l-g*I),s}}const $L=new U,ez=new U,tz={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class st{constructor(e){e===void 0&&(e={}),this.id=st.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}st.idCounter=0;st.types=tz;class Ti{constructor(e){e===void 0&&(e={}),this.position=new U,this.quaternion=new Wi,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Ti.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Ti.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new U),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,s){return s===void 0&&(s=new U),n.vsub(e,s),t.conjugate(kZ),kZ.vmult(s,s),s}static pointToWorldFrame(e,t,n,s){return s===void 0&&(s=new U),t.vmult(n,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new U),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,s){return s===void 0&&(s=new U),t.w*=-1,t.vmult(n,s),t.w*=-1,s}}const kZ=new Wi;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U,new U,new U;new U;new Wi;new Zs;new $o;new $o;new $o;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Wi;new U;new U;new U;new U;class b0{constructor(){this.rayFromWorld=new U,this.rayToWorld=new U,this.hitNormalWorld=new U,this.hitPointWorld=new U,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,s,o,r,g){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(s),this.shape=o,this.body=r,this.distance=g}}let DR,PR,QR,OR,jR,qR,$R;const hG={CLOSEST:1,ANY:2,ALL:4};DR=st.types.SPHERE;PR=st.types.PLANE;QR=st.types.BOX;OR=st.types.CYLINDER;jR=st.types.CONVEXPOLYHEDRON;qR=st.types.HEIGHTFIELD;$R=st.types.TRIMESH;class hi{get[DR](){return this._intersectSphere}get[PR](){return this._intersectPlane}get[QR](){return this._intersectBox}get[OR](){return this._intersectConvex}get[jR](){return this._intersectConvex}get[qR](){return this._intersectHeightfield}get[$R](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new U),t===void 0&&(t=new U),this.from=e.clone(),this.to=t.clone(),this.direction=new U,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=hi.ANY,this.result=new b0,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||hi.ANY,this.result=t.result||new b0,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(TZ),xm.length=0,e.broadphase.aabbQuery(e,TZ,xm),this.intersectBodies(xm),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const s=nz,o=iz;for(let r=0,g=e.shapes.length;r<g;r++){const a=e.shapes[r];if(!(n&&!a.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],s),s.vadd(e.position,s),this.intersectShape(a,o,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,s=e.length;!this.result.shouldStop&&n<s;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,s){const o=this.from;if(pz(o,this.direction,n)>e.boundingSphereRadius)return;const g=this[e.type];g&&g.call(this,e,t,n,s,e)}_intersectBox(e,t,n,s,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,s,o)}_intersectPlane(e,t,n,s,o){const r=this.from,g=this.to,a=this.direction,l=new U(0,0,1);t.vmult(l,l);const I=new U;r.vsub(n,I);const C=I.dot(l);g.vsub(n,I);const u=I.dot(l);if(C*u>0||r.distanceTo(g)<C)return;const A=l.dot(a);if(Math.abs(A)<this.precision)return;const h=new U,m=new U,b=new U;r.vsub(n,h);const G=-l.dot(h)/A;a.scale(G,m),r.vadd(m,b),this.reportIntersection(l,b,o,s,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,s=this.to,o=this.from;t.x=Math.min(s.x,o.x),t.y=Math.min(s.y,o.y),t.z=Math.min(s.z,o.z),n.x=Math.max(s.x,o.x),n.y=Math.max(s.y,o.y),n.z=Math.max(s.z,o.z)}_intersectHeightfield(e,t,n,s,o){e.data,e.elementSize;const r=sz;r.from.copy(this.from),r.to.copy(this.to),Ti.pointToLocalFrame(n,t,r.from,r.from),Ti.pointToLocalFrame(n,t,r.to,r.to),r.updateDirection();const g=oz;let a,l,I,C;a=l=0,I=C=e.data.length-1;const u=new Zs;r.getAABB(u),e.getIndexOfPosition(u.lowerBound.x,u.lowerBound.y,g,!0),a=Math.max(a,g[0]),l=Math.max(l,g[1]),e.getIndexOfPosition(u.upperBound.x,u.upperBound.y,g,!0),I=Math.min(I,g[0]+1),C=Math.min(C,g[1]+1);for(let A=a;A<I;A++)for(let h=l;h<C;h++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(A,h,u),!!u.overlapsRay(r)){if(e.getConvexTrianglePillar(A,h,!1),Ti.pointToWorldFrame(n,t,e.pillarOffset,Rd),this._intersectConvex(e.pillarConvex,t,Rd,s,o,EZ),this.result.shouldStop)return;e.getConvexTrianglePillar(A,h,!0),Ti.pointToWorldFrame(n,t,e.pillarOffset,Rd),this._intersectConvex(e.pillarConvex,t,Rd,s,o,EZ)}}}_intersectSphere(e,t,n,s,o){const r=this.from,g=this.to,a=e.radius,l=(g.x-r.x)**2+(g.y-r.y)**2+(g.z-r.z)**2,I=2*((g.x-r.x)*(r.x-n.x)+(g.y-r.y)*(r.y-n.y)+(g.z-r.z)*(r.z-n.z)),C=(r.x-n.x)**2+(r.y-n.y)**2+(r.z-n.z)**2-a**2,u=I**2-4*l*C,A=rz,h=gz;if(!(u<0))if(u===0)r.lerp(g,u,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1);else{const m=(-I-Math.sqrt(u))/(2*l),b=(-I+Math.sqrt(u))/(2*l);if(m>=0&&m<=1&&(r.lerp(g,m,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1)),this.result.shouldStop)return;b>=0&&b<=1&&(r.lerp(g,b,A),A.vsub(n,h),h.normalize(),this.reportIntersection(h,A,o,s,-1))}}_intersectConvex(e,t,n,s,o,r){const g=az,a=_Z,l=r&&r.faceList||null,I=e.faces,C=e.vertices,u=e.faceNormals,A=this.direction,h=this.from,m=this.to,b=h.distanceTo(m),G=l?l.length:I.length,f=this.result;for(let y=0;!f.shouldStop&&y<G;y++){const B=l?l[y]:y,v=I[B],W=u[B],R=t,Z=n;a.copy(C[v[0]]),R.vmult(a,a),a.vadd(Z,a),a.vsub(h,a),R.vmult(W,g);const V=A.dot(g);if(Math.abs(V)<this.precision)continue;const H=g.dot(a)/V;if(!(H<0)){A.scale(H,zi),zi.vadd(h,zi),Ms.copy(C[v[0]]),R.vmult(Ms,Ms),Z.vadd(Ms,Ms);for(let P=1;!f.shouldStop&&P<v.length-1;P++){lo.copy(C[v[P]]),Io.copy(C[v[P+1]]),R.vmult(lo,lo),R.vmult(Io,Io),Z.vadd(lo,lo),Z.vadd(Io,Io);const E=zi.distanceTo(h);!(hi.pointInTriangle(zi,Ms,lo,Io)||hi.pointInTriangle(zi,lo,Ms,Io))||E>b||this.reportIntersection(g,zi,o,s,B)}}}}_intersectTrimesh(e,t,n,s,o,r){const g=lz,a=Az,l=hz,I=_Z,C=Iz,u=cz,A=Cz,h=dz,m=uz,b=e.indices;e.vertices;const G=this.from,f=this.to,y=this.direction;l.position.copy(n),l.quaternion.copy(t),Ti.vectorToLocalFrame(n,t,y,C),Ti.pointToLocalFrame(n,t,G,u),Ti.pointToLocalFrame(n,t,f,A),A.x*=e.scale.x,A.y*=e.scale.y,A.z*=e.scale.z,u.x*=e.scale.x,u.y*=e.scale.y,u.z*=e.scale.z,A.vsub(u,C),C.normalize();const B=u.distanceSquared(A);e.tree.rayQuery(this,l,a);for(let v=0,W=a.length;!this.result.shouldStop&&v!==W;v++){const R=a[v];e.getNormal(R,g),e.getVertex(b[R*3],Ms),Ms.vsub(u,I);const Z=C.dot(g),V=g.dot(I)/Z;if(V<0)continue;C.scale(V,zi),zi.vadd(u,zi),e.getVertex(b[R*3+1],lo),e.getVertex(b[R*3+2],Io);const H=zi.distanceSquared(u);!(hi.pointInTriangle(zi,lo,Ms,Io)||hi.pointInTriangle(zi,Ms,lo,Io))||H>B||(Ti.vectorToWorldFrame(t,g,m),Ti.pointToWorldFrame(n,t,zi,h),this.reportIntersection(m,h,o,s,R))}a.length=0}reportIntersection(e,t,n,s,o){const r=this.from,g=this.to,a=r.distanceTo(t),l=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(l.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case hi.ALL:this.hasHit=!0,l.set(r,g,e,t,n,s,a),l.hasHit=!0,this.callback(l);break;case hi.CLOSEST:(a<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,n,s,a));break;case hi.ANY:this.hasHit=!0,l.hasHit=!0,l.set(r,g,e,t,n,s,a),l.shouldStop=!0;break}}static pointInTriangle(e,t,n,s){s.vsub(t,ta),n.vsub(t,lc),e.vsub(t,Xm);const o=ta.dot(ta),r=ta.dot(lc),g=ta.dot(Xm),a=lc.dot(lc),l=lc.dot(Xm);let I,C;return(I=a*g-r*l)>=0&&(C=o*l-r*g)>=0&&I+C<o*a-r*r}}hi.CLOSEST=hG.CLOSEST;hi.ANY=hG.ANY;hi.ALL=hG.ALL;const TZ=new Zs,xm=[],lc=new U,Xm=new U,nz=new U,iz=new Wi,zi=new U,Ms=new U,lo=new U,Io=new U;new U;new b0;const EZ={faceList:[0]},Rd=new U,sz=new hi,oz=[],rz=new U,gz=new U,az=new U;new U;new U;const _Z=new U,lz=new U,Iz=new U,cz=new U,Cz=new U,uz=new U,dz=new U;new Zs;const Az=[],hz=new Ti,ta=new U,Vd=new U;function pz(i,e,t){t.vsub(i,ta);const n=ta.dot(e);return e.scale(n,Vd),Vd.vadd(i,Vd),t.distanceTo(Vd)}new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new hi;new U;new U;new U;new U(1,0,0),new U(0,1,0),new U(0,0,1);new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Zs;new U;new Zs;new U;new U;new U;new U;new U;new U;new U;new Zs;new U;new Ti;new Zs;st.types.SPHERE,st.types.SPHERE|st.types.PLANE,st.types.BOX|st.types.BOX,st.types.SPHERE|st.types.BOX,st.types.PLANE|st.types.BOX,st.types.CONVEXPOLYHEDRON,st.types.SPHERE|st.types.CONVEXPOLYHEDRON,st.types.PLANE|st.types.CONVEXPOLYHEDRON,st.types.BOX|st.types.CONVEXPOLYHEDRON,st.types.SPHERE|st.types.HEIGHTFIELD,st.types.BOX|st.types.HEIGHTFIELD,st.types.CONVEXPOLYHEDRON|st.types.HEIGHTFIELD,st.types.PARTICLE|st.types.SPHERE,st.types.PLANE|st.types.PARTICLE,st.types.BOX|st.types.PARTICLE,st.types.PARTICLE|st.types.CONVEXPOLYHEDRON,st.types.CYLINDER,st.types.SPHERE|st.types.CYLINDER,st.types.PLANE|st.types.CYLINDER,st.types.BOX|st.types.CYLINDER,st.types.CONVEXPOLYHEDRON|st.types.CYLINDER,st.types.HEIGHTFIELD|st.types.CYLINDER,st.types.PARTICLE|st.types.CYLINDER,st.types.SPHERE|st.types.TRIMESH,st.types.PLANE|st.types.TRIMESH;new U;new U;new U;new U;new U;new Wi;new Wi;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Zs;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Wi;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Zs;new hi;const Ic=globalThis.performance||{};if(!Ic.now){let i=Date.now();Ic.timing&&Ic.timing.navigationStart&&(i=Ic.timing.navigationStart),Ic.now=()=>Date.now()-i}new U;const mz=Je.exports.createContext(null),fz=()=>Je.exports.useContext(mz),eV=Je.exports.createContext(null),bz=()=>{const i=Je.exports.useContext(eV);if(!i)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return i};new Qn;new N(1,1,1);new N;new dt;const JZ=new St;function Gz(i){const e=Je.exports.useRef(null);return i&&typeof i!="function"?i:e}function UZ(i){return i.charAt(0).toUpperCase()+i.slice(1)}function ii(i,e){const t=e===void 0?"":`/${e}`;return typeof i=="function"?null:i&&i.current&&`${i.current.uuid}${t}`}const yz=new Wg,Bz=new Qn,vz=i=>e=>i(yz.setFromQuaternion(Bz.fromArray(e)).toArray());let tV=0;function Ym(i,e,t,n,s,o){return o===void 0&&(o="bodies"),r=>{const g=tV++;t[g]={[n]:r};const a=ii(i,s);return a&&e.subscribe({props:{id:g,target:o,type:n},uuid:a}),()=>{delete t[g],e.unsubscribe({props:g})}}}function DZ(i,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:s={}}=e;i.userData=s,i.position.set(...t),i.rotation.set(...n),i.updateMatrix()}function PZ(i,e,t){let{onCollide:n,onCollideBegin:s,onCollideEnd:o}=e;i[t]={collide:n,collideBegin:s,collideEnd:o}}function nV(i,e,t,n,s){n===void 0&&(n=null),s===void 0&&(s=[]);const o=Gz(n),{events:r,refs:g,scaleOverrides:a,subscriptions:l,worker:I}=bz(),C=fz();Je.exports.useLayoutEffect(()=>{o.current||(o.current=new St);const A=o.current,h=I,m=A instanceof Fl?(A.instanceMatrix.setUsage(uS),A.count):1,b=A instanceof Fl?new Array(m).fill(0).map((f,y)=>`${A.uuid}/${y}`):[A.uuid],G=A instanceof Fl?b.map((f,y)=>{const B=e(y);return DZ(JZ,B),A.setMatrixAt(y,JZ.matrix),A.instanceMatrix.needsUpdate=!0,g[f]=A,C==null||C.add(f,B,i),PZ(r,B,f),{...B,args:t(B.args)}}):b.map((f,y)=>{const B=e(y);return DZ(A,B),g[f]=A,C==null||C.add(f,B,i),PZ(r,B,f),{...B,args:t(B.args)}});return h.addBodies({props:G.map(f=>{let{onCollide:y,onCollideBegin:B,onCollideEnd:v,...W}=f;return{onCollide:Boolean(y),...W}}),type:i,uuid:b}),()=>{b.forEach(f=>{delete g[f],C==null||C.remove(f),delete r[f]}),h.removeBodies({uuid:b})}},s);const u=Je.exports.useMemo(()=>{const A=(y,B)=>{const v=`set${UZ(y)}`;return{set:W=>{const R=ii(o,B);R&&I[v]({props:W,uuid:R})},subscribe:Ym(o,I,l,y,B)}},h=y=>({copy:v=>{let{w:W,x:R,y:Z,z:V}=v;const H=ii(o,y);H&&I.setQuaternion({props:[R,Z,V,W],uuid:H})},set:(v,W,R,Z)=>{const V=ii(o,y);V&&I.setQuaternion({props:[v,W,R,Z],uuid:V})},subscribe:Ym(o,I,l,"quaternion",y)}),m=y=>({copy:B=>{let{x:v,y:W,z:R}=B;const Z=ii(o,y);Z&&I.setRotation({props:[v,W,R],uuid:Z})},set:(B,v,W)=>{const R=ii(o,y);R&&I.setRotation({props:[B,v,W],uuid:R})},subscribe:B=>{const v=tV++,W="bodies",R="quaternion",Z=ii(o,y);return l[v]={[R]:vz(B)},Z&&I.subscribe({props:{id:v,target:W,type:R},uuid:Z}),()=>{delete l[v],I.unsubscribe({props:v})}}}),b=(y,B)=>{const v=`set${UZ(y)}`;return{copy:W=>{let{x:R,y:Z,z:V}=W;const H=ii(o,B);H&&I[v]({props:[R,Z,V],uuid:H})},set:(W,R,Z)=>{const V=ii(o,B);V&&I[v]({props:[W,R,Z],uuid:V})},subscribe:Ym(o,I,l,y,B)}};function G(y){return{allowSleep:A("allowSleep",y),angularDamping:A("angularDamping",y),angularFactor:b("angularFactor",y),angularVelocity:b("angularVelocity",y),applyForce(B,v){const W=ii(o,y);W&&I.applyForce({props:[B,v],uuid:W})},applyImpulse(B,v){const W=ii(o,y);W&&I.applyImpulse({props:[B,v],uuid:W})},applyLocalForce(B,v){const W=ii(o,y);W&&I.applyLocalForce({props:[B,v],uuid:W})},applyLocalImpulse(B,v){const W=ii(o,y);W&&I.applyLocalImpulse({props:[B,v],uuid:W})},applyTorque(B){const v=ii(o,y);v&&I.applyTorque({props:[B],uuid:v})},collisionFilterGroup:A("collisionFilterGroup",y),collisionFilterMask:A("collisionFilterMask",y),collisionResponse:A("collisionResponse",y),fixedRotation:A("fixedRotation",y),isTrigger:A("isTrigger",y),linearDamping:A("linearDamping",y),linearFactor:b("linearFactor",y),mass:A("mass",y),material:A("material",y),position:b("position",y),quaternion:h(y),rotation:m(y),scaleOverride(B){const v=ii(o,y);v&&(a[v]=new N(...B))},sleep(){const B=ii(o,y);B&&I.sleep({uuid:B})},sleepSpeedLimit:A("sleepSpeedLimit",y),sleepTimeLimit:A("sleepTimeLimit",y),userData:A("userData",y),velocity:b("velocity",y),wakeUp(){const B=ii(o,y);B&&I.wakeUp({uuid:B})}}}const f={};return{...G(void 0),at:y=>f[y]||(f[y]=G(y))}},[]);return[o,u]}function Zz(i,e,t){return nV("Plane",i,()=>[],e,t)}function wz(i,e,t){return nV("Sphere",i,function(n){if(n===void 0&&(n=[1]),!Array.isArray(n))throw new Error("useSphere args must be an array");return[n[0]]},e,t)}const Wz=new N,Sz=new N(1,1,1),Rz=new Qn,xd=new dt;function QZ(i,e,t,n,s){return n===void 0&&(n=Sz),i!==void 0?(xd.compose(Wz.fromArray(e,i*3),Rz.fromArray(t,i*4),n),s&&(s.matrixAutoUpdate=!1,s.matrix.copy(xd)),xd):xd.identity()}function Vz(i){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:s,defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:r=null,gravity:g=[0,-9.81,0],isPaused:a=!1,iterations:l=5,maxSubSteps:I=10,quatNormalizeFast:C=!1,quatNormalizeSkip:u=0,shouldInvalidate:A=!0,size:h=1e3,solver:m="GS",stepSize:b=1/60,tolerance:G=.001}=i;const{invalidate:f}=Or(),[{bodies:y,events:B,refs:v,scaleOverrides:W,subscriptions:R,worker:Z}]=Je.exports.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new WL({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:o,frictionGravity:r,gravity:g,iterations:l,quatNormalizeFast:C,quatNormalizeSkip:u,size:h,solver:m,tolerance:G})}));let V=0;const H=Je.exports.useCallback((ne,k)=>{a||(V+=k,Z.step({maxSubSteps:I,stepSize:b,timeSinceLastCalled:V}),V=0)},[a,I,b]),P=ne=>{var k;let{body:F,contact:{bi:z,bj:X,...T},target:Q,...ee}=ne;const oe=(k=B[Q])==null?void 0:k.collide;oe&&oe({body:v[F],contact:{bi:v[z],bj:v[X],...T},target:v[Q],...ee})},E=ne=>{var k,F;let{bodyA:z,bodyB:X}=ne;const T=(k=B[z])==null?void 0:k.collideBegin;T&&T({body:v[X],op:"event",target:v[z],type:"collideBegin"});const Q=(F=B[X])==null?void 0:F.collideBegin;Q&&Q({body:v[z],op:"event",target:v[X],type:"collideBegin"})},L=ne=>{var k,F;let{bodyA:z,bodyB:X}=ne;const T=(k=B[z])==null?void 0:k.collideEnd;T&&T({body:v[X],op:"event",target:v[z],type:"collideEnd"});const Q=(F=B[X])==null?void 0:F.collideEnd;Q&&Q({body:v[z],op:"event",target:v[X],type:"collideEnd"})},K=ne=>{let{active:k,bodies:F=[],observations:z,positions:X,quaternions:T}=ne;for(let Q=0;Q<F.length;Q++)y[F[Q]]=Q;if(z.forEach(Q=>{let[ee,oe,j]=Q;const Ie=(R[ee]||{})[j];Ie&&Ie(oe)}),k){for(const Q of Object.values(v))if(Q instanceof Fl)for(let ee=0;ee<Q.count;ee++){const oe=`${Q.uuid}/${ee}`,j=y[oe];j!==void 0&&(Q.setMatrixAt(ee,QZ(j,X,T,W[oe])),Q.instanceMatrix.needsUpdate=!0)}else{const ee=W[Q.uuid]||Q.scale;QZ(y[Q.uuid],X,T,ee,Q)}A&&f()}},O=ne=>{var k;let{body:F,ray:{uuid:z,...X},...T}=ne;const Q=(k=B[z])==null?void 0:k.rayhit;Q&&Q({body:F?v[F]:null,ray:{uuid:z,...X},...T})};mR(H),Je.exports.useEffect(()=>(Z.connect(),Z.init(),Z.on("collide",P),Z.on("collideBegin",E),Z.on("collideEnd",L),Z.on("frame",K),Z.on("rayhit",O),()=>{Z.terminate(),Z.removeAllListeners()}),[]),Je.exports.useEffect(()=>{Z.axisIndex=t},[t]),Je.exports.useEffect(()=>{Z.broadphase=n},[n]),Je.exports.useEffect(()=>{Z.gravity=g},[g]),Je.exports.useEffect(()=>{Z.iterations=l},[l]),Je.exports.useEffect(()=>{Z.tolerance=G},[G]);const q=Je.exports.useMemo(()=>({bodies:y,events:B,refs:v,scaleOverrides:W,subscriptions:R,worker:Z}),[y,B,v,R,Z]);return Wt(eV.Provider,{value:q,children:s})}const Go=Object.create(null);Go.open="0";Go.close="1";Go.ping="2";Go.pong="3";Go.message="4";Go.upgrade="5";Go.noop="6";const nA=Object.create(null);Object.keys(Go).forEach(i=>{nA[Go[i]]=i});const xz={type:"error",data:"parser error"},Xz=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Yz=typeof ArrayBuffer=="function",Hz=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,iV=({type:i,data:e},t,n)=>Xz&&e instanceof Blob?t?n(e):OZ(e,n):Yz&&(e instanceof ArrayBuffer||Hz(e))?t?n(e):OZ(new Blob([e]),n):n(Go[i]+(e||"")),OZ=(i,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+n)},t.readAsDataURL(i)},jZ="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<jZ.length;i++)pc[jZ.charCodeAt(i)]=i;const Fz=i=>{let e=i.length*.75,t=i.length,n,s=0,o,r,g,a;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const l=new ArrayBuffer(e),I=new Uint8Array(l);for(n=0;n<t;n+=4)o=pc[i.charCodeAt(n)],r=pc[i.charCodeAt(n+1)],g=pc[i.charCodeAt(n+2)],a=pc[i.charCodeAt(n+3)],I[s++]=o<<2|r>>4,I[s++]=(r&15)<<4|g>>2,I[s++]=(g&3)<<6|a&63;return l},Kz=typeof ArrayBuffer=="function",sV=(i,e)=>{if(typeof i!="string")return{type:"message",data:oV(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:Nz(i.substring(1),e)}:nA[t]?i.length>1?{type:nA[t],data:i.substring(1)}:{type:nA[t]}:xz},Nz=(i,e)=>{if(Kz){const t=Fz(i);return oV(t,e)}else return{base64:!0,data:i}},oV=(i,e)=>{switch(e){case"blob":return i instanceof ArrayBuffer?new Blob([i]):i;case"arraybuffer":default:return i}},rV=String.fromCharCode(30),Mz=(i,e)=>{const t=i.length,n=new Array(t);let s=0;i.forEach((o,r)=>{iV(o,!1,g=>{n[r]=g,++s===t&&e(n.join(rV))})})},Lz=(i,e)=>{const t=i.split(rV),n=[];for(let s=0;s<t.length;s++){const o=sV(t[s],e);if(n.push(o),o.type==="error")break}return n},gV=4;function Fn(i){if(i)return zz(i)}function zz(i){for(var e in Fn.prototype)i[e]=Fn.prototype[e];return i}Fn.prototype.on=Fn.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};Fn.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};Fn.prototype.off=Fn.prototype.removeListener=Fn.prototype.removeAllListeners=Fn.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===e||n.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+i],this};Fn.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,e)}return this};Fn.prototype.emitReserved=Fn.prototype.emit;Fn.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};Fn.prototype.hasListeners=function(i){return!!this.listeners(i).length};const sg=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function aV(i,...e){return e.reduce((t,n)=>(i.hasOwnProperty(n)&&(t[n]=i[n]),t),{})}const kz=setTimeout,Tz=clearTimeout;function bh(i,e){e.useNativeTimers?(i.setTimeoutFn=kz.bind(sg),i.clearTimeoutFn=Tz.bind(sg)):(i.setTimeoutFn=setTimeout.bind(sg),i.clearTimeoutFn=clearTimeout.bind(sg))}const Ez=1.33;function _z(i){return typeof i=="string"?Jz(i):Math.ceil((i.byteLength||i.size)*Ez)}function Jz(i){let e=0,t=0;for(let n=0,s=i.length;n<s;n++)e=i.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}class Uz extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class lV extends Fn{constructor(e){super(),this.writable=!1,bh(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new Uz(e,t,n)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=sV(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const IV="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),G0=64,Dz={};let qZ=0,Xd=0,$Z;function e2(i){let e="";do e=IV[i%G0]+e,i=Math.floor(i/G0);while(i>0);return e}function cV(){const i=e2(+new Date);return i!==$Z?(qZ=0,$Z=i):i+"."+e2(qZ++)}for(;Xd<G0;Xd++)Dz[IV[Xd]]=Xd;function CV(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function Pz(i){let e={},t=i.split("&");for(let n=0,s=t.length;n<s;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}let uV=!1;try{uV=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Qz=uV;function dV(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Qz))return new XMLHttpRequest}catch{}if(!e)try{return new sg[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Oz(){}const jz=function(){return new dV({xdomain:!1}).responseType!=null}();class qz extends lV{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==n}const t=e&&e.forceBase64;this.supportsBinary=jz&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Lz(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Mz(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=cV()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.opts.port&&(t==="https"&&Number(this.opts.port)!==443||t==="http"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port);const s=CV(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new bo(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class bo extends Fn{constructor(e,t){super(),bh(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=t.async!==!1,this.data=t.data!==void 0?t.data:null,this.create()}create(){const e=aV(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new dV(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let n in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(n)&&t.setRequestHeader(n,this.opts.extraHeaders[n])}}catch{}if(this.method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{t.readyState===4&&(t.status===200||t.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof t.status=="number"?t.status:0)},0))},t.send(this.data)}catch(n){this.setTimeoutFn(()=>{this.onError(n)},0);return}typeof document<"u"&&(this.index=bo.requestsCount++,bo.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Oz,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete bo.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}bo.requestsCount=0;bo.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",t2);else if(typeof addEventListener=="function"){const i="onpagehide"in sg?"pagehide":"unload";addEventListener(i,t2,!1)}}function t2(){for(let i in bo.requests)bo.requests.hasOwnProperty(i)&&bo.requests[i].abort()}const $z=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Yd=sg.WebSocket||sg.MozWebSocket,n2=!0,ek="arraybuffer",i2=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class tk extends lV{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=i2?{}:aV(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=n2&&!i2?t?new Yd(e,t):new Yd(e):new Yd(e,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType||ek,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;iV(n,this.supportsBinary,o=>{const r={};try{n2&&this.ws.send(o)}catch{}s&&$z(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&(t==="wss"&&Number(this.opts.port)!==443||t==="ws"&&Number(this.opts.port)!==80)&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=cV()),this.supportsBinary||(e.b64=1);const s=CV(e),o=this.opts.hostname.indexOf(":")!==-1;return t+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(s.length?"?"+s:"")}check(){return!!Yd}}const nk={websocket:tk,polling:qz},ik=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,sk=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function y0(i){const e=i,t=i.indexOf("["),n=i.indexOf("]");t!=-1&&n!=-1&&(i=i.substring(0,t)+i.substring(t,n).replace(/:/g,";")+i.substring(n,i.length));let s=ik.exec(i||""),o={},r=14;for(;r--;)o[sk[r]]=s[r]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=ok(o,o.path),o.queryKey=rk(o,o.query),o}function ok(i,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.substr(0,1)=="/"||e.length===0)&&n.splice(0,1),e.substr(e.length-1,1)=="/"&&n.splice(n.length-1,1),n}function rk(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(t[s]=o)}),t}class jr extends Fn{constructor(e,t={}){super(),e&&typeof e=="object"&&(t=e,e=null),e?(e=y0(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=y0(t.host).host),bh(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=Pz(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=gV,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new nk[e](n)}open(){let e;if(this.opts.rememberUpgrade&&jr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;jr.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",C=>{if(!n)if(C.type==="pong"&&C.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;jr.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(I(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const u=new Error("probe error");u.transport=t.name,this.emitReserved("upgradeError",u)}}))};function o(){n||(n=!0,I(),t.close(),t=null)}const r=C=>{const u=new Error("probe error: "+C);u.transport=t.name,o(),this.emitReserved("upgradeError",u)};function g(){r("transport closed")}function a(){r("socket closed")}function l(C){t&&C.name!==t.name&&o()}const I=()=>{t.removeListener("open",s),t.removeListener("error",r),t.removeListener("close",g),this.off("close",a),this.off("upgrading",l)};t.once("open",s),t.once("error",r),t.once("close",g),this.once("close",a),this.once("upgrading",l),t.open()}onOpen(){if(this.readyState="open",jr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+=_z(s)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){jr.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}jr.protocol=gV;function gk(i,e="",t){let n=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),n=y0(i)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}const ak=typeof ArrayBuffer=="function",lk=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,AV=Object.prototype.toString,Ik=typeof Blob=="function"||typeof Blob<"u"&&AV.call(Blob)==="[object BlobConstructor]",ck=typeof File=="function"||typeof File<"u"&&AV.call(File)==="[object FileConstructor]";function pG(i){return ak&&(i instanceof ArrayBuffer||lk(i))||Ik&&i instanceof Blob||ck&&i instanceof File}function iA(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,n=i.length;t<n;t++)if(iA(i[t]))return!0;return!1}if(pG(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return iA(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&iA(i[t]))return!0;return!1}function Ck(i){const e=[],t=i.data,n=i;return n.data=B0(t,e),n.attachments=e.length,{packet:n,buffers:e}}function B0(i,e){if(!i)return i;if(pG(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let n=0;n<i.length;n++)t[n]=B0(i[n],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=B0(i[n],e));return t}return i}function uk(i,e){return i.data=v0(i.data,e),i.attachments=void 0,i}function v0(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=v0(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=v0(i[t],e));return i}const dk=5;var xt;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(xt||(xt={}));class Ak{constructor(e){this.replacer=e}encode(e){return(e.type===xt.EVENT||e.type===xt.ACK)&&iA(e)?(e.type=e.type===xt.EVENT?xt.BINARY_EVENT:xt.BINARY_ACK,this.encodeAsBinary(e)):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===xt.BINARY_EVENT||e.type===xt.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ck(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}class mG extends Fn{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===xt.BINARY_EVENT||t.type===xt.BINARY_ACK?(this.reconstructor=new hk(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(pG(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(xt[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===xt.BINARY_EVENT||n.type===xt.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const r=e.substring(o,t);if(r!=Number(r)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(r)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";const s=e.charAt(t+1);if(s!==""&&Number(s)==s){const o=t+1;for(;++t;){const r=e.charAt(t);if(r==null||Number(r)!=r){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(mG.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case xt.CONNECT:return typeof t=="object";case xt.DISCONNECT:return t===void 0;case xt.CONNECT_ERROR:return typeof t=="string"||typeof t=="object";case xt.EVENT:case xt.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case xt.ACK:case xt.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class hk{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=uk(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const pk=Object.freeze(Object.defineProperty({__proto__:null,protocol:dk,get PacketType(){return xt},Encoder:Ak,Decoder:mG},Symbol.toStringTag,{value:"Module"}));function ks(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const mk=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class hV extends Fn{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[ks(e,"open",this.onopen.bind(this)),ks(e,"packet",this.onpacket.bind(this)),ks(e,"error",this.onerror.bind(this)),ks(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(mk.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const n={type:xt.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const r=this.ids++,g=t.pop();this._registerAckCallback(r,g),n.id=r}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(n===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);t.call(this,new Error("operation has timed out"))},n);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(s),t.apply(this,[null,...o])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this.packet({type:xt.CONNECT,data:e})}):this.packet({type:xt.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case xt.CONNECT:if(e.data&&e.data.sid){const s=e.data.sid;this.onconnect(s)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case xt.EVENT:case xt.BINARY_EVENT:this.onevent(e);break;case xt.ACK:case xt.BINARY_ACK:this.onack(e);break;case xt.DISCONNECT:this.ondisconnect();break;case xt.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:xt.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:xt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function CI(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}CI.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};CI.prototype.reset=function(){this.attempts=0};CI.prototype.setMin=function(i){this.ms=i};CI.prototype.setMax=function(i){this.max=i};CI.prototype.setJitter=function(i){this.jitter=i};class Z0 extends Fn{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,bh(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new CI({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||pk;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new jr(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=ks(t,"open",function(){n.onopen(),e&&e()}),o=ks(t,"error",r=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",r),e?e(r):n.maybeReconnectOnOpen()});if(this._timeout!==!1){const r=this._timeout;r===0&&s();const g=this.setTimeoutFn(()=>{s(),t.close(),t.emit("error",new Error("timeout"))},r);this.opts.autoUnref&&g.unref(),this.subs.push(function(){clearTimeout(g)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(ks(e,"ping",this.onping.bind(this)),ks(e,"data",this.ondata.bind(this)),ks(e,"error",this.onerror.bind(this)),ks(e,"close",this.onclose.bind(this)),ks(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch{this.onclose("parse error")}}ondecoded(e){this.emitReserved("packet",e)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new hV(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(function(){clearTimeout(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const cc={};function sA(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=gk(i,e.path||"/socket.io"),n=t.source,s=t.id,o=t.path,r=cc[s]&&o in cc[s].nsps,g=e.forceNew||e["force new connection"]||e.multiplex===!1||r;let a;return g?a=new Z0(n,e):(cc[s]||(cc[s]=new Z0(n,e)),a=cc[s]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(sA,{Manager:Z0,Socket:hV,io:sA,connect:sA});const fk="/assets/emoji.a12e53c4.glb";function bk({id:i,...e}){const{nodes:t,materials:n}=mh(fk);return dg("group",{...e,dispose:null,children:[Wt("mesh",{geometry:t.smile_emoji005.geometry,material:n.smile,rotation:[0,.4,0],scale:.13}),Wt(CL,{position:[0,.2,0],rotation:[0,1.5,0],color:"orange",anchorX:"center",anchorY:"middle",fontSize:.03,children:i})]})}const Gk="/assets/axe.b1f7d305.glb",yk="/assets/grass.e89693ee.jpg",Bk=5,vk={KeyW:"forward",KeyS:"backward",KeyA:"left",KeyD:"right",Space:"jump"},s2=i=>vk[i],Hm=new N,o2=new N,r2=new N,Zk=new N,g2=new N,wk=({position:i,rotation:e,id:t})=>Wt(IG,{children:Wt(bk,{id:t,position:[i[0],i[1]-.5,i[2]],rotation:[0,e[1]-5,0]})});function Wk(){const[i,e]=Je.exports.useState({forward:!1,backward:!1,left:!1,right:!1,jump:!1});return Je.exports.useEffect(()=>{const t=s=>e(o=>({...o,[s2(s.code)]:!0})),n=s=>e(o=>({...o,[s2(s.code)]:!1}));return document.addEventListener("keydown",t),document.addEventListener("keyup",n),()=>(document.removeEventListener("keydown",t),document.removeEventListener("keyup",n))},[]),i}function Sk(){const[i,e]=Je.exports.useState(null),[t,n]=Je.exports.useState({});return Je.exports.useEffect(()=>(e(sA()),()=>{i&&i.disconnect()}),[]),Je.exports.useEffect(()=>{i&&i.on("move",s=>{n(s)})},[i]),i&&dg(LM,{shadows:!0,gl:{alpha:!1},camera:{fov:45},raycaster:{computeOffsets:s=>({offsetX:s.target.width/2,offsetY:s.target.height/2})},children:[Wt(AL,{sunPosition:[100,20,100]}),Wt("ambientLight",{intensity:.3}),dg(Je.exports.Suspense,{fallback:null,children:[Wt("pointLight",{castShadow:!0,intensity:.8,position:[100,100,100]}),dg(Vz,{gravity:[0,-30,0],children:[Wt(Rk,{}),Wt(xk,{socket:i}),Object.keys(t).filter(s=>s!==i.id).map(s=>{const{position:o,rotation:r}=t[s];return Wt(wk,{id:s,position:o,rotation:r},s)})]}),Wt(uL,{})]})]})}function Rk(i){const[e]=Zz(()=>({rotation:[-Math.PI/2,0,0],...i})),t=II(qb,yk);return t.wrapS=t.wrapT=gr,dg("mesh",{ref:e,receiveShadow:!0,children:[Wt("planeGeometry",{args:[1e3,1e3]}),Wt("meshStandardMaterial",{map:t,"map-repeat":[240,240],color:"green"})]})}function Vk({position:i,rotation:e,...t}){const n=Je.exports.useRef(),{nodes:s,materials:o}=mh(Gk);return Wt("group",{position:i,rotation:e,ref:n,dispose:null,...t,children:dg("group",{rotation:[0,Math.PI/1.8,-.3],scale:.5,children:[Wt("mesh",{geometry:s.Mesh_1001_1.geometry,material:o.material_2}),Wt("mesh",{geometry:s.Mesh_1001_2.geometry,material:o.material_3})]})})}function xk({socket:i,...e}){const t=Je.exports.useRef(),[n,s]=wz(()=>({mass:1,type:"Dynamic",position:[0,10,0],...e})),{forward:o,backward:r,left:g,right:a,jump:l}=Wk(),{camera:I}=Or(),C=Je.exports.useRef([0,0,0]);return mR(u=>{if(n.current.getWorldPosition(I.position),o2.set(0,0,Number(r)-Number(o)),r2.set(Number(g)-Number(a),0,0),Hm.subVectors(o2,r2).normalize().multiplyScalar(Bk).applyEuler(I.rotation),g2.fromArray(C.current),t.current.children[0].rotation.x=Vb.lerp(t.current.children[0].rotation.x,Math.sin((g2.length()>1)*u.clock.elapsedTime*10)/8,1),t.current.rotation.copy(I.rotation),t.current.position.copy(I.position).add(I.getWorldDirection(Zk).multiplyScalar(1)),s.velocity.set(Hm.x,C.current[1],Hm.z),l&&Math.abs(C.current[1].toFixed(2))<.05&&s.velocity.set(C.current[0],10,C.current[2]),i&&g||a||r||o||l||!l){I.rotation.order="YXZ";const A=t.current.rotation,h=I.position,{id:m}=i,b=[],G=[];h.toArray(b),A.toArray(G),i.emit("move",{id:m,rotation:G,position:b})}}),dg(IG,{children:[Wt("mesh",{ref:n}),Wt("group",{ref:t,onPointerMissed:u=>t.current.children[0].rotation.x=-.5,children:Wt(Vk,{position:[.15,-.35,.5]})})]})}function Xk(){const[i,e]=Je.exports.useState(!1);return dg(IG,{children:[Wt(Sk,{}),Wt("div",{className:"dot"}),Wt("div",{className:`fullscreen bg ${i?"ready":"notready"} ${i&&"clicked"}`,children:Wt("div",{className:"stack",children:Wt("button",{onClick:()=>e(!0),children:"Click (needs fullscreen)"})})})]})}lX.render(Wt(Xk,{}),document.getElementById("root"));
